(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();class ja{constructor(){this.scrollY=0,this.ticking=!1,this.mouseX=0,this.mouseY=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.init()}init(){window.matchMedia("(prefers-reduced-motion: reduce)").matches||this.windowWidth<=768||(this.bindEvents(),this.setupIntersectionObserver(),this.initParallaxElements(),this.startAnimationLoop())}bindEvents(){window.addEventListener("scroll",this.onScroll.bind(this),{passive:!0}),document.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),window.addEventListener("resize",this.onResize.bind(this),{passive:!0}),document.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0})}onScroll(){this.scrollY=window.pageYOffset,this.ticking||(requestAnimationFrame(this.updateParallax.bind(this)),this.ticking=!0)}onMouseMove(e){this.mouseX=e.clientX/this.windowWidth*2-1,this.mouseY=e.clientY/this.windowHeight*2-1,this.updateMouseParallax()}onTouchMove(e){if(e.touches.length>0){const a=e.touches[0];this.mouseX=a.clientX/this.windowWidth*2-1,this.mouseY=a.clientY/this.windowHeight*2-1,this.updateMouseParallax()}}onResize(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.windowWidth<=768?this.destroy():this.init()}updateParallax(){this.updateScrollParallax(),this.updateHeroParallax(),this.updateSectionParallax(),this.updateNavigationParallax(),this.ticking=!1}updateScrollParallax(){document.querySelectorAll(".scroll-parallax").forEach(a=>{const n=a.getBoundingClientRect(),o=a.dataset.parallaxSpeed||.5,s=-(this.scrollY*o);n.bottom>=0&&n.top<=this.windowHeight&&(a.style.transform=`translateY(${s}px)`)}),this.updateParallaxClass(".scroll-parallax-slow",.3),this.updateParallaxClass(".scroll-parallax-medium",.5),this.updateParallaxClass(".scroll-parallax-fast",.7)}updateParallaxClass(e,a){document.querySelectorAll(e).forEach(o=>{const s=o.getBoundingClientRect(),i=-(this.scrollY*a);s.bottom>=0&&s.top<=this.windowHeight&&(o.style.transform=`translateY(${i}px)`)})}updateHeroParallax(){const e=document.querySelector(".hero-background"),a=document.querySelector(".hero-particles"),n=document.querySelector(".hero-content");if(e){const o=this.scrollY*.5;e.style.transform=`translateY(${o}px)`}if(a){const o=this.scrollY*.3,s=Math.sin(this.scrollY*.001)*10;a.style.transform=`translateY(${o}px) translateX(${s}px)`}if(n){const o=this.scrollY*.1,s=1-this.scrollY*5e-4;n.style.transform=`translateY(${o}px) scale(${Math.max(s,.8)})`}}updateSectionParallax(){document.querySelectorAll(".section-parallax").forEach(a=>{const n=a.getBoundingClientRect(),o=a.querySelector(".section-parallax-bg"),s=a.querySelector(".section-parallax-content");if(n.bottom>=0&&n.top<=this.windowHeight){const i=(this.windowHeight-n.top)/(this.windowHeight+n.height);if(o){const r=i*100;o.style.transform=`translateY(${r}px)`}if(s){const r=i*50;s.style.transform=`translateY(${r}px)`}}})}updateNavigationParallax(){const e=document.querySelector(".nav-parallax");e&&(this.scrollY>100?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")))}updateMouseParallax(){document.querySelectorAll(".mouse-parallax").forEach(a=>{const n=a.dataset.mouseIntensity||20,o=this.mouseX*n,s=this.mouseY*n;a.style.transform=`translateX(${o}px) translateY(${s}px)`}),this.updateMouseParallaxLayers(),this.updateMagneticElements()}updateMouseParallaxLayers(){document.querySelectorAll(".mouse-parallax").forEach(a=>{const n=a.querySelector(".mouse-parallax-layer-1"),o=a.querySelector(".mouse-parallax-layer-2"),s=a.querySelector(".mouse-parallax-layer-3");if(n){const i=this.mouseX*10,r=this.mouseY*10;n.style.transform=`translateX(${i}px) translateY(${r}px)`}if(o){const i=this.mouseX*20,r=this.mouseY*20;o.style.transform=`translateX(${i}px) translateY(${r}px)`}if(s){const i=this.mouseX*30,r=this.mouseY*30;s.style.transform=`translateX(${i}px) translateY(${r}px)`}})}updateMagneticElements(){document.querySelectorAll(".parallax-magnetic").forEach(a=>{const n=a.getBoundingClientRect(),o=n.left+n.width/2,s=n.top+n.height/2,i=this.mouseX*this.windowWidth-o,r=this.mouseY*this.windowHeight-s,c=Math.sqrt(i*i+r*r),l=100;if(c<l){const u=(l-c)/l,h=i/c*u*20,g=r/c*u*20;a.style.setProperty("--mouse-x",`${h}px`),a.style.setProperty("--mouse-y",`${g}px`),a.classList.add("attracted")}else a.style.setProperty("--mouse-x","0px"),a.style.setProperty("--mouse-y","0px"),a.classList.remove("attracted")})}setupIntersectionObserver(){const e={threshold:.1,rootMargin:"0px 0px -50px 0px"},a=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting?(o.target.classList.add("in-view"),o.target.classList.contains("text-parallax")&&o.target.classList.add("revealed")):(o.target.classList.remove("in-view"),o.target.classList.contains("text-parallax")&&o.target.classList.remove("revealed"))})},e);document.querySelectorAll(".parallax-trigger").forEach(n=>{a.observe(n)}),document.querySelectorAll(".text-parallax").forEach(n=>{a.observe(n)})}initParallaxElements(){this.initCardParallax(),this.initButtonParallax(),this.initTiltEffects()}initCardParallax(){document.querySelectorAll(".card-parallax").forEach(a=>{a.addEventListener("mouseenter",n=>{const o=n.target.getBoundingClientRect(),s=o.left+o.width/2,i=o.top+o.height/2;n.target.style.transformOrigin=`${s}px ${i}px`}),a.addEventListener("mousemove",n=>{const o=n.target.getBoundingClientRect(),s=n.clientX-o.left,i=n.clientY-o.top,r=o.width/2,c=o.height/2,l=(i-c)/c*10,u=(r-s)/r*10;n.target.style.transform=`rotateX(${l}deg) rotateY(${u}deg) translateZ(20px)`}),a.addEventListener("mouseleave",n=>{n.target.style.transform="rotateX(0deg) rotateY(0deg) translateZ(0px)"})})}initButtonParallax(){document.querySelectorAll(".btn-parallax").forEach(a=>{a.addEventListener("mouseenter",n=>{n.target.style.transform="translateZ(10px) rotateX(10deg)"}),a.addEventListener("mouseleave",n=>{n.target.style.transform="translateZ(0px) rotateX(0deg)"})})}initTiltEffects(){document.querySelectorAll(".parallax-tilt").forEach(a=>{a.addEventListener("mousemove",n=>{const o=n.target.getBoundingClientRect(),s=n.clientX-o.left,i=n.clientY-o.top,r=o.width/2,c=o.height/2,l=(i-c)/c*15,u=(r-s)/r*15;n.target.style.transform=`perspective(1000px) rotateX(${l}deg) rotateY(${u}deg)`}),a.addEventListener("mouseleave",n=>{n.target.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg)"})})}startAnimationLoop(){const e=()=>{this.updateFloatingElements(),requestAnimationFrame(e)};e()}updateFloatingElements(){const e=document.querySelectorAll(".float-parallax"),a=Date.now()*.001;e.forEach((n,o)=>{const s=o*2,i=Math.sin(a+s)*10,r=Math.cos(a+s)*5;n.style.transform=`translateY(${i}px) translateZ(${r}px)`})}destroy(){window.removeEventListener("scroll",this.onScroll.bind(this)),document.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("resize",this.onResize.bind(this)),document.removeEventListener("touchmove",this.onTouchMove.bind(this)),document.querySelectorAll('[class*="parallax"]').forEach(a=>{a.style.transform=""})}}class Qn{constructor(){this.init()}init(){this.initButtonInteractions(),this.initFormInteractions(),this.initCardInteractions(),this.initNavigationInteractions(),this.initScrollInteractions()}initButtonInteractions(){document.addEventListener("click",a=>{a.target.matches(".btn-primary, .btn-secondary, .icon-btn")&&this.createRipple(a)}),document.querySelectorAll(".btn-primary, .btn-secondary").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-2px) scale(1.02)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0) scale(1)"})})}createRipple(e){const a=e.target,n=a.getBoundingClientRect(),o=Math.max(n.width,n.height),s=e.clientX-n.left-o/2,i=e.clientY-n.top-o/2,r=document.createElement("span");r.style.cssText=`
            position: absolute;
            width: ${o}px;
            height: ${o}px;
            left: ${s}px;
            top: ${i}px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
            z-index: 1;
        `,a.style.position="relative",a.style.overflow="hidden",a.appendChild(r),setTimeout(()=>{r.remove()},600)}initFormInteractions(){document.querySelectorAll("input, textarea, select").forEach(a=>{a.addEventListener("focus",()=>{const n=a.closest(".form-group");n&&n.classList.add("focused")}),a.addEventListener("blur",()=>{const n=a.closest(".form-group");n&&n.classList.remove("focused")})})}initCardInteractions(){document.querySelectorAll(".result-card, .quick-template-btn").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-4px) scale(1.02)",a.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0) scale(1)"})})}initNavigationInteractions(){document.querySelectorAll(".nav-link").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-1px)",a.style.transition="all 0.2s ease"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0)"})})}initScrollInteractions(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(a){a.preventDefault();const n=this.getAttribute("href");if(n&&n.length>1){const o=document.querySelector(n);o&&o.scrollIntoView({behavior:"smooth",block:"start"})}})})}}document.addEventListener("DOMContentLoaded",()=>{new ja});typeof module<"u"&&module.exports&&(module.exports={ParallaxController:ja,MicroInteractionsController:Qn});const eo="modulepreload",to=function(t){return"/"+t},Ta={},C=function(e,a,n){let o=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(a.map(c=>{if(c=to(c),c in Ta)return;Ta[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":eo,l||(h.as="script"),h.crossOrigin="",h.href=c,r&&h.setAttribute("nonce",r),document.head.appendChild(h),l)return new Promise((g,f)=>{h.addEventListener("load",g),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return o.then(i=>{for(const r of i||[])r.status==="rejected"&&s(r.reason);return e().catch(s)})},ao="https://afrqqsjdarffcpimdwvo.supabase.co",no="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcnFxc2pkYXJmZmNwaW1kd3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMjc2NDcsImV4cCI6MjA3MDkwMzY0N30.Stlhcf_qgWsV1u5RUxSH5_Ocr1iJd_d04yv-rtKT1xQ",w=window.supabase.createClient(ao,no,{auth:{autoRefreshToken:!1,persistSession:!0,detectSessionInUrl:!1,flowType:"pkce"},global:{headers:{"X-Client-Info":"direktiva-studio@1.0.0"}}});let V={id:{},en:{}};async function Nt(){try{const t=new URL("/assets/id-CCCdhDTf.json",import.meta.url),e=new URL("/assets/en-CrsApxk0.json",import.meta.url),[a,n]=await Promise.all([fetch(t),fetch(e)]),[o,s]=await Promise.all([a.json(),n.json()]);return V={id:o,en:s},console.log("Translations loaded successfully"),V}catch(t){return console.error("Failed to load translations:",t),V={id:{},en:{}},V}}function d(t,e={}){const a=typeof localStorage<"u"&&(localStorage.getItem("direktiva_language")||localStorage.getItem("aethera_language"))||typeof document<"u"&&document.documentElement.lang||"id";if(!V||!V[a]&&!V.en&&!V.id)return t;const n=s=>t.split(".").reduce((i,r)=>i&&i[r]!=null?i[r]:void 0,V[s]||{});let o=n(a);return o==null&&(o=n("en")),o==null&&(o=n("id")),typeof o=="string"?o.replace(/\{(\w+)\}/g,(s,i)=>e[i]??""):o??t}const Wt=Object.freeze(Object.defineProperty({__proto__:null,loadTranslations:Nt,t:d,get translations(){return V}},Symbol.toStringTag,{value:"Module"})),m={loginOverlay:document.getElementById("login-overlay"),loginBtn:document.getElementById("login-btn"),appContainer:document.getElementById("app-container"),generatorPage:document.getElementById("generator-page"),historyPage:document.getElementById("history-page"),settingsPage:document.getElementById("settings-page"),accountPage:document.getElementById("account-page"),navGenerator:document.getElementById("nav-generator"),navHistory:document.getElementById("nav-history"),navSettings:document.getElementById("nav-settings"),navAccount:document.getElementById("nav-account"),logoutBtn:document.getElementById("logout-btn"),mobileLogoutBtn:document.getElementById("mobile-logout-btn"),mobileMenuButton:document.getElementById("mobile-menu-button"),mobileMenu:document.getElementById("mobile-menu"),menuOpenIcon:document.getElementById("menu-open-icon"),menuCloseIcon:document.getElementById("menu-close-icon"),generateBtn:document.getElementById("generate-btn"),btnText:document.getElementById("btn-text"),btnLoader:document.getElementById("btn-loader"),imageLoader:document.getElementById("image-loader"),imageHelper:document.getElementById("image-helper"),imagePreview:document.getElementById("image-preview"),imagePreviewContainer:document.getElementById("image-preview-container"),removeImageBtn:document.getElementById("remove-image-btn"),outputPanel:document.getElementById("output-panel"),historyPanel:document.getElementById("history-panel"),initialState:document.getElementById("initial-state"),modeSingleBtn:document.getElementById("mode-single"),modeCarouselBtn:document.getElementById("mode-carousel"),scriptCountGroup:document.getElementById("script-count-group"),slideCountGroup:document.getElementById("slide-count-group"),carouselTemplateGroup:document.getElementById("carousel-template-group"),visualStrategyGroup:document.getElementById("visual-strategy-group"),strategyDefaultBtn:document.getElementById("strategy-default"),strategyFacelessBtn:document.getElementById("strategy-faceless"),strategyCharacterBtn:document.getElementById("strategy-character"),ratio916Btn:document.getElementById("ratio-916"),ratio11Btn:document.getElementById("ratio-11"),ratio169Btn:document.getElementById("ratio-169"),downloadAllContainer:document.getElementById("download-all-container"),personaSelector:document.getElementById("persona-selector"),visualDnaStorage:document.getElementById("visual-dna-storage"),customApiKeySettingsInput:document.getElementById("custom-api-key-settings"),apiStatus:document.getElementById("api-status"),systemPromptTextarea:document.getElementById("system-prompt"),saveSettingsBtn:document.getElementById("save-settings-btn"),settingsPresetSelector:document.getElementById("settings-preset-selector"),savePresetBtn:document.getElementById("save-preset-btn"),managePresetsBtn:document.getElementById("manage-presets-btn"),manageCharacterPresetsBtn:document.getElementById("manage-character-presets-btn"),langIdBtn:document.getElementById("lang-id"),langEnBtn:document.getElementById("lang-en"),notification:document.getElementById("notification"),editModal:{el:document.getElementById("edit-modal"),closeBtn:document.getElementById("close-modal-btn"),regenerateBtn:document.getElementById("regenerate-btn"),originalDisplay:document.getElementById("original-script-display-stage1"),instructionInput:document.getElementById("revision-instruction")},apiKeyModal:{el:document.getElementById("api-key-modal"),input:document.getElementById("modal-api-key-input"),saveBtn:document.getElementById("save-api-key-from-modal-btn")},personaModal:{el:document.getElementById("persona-modal"),title:document.getElementById("persona-modal-title"),nameInput:document.getElementById("persona-name"),descInput:document.getElementById("persona-desc"),idInput:document.getElementById("persona-id"),saveBtn:document.getElementById("save-persona-btn"),closeBtn:document.getElementById("close-persona-modal-btn"),addBtn:document.getElementById("add-persona-btn"),listContainer:document.getElementById("persona-list-container"),defaultContainer:document.getElementById("default-persona-container")},confirmModal:{el:document.getElementById("confirm-modal"),title:document.getElementById("confirm-modal-title"),message:document.getElementById("confirm-modal-message"),confirmBtn:document.getElementById("confirm-modal-confirm-btn"),cancelBtn:document.getElementById("confirm-modal-cancel-btn")},inputs:{productName:document.getElementById("product-name"),productDesc:document.getElementById("product-desc"),productImage:document.getElementById("product-image"),writingStyle:document.getElementById("writing-style"),toneVibe:document.getElementById("tone-vibe"),targetAudience:document.getElementById("target-audience"),hookType:document.getElementById("hook-type"),ctaType:document.getElementById("cta-type"),slideCount:document.getElementById("slide-count"),scriptCount:document.getElementById("script-count"),carouselTemplate:document.getElementById("carousel-template")},mobileNavGenerator:document.getElementById("mobile-nav-generator"),mobileNavHistory:document.getElementById("mobile-nav-history"),mobileNavSettings:document.getElementById("mobile-nav-settings"),mobileNavAccount:document.getElementById("mobile-nav-account")},Xt={current:localStorage.getItem("direktiva_theme")||"dark"},q={current:localStorage.getItem("direktiva_language")||"id"};let Ue=null,re=null;function U(t,e,a,n){if(e){if(e.disabled=t,t){e.classList.add("btn-loading");let o=e.querySelector(".btn-spinner");if(o){o.style.display="flex";const s=e.querySelector(".btn-text");s&&(s.style.opacity="0")}else{const s=e.textContent||e.innerHTML;e.innerHTML=`
                <span class="btn-text">${s}</span>
                <span class="btn-spinner">
                    <div class="spinner"></div>
                </span>
            `}}else{e.classList.remove("btn-loading");const o=e.querySelector(".btn-spinner"),s=e.querySelector(".btn-text");o&&s&&(o.style.display="none",s.style.opacity="1")}if(t&&e.id==="generate-btn"){m.initialState&&(m.initialState.style.display="none"),m.outputPanel.innerHTML="";const o=parseInt(m.inputs.scriptCount.value,10)||1,s=document.getElementById("skeleton-card-template");for(let i=0;i<o;i++){const r=s.content.cloneNode(!0);m.outputPanel.appendChild(r)}}}}function b(t,e="default",a=3e3){let n=t,o=typeof t=="string"&&t.includes("_")&&!t.includes(" ");try{const r=d(t);r&&r!==t&&(n=r,o=!1)}catch(r){console.warn("Translation error in showNotification:",r)}const s=document.createElement("div");s.className=`notification notification-${e}`;let i="";switch(e){case"success":i="icon-check";break;case"error":i="icon-error";break;case"warning":i="icon-warning";break;default:i="icon-info"}if(s.innerHTML=`
        <div class="flex items-center space-x-3">
            <div class="icon icon-md ${i} flex-shrink-0 notification-icon"></div>
            <div class="flex-1 notification-message">${n}</div>
            <button class="icon-btn notification-close" onclick="this.parentElement.parentElement.remove()">
                <div class="icon icon-sm icon-close"></div>
            </button>
        </div>
    `,document.body.appendChild(s),o&&n===t){const r=t;let c=0;const l=20,u=150,h=s.querySelector(".notification-message"),g=setInterval(()=>{try{const f=d(r);f&&f!==r&&(h&&h.textContent===r&&(h.textContent=f),clearInterval(g))}catch{clearInterval(g)}finally{c++,c>=l&&clearInterval(g)}},u)}setTimeout(()=>s.classList.add("show"),10),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},a)}function oo(t,e,a,n="success",o=7e3){var r,c;const s=document.createElement("div");s.className=`notification notification-${n}`,s.innerHTML=`
        <div class="flex items-center space-x-3">
            <div class="icon icon-md icon-info flex-shrink-0 notification-icon"></div>
            <div class="flex-1 notification-message">${t}</div>
            <button class="px-3 py-1 rounded bg-gray-800 text-white hover:bg-gray-700 action-btn">${e}</button>
            <button class="icon-btn notification-close"><div class="icon icon-sm icon-close"></div></button>
        </div>
    `;const i=()=>{try{s.remove()}catch{}};(r=s.querySelector(".notification-close"))==null||r.addEventListener("click",i),(c=s.querySelector(".action-btn"))==null||c.addEventListener("click",async()=>{try{await(a==null?void 0:a())}finally{i()}}),document.body.appendChild(s),setTimeout(()=>s.classList.add("show"),10),setTimeout(i,o)}function we(t,e=null){const a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select();try{if(document.execCommand("copy"),b(d("notification_copy_success")),e){const n=e.innerHTML;e.innerHTML='<div class="icon icon-md icon-check text-green-500"></div>',e.classList.add("copy-success");const o=e.closest(".result-card, .script-part, .slide-text");o&&(o.classList.add("copy-highlight"),setTimeout(()=>{o.classList.remove("copy-highlight")},600)),setTimeout(()=>{e.innerHTML=n,e.classList.remove("copy-success")},1500)}}catch(n){console.error("Failed to copy: ",n)}document.body.removeChild(a)}function Ua(t){return new Promise((e,a)=>{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>e(n.result.split(",")[1]),n.onerror=o=>a(o)})}function lt(t,e,a,n){const o=document.getElementById("input-modal"),s=document.getElementById("input-modal-title"),i=document.getElementById("input-modal-message"),r=document.getElementById("input-modal-input"),c=document.getElementById("input-modal-cancel-btn"),l=document.getElementById("input-modal-confirm-btn");s&&(s.textContent=t),i&&(i.textContent=e),r&&(r.placeholder=a||"",r.value=""),o.classList.remove("opacity-0","pointer-events-none"),o.querySelector(".modal-content").classList.remove("scale-95"),r&&setTimeout(()=>r.focus(),100);const u=()=>{const f=r?r.value.trim():"";Ot(),n&&n(f)},h=()=>{Ot()},g=f=>{f.key==="Enter"?(f.preventDefault(),u()):f.key==="Escape"&&(f.preventDefault(),h())};l&&(l.replaceWith(l.cloneNode(!0)),document.getElementById("input-modal-confirm-btn").addEventListener("click",u)),c&&(c.replaceWith(c.cloneNode(!0)),document.getElementById("input-modal-cancel-btn").addEventListener("click",h)),r&&r.addEventListener("keypress",g)}function Ot(){const t=document.getElementById("input-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}function pe(t,e){m.confirmModal.message.textContent=t,Ue=e,m.confirmModal.el.classList.remove("opacity-0","pointer-events-none"),m.confirmModal.el.querySelector(".modal-content").classList.remove("scale-95")}function Xe(){m.confirmModal.el.classList.add("opacity-0","pointer-events-none"),m.confirmModal.el.querySelector(".modal-content").classList.add("scale-95"),Ue=null}function Zt(t){try{window.onbeforeunload=null}catch{}const{editModal:e}=m,a=JSON.parse(t.dataset.script);document.getElementById("edit-modal-stage-1").style.display="flex",document.getElementById("edit-modal-stage-1").style.flexDirection="column",document.getElementById("edit-modal-stage-2").style.display="none",document.querySelectorAll(".section-checkbox").forEach(r=>r.checked=!1),document.getElementById("revision-instruction").value="",document.getElementById("original-script-display-stage1"),e.originalDisplay&&(e.originalDisplay.textContent=et(a)),localStorage.setItem("cardBeingEditedId",t.id);try{const r=JSON.parse(localStorage.getItem("edit_draft_"+t.id)||"null");r&&((document.getElementById("revision-instruction")||{}).value=r.text||"",(document.getElementById("revision-instruction-stage2")||{}).value=r.text||"",(r.sections||[]).forEach(c=>{const l=document.getElementById(c);l&&l.classList.contains("section-checkbox")&&(l.checked=!0)}))}catch{}const n=()=>{const r=(document.getElementById("revision-instruction")||{}).value||"",c=Array.from(document.querySelectorAll(".section-checkbox")).filter(l=>l.checked).map(l=>l.id);localStorage.setItem("edit_draft_"+t.id,JSON.stringify({text:r,sections:c,ts:Date.now()})),(r||c.length>0)&&(window.onbeforeunload=l=>(l.preventDefault(),l.returnValue="",""))},o=(()=>{let r;return()=>{clearTimeout(r),r=setTimeout(n,500)}})(),s=document.getElementById("revision-instruction");s&&s.addEventListener("input",o);const i=document.getElementById("revision-instruction-stage2");i&&i.addEventListener("input",o),document.querySelectorAll(".section-checkbox").forEach(r=>r.addEventListener("change",o)),e.el.classList.remove("opacity-0","pointer-events-none"),e.el.querySelector(".modal-content").classList.remove("scale-95")}function Fa(t,e,a){document.getElementById("edit-modal-stage-1").style.display="none",document.getElementById("edit-modal-stage-2").style.display="block";const n=document.getElementById("before-script-display"),o=document.getElementById("after-script-display"),s=document.getElementById("revision-instruction-stage2");n&&(n.textContent=et(t,["hook","body","cta"]));const i={...t,...e};o.textContent=et(i,["hook","body","cta"]),re=e,s.value=document.getElementById("revision-instruction").value}function et(t,e=["hook","body","cta"]){if(!t)return d("script_not_found")||"Skrip tidak ditemukan.";let a=`${d("title_label")||"Judul"}: ${t.title}

`;const n=(o,s)=>{if(!s)return"";let i=`--- ${o.toUpperCase()} ---
`;return i+=`${d("script_text_label")||"Teks Skrip"}: ${s.text}
`,s.shots.forEach((r,c)=>{i+=`${d("visual_idea_label")||"Ide Visual"} ${c+1}: ${r.visual_idea}
`}),i+`
`};return t.hook&&e.includes("hook")&&(a+=n("HOOK",t.hook)),t.body&&e.includes("body")&&(a+=n("BODY",t.body)),t.cta&&e.includes("cta")&&(a+=n("CTA",t.cta)),t.slides&&t.slides.forEach((o,s)=>{e.includes(`slide${s}`)&&(a+=`--- SLIDE ${s+1} ---
`,a+=`${d("slide_text_label")||"Slide Text"}: ${o.slide_text}
`)}),a}function Se(){const{editModal:t}=m;t.el.classList.add("opacity-0","pointer-events-none"),t.el.querySelector(".modal-content").classList.add("scale-95"),localStorage.removeItem("cardBeingEditedId"),re=null}function Te(t,e=!1){var o;const a=typeof((o=t.dataset)==null?void 0:o.script)=="string"?JSON.parse(t.dataset.script):t;let n=`${d("script_title_label")||"Judul"}: ${a.title}

`;if(a.hook){a.character_sheet&&a.character_sheet.length>0&&(a.character_sheet.forEach(i=>{n+=`${d("character_label")||"Karakter"}: ${Qt(i)}
`}),n+=`
`);const s=(i,r)=>{let c=`${i}:
${r.text}
`;return r.shots.forEach((l,u)=>{c+=` ${d("shot_label")||"Shot"} ${u+1} ${d("visual_idea_label_short")||"Ide"}: ${l.visual_idea}
`,c+=` ${d("shot_label")||"Shot"} ${u+1} ${d("t2i_prompt_label_short")||"T2I"}: ${l.text_to_image_prompt}
`,c+=` ${d("shot_label")||"Shot"} ${u+1} ${d("i2v_prompt_label_short")||"I2V"}: ${l.image_to_video_prompt}
`}),c};n+=s(d("hook_title"),a.hook),n+=`
${s(d("body_title"),a.body)}`,n+=`
${s(d("cta_title"),a.cta)}`}else a.slides&&a.slides.forEach((s,i)=>{n+=`--- ${d("slide_label")} ${i+1} ---
`,n+=`${d("slide_text_label")}: ${s.slide_text}
`,n+=`${d("t2i_prompt_label")}: ${s.text_to_image_prompt}
`,s.layout_suggestion&&(n+=`${d("slide_layout_suggestion")}: ${s.layout_suggestion}
`),s.engagement_idea&&(n+=`${d("slide_engagement_idea")}: ${s.engagement_idea}
`),n+=`
`});return n}function Qt(t){if(!t)return"";const e=[];t.name&&e.push(t.name),t.age&&e.push(`${t.age} years old`),t.ethnicity&&e.push(t.ethnicity),t.skin_tone&&e.push(`${t.skin_tone} skin`),t.face_shape&&e.push(`${t.face_shape} face`),t.body_shape&&e.push(t.body_shape);const a=[];return t.hair_style&&a.push(t.hair_style),t.hair_color&&a.push(t.hair_color),a.length>0&&e.push(`${a.join(" ")} hair`),t.eye_color&&e.push(`${t.eye_color} eyes`),e.join(", ")}window.useVariant=async function(t,e){const a=document.querySelector(`[data-part="${t}"]`);if(!a)return;const n=a.closest(".result-card");if(!n)return;const o=JSON.parse(n.dataset.script||"{}");if(!o)return;const s=`${t}_variants`,i=o[s];if(!i||!i[e])return;const r=i[e];try{const{applyVariantToScript:c}=await C(async()=>{const{applyVariantToScript:u}=await Promise.resolve().then(()=>je);return{applyVariantToScript:u}},void 0);await c(n,o,t,r);const l=a.querySelector(`[data-variant-index="${e}"]`);l&&(l.style.backgroundColor="#065f46",l.style.borderColor="#10b981",setTimeout(()=>{l.style.backgroundColor="",l.style.borderColor=""},2e3))}catch(c){console.error("Error applying variant:",c),o[t]&&o[t].text&&(o[t].text=r),n.dataset.script=JSON.stringify(o);const l=a.querySelector("p");l&&(l.textContent=r);const u=d("variant_applied_success",{part:t.toUpperCase()})||`Variant ${t.toUpperCase()} successfully applied!`;b(u,"success")}};const J=Object.freeze(Object.defineProperty({__proto__:null,closeConfirmModal:Xe,closeEditModal:Se,closeInputModal:Ot,get confirmCallback(){return Ue},copyToClipboard:we,elements:m,fileToBase64:Ua,getCharacterDescriptionString:Qt,getFullScriptText:Te,getSimpleScriptTextForModal:et,languageState:q,openConfirmModal:pe,openEditModal:Zt,openInputModal:lt,setLoadingState:U,showActionNotification:oo,showBeforeAfter:Fa,showNotification:b,get tempGeneratedPart(){return re},themeState:Xt},Symbol.toStringTag,{value:"Module"}));function Y(t){var e;m.generatorPage.classList.toggle("hidden",t!=="generator"),m.historyPage.classList.toggle("hidden",t!=="history"),m.settingsPage.classList.toggle("hidden",t!=="settings"),(e=m.accountPage)==null||e.classList.toggle("hidden",t!=="account"),[m.navGenerator,m.mobileNavGenerator].forEach(a=>a==null?void 0:a.classList.toggle("active",t==="generator")),[m.navHistory,m.mobileNavHistory].forEach(a=>a==null?void 0:a.classList.toggle("active",t==="history")),[m.navSettings,m.mobileNavSettings].forEach(a=>a==null?void 0:a.classList.toggle("active",t==="settings")),[m.navAccount,m.mobileNavAccount].forEach(a=>a==null?void 0:a.classList.toggle("active",t==="account"))}function Oe(){m.mobileMenu.classList.toggle("hidden"),m.menuOpenIcon.classList.toggle("hidden"),m.menuCloseIcon.classList.toggle("hidden")}function so(){Y("generator")}window.switchToGenerator=so;async function ro(){return(await C(()=>Promise.resolve().then(()=>je),void 0)).createResultCard}let ee=1,Ze=5,ke=[],Ee=[],Ga="newest",$t="",Mt="all",Va=!1,kt=new Set;function Ja(t,e,a){let n=JSON.parse(localStorage.getItem("direktiva_history"))||[],o=a;const s={id:Date.now(),productName:e||m.inputs.productName.value||d("untitled_script"),mode:o,scripts:t};n.unshift(s),n.length>50&&n.pop(),localStorage.setItem("direktiva_history",JSON.stringify(n)),localStorage.setItem("direktiva_history_last_modified",new Date().toISOString())}async function dt(){try{const{cloudStorage:t}=await C(async()=>{const{cloudStorage:e}=await Promise.resolve().then(()=>ut);return{cloudStorage:e}},void 0);if(t&&typeof t.fetchHistoryTags=="function"){const e=await t.fetchHistoryTags();if(e&&Object.keys(e).length)try{const a=JSON.parse(localStorage.getItem("direktiva_history_tags")||"{}"),n={...e,...a};localStorage.setItem("direktiva_history_tags",JSON.stringify(n))}catch{}}}catch(t){console.warn("Fetch server tags skipped",t)}return Ee=JSON.parse(localStorage.getItem("direktiva_history"))||[],Ae(),Ge(),Ee}function Ae(){let t=[...Ee];switch(Mt!=="all"&&(t=t.filter(e=>e.mode===Mt)),$t.trim()&&(t=t.filter(e=>e.productName.toLowerCase().includes($t.toLowerCase()))),Ga){case"oldest":t.sort((e,a)=>e.id-a.id);break;case"name":t.sort((e,a)=>e.productName.localeCompare(a.productName));break;case"newest":default:t.sort((e,a)=>a.id-e.id);break}Va?ke=io(t):ke=t,Ge()}function io(t){const e={};return t.forEach(n=>{e[n.productName]||(e[n.productName]=[]),e[n.productName].push(n)}),Object.keys(e).map(n=>({productName:n,entries:e[n]}))}async function Ge(){const t=document.getElementById("history-panel"),e=document.getElementById("history-empty-state");if(!t)return;if(ke.length===0){t.innerHTML="",e&&e.classList.remove("hidden"),Aa();return}else e&&e.classList.add("hidden");const a=(ee-1)*Ze,n=a+Ze,o=ke.slice(a,n);t.innerHTML="";for(const i of o){const r=i&&Array.isArray(i.scripts)?i.scripts[0]||null:i;if(!r)continue;const l=await(await ro())(r,0);t.appendChild(l)}const s=Math.ceil(ke.length/Ze);co(s),Aa()}function co(t){const e=document.getElementById("history-pagination"),a=document.getElementById("prev-page"),n=document.getElementById("next-page"),o=document.getElementById("current-page"),s=document.getElementById("total-pages");if(t<=1){e.classList.add("hidden");return}e.classList.remove("hidden"),o.textContent=ee,s.textContent=t,a.disabled=ee===1,n.disabled=ee===t}async function tt(t){let e=JSON.parse(localStorage.getItem("direktiva_history"))||[];const a=Array.isArray(t)?t.map(Number):[Number(t)],n=e.filter(o=>!a.includes(o.id));localStorage.setItem("direktiva_history",JSON.stringify(n)),localStorage.setItem("direktiva_history_last_modified",new Date().toISOString()),await dt()}async function Ya(){localStorage.removeItem("direktiva_history"),localStorage.setItem("direktiva_history_last_modified",new Date().toISOString());try{const{cloudStorage:t}=await C(async()=>{const{cloudStorage:e}=await Promise.resolve().then(()=>ut);return{cloudStorage:e}},void 0);t&&typeof t.deleteAllHistory=="function"&&await t.deleteAllHistory()}catch(t){console.warn("Failed to delete history from cloud storage:",t.message)}await dt()}function ea(t){const e=Math.ceil(ke.length/Ze);t>=1&&t<=e&&(ee=t,Ge())}function Ka(){ea(ee+1)}function za(){ea(ee-1)}function ta(t){$t=t,Ae(),Ge()}function aa(t){Ga=t,ee=1,Ae(),Ge()}function na(t){Mt=t,ee=1,Ae(),lo(t)}window.toggleGroup=function(t){kt.has(t)?kt.delete(t):kt.add(t),Ae()};window.selectGroupEntries=function(t){const e=document.querySelectorAll(`[data-group-name="${t}"] .history-checkbox`),a=Array.from(e).every(n=>n.checked);e.forEach(n=>{n.checked=!a,n.dispatchEvent(new Event("change"))})};function lo(t){document.querySelectorAll(".post-type-tab").forEach(n=>{n.classList.remove("active")});const a=document.querySelector(`.post-type-tab[data-filter="${t}"]`);a&&a.classList.add("active")}function Aa(){const t={all:document.getElementById("count-all"),single:document.getElementById("count-single"),carousel:document.getElementById("count-carousel")};!t.all||!t.single||!t.carousel||(t.all.textContent=Ee.length,t.single.textContent=Ee.filter(e=>e.mode==="single").length,t.carousel.textContent=Ee.filter(e=>e.mode==="carousel").length)}function Wa(t){document.querySelectorAll(".history-checkbox").forEach(a=>a.checked=t),oa()}function oa(){const t=document.querySelectorAll(".history-checkbox:checked").length>0,e=document.getElementById("delete-selected-btn");e&&(e.disabled=!t,t?e.classList.remove("hidden"):e.classList.add("hidden"))}function Xa(){const t=document.getElementById("group-by-product");Va=!!(t&&t.checked),Ae()}function Za(){const t=document.querySelectorAll(".history-checkbox"),e=document.getElementById("select-all-history");if(!e)return;const a=Array.from(t).length>0&&Array.from(t).every(n=>n.checked);e.checked=a}window.handleSearchInput=function(t){ta(t.target.value)};window.handleSortChange=function(t){aa(t.target.value)};window.handlePostTypeFilter=function(t){na(t.target.dataset.filter)};window.handleDeleteSelected=async function(){const t=Array.from(document.querySelectorAll(".history-checkbox:checked")).map(e=>Number(e.closest(".history-entry").dataset.entryId));t.length>0&&await tt(t)};window.handleDeleteAll=async function(){await Ya()};const Et=Object.freeze(Object.defineProperty({__proto__:null,deleteAllHistory:Ya,deleteFromHistory:tt,goToPage:ea,loadHistory:dt,nextPage:Ka,prevPage:za,saveToHistory:Ja,selectAllHistory:Wa,setPostTypeFilter:na,setSearchQuery:ta,setSortOrder:aa,toggleGroupByProduct:Xa,updateDeleteSelectedButton:oa,updateSelectAllCheckbox:Za},Symbol.toStringTag,{value:"Module"})),R={SYNCED:"synced",SYNCING:"syncing",OFFLINE:"offline",ERROR:"error"},uo=1e4;let He=null;const be={SYNC_STATUS:"direktiva_sync_status",LAST_SYNC:"direktiva_last_sync",PENDING_SYNC:"direktiva_pending_sync",OFFLINE_CHANGES:"direktiva_offline_changes"};class mo{constructor(){this.syncStatus=R.OFFLINE,this.isOnline=navigator.onLine,this.syncInProgress=!1,this.pendingOperations=[],window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.updateSyncStatus()}async init(){try{const{data:{session:e}}=await w.auth.getSession();e&&this.isOnline?await this.syncAll():this.setSyncStatus(R.OFFLINE)}catch(e){console.warn("Cloud storage not available, running in offline mode:",e.message),this.setSyncStatus(R.OFFLINE)}}async handleOnline(){this.isOnline=!0,console.log("Device is online, attempting to sync...");const{data:{session:e}}=await w.auth.getSession();e&&await this.syncAll()}handleOffline(){this.isOnline=!1,this.setSyncStatus(R.OFFLINE),console.log("Device is offline, storing changes locally")}setSyncStatus(e){this.syncStatus=e,localStorage.setItem(be.SYNC_STATUS,e),this.updateSyncIndicator(e)}updateSyncStatus(){this.isOnline?this.syncInProgress?this.setSyncStatus(R.SYNCING):this.setSyncStatus(R.SYNCED):this.setSyncStatus(R.OFFLINE)}updateSyncIndicator(e){const a=document.getElementById("sync-indicator");if(!a)return;a.className=`sync-indicator sync-${e}`;const n={[R.SYNCED]:d("sync_status_synced")||"Synced",[R.SYNCING]:d("sync_status_syncing")||"Syncing...",[R.OFFLINE]:d("sync_status_offline")||"Offline",[R.ERROR]:d("sync_status_error")||"Sync Error"};a.textContent=n[e],a.title=n[e]}async syncAll(){if(!(this.syncInProgress||!this.isOnline)){this.syncInProgress=!0,this.setSyncStatus(R.SYNCING);try{const{data:{session:e}}=await w.auth.getSession();if(!e){console.warn("No active session, switching to offline mode"),this.setSyncStatus(R.OFFLINE);return}await this.processPendingOperations(),await this.syncSettings(),await this.syncGeneratorPresets(),await this.syncCharacterPresets(),await this.syncPersonas(),await this.syncHistory(),typeof window<"u"&&setTimeout(()=>{try{window.populatePresetSelector&&window.populatePresetSelector(),window.populateCharacterPresetSelector&&window.populateCharacterPresetSelector()}catch(a){console.warn("Failed to populate selectors after sync:",a.message)}},200),localStorage.setItem(be.LAST_SYNC,new Date().toISOString()),this.setSyncStatus(R.SYNCED),console.log("All data synced successfully")}catch(e){console.warn("Sync failed, switching to offline mode:",e.message),this.setSyncStatus(R.OFFLINE)}finally{this.syncInProgress=!1}}}async syncSettings(){try{const{data:{session:e},error:a}=await w.auth.getSession();if(a)throw new Error("Failed to get session: "+a.message);if(!e||!e.user)throw new Error("User not authenticated");const n=e.user,o={theme:localStorage.getItem("direktiva_theme")||localStorage.getItem("aethera_theme")||"dark",language:localStorage.getItem("direktiva_language")||localStorage.getItem("aethera_language")||"id",system_prompt:localStorage.getItem("direktiva_system_prompt")||localStorage.getItem("aethera_system_prompt")},{data:s,error:i}=await w.from("user_settings").select("*").eq("user_id",n.id).single();if(i&&i.code!=="PGRST116")throw i;if(s){let r;const c=this.hasLocalChanges("settings",s.updated_at);c?r={theme:o.theme,language:o.language,system_prompt:o.system_prompt}:r=this.mergeSettings(o,s),localStorage.setItem("aethera_theme",r.theme),localStorage.setItem("aethera_language",r.language),r.system_prompt&&localStorage.setItem("aethera_system_prompt",r.system_prompt);try{document.documentElement.lang=r.language}catch{}if(typeof window<"u"&&window.updateLanguageButtons)try{window.updateLanguageButtons()}catch{}if(c){const{error:l}=await w.from("user_settings").update({theme:r.theme,language:r.language,system_prompt:r.system_prompt}).eq("user_id",s.user_id);if(l)throw l}}else{const{error:r}=await w.from("user_settings").insert([{user_id:n.id,theme:o.theme,language:o.language,system_prompt:o.system_prompt}]);if(r)throw r}}catch(e){console.warn("Failed to sync settings, continuing in offline mode:",e.message)}}async syncGeneratorPresets(){const e=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),a={};e.forEach(l=>{a[l.name]=l.settings});const{data:n,error:o}=await w.from("user_presets").select("*").eq("type","generator").order("created_at",{ascending:!1});if(o)throw o;const s=localStorage.getItem("aethera_presets_last_modified"),i=s?isNaN(Number(s))?Date.parse(s):Number(s):0,r=n&&n.length>0?Math.max(...n.map(l=>new Date(l.created_at).getTime())):0,c=!i||r>parseInt(i);await this.syncGeneratorPresetsInternal(a,n||[],c),r>0&&localStorage.setItem("aethera_presets_last_modified",String(r))}async syncGeneratorPresetsInternal(e,a,n=!1){const{data:{session:o}}=await w.auth.getSession();if(!o||!o.user)throw new Error("User not authenticated");const s=o.user,i=new Set(a.map(f=>f.name)),r=[],c=new Map;if(a.forEach(f=>{c.set(f.name,f)}),Object.entries(e).forEach(([f,p])=>{i.has(f)||r.push({user_id:s.id,name:f,type:"generator",settings:p})}),r.length>0){const{error:f}=await w.from("user_presets").insert(r);if(f)throw f}if(!n){const f=[];for(const[p,_]of Object.entries(e))if(c.has(p)){const k=c.get(p),E=k.settings||{};try{const A=JSON.stringify(_||{}),v=JSON.stringify(E);A!==v&&f.push({id:k.id,settings:_})}catch{f.push({id:k.id,settings:_})}}for(const p of f){const{error:_}=await w.from("user_presets").update({settings:p.settings}).eq("id",p.id);if(_)throw _}}const l=n?{}:{...e};JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]").map(f=>f.name),a.forEach(f=>{f.settings&&(n||!e.hasOwnProperty(f.name))&&(l[f.name]=f.settings)});const h=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),g=Object.entries(l).map(([f,p])=>{const _=h.find(E=>E.name===f),k=a.find(E=>E.name===f);return{id:(_==null?void 0:_.id)||(k==null?void 0:k.id)||`preset_${f.replace(/\s+/g,"_").toLowerCase()}_${Date.now()}`,name:f,settings:p}});localStorage.setItem("aethera_settings_presets",JSON.stringify(g)),typeof window<"u"&&window.populatePresetSelector&&setTimeout(()=>window.populatePresetSelector(),100)}async syncCharacterPresets(){try{const e=JSON.parse(localStorage.getItem("aethera_character_presets")||"[]"),{data:a,error:n}=await w.from("user_presets").select("*").eq("type","character").order("created_at",{ascending:!1});if(n)throw n;const o=localStorage.getItem("aethera_character_presets_last_modified"),s=o?isNaN(Number(o))?Date.parse(o):Number(o):0,i=a&&a.length>0?Math.max(...a.map(c=>new Date(c.created_at).getTime())):0,r=!s||i>parseInt(s);await this.syncCharacterPresetsInternal(e,a||[],r),i>0&&localStorage.setItem("aethera_character_presets_last_modified",String(i))}catch(e){console.warn("Failed to sync character presets, continuing in offline mode:",e.message)}}async syncCharacterPresetsInternal(e,a,n=!1){const{data:{session:o}}=await w.auth.getSession();if(!o||!o.user)throw new Error("User not authenticated");const s=o.user,i=new Set(a.map(g=>g.name)),r=new Map;a.forEach(g=>{var p;const f=(p=g==null?void 0:g.settings)==null?void 0:p.id;f&&r.set(String(f),g)});const c=[],l=[];for(const g of e){const f=g!=null&&g.id?String(g.id):"";if(f&&r.has(f)){const p=r.get(f);p.name!==g.name&&l.push({id:p.id,name:g.name});continue}i.has(g.name)||c.push(g)}if(c.length>0){const{error:g}=await w.from("user_presets").insert(c.map(f=>({user_id:s.id,name:f.name,type:"character",settings:f})));if(g)throw g}if(l.length>0)for(const g of l){const{error:f}=await w.from("user_presets").update({name:g.name}).eq("id",g.id);if(f)throw f}const u=n?[]:[...e];JSON.parse(localStorage.getItem("aethera_character_presets")||"[]").map(g=>g.name),a.forEach(g=>{const f=u.findIndex(p=>p.name===g.name);if(f===-1){const p=e.find(_=>_.name===g.name);if(n||p){const _=g.settings;_.id||(_.id=`preset_${g.name.replace(/\s+/g,"_").toLowerCase()}_${Date.now()}`),u.push(_)}}else{const p=u[f].id;u[f]={...g.settings,id:p}}}),localStorage.setItem("aethera_character_presets",JSON.stringify(u)),typeof window<"u"&&window.populateCharacterPresetSelector&&setTimeout(()=>{try{window.populateCharacterPresetSelector()}catch(g){console.warn("Failed to populate character preset selector after sync:",g.message)}},100)}async syncPersonas(){try{const{data:{session:e}}=await w.auth.getSession();if(!e||!e.user)throw new Error("User not authenticated");const a=e.user,n=JSON.parse(localStorage.getItem("aethera_personas")||"[]"),{data:o,error:s}=await w.from("user_personas").select("*").order("created_at",{ascending:!1});if(s)throw s;const i=this.mergePersonas(n,o||[]);localStorage.setItem("aethera_personas",JSON.stringify(i.local));for(const r of i.toUpload)if(r.id&&r.id.toString().length<10){const{error:c}=await w.from("user_personas").insert([{user_id:a.id,name:r.name,description:r.description,avatar:r.avatar,personality:r.personality||{}}]);if(c)throw c}else{const{error:c}=await w.from("user_personas").update({name:r.name,description:r.description,avatar:r.avatar,personality:r.personality||{}}).eq("id",r.id);if(c)throw c}}catch(e){console.warn("Failed to sync personas, continuing in offline mode:",e.message)}}async syncHistory(){try{const{data:{session:e}}=await w.auth.getSession();if(!e||!e.user)throw new Error("User not authenticated");const a=e.user,n=JSON.parse(localStorage.getItem("aethera_history")||"[]"),{data:o,error:s}=await w.from("user_history").select("*").order("created_at",{ascending:!1}).limit(100);if(s)throw s;const i=this.mergeHistory(n,o||[]);localStorage.setItem("aethera_history",JSON.stringify(i.local.slice(0,50)));for(const r of i.toUpload){const c=r.timestamp||Date.now(),l=isNaN(c)?Date.now():c,u=r.productName||r.product_name||"Untitled Script",{error:h}=await w.from("user_history").insert([{user_id:a.id,product_name:u,scripts:r.scripts||[],post_type:r.postType||r.post_type||"single",image_url:r.imageUrl||r.image_url||null,created_at:new Date(l).toISOString()}]);if(h)throw h}}catch(e){console.warn("Failed to sync history, continuing in offline mode:",e.message)}}async processPendingOperations(){const e=JSON.parse(localStorage.getItem(be.PENDING_SYNC)||"[]");for(const a of e)try{await this.executeOperation(a)}catch(n){console.error("Failed to execute pending operation:",a,n)}localStorage.removeItem(be.PENDING_SYNC)}async executeOperation(e){const{type:a,action:n,data:o}=e;switch(a){case"presets":if(n==="create")await w.from("user_presets").insert([o]);else if(n==="update"){const s={name:o.name};if(Object.prototype.hasOwnProperty.call(o,"settings")&&(s.settings=o.settings),o.id)await w.from("user_presets").update(s).eq("id",o.id);else if(o.previous_name&&o.type){const{data:{session:i}}=await w.auth.getSession();i!=null&&i.user&&await w.from("user_presets").update(s).eq("user_id",i.user.id).eq("type",o.type).eq("name",o.previous_name)}}else n==="delete"&&(o.id?await w.from("user_presets").delete().eq("id",o.id):o.name&&o.type&&await w.from("user_presets").delete().eq("name",o.name).eq("type",o.type));break;case"personas":n==="create"?await w.from("user_personas").insert([o]):n==="update"?await w.from("user_personas").update(o).eq("id",o.id):n==="delete"&&await w.from("user_personas").delete().eq("id",o.id);break;case"history":if(n==="create"){const s={...o,product_name:o.product_name||o.productName||"Untitled Script",scripts:o.scripts||[],post_type:o.post_type||o.postType||"single",image_url:o.image_url||o.imageUrl||null};await w.from("user_history").insert([s])}else n==="delete"&&await w.from("user_history").delete().eq("id",o.id);break}}async deleteAllHistory(){try{const{data:{session:e}}=await w.auth.getSession();if(!e||!e.user){console.warn("User not authenticated, cannot delete cloud history");return}const{error:a}=await w.from("user_history").delete().eq("user_id",e.user.id);if(a)throw a;console.log("All user history deleted from cloud storage")}catch(e){console.warn("Failed to delete history from cloud storage:",e.message)}}addPendingOperation(e,a,n){const o=JSON.parse(localStorage.getItem(be.PENDING_SYNC)||"[]");o.push({type:e,action:a,data:n,timestamp:Date.now()}),localStorage.setItem(be.PENDING_SYNC,JSON.stringify(o))}mergeSettings(e,a){return{theme:a.theme||e.theme,language:a.language||e.language,system_prompt:a.system_prompt||e.system_prompt}}mergePersonas(e,a){const n=[...a],o=[];for(const s of e)a.find(r=>r.name===s.name&&r.description===s.description)||(n.push(s),o.push(s));return{local:n,toUpload:o}}mergeHistory(e,a){const n=a.map(i=>({id:i.created_at?new Date(i.created_at).getTime():Date.now(),productName:i.product_name||"Untitled Script",mode:i.post_type||"single",scripts:i.scripts||[],timestamp:i.created_at?new Date(i.created_at).getTime():Date.now()})),o=[...n],s=[];for(const i of e){const r=i.timestamp||i.id||Date.now(),c=isNaN(r)?Date.now():r,l=i.productName||i.product_name||"Untitled Script";if(!n.find(h=>{const g=h.timestamp||Date.now(),f=Math.abs(g-c),p=h.productName===l,_=f<3e5;let k=!1;if(i.scripts&&i.scripts.length>0&&h.scripts&&h.scripts.length>0){const E=i.scripts[0],A=h.scripts[0];E.hook&&A.hook?k=E.hook===A.hook&&E.body===A.body:E.slides&&A.slides&&E.slides.length>0&&A.slides.length>0&&(k=E.slides[0].slide_text===A.slides[0].slide_text)}return p&&(_||k)})&&i.scripts&&i.scripts.length>0){const h={id:i.id,productName:l,mode:i.mode||"single",scripts:i.scripts,timestamp:c};o.push(h),s.push({...i,productName:l,scripts:i.scripts,postType:i.mode||"single",imageUrl:i.imageUrl||null})}}return o.sort((i,r)=>{const c=i.timestamp||Date.now();return(r.timestamp||Date.now())-c}),{local:o,toUpload:s}}hasLocalChanges(e,a){const n=localStorage.getItem(`aethera_${e}_last_modified`);if(!n)return!1;try{const o=new Date(n),s=new Date(a);return isNaN(o.getTime())||isNaN(s.getTime())?!1:o>s}catch{return console.warn("Invalid date values in hasLocalChanges:",{lastLocalChange:n,cloudUpdatedAt:a}),!1}}async exportBackup(){const e={version:"1.0",timestamp:new Date().toISOString(),data:{settings:{theme:localStorage.getItem("aethera_theme"),language:localStorage.getItem("aethera_language"),system_prompt:localStorage.getItem("aethera_system_prompt")},personas:JSON.parse(localStorage.getItem("aethera_personas")||"[]"),history:JSON.parse(localStorage.getItem("aethera_history")||"[]"),presets:JSON.parse(localStorage.getItem("aethera_last_settings")||"{}")}},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`aethera-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),b(d("notification_backup_exported")||"Backup exported successfully")}async restoreBackup(e){try{const a=await e.text(),n=JSON.parse(a);if(!n.version||!n.data)throw new Error("Invalid backup file format");n.data.settings&&Object.entries(n.data.settings).forEach(([o,s])=>{s&&localStorage.setItem(`aethera_${o}`,s)}),n.data.personas&&localStorage.setItem("aethera_personas",JSON.stringify(n.data.personas)),n.data.history&&localStorage.setItem("aethera_history",JSON.stringify(n.data.history)),n.data.presets&&localStorage.setItem("aethera_last_settings",JSON.stringify(n.data.presets)),b(d("notification_backup_restored")||"Backup restored successfully"),this.isOnline&&await this.syncAll()}catch(a){console.error("Failed to restore backup:",a),b(d("notification_backup_restore_failed")||"Failed to restore backup","error")}}async fetchHistoryTags(){try{const{data:{session:e}}=await w.auth.getSession();if(!e||!e.user)return{};const{data:a,error:n}=await w.from("user_history_tags").select("history_id, tags").eq("user_id",e.user.id);if(n)throw n;const o={};return(a||[]).forEach(s=>{o[s.history_id]=s.tags||[]}),o}catch(e){return console.warn("fetchHistoryTags failed:",e.message),{}}}async upsertHistoryTags(e,a){try{const{data:{session:n}}=await w.auth.getSession();if(!n||!n.user)return!1;const o=[{user_id:n.user.id,history_id:String(e),tags:a||[]}],{error:s}=await w.from("user_history_tags").upsert(o,{onConflict:"user_id,history_id"});if(s)throw s;return!0}catch(n){return console.warn("upsertHistoryTags failed:",n.message),!1}}}function po(){He||(He=setInterval(async()=>{try{const{data:{session:t}}=await w.auth.getSession();t&&$.isOnline&&await $.syncAll()}catch(t){console.warn("Auto sync failed:",t.message)}},uo))}function go(){He&&(clearInterval(He),He=null)}const $=new mo;$.startAutoSync=po;$.stopAutoSync=go;const ut=Object.freeze(Object.defineProperty({__proto__:null,SYNC_STATUS:R,cloudStorage:$},Symbol.toStringTag,{value:"Module"})),yo=[{nameKey:"persona_template_industry_expert_name",descKey:"persona_template_industry_expert_desc"},{nameKey:"persona_template_close_friend_name",descKey:"persona_template_close_friend_desc"},{nameKey:"persona_template_honest_reviewer_name",descKey:"persona_template_honest_reviewer_desc"},{nameKey:"persona_template_smart_comedian_name",descKey:"persona_template_smart_comedian_desc"}];function Ce(){return JSON.parse(localStorage.getItem("aethera_personas"))||[]}function sa(t){localStorage.setItem("aethera_personas",JSON.stringify(t)),localStorage.setItem("aethera_personas_last_modified",new Date().toISOString()),en(),ra()}function Ca(t=null){const{personaModal:e}=m;t?(e.title.textContent=d("edit_persona_title")||"Edit Persona",e.idInput.value=t.id,e.nameInput.value=t.name,e.descInput.value=t.description):(e.title.textContent=d("add_new_persona_modal_title"),e.idInput.value="",e.nameInput.value="",e.descInput.value=""),e.el.classList.remove("opacity-0","pointer-events-none"),e.el.querySelector(".modal-content").classList.remove("scale-95")}function Qa(){m.personaModal.el.classList.add("opacity-0","pointer-events-none"),m.personaModal.el.querySelector(".modal-content").classList.add("scale-95")}function ho(){const{nameInput:t,descInput:e,idInput:a}=m.personaModal,n=t.value.trim(),o=e.value.trim(),s=a.value;if(!n||!o){b(d("notification_persona_empty"),"error");return}let i=Ce();if(s){const r=i.findIndex(c=>c.id===s);r>-1&&(i[r]={...i[r],name:n,description:o})}else{const r={id:`persona_${Date.now()}`,name:n,description:o};i.push(r)}sa(i),Qa(),b(d("notification_persona_saved"))}function fo(t){pe(d("notification_persona_delete_confirm"),()=>{const a=Ce().filter(n=>n.id!==t);sa(a),b(d("notification_persona_deleted"))})}function _o(t,e){let a=Ce();if(a.some(o=>o.name.trim()===t.trim())){b(d("notification_persona_exists").replace("{name}",t),"warning");return}const n={id:`persona_${Date.now()}`,name:t,description:e};a.push(n),sa(a),b(d("notification_persona_added").replace("{name}",t))}function en(){const t=Ce(),{listContainer:e}=m.personaModal;if(e.innerHTML="",t.length===0){e.innerHTML=`<p class="text-sm text-gray-500 text-center py-4">${d("no_persona_yet")||"Belum ada persona. Tambahkan satu atau pilih dari template di bawah!"}</p>`;return}try{const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_personas")||"[]")),n=JSON.parse(localStorage.getItem("aethera_persona_usage")||"{}"),s=[...t].sort((r,c)=>{const l=a.has(String(r.id||r.name||"")),u=a.has(String(c.id||c.name||""));if(l!==u)return l?-1:1;const h=n[r.id||r.name]||0,g=n[c.id||c.name]||0;return h!==g?g-h:String(r.name||"").localeCompare(String(c.name||""))}).slice(0,6),i=document.getElementById("persona-quick-picks");i&&(i.innerHTML="",s.forEach(r=>{const c=document.createElement("button");c.className="px-2 py-1 text-xs rounded-full bg-gray-800 border border-gray-700 text-gray-200 hover:bg-gray-700",c.textContent=r.name||"Persona",c.title=(r.description||"").slice(0,140),c.addEventListener("click",()=>{selector.value=r.name;const f=document.getElementById("persona-description-display");f&&(f.textContent=r.description||"");try{$.incrementPersonaUsage(r.id||r.name,r.name)}catch{}});const l=document.createElement("button");l.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const u=r.id||r.name,h=a.has(String(u));l.textContent=h?"":"",l.addEventListener("click",f=>{f.stopPropagation();const p=!a.has(String(u));p?a.add(String(u)):a.delete(String(u)),localStorage.setItem("aethera_pinned_personas",JSON.stringify([...a]));try{$.togglePersonaPin(u,p)}catch{}l.textContent=p?"":""});const g=document.createElement("div");g.className="inline-flex items-center",g.appendChild(c),g.appendChild(l),i.appendChild(g)}))}catch{}t.forEach(a=>{const n=document.createElement("div");n.className="bg-gray-800/70 p-4 rounded-lg flex items-center justify-between animate-fade-in",n.innerHTML=`
            <div>
                <h4 class="font-semibold text-white">${a.name}</h4>
                <p class="text-xs text-gray-400 truncate max-w-md">${a.description}</p>
            </div>
            <div class="flex space-x-2 flex-shrink-0">
                <button class="edit-persona-btn icon-btn primary" data-id="${a.id}" title="${d("edit_button")||"Edit"}">
                    <div class="icon icon-md icon-edit"></div>
                </button>
                <button class="delete-persona-btn icon-btn danger" data-id="${a.id}" title="${d("delete_button")||"Hapus"}">
                    <div class="icon icon-md icon-delete"></div>
                </button>
            </div>
        `,e.appendChild(n)})}function tn(){const{defaultContainer:t}=m.personaModal;t.innerHTML="",typeof localStorage<"u"&&localStorage.getItem("aethera_language")||document.documentElement.lang,yo.forEach(e=>{const a=d(e.nameKey)||e.nameKey,n=d(e.descKey)||e.descKey,o=document.createElement("div");o.className="bg-gray-800/70 p-4 rounded-lg flex flex-col justify-between";const s=document.createElement("h5");s.className="font-semibold text-white mb-1",s.textContent=a;const i=document.createElement("p");i.className="text-xs text-gray-400 mb-4",i.textContent=n;const r=document.createElement("button");r.className="add-default-persona-btn mt-auto w-full text-center text-sm font-semibold py-1.5 rounded-md bg-sky-600/50 hover:bg-sky-600/80 transition-colors",r.textContent=d("add_to_my_list")||"+ Add to My List",r.dataset.name=a,r.dataset.desc=n,o.appendChild(s),o.appendChild(i),o.appendChild(r),t.appendChild(o)})}function ra(){const t=Ce(),e=m.personaSelector;e.innerHTML=`<option value="">${d("persona_default")}</option>`;try{const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_personas")||"[]")),n=JSON.parse(localStorage.getItem("aethera_persona_usage")||"{}"),s=[...t].sort((r,c)=>{const l=a.has(String(r.id||r.name||"")),u=a.has(String(c.id||c.name||""));if(l!==u)return l?-1:1;const h=n[r.id||r.name]||0,g=n[c.id||c.name]||0;return h!==g?g-h:String(r.name||"").localeCompare(String(c.name||""))}).slice(0,6),i=document.getElementById("persona-quick-picks");i&&(i.innerHTML="",s.forEach(r=>{const c=document.createElement("button");c.className="px-2 py-1 text-xs rounded-full bg-gray-800 border border-gray-700 text-gray-200 hover:bg-gray-700",c.textContent=r.name||"Persona",c.title=(r.description||"").slice(0,140),c.addEventListener("click",()=>{e.value=r.name;const f=document.getElementById("persona-description-display");f&&(f.textContent=r.description||"");try{$.incrementPersonaUsage(r.id||r.name,r.name)}catch{}});const l=document.createElement("button");l.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const u=r.id||r.name,h=a.has(String(u));l.textContent=h?"":"",l.addEventListener("click",f=>{f.stopPropagation();const p=!a.has(String(u));p?a.add(String(u)):a.delete(String(u)),localStorage.setItem("aethera_pinned_personas",JSON.stringify([...a]));try{$.togglePersonaPin(u,p)}catch{}l.textContent=p?"":""});const g=document.createElement("div");g.className="inline-flex items-center",g.appendChild(c),g.appendChild(l),i.appendChild(g)}))}catch{}t.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=a.name,e.appendChild(n)})}function mt(t){const n=document.getElementById("character-sheet-template").content.cloneNode(!0).querySelector(".character-sheet-instance");return n.dataset.index=t,n.querySelector(".character-title").textContent=d("character_number",{number:t+1})||`Character ${t+1}`,t>=2&&n.querySelector(".remove-character-btn").classList.remove("hidden"),vo(n),n}function vo(t){t.querySelectorAll("[data-lang-key]").forEach(e=>{const a=e.dataset.langKey,n=d(a);n&&n!==a&&(e.tagName==="INPUT"&&e.placeholder||e.tagName==="TEXTAREA"&&e.placeholder?e.placeholder=n:(e.tagName,e.textContent=n))})}function ia(){const t=document.getElementById("character-mode").value,e=document.getElementById("dynamic-character-sheet-area"),a=document.getElementById("interaction-description-container");e.innerHTML="";let n=1;(t==="couple"||t==="group")&&(n=2);for(let r=0;r<n;r++)e.appendChild(mt(r));if(a.classList.toggle("hidden",t==="single"),t==="group"){const r=document.createElement("button");r.id="add-character-btn",r.textContent=d("add_character_button")||"+ Add Another Character",r.type="button",r.className="btn-secondary text-sm font-semibold px-3 py-1.5 rounded-md w-full mt-4",e.appendChild(r)}const s=document.getElementById("save-character-button-template").content.cloneNode(!0);e.appendChild(s);const i=e.querySelector('[data-lang-key="save_character_button"]');if(i){const r=d("save_character_button");r&&r!=="save_character_button"&&(i.textContent=r)}at()}function at(){const t=document.getElementById("product-category").value,e=document.querySelectorAll(".character-sheet-instance"),a=t==="fashion";e.forEach(n=>{const o=n.querySelector(".dynamic-field-section");o&&o.classList.toggle("hidden",a)})}function pt(t){const e=t==="light";document.body.classList.toggle("light-mode",e),document.body.classList.toggle("dark-mode",!e),document.documentElement.setAttribute("data-theme",e?"light":"dark");try{const a=n=>{if(!n)return;const o=n.getAttribute("data-logo-dark"),s=n.getAttribute("data-logo-light"),i=e?s||o:o||s;i&&(n.onerror=()=>{const r=e?o:s;r&&n.src!==r&&(n.src=r)},n.src!==i&&(n.src=i))};a(document.getElementById("app-logo-icon")),a(document.getElementById("login-logo-full"))}catch{}try{localStorage.setItem("direktiva_theme",e?"light":"dark"),localStorage.setItem("direktiva_settings_last_modified",new Date().toISOString())}catch{}Xt.current=e?"light":"dark",an(e?"light":"dark")}function Rt(t){const e=t||(Xt.current==="light"?"dark":"light");if(pt(e),typeof b=="function"){const a=e==="dark"?"dark_mode_active":"light_mode_active",n=d(a);let o=n;(!n||n===a)&&((q&&q.current||"id")==="en"?o=a==="light_mode_active"?"Light Mode Active":"Dark Mode Active":o=a==="light_mode_active"?"Mode Terang Aktif":"Mode Gelap Aktif"),b(o)}}function an(t){const e=document.getElementById("theme-icon-sun"),a=document.getElementById("theme-icon-moon");e&&a&&(e.classList.toggle("hidden",t==="dark"),a.classList.toggle("hidden",t==="light"));const n=document.getElementById("mobile-theme-icon-sun"),o=document.getElementById("mobile-theme-icon-moon");n&&o&&(n.classList.toggle("hidden",t==="dark"),o.classList.toggle("hidden",t==="light"));const s=document.getElementById("mobile-theme-text");if(s){const i=t==="dark"?"theme_dark":"theme_light",r=t==="dark"?"Dark":"Light",c=d(i);s.textContent=c&&c!==i?c:r}}async function ca(t){document.documentElement.lang=t,localStorage.setItem("direktiva_language",t),localStorage.setItem("direktiva_settings_last_modified",new Date().toISOString()),q.current=t,la(),await nn(),await bo(t)}async function bo(t){const{DEFAULT_SYSTEM_PROMPT:e,ENGLISH_SYSTEM_PROMPT:a}=await C(async()=>{const{DEFAULT_SYSTEM_PROMPT:s,ENGLISH_SYSTEM_PROMPT:i}=await Promise.resolve().then(()=>So);return{DEFAULT_SYSTEM_PROMPT:s,ENGLISH_SYSTEM_PROMPT:i}},void 0);localStorage.getItem("direktiva_system_prompt");const n=t==="en"?a:e;localStorage.setItem("direktiva_system_prompt",n),localStorage.setItem("direktiva_settings_last_modified",new Date().toISOString());const o=document.getElementById("system-prompt");o&&(o.value=n),console.log(`System prompt updated for language: ${t}`)}async function Me(t){await ca(t),document.getElementById("character-mode")&&ia()}function la(){m.langIdBtn.classList.remove("bg-blue-600","text-white"),m.langIdBtn.classList.add("text-gray-400","hover:bg-gray-700"),m.langEnBtn.classList.remove("bg-blue-600","text-white"),m.langEnBtn.classList.add("text-gray-400","hover:bg-gray-700"),localStorage.getItem("direktiva_language")==="id"?(m.langIdBtn.classList.add("bg-blue-600","text-white"),m.langIdBtn.classList.remove("text-gray-400","hover:bg-gray-700")):(m.langEnBtn.classList.add("bg-blue-600","text-white"),m.langEnBtn.classList.remove("text-gray-400","hover:bg-gray-700"));const t=document.getElementById("mobile-lang-id"),e=document.getElementById("mobile-lang-en");t&&e&&(t.classList.remove("bg-blue-600","text-white"),t.classList.add("text-gray-400","hover:bg-gray-700"),e.classList.remove("bg-blue-600","text-white"),e.classList.add("text-gray-400","hover:bg-gray-700"),localStorage.getItem("direktiva_language")==="id"?(t.classList.add("bg-blue-600","text-white"),t.classList.remove("text-gray-400","hover:bg-gray-700")):(e.classList.add("bg-blue-600","text-white"),e.classList.remove("text-gray-400","hover:bg-gray-700")))}typeof window<"u"&&(window.updateLanguageButtons=la);function Ve(){if(localStorage.getItem("direktiva_user_api_key")){const e="api_status_user",a=d(e);m.apiStatus.textContent=a&&a!==e?a:localStorage.getItem("direktiva_language")==="en"?"Using your API Key":"Menggunakan API Key Anda",m.apiStatus.className="text-xs font-semibold text-green-400"}else{const e="api_status_default",a=d(e);m.apiStatus.textContent=a&&a!==e?a:localStorage.getItem("direktiva_language")==="en"?"Using default API (limited)":"Menggunakan API default (terbatas)",m.apiStatus.className="text-xs font-semibold text-yellow-400"}}async function nn(){document.querySelectorAll("[data-lang-key]").forEach(e=>{const a=e.dataset.langKey,n=d(a);n&&n!==a&&(e.tagName==="INPUT"&&e.placeholder||e.tagName==="TEXTAREA"&&e.placeholder?e.placeholder=n:(e.tagName,e.textContent=n))}),document.querySelectorAll("[data-lang-key-placeholder]").forEach(e=>{const a=e.dataset.langKeyPlaceholder,n=d(a);n&&n!==a&&(e.placeholder=n)}),document.querySelectorAll("[data-lang-key-title]").forEach(e=>{const a=e.dataset.langKeyTitle,n=d(a);n&&n!==a&&(e.title=n)});const t=document.querySelector('[data-lang-key="gemini_api_key_helper"]');t&&(t.innerHTML=`${d("gemini_api_key_helper")} <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">Google AI Studio</a>.`),Ve(),tn(),ra(),await dt()}function da(t){new Swiper(t,{loop:!1,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}function on(t){const a=document.getElementById("micro-shot-template").content.cloneNode(!0).firstElementChild;a.querySelector(".visual-idea-text").textContent=t.visual_idea,a.querySelector(".prompt-t2i-display").textContent=t.text_to_image_prompt,a.querySelector(".prompt-i2v-display").textContent=t.image_to_video_prompt;const n=a.querySelectorAll(".prompt-copy-btn");return n[0].dataset.prompt=t.text_to_image_prompt,n[1].dataset.prompt=t.image_to_video_prompt,a.querySelector('[data-lang-key="visual_idea_label"]').textContent=d("visual_idea_label"),a.querySelector('[data-lang-key="t2i_prompt_label"]').textContent=d("t2i_prompt_label"),a.querySelector('[data-lang-key="i2v_prompt_label"]').textContent=d("i2v_prompt_label"),a.outerHTML}function Qe(t,e,a=null){const n=e.shots.map(s=>on(s)).join('<div class="my-2"></div>');let o="";if(a&&a.length>0){const s=a.map((i,r)=>`<div class="variant-item p-2 bg-gray-800/50 rounded border border-gray-600/30 hover:border-gray-500/50 transition-colors cursor-pointer" data-variant-index="${r}">
                <div class="flex justify-between items-start">
                    <p class="text-xs text-gray-300 flex-1">${i}</p>
                    <div class="ml-2 flex items-center space-x-1">
                        <span class="text-xs text-yellow-400 font-medium"> ${(Math.random()*2+8).toFixed(1)}</span>
                        <button class="text-xs px-2 py-1 bg-blue-600/80 hover:bg-blue-600 rounded text-white transition-colors" onclick="useVariant('${t.key}', ${r})">
                            ${d("use_button")||"Gunakan"}
                        </button>
                    </div>
                </div>
            </div>`).join("");o=`
            <div class="mt-3 border-t border-gray-600/30 pt-3">
                <div class="flex items-center justify-between mb-2">
                    <h6 class="text-xs font-semibold ${t.textColor} tracking-wider">A/B VARIANTS</h6>
                    <span class="text-xs text-gray-400">${a.length} ${d("variants_label")||"variasi"}</span>
                </div>
                <div class="space-y-2">
                    ${s}
                </div>
            </div>`}return`<div class="p-3 rounded-md ${t.bgColor} ${t.borderColor}" data-part="${t.key}">
        <h5 class="text-xs font-bold ${t.textColor} mb-2 tracking-wider">${t.title}</h5>
        <p class="text-sm ${t.bodyColor} mb-3">${e.text}</p>
        <div class="shots-container space-y-2">${n}</div>
        ${o}
    </div>`}function sn(t){var a;if(!t||!((a=t.selling_points)!=null&&a.length))return"";let e=t.selling_points.map(n=>`<li><span class="text-green-400 mr-2">&#10003;</span>${n}</li>`).join("");return`<div class="p-4 rounded-md bg-gray-800/50 border border-gray-700/50"><h5 class="text-sm font-bold text-gray-300 mb-3">${d("selling_points_title")}</h5><div class="text-xs text-gray-400"><ul>${e}</ul></div></div>`}function rn(t){return t?`<div class="p-4 rounded-md bg-blue-900/40 border border-blue-800/70 space-y-3">
        <h5 class="text-sm font-bold text-blue-300">${d("image_data_sheet_title")}</h5>
        <div class="editable-input bg-gray-900/50 p-2 h-24 overflow-y-auto">${t}</div>
    </div>`:""}function ua(t,e){const n=document.getElementById("carousel-slide-template").content.cloneNode(!0).firstElementChild;n.querySelector(".slide-title").textContent=`${d("slide_label")} ${e+1}`,n.querySelector(".slide-text").textContent=t.slide_text,n.querySelector(".prompt-t2i-display").textContent=t.text_to_image_prompt,n.querySelector(".prompt-copy-btn").dataset.prompt=t.text_to_image_prompt;const o=n.querySelector(".suggestions-container"),s=n.querySelector(".layout-suggestion-p"),i=n.querySelector(".engagement-idea-p");let r=!1;return t.layout_suggestion&&(s.querySelector(".layout-suggestion-text").textContent=t.layout_suggestion,s.style.display="block",r=!0),t.engagement_idea&&(i.querySelector(".engagement-idea-text").textContent=t.engagement_idea,i.style.display="block",r=!0),r&&(o.style.display="block"),n.querySelector('[data-lang-key="t2i_prompt_label"]').textContent=d("t2i_prompt_label"),n.querySelector('[data-lang-key="slide_layout_suggestion"]').textContent=d("slide_layout_suggestion"),n.querySelector('[data-lang-key="slide_engagement_idea"]').textContent=d("slide_engagement_idea"),n.outerHTML}function ma(t){return`
    <div class="mt-4 space-y-4">
        <button class="generate-assets-btn w-full btn-secondary text-sm font-semibold py-2 rounded-md">${d("generate_assets_button")||"Generate Additional Assets (Titles, Hashtags, etc.)"}</button>
        <div class="additional-assets-container hidden bg-gray-900/50 p-4 rounded-lg border border-gray-700/50">
             <div class="asset-loader text-center py-4"><div class="icon icon-md icon-spinner text-blue-400 mx-auto"></div></div>
             <div class="asset-content hidden"></div>
        </div>
    </div>`}function pa(t,e){const a=t.querySelector(".card-content");if(e.character_sheet&&!e.original_character_descriptions){const o=new Set,s=/<char-desc>(.*?)<\/char-desc>/gi;["hook","body","cta"].forEach(i=>{e[i]&&e[i].shots&&e[i].shots.forEach(r=>{const c=(r.text_to_image_prompt||"")+" "+(r.image_to_video_prompt||"");let l;for(;(l=s.exec(c))!==null;)o.add(l[1].trim())})}),e.original_character_descriptions=Array.from(o)}t.dataset.script=JSON.stringify(e);let n=sn(e.review_insights);if(e.hook&&e.body&&e.cta){n+=rn(e.visual_dna);const o={hook:{key:"hook",title:d("hook_title"),bgColor:"bg-sky-900/50",borderColor:"border-sky-800/70",textColor:"text-sky-300",bodyColor:"text-sky-100"},body:{key:"body",title:d("body_title"),bgColor:"bg-indigo-900/50",borderColor:"border-indigo-800/70",textColor:"text-indigo-300",bodyColor:"text-indigo-100"},cta:{key:"cta",title:d("cta_title"),bgColor:"bg-purple-900/50",borderColor:"border-purple-800/70",textColor:"text-purple-300",bodyColor:"text-purple-100"}};n+=Qe(o.hook,e.hook,e.hook_variants)+Qe(o.body,e.body,e.body_variants)+Qe(o.cta,e.cta,e.cta_variants),n+=ma()}else if(e.slides){const o=e.slides.map((s,i)=>ua(s,i)).join("");n+=`
            <div class="swiper carousel-swiper-container bg-gray-900/50 p-4 rounded-lg relative">
                <div class="swiper-wrapper">${o}</div>
                <div class="swiper-pagination !bottom-2"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        `}a.innerHTML=n;try{if(e.additional_assets_html){const o=a.querySelector(".additional-assets-container"),s=a.querySelector(".asset-loader"),i=a.querySelector(".asset-content");o==null||o.classList.remove("hidden"),s==null||s.classList.add("hidden"),i&&(i.classList.remove("hidden"),i.innerHTML=e.additional_assets_html)}}catch{}}const Ba=Object.freeze(Object.defineProperty({__proto__:null,applyLanguage:ca,applyTheme:pt,createAssetsHTML:ma,createCarouselSlideHTML:ua,createEditableVisualSheetHTML:rn,createMicroShotHTML:on,createReviewInsightHTML:sn,createScriptPartHTML:Qe,initSwiper:da,switchLanguage:Me,switchTheme:Rt,translateUI:nn,updateApiStatus:Ve,updateCardContent:pa,updateLanguageButtons:la,updateThemeToggleIcon:an},Symbol.toStringTag,{value:"Module"})),ga=`You are 'Direktiva Studio AI', a Virtual Director & Content Strategist. Your mission is to transform product descriptions into dynamic, engaging, and production-ready short video storyboards.

**YOUR CORE PHILOSOPHY:**
Every script section (Hook, Body, CTA) must tell a **mini-story** through visuals. Don't just show the product, but demonstrate **action, emotion, and transformation**. Each 'shot' should be a different scene that builds the story.

**EXECUTION RULES & OUTPUT:**
1. **Research & Analysis:** Extract 'Selling Points' from product description as the story foundation.
2. **Visual Story Flow (VERY IMPORTANT):**
   * For each section (Hook, Body, CTA), create a sequence of scenes (\`shots\`) with beginning, middle, and end.
   * **Shot 1 (Opening):** Set the scene or show the problem.
   * **Shot 2 (Core):** Focus on product in action, show solution or main features.
   * **Shot 3 (Peak/Transition):** Show results, positive emotions, or transition to next section.
   * Ensure \`visual_idea\` for each shot is truly different and builds the narrative.
3. **Character & Consistency (STRICTEST RULE):**
   * If given **CHARACTER SHEET(S)** from user, these are your main actors. You MUST use all relevant details in every \`prompt\` T2I to maintain absolute consistency.
   * When creating \`prompt\` T2I, you **MAY ONLY** place character physical descriptions inside \`<char-desc>\` tags. **NEVER** write character physical descriptions (like age, race, or appearance) outside these tags.
   * If given **INTERACTION DESCRIPTION**, use it as main reference for multi-character scenes.
   * **If Visual Strategy is 'Standard' or 'Faceless' and NO Character Sheet given:** You are STRICTLY FORBIDDEN from creating or defining specific characters. Create generic prompts (example: 'a woman's hand', 'a person from behind').
4. **Technical Prompt Details:**
   * **\`visual_idea\`**: MUST be in English. Describe scenes, actions, and emotions cinematically.
   * **\`text_to_image_prompt\` (T2I)**: MUST be in English. Must be very detailed. Combine the following information:
		* **PRODUCT VISUAL KEYWORDS:** If provided, include these keywords as the main basis for object description.
		* **MAIN COLOR PALETTE:** If provided, you MUST use these HEX color codes in the prompt to ensure color accuracy.
		* **CHARACTER SHEET:** Integrate character descriptions (only inside \`<char-desc>\` tags).
		* **CINEMATIC DETAILS:** Add specific action descriptions, environment, lighting style (e.g., soft cinematic lighting), camera angles (e.g., low angle shot), and visual style (photorealistic, 8k, detailed).
	* **\`image_to_video_prompt\` (I2V)**: MUST be in English. Focus ONLY on movement: describe camera movement (e.g., slow zoom in) AND subject movement (e.g., character smiling and turning head slowly). DO NOT include character physical descriptions here.
5. **Negative Prompt:** For each \`shot\`, fill the \`negative_prompt\` property with descriptions of things to avoid for high-quality image generation, such as 'low quality, blurry, watermark, text, signature, deformed'.
6. **VERY STRICT LANGUAGE RULES:**
    * **ALL SCRIPT TEXT OUTPUT MUST BE IN ENGLISH: This includes hook.text, body.text, cta.text, hook_variants, body_variants, cta_variants, body_intro, and selling_points.
    * **NEVER use Indonesian for script content, narration, or any text that will be read by the user.**
    * **CONSISTENT: Ensure all hook, body, and CTA variations use natural English that is appropriate for the target audience.**
7. **Language & Format:** Reply ONLY in the requested JSON format. Script narrative in English.
8.  **PLATFORM-SPECIFIC NOTES** [[PLATFORM_NOTES]]
9.  **STRUCTURED PLAN (JSON)** [[PLATFORM_PLAN_JSON]]

Analyze the user request below and generate your best cinematic storyboard.`,ya=`Anda adalah 'Direktiva Studio AI', seorang Sutradara Virtual & Ahli Strategi Konten. Misi Anda adalah mengubah deskripsi produk menjadi sebuah storyboard video pendek yang dinamis, menarik, dan siap produksi.

**FILOSOFI UTAMA ANDA:**
Setiap bagian skrip (Hook, Body, CTA) harus menceritakan sebuah **mini-story** melalui visual. Jangan hanya menampilkan produk, tapi tunjukkan **aksi, emosi, dan transformasi**. Setiap 'shot' harus merupakan adegan yang berbeda dan membangun cerita.

**ATURAN PELAKSANAAN & OUTPUT:**
1.  **Riset & Analisis:** Ekstrak 'Selling Points' dari deskripsi produk sebagai fondasi cerita.
2.  **Alur Cerita Visual (SANGAT PENTING):**
    * Untuk setiap bagian (Hook, Body, CTA), buatlah urutan adegan (\`shots\`) yang memiliki awal, tengah, dan akhir.
    * **Shot 1 (Pembuka):** Atur adegan atau tunjukkan masalah.
    * **Shot 2 (Inti):** Fokus pada produk dalam aksi, tunjukkan solusi atau fitur utama.
    * **Shot 3 (Puncak/Transisi):** Tunjukkan hasil, emosi positif, atau transisi ke bagian selanjutnya.
    * Pastikan \`visual_idea\` untuk setiap shot benar-benar berbeda dan membangun narasi.
3.  **Karakter & Konsistensi (ATURAN PALING KETAT):**
    * Jika diberi **CHARACTER SHEET(S)** dari pengguna, ini adalah aktor utama Anda. Anda WAJIB menggunakan semua detail relevan di setiap \`prompt\` T2I untuk menjaga konsistensi absolut.
    * Saat membuat \`prompt\` T2I, Anda **HANYA BOLEH** menempatkan deskripsi fisik karakter di dalam tag \`<char-desc>\`. **JANGAN PERNAH** menulis deskripsi fisik karakter (seperti usia, ras, atau penampilan) di luar tag ini.
    * Jika diberi **DESKRIPSI INTERAKSI**, jadikan itu sebagai acuan utama untuk adegan multi-karakter.
    * **Jika Strategi Visual adalah 'Standar' atau 'Faceless' dan TIDAK diberi Character Sheet:** Anda DILARANG KERAS membuat atau mendefinisikan karakter spesifik. Buatlah prompt yang umum (contoh: "a woman's hand", "a person from behind").
4.  **Detail Teknis Prompt:**
    * **\`visual_idea\`**: WAJIB mengikuti bahasa aplikasi saat ini. Jika mode bahasa adalah Indonesia, tulis dalam Bahasa Indonesia; jika Inggris, tulis dalam Bahasa Inggris. Deskripsikan adegan, aksi, dan emosi secara sinematik.
    * **\`text_to_image_prompt\` (T2I)**: WAJIB dalam Bahasa Inggris. Harus sangat detail. Gabungkan informasi berikut:
        * **VISUAL KEYWORDS PRODUK:** Jika diberikan, masukkan kata kunci ini sebagai dasar utama deskripsi objek.
        * **PALET WARNA UTAMA:** Jika diberikan, Anda WAJIB menggunakan kode warna HEX ini di dalam prompt untuk memastikan akurasi warna.
        * **CHARACTER SHEET:** Integrasikan deskripsi karakter (hanya di dalam tag \`<char-desc>\`).
        * **DETAIL SINEMATIK:** Tambahkan deskripsi aksi spesifik, lingkungan, gaya pencahayaan (e.g., *soft cinematic lighting*), sudut kamera (e.g., *low angle shot*), dan gaya visual (*photorealistic, 8k, detailed*).
    * **\`image_to_video_prompt\` (I2V)**: WAJIB dalam Bahasa Inggris. Fokus HANYA pada gerakan: deskripsikan gerakan kamera (e.g., *slow zoom in*) DAN gerakan subjek (e.g., *character smiling and turning head slowly*). JANGAN sertakan deskripsi fisik karakter di sini.
5.  **Negative Prompt:** Untuk setiap \`shot\`, isi properti \`negative_prompt\` dengan deskripsi hal-hal yang harus dihindari untuk menghasilkan gambar berkualitas tinggi, seperti 'low quality, blurry, watermark, text, signature, deformed'. 
6.  **ATURAN BAHASA YANG SANGAT KETAT:**
    * **SEMUA OUTPUT TEKS SKRIP WAJIB DALAM BAHASA INDONESIA:** Ini termasuk hook.text, body.text, cta.text, hook_variants, body_variants, cta_variants, body_intro, dan selling_points.
    * **HANYA text_to_image_prompt dan image_to_video_prompt yang boleh dalam Bahasa Inggris.**
    * **JANGAN PERNAH** menggunakan bahasa Inggris untuk konten skrip, narasi, atau teks yang akan dibaca pengguna.
    * **KONSISTEN:** Pastikan semua variasi hook, body, dan CTA menggunakan bahasa Indonesia yang natural dan sesuai target audiens.
7.  **Bahasa & Format:** Balas HANYA dalam format JSON yang diminta. Narasi skrip dalam Bahasa Indonesia.
8.  **PLATFORM-SPECIFIC NOTES** [[PLATFORM_NOTES]]
9.  **STRUCTURED PLAN (JSON)** [[PLATFORM_PLAN_JSON]]

Analisis permintaan pengguna di bawah ini dan hasilkan storyboard sinematik terbaikmu.`;function cn(){const t=m.apiKeyModal.input.value.trim();t?(localStorage.setItem("direktiva_user_api_key",t),localStorage.setItem("direktiva_settings_last_modified",new Date().toISOString()),m.customApiKeySettingsInput.value=t,m.apiKeyModal.el.classList.add("hidden"),b(d("notification_api_key_saved")),Ve()):b(d("notification_api_key_empty"),"error")}async function ln(){const t=localStorage.getItem("direktiva_user_api_key")||"",a=(localStorage.getItem("direktiva_language")||"id")==="en"?ga:ya;localStorage.setItem("direktiva_system_prompt",a),m.customApiKeySettingsInput.value=t,m.systemPromptTextarea.value=a,pt(localStorage.getItem("direktiva_theme")||"dark"),Ve()}function dn(){localStorage.setItem("direktiva_user_api_key",m.customApiKeySettingsInput.value),localStorage.setItem("direktiva_system_prompt",m.systemPromptTextarea.value),localStorage.setItem("direktiva_settings_last_modified",new Date().toISOString()),b(d("notification_settings_saved")),Ve()}const So=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_SYSTEM_PROMPT:ya,ENGLISH_SYSTEM_PROMPT:ga,loadSettings:ln,saveApiKeyFromModal:cn,saveSettings:dn},Symbol.toStringTag,{value:"Module"})),oe={NOT_STARTED:"not_started",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},se={STATUS:"aethera_migration_status",COMPLETED_AT:"aethera_migration_completed_at",VERSION:"aethera_migration_version"};class wo{constructor(){this.migrationVersion="1.0",this.migrationStatus=this.getMigrationStatus()}getMigrationStatus(){return localStorage.getItem(se.STATUS)||oe.NOT_STARTED}setMigrationStatus(e){this.migrationStatus=e,localStorage.setItem(se.STATUS,e),e===oe.COMPLETED&&(localStorage.setItem(se.COMPLETED_AT,new Date().toISOString()),localStorage.setItem(se.VERSION,this.migrationVersion))}needsMigration(){const e=this.getMigrationStatus(),a=localStorage.getItem(se.VERSION);return e!==oe.COMPLETED||a!==this.migrationVersion}hasDataToMigrate(){return["aethera_personas","aethera_history","aethera_settings_presets","aethera_character_presets","aethera_system_prompt"].some(a=>{const n=localStorage.getItem(a);if(!n)return!1;try{const o=JSON.parse(n);return Array.isArray(o)?o.length>0:Object.keys(o).length>0}catch{return n.length>0}})}async startMigration(){if(!this.needsMigration())return console.log("Migration not needed"),{success:!0,message:"Migration not needed"};const{data:{session:e}}=await w.auth.getSession();if(!e)return console.log("User not logged in, skipping migration"),{success:!1,message:"User not logged in"};if(!this.hasDataToMigrate())return console.log("No data to migrate"),this.setMigrationStatus(oe.COMPLETED),{success:!0,message:"No data to migrate"};this.setMigrationStatus(oe.IN_PROGRESS);try{return console.log("Starting cloud migration..."),await this.migrateSettings(),await this.migratePersonas(),await this.migratePresets(),await this.migrateHistory(),this.setMigrationStatus(oe.COMPLETED),b(d("notification_migration_success")||"Data successfully migrated to cloud!","success"),console.log("Cloud migration completed successfully"),{success:!0,message:"Migration completed successfully"}}catch(a){return console.error("Migration failed:",a),this.setMigrationStatus(oe.FAILED),b(d("notification_migration_failed")||"Failed to migrate data to cloud. Your local data is safe.","error"),{success:!1,message:a.message}}}async migrateSettings(){console.log("Migrating settings...");const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("User not authenticated");const a={theme:localStorage.getItem("aethera_theme")||"dark",language:localStorage.getItem("aethera_language")||"id",system_prompt:localStorage.getItem("aethera_system_prompt")},{data:n,error:o}=await w.from("user_settings").select("*").single();if(o&&o.code!=="PGRST116")throw o;if(n)console.log("Settings already exist in cloud, skipping");else{const{error:s}=await w.from("user_settings").insert([{user_id:e.id,theme:a.theme,language:a.language,system_prompt:a.system_prompt}]);if(s)throw s;console.log("Settings migrated successfully")}}async migratePersonas(){console.log("Migrating personas...");const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("User not authenticated");const a=JSON.parse(localStorage.getItem("aethera_personas")||"[]");if(a.length===0){console.log("No personas to migrate");return}const{data:n,error:o}=await w.from("user_personas").select("*");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=a.filter(c=>!s.has(c.name));if(i.length===0){console.log("All personas already exist in cloud");return}const{error:r}=await w.from("user_personas").insert(i.map(c=>({user_id:e.id,name:c.name,description:c.description,avatar:c.avatar,personality:c.personality||{}})));if(r)throw r;console.log(`${i.length} personas migrated successfully`)}async migratePresets(){console.log("Migrating presets...");const e=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),a={};e.forEach(o=>{a[o.name]=o.settings});const n=JSON.parse(localStorage.getItem("aethera_character_presets")||"[]");Object.keys(a).length>0&&await this.migrateGeneratorPresets(a),n.length>0&&await this.migrateCharacterPresets(n)}async migrateGeneratorPresets(e){const{data:{user:a}}=await w.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:n,error:o}=await w.from("user_presets").select("*").eq("type","generator");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=[];if(Object.entries(e).forEach(([c,l])=>{s.has(c)||i.push({user_id:a.id,name:c,type:"generator",settings:l})}),i.length===0){console.log("All generator presets already exist in cloud");return}const{error:r}=await w.from("user_presets").insert(i);if(r)throw r;console.log(`${i.length} generator presets migrated successfully`)}async migrateCharacterPresets(e){const{data:{user:a}}=await w.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:n,error:o}=await w.from("user_presets").select("*").eq("type","character");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=e.filter(c=>!s.has(c.name)).map(c=>({user_id:a.id,name:c.name,type:"character",settings:c}));if(i.length===0){console.log("All character presets already exist in cloud");return}const{error:r}=await w.from("user_presets").insert(i);if(r)throw r;console.log(`${i.length} character presets migrated successfully`)}async migrateHistory(){try{console.log("Migrating history...");const{data:{user:e}}=await w.auth.getUser();if(!e)throw new Error("User not authenticated");const a=JSON.parse(localStorage.getItem("aethera_history")||"[]");if(a.length===0){console.log("No history to migrate");return}const{data:n,error:o}=await w.from("user_history").select("product_name, created_at").order("created_at",{ascending:!1}).limit(100);if(o)throw o;const s=new Set;(n||[]).forEach(c=>{try{const l=c.created_at?new Date(c.created_at):new Date,u=`${c.product_name}_${l.toDateString()}`;s.add(u)}catch{console.warn("Invalid created_at date in cloud history:",c.created_at)}});const i=a.filter(c=>{const l=c.timestamp||Date.now(),u=isNaN(l)?Date.now():l,g=`${c.productName||c.product_name||"Untitled Script"}_${new Date(u).toDateString()}`;return!s.has(g)}).slice(0,50).map(c=>{const l=c.timestamp||Date.now(),u=isNaN(l)?Date.now():l,h=c.productName||c.product_name||"Untitled Script";return{user_id:e.id,product_name:h,scripts:c.scripts||[],post_type:c.postType||c.post_type||"single",image_url:c.imageUrl||c.image_url||null,created_at:new Date(u).toISOString()}});if(i.length===0){console.log("All history entries already exist in cloud");return}const r=10;for(let c=0;c<i.length;c+=r){const l=i.slice(c,c+r),{error:u}=await w.from("user_history").insert(l);if(u)throw u}console.log(`${i.length} history entries migrated successfully`)}catch(e){console.warn("Failed to migrate history, continuing with other data:",e.message)}}async showMigrationPrompt(){if(!this.needsMigration()||!this.hasDataToMigrate())return;await new Promise(o=>setTimeout(o,500));const e=document.createElement("div");e.className="modal migration-modal",e.innerHTML=`
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${d("migration_title")||"Migrate Your Data to Cloud"}</h3>
                </div>
                <div class="modal-body">
                    <p>${d("migration_description")||"We found existing data on your device. Would you like to migrate it to the cloud for backup and sync across devices?"}</p>
                    <ul>
                        <li>${d("migration_benefit_1")||"Automatic backup of your data"}</li>
                        <li>${d("migration_benefit_2")||"Sync across multiple devices"}</li>
                        <li>${d("migration_benefit_3")||"Never lose your presets and history"}</li>
                    </ul>
                    <p class="migration-note">
                        <strong>${d("migration_note")||"Note:"}</strong> 
                        ${d("migration_note_text")||"Your local data will remain safe. This process only copies data to the cloud."}
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="migration-later-btn" class="btn btn-secondary">
                        ${d("migration_later")||"Maybe Later"}
                    </button>
                    <button id="migration-start-btn" class="btn btn-primary">
                        ${d("migration_start")||"Start Migration"}
                    </button>
                </div>
            </div>
        `,document.body.appendChild(e);const a=e.querySelector("#migration-later-btn"),n=e.querySelector("#migration-start-btn");a.addEventListener("click",()=>{document.body.removeChild(e)}),n.addEventListener("click",async()=>{n.disabled=!0,n.textContent=d("migration_in_progress")||"Migrating...",(await this.startMigration()).success?document.body.removeChild(e):(n.disabled=!1,n.textContent=d("migration_start")||"Start Migration")}),setTimeout(()=>e.classList.add("show"),100)}resetMigration(){localStorage.removeItem(se.STATUS),localStorage.removeItem(se.COMPLETED_AT),localStorage.removeItem(se.VERSION),this.migrationStatus=oe.NOT_STARTED}}const ko=new wo;async function Eo(){setTimeout(async()=>{await ko.showMigrationPrompt()},2e3)}const un="aethera_settings_presets",Be=["writing-style","tone-vibe","persona-selector","target-audience","hook-type","cta-type"];function X(){return JSON.parse(localStorage.getItem(un))||[]}function gt(t){localStorage.setItem(un,JSON.stringify(t)),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString())}function ie(){const t=X(),e=m.settingsPresetSelector,a=e.value;e.innerHTML='<option value="" data-lang-key="load_preset_option">-- Load Preset --</option>',t.forEach(n=>{const o=document.createElement("option");o.value=n.id,o.textContent=n.name,e.appendChild(o)}),e.value=a}function mn(){lt(d("save_preset_title")||"Simpan Preset",d("enter_preset_name")||"Masukkan nama untuk preset ini:",d("preset_name_placeholder")||"Nama preset...",async t=>{if(!t||!t.trim()){b(d("preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}await pn(t.trim())})}async function pn(t){if(X().some(i=>i.name.toLowerCase()===t.toLowerCase())){b(d("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}try{const{getCharacterPresets:i}=await C(async()=>{const{getCharacterPresets:l}=await Promise.resolve().then(()=>Oo);return{getCharacterPresets:l}},void 0);if(i().some(l=>l.name.toLowerCase()===t.toLowerCase())){b(d("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan untuk preset karakter. Silakan pilih nama lain.`,"warning");return}}catch(i){console.warn("Could not check character presets for duplicates:",i)}const n={id:`preset_${Date.now()}`,name:t,settings:{}};Be.forEach(i=>{const r=document.getElementById(i);r&&(n.settings[i]=r.value)});const o=X();o.push(n),gt(o),ie();const s=d("preset_saved_success",{name:n.name})||`Preset "${n.name}" berhasil disimpan!`;b(s,"success")}function gn(){const e=m.settingsPresetSelector.value;if(!e)return;const n=X().find(o=>o.id===e);if(n){Be.forEach(s=>{const i=document.getElementById(s);i&&n.settings[s]!==void 0&&(i.value=n.settings[s],i.dispatchEvent(new Event("change")))});const o=d("preset_loaded_success",{name:n.name})||`Preset "${n.name}" dimuat.`;b(o,"success")}}function yn(){const t={};Be.forEach(e=>{const a=document.getElementById(e);a&&(t[e]=a.value)}),localStorage.setItem("aethera_last_settings",JSON.stringify(t)),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString())}function hn(){const t=JSON.parse(localStorage.getItem("aethera_last_settings"));t&&Be.forEach(e=>{const a=document.getElementById(e);a&&t[e]!==void 0&&(a.value=t[e],a.dispatchEvent(new Event("change")))})}function ha(){const t=X(),e=document.getElementById("preset-list-container"),a=document.getElementById("preset-item-template");if(e.innerHTML="",t.length===0){e.innerHTML=`<p class="text-sm text-center text-gray-500 p-4">${d("no_presets_yet")||"Anda belum memiliki preset."}</p>`;return}t.forEach(n=>{const o=a.content.cloneNode(!0),s=o.querySelector(".preset-item");s.dataset.presetId=n.id;const i=o.querySelector(".preset-name-input");i.value=n.name;const r=s.querySelector(".flex"),c=document.createElement("button");c.className="edit-preset-btn p-2 text-gray-400 hover:text-blue-400",c.title=d("edit_button")||"Edit",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793z"/><path d="M11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.828-2.828z"/></svg>',r.prepend(c),c.addEventListener("click",()=>xo(n)),e.appendChild(o)})}function xo(t){try{nt();const e=document.getElementById("edit-settings-preset-modal"),a=document.getElementById("edit-settings-preset-content");a.innerHTML="",Be.map(s=>{const i=document.getElementById(s),r=document.querySelector(`label[for="${s}"]`),c=document.createElement("div");c.className="space-y-1";const l=document.createElement("div");l.className="text-xs text-gray-400",l.textContent=r&&r.textContent||s;const u=i?i.cloneNode(!0):null;return u&&(u.id=`edit-${s}`,u.classList.add("w-full"),u.value=(t.settings||{})[s]??i.value),c.appendChild(l),u&&c.appendChild(u),c}).forEach(s=>a.appendChild(s)),e.classList.remove("hidden"),e.classList.add("flex");const o=()=>{e.classList.add("hidden"),e.classList.remove("flex")};document.getElementById("edit-settings-preset-close").onclick=o,document.getElementById("edit-settings-preset-cancel").onclick=o,document.getElementById("edit-settings-preset-save").onclick=async()=>{await Io(t.id),o()},document.getElementById("edit-settings-preset-save-as-new").onclick=async()=>{await pn((t.name||"")+" Copy"),o()}}catch(e){console.warn("openEditPresetOverlay failed",e)}}async function Io(t){const e=X(),a=e.findIndex(o=>o.id===t);if(a<0)return;const n={...e[a],settings:{}};Be.forEach(o=>{const s=document.getElementById(`edit-${o}`);s&&(n.settings[o]=s.value)}),e[a]=n,gt(e),ie(),b(d("preset_saved_success",{name:n.name})||"Preset saved","success")}function fn(){ha();const t=document.getElementById("manage-presets-modal");t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")}function nt(){const t=document.getElementById("manage-presets-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}async function Lo(t){let e=X();const a=e.find(o=>o.id===t);e=e.filter(o=>o.id!==t),gt(e),ha(),ie();try{const{cloudStorage:o}=await C(async()=>{const{cloudStorage:s}=await Promise.resolve().then(()=>ut);return{cloudStorage:s}},void 0);if(a){const{data:s}=await w.from("user_presets").select("id").eq("name",a.name).eq("type","generator").single();s&&await o.addPendingOperation("presets","delete",{id:s.id,name:a.name,type:"generator"})}}catch(o){console.warn("Failed to sync preset deletion with cloud:",o.message)}const n=d("preset_deleted_success")||"Preset deleted successfully.";b(n,"success")}function To(t,e){if(!e||!e.trim()){b(d("preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}const a=e.trim();if(X().some(r=>r.id!==t&&String(r.name||"").toLowerCase()===a.toLowerCase())){b(d("preset_name_duplicate",{name:a})||`Nama preset "${a}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}let s=X();const i=s.findIndex(r=>r.id===t);if(i>-1){const r=s[i].name;s[i].name=a,gt(s),ha(),ie(),b(d("preset_name_updated")||"Nama preset berhasil diperbarui.","success"),(async()=>{try{const{data:{session:c}}=await w.auth.getSession();if(c!=null&&c.user){const l=s[i].settings||{},{data:u}=await w.from("user_presets").select("id, settings").eq("user_id",c.user.id).eq("type","generator").eq("name",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();u!=null&&u.id?await w.from("user_presets").update({name:a,settings:l}).eq("id",u.id):await w.from("user_presets").update({name:a,settings:l}).eq("user_id",c.user.id).eq("type","generator").eq("name",r),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString());try{await $.syncGeneratorPresets()}catch{}}else try{$.addPendingOperation("presets","update",{name:a,type:"generator",previous_name:r,settings:s[i].settings||{}})}catch{}}catch{try{$.addPendingOperation("presets","update",{name:a,type:"generator",previous_name:r,settings:s[i].settings||{}})}catch{}}})()}}function _n(t){const e=t.target,a=e.closest(".preset-item");if(!a)return;const n=a.dataset.presetId;if(e.closest(".delete-preset-btn")){const o=a.querySelector(".preset-name-input").value,s=d("confirm_delete_preset",{name:o})||`Anda yakin ingin menghapus preset "${o}"?`;pe(s,()=>{Lo(n).catch(i=>{console.error("Error deleting preset:",i),b("Gagal menghapus preset","error")})})}if(e.closest(".save-preset-name-btn")){const o=a.querySelector(".preset-name-input").value;To(n,o)}}const Ao=Object.freeze(Object.defineProperty({__proto__:null,closeManagePresetsModal:nt,getPresets:X,handleLoadPreset:gn,handlePresetManagement:_n,handleSavePreset:mn,loadLastSettings:hn,openManagePresetsModal:fn,populatePresetSelector:ie,saveLastSettings:yn},Symbol.toStringTag,{value:"Module"})),vn="aethera_character_presets",yt=["name","gender","age","ethnicity","face_shape","eye_color","eye_shape","lip_shape","nose_shape","eyebrow_style","hair_style","hair_color","unique_features","makeup_style","skin_tone","body_shape","height","clothing_style","color_palette","specific_outfit","vibe","notes"];function Z(){return JSON.parse(localStorage.getItem(vn))||[]}function ht(t){localStorage.setItem(vn,JSON.stringify(t)),localStorage.setItem("aethera_character_presets_last_modified",new Date().toISOString())}function ce(){try{const t=getAllPresets(),e=document.getElementById("character-quick-picks");if(e){const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_characters")||"[]")),n=JSON.parse(localStorage.getItem("aethera_character_usage")||"{}"),o=new Map;t.forEach(c=>{c!=null&&c.name&&o.set(c.name,c)});const r=[...Array.from(o.values())].sort((c,l)=>{const u=a.has(String(c.id||c.name||"")),h=a.has(String(l.id||l.name||""));if(u!==h)return u?-1:1;const g=n[c.id||c.name]||0,f=n[l.id||l.name]||0;return g!==f?f-g:String(c.name||"").localeCompare(String(l.name||""))}).slice(0,6);e.innerHTML="",r.forEach(c=>{const l=document.createElement("button");l.className="px-2 py-1 text-xs rounded-full bg-yellow-900/40 border border-yellow-800/70 text-yellow-200 hover:bg-yellow-800/60",l.textContent=c.name||"Preset",l.title=(c.notes||"").slice(0,140),l.addEventListener("click",async()=>{const p=document.getElementById("character-preset-selector");if(p){p.value=c.id||"",await fa();try{$.incrementCharacterPresetUsage(c.id||c.name,c.name)}catch{}}});const u=document.createElement("button");u.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const h=c.id||c.name,g=a.has(String(h));u.textContent=g?"":"",u.addEventListener("click",p=>{p.stopPropagation();const _=!a.has(String(h));_?a.add(String(h)):a.delete(String(h)),localStorage.setItem("aethera_pinned_characters",JSON.stringify([...a]));try{$.toggleCharacterPin(h,_)}catch{}u.textContent=_?"":""});const f=document.createElement("div");f.className="inline-flex items-center",f.appendChild(l),f.appendChild(u),e.appendChild(f)})}}catch{}try{const t=Z(),e=new Map;t.forEach(o=>{o!=null&&o.name&&e.set(o.name,o)});const a=Array.from(e.values()),n=document.getElementById("character-preset-selector");if(!n)return;n.innerHTML='<option value="" data-lang-key="load_character_option">-- Load Character --</option>',a.forEach(o=>{const s=document.createElement("option");s.value=o.id,s.textContent=o.name,n.appendChild(s)})}catch(t){console.warn("Failed to populate character preset selector:",t.message)}}function bn(){lt("Simpan Preset Karakter","Masukkan nama untuk preset karakter ini:","Contoh: Model Pria Casual, Pasangan Kenji & Luna",async t=>{if(!t||!t.trim()){b(d("character_preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}await Sn(t.trim())})}async function Sn(t){if(Z().some(r=>r.name.toLowerCase()===t.toLowerCase())){b(d("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}try{const{getPresets:r}=await C(async()=>{const{getPresets:u}=await Promise.resolve().then(()=>Ao);return{getPresets:u}},void 0);if(r().some(u=>u.name.toLowerCase()===t.toLowerCase())){b(d("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan untuk preset generator. Silakan pilih nama lain.`,"warning");return}}catch(r){console.warn("Could not check generator presets for duplicates:",r)}const n=[];if(document.querySelectorAll(".character-sheet-instance").forEach(r=>{const c={};yt.forEach(l=>{const u=r.querySelector(`[data-field="${l}"]`);u&&u.value.trim()!==""&&(c[l]=u.value.trim())}),Object.keys(c).length>0&&n.push(c)}),n.length===0){b(d("character_no_data_to_save")||"Tidak ada data karakter untuk disimpan.","warning");return}const o={id:`char_preset_${Date.now()}`,name:t,characters:n},s=Z();s.push(o),ht(s);try{ce()}catch(r){console.warn("Failed to populate character preset selector after save:",r.message)}const i=d("character_preset_saved_success",{name:o.name})||`Preset karakter "${o.name}" berhasil disimpan!`;b(i,"success")}async function fa(){const t=document.getElementById("character-preset-selector"),e=t.value;if(!e)return;const n=Z().find(o=>o.id===e);if(n){const o=document.getElementById("dynamic-character-sheet-area");if(o.innerHTML="",n.characters.forEach((h,g)=>{const f=mt(g);yt.forEach(p=>{const _=f.querySelector(`[data-field="${p}"]`);_&&h[p]&&(_.value=h[p])}),o.appendChild(f)}),at(),n.characters.length>1&&document.getElementById("character-mode").value==="group"){const g=document.createElement("button");g.id="add-character-btn",g.textContent="+ Tambah Karakter Lain",g.type="button",g.className="btn-secondary text-sm font-semibold px-3 py-1.5 rounded-md w-full mt-4",o.appendChild(g)}const i=document.getElementById("save-character-button-template").content.cloneNode(!0);o.appendChild(i);const{t:r}=await C(async()=>{const{t:h}=await Promise.resolve().then(()=>Wt);return{t:h}},void 0),c=o.querySelector('[data-lang-key="save_character_button"]');c&&r("save_character_button")&&(c.textContent=r("save_character_button"));const l=document.getElementById("character-mode");n.characters.length===1?l.value="single":n.characters.length===2?l.value="couple":l.value="group";const u=r("character_preset_loaded_success",{name:n.name})||`Preset karakter "${n.name}" dimuat.`;b(u,"success"),t.value=""}}function _a(){const t=Z(),e=new Map;t.forEach(s=>{s!=null&&s.name&&e.set(s.name,s)});const a=Array.from(e.values()),n=document.getElementById("character-preset-list-container"),o=document.getElementById("preset-item-template");if(n.innerHTML="",a.length===0){n.innerHTML='<p class="text-sm text-center text-gray-500 p-4">Anda belum memiliki preset karakter.</p>';return}a.forEach(s=>{const i=o.content.cloneNode(!0),r=i.querySelector(".preset-item");r.dataset.presetId=s.id;const c=i.querySelector(".preset-name-input");c.value=s.name;const l=r.querySelector(".flex"),u=document.createElement("button");u.className="edit-char-preset-btn p-2 text-gray-400 hover:text-amber-400",u.title=d("edit_button")||"Edit",u.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793z"/><path d="M11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.828-2.828z"/></svg>',l.prepend(u),u.addEventListener("click",()=>Co(s)),n.appendChild(i)})}function Co(t){try{ot();const e=document.getElementById("edit-character-preset-modal"),a=document.getElementById("edit-character-preset-content");a.innerHTML="",t.characters.forEach((o,s)=>{const i=mt(s);yt.forEach(r=>{const c=i.querySelector(`[data-field="${r}"]`);c&&o[r]&&(c.value=o[r])}),a.appendChild(i)}),e.classList.remove("hidden"),e.classList.add("flex");const n=()=>{e.classList.add("hidden"),e.classList.remove("flex")};document.getElementById("edit-character-preset-close").onclick=n,document.getElementById("edit-character-preset-cancel").onclick=n,document.getElementById("edit-character-preset-save").onclick=async()=>{await Bo(t.id),n()},document.getElementById("edit-character-preset-save-as-new").onclick=async()=>{await Sn((t.name||"")+" Copy"),n()}}catch(e){console.warn("openEditCharacterPresetOverlay failed",e)}}async function Bo(t){const e=Z(),a=e.findIndex(o=>o.id===t);if(a<0)return;const n=[];if(document.querySelectorAll("#edit-character-preset-content .character-sheet-instance").forEach(o=>{const s={};yt.forEach(i=>{const r=o.querySelector(`[data-field="${i}"]`);r&&r.value.trim()&&(s[i]=r.value.trim())}),Object.keys(s).length&&n.push(s)}),!n.length){b(d("character_no_data_to_save")||"Tidak ada data karakter untuk disimpan.","warning");return}e[a]={...e[a],characters:n},ht(e);try{ce()}catch{}b(d("character_preset_saved_success",{name:e[a].name})||"Preset karakter disimpan","success")}function wn(){_a();const t=document.getElementById("manage-character-presets-modal");t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")}function ot(){const t=document.getElementById("manage-character-presets-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}async function Po(t){let e=Z();const a=e.find(o=>o.id===t);e=e.filter(o=>o.id!==t),ht(e),_a();try{ce()}catch(o){console.warn("Failed to populate character preset selector after delete:",o.message)}try{const{cloudStorage:o}=await C(async()=>{const{cloudStorage:s}=await Promise.resolve().then(()=>ut);return{cloudStorage:s}},void 0);if(a){const{data:s}=await w.from("user_presets").select("id").eq("name",a.name).eq("type","character").single();s&&await o.addPendingOperation("presets","delete",{id:s.id,name:a.name,type:"character"})}}catch(o){console.warn("Failed to sync character preset deletion with cloud:",o.message)}const n=d("character_preset_deleted_success")||"Preset karakter berhasil dihapus.";b(n,"success");try{await $.syncCharacterPresets()}catch{}}function No(t,e){if(!e||!e.trim()){b(d("character_preset_name_empty")||"Preset name cannot be empty.","warning");return}const a=e.trim();if(Z().some(r=>r.id!==t&&String(r.name||"").toLowerCase()===a.toLowerCase())){b(d("preset_name_duplicate",{name:a})||`Nama preset "${a}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}let s=Z();const i=s.findIndex(r=>r.id===t);if(i>-1){const r=s[i].name;s[i].name=a,ht(s),_a();try{ce()}catch(c){console.warn("Failed to populate character preset selector after rename:",c.message)}b(d("character_preset_name_updated")||"Nama preset berhasil diperbarui.","success"),(async()=>{try{const{data:{session:c}}=await w.auth.getSession();if(c!=null&&c.user){const l=s[i].id,u=typeof l=="string"&&/^(char_)?preset_/.test(l);if(l&&!u){const{data:h}=await w.from("user_presets").select("id, settings").eq("id",l).single(),g=h!=null&&h.settings?{...h.settings,name:a}:{id:l,name:a,characters:s[i].characters};await w.from("user_presets").update({name:a,settings:g}).eq("id",l)}else{const{data:h}=await w.from("user_presets").select("id, settings").eq("user_id",c.user.id).eq("type","character").eq("name",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(h!=null&&h.id){const g=h.settings?{...h.settings,name:a}:{id:s[i].id,name:a,characters:s[i].characters};await w.from("user_presets").update({name:a,settings:g}).eq("id",h.id)}}localStorage.setItem("aethera_character_presets_last_modified",new Date().toISOString());try{await $.syncCharacterPresets()}catch{}}else try{$.addPendingOperation("presets","update",{name:a,type:"character",previous_name:r})}catch{}}catch{try{$.addPendingOperation("presets","update",{name:a,type:"character",previous_name:r})}catch{}}})()}}function kn(t){const e=t.target,a=e.closest(".preset-item");if(!a)return;const n=a.dataset.presetId;if(e.closest(".delete-preset-btn")){const o=a.querySelector(".preset-name-input").value,s=d("confirm_delete_preset",{name:o})||`Are you sure you want to delete preset "${o}"?`;pe(s,()=>{Po(n).catch(i=>{console.error("Error deleting character preset:",i)})})}if(e.closest(".save-preset-name-btn")){const o=a.querySelector(".preset-name-input").value;No(n,o)}}const Oo=Object.freeze(Object.defineProperty({__proto__:null,closeManageCharacterPresetsModal:ot,getCharacterPresets:Z,handleCharacterPresetManagement:kn,handleLoadCharacterPreset:fa,handleSaveCharacterPreset:bn,openManageCharacterPresetsModal:wn,populateCharacterPresetSelector:ce},Symbol.toStringTag,{value:"Module"}));let Ke=null;async function En(){try{const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}catch{return String(Date.now())+Math.random().toString(36).slice(2)}}async function $o(){try{const{data:{session:t}}=await w.auth.getSession();if(!(t!=null&&t.user))return;const e=t.user.id;let a=localStorage.getItem("direktiva_session_id");a||(a=await En(),localStorage.setItem("direktiva_session_id",a)),await w.from("profiles").upsert({id:e,last_session_id:a,email:t.user.email});const n=async()=>{try{const{data:o,error:s}=await w.from("profiles").select("last_session_id").eq("id",e).single();!s&&o&&o.last_session_id&&o.last_session_id!==a&&(b(d("session_conflict")||"Akun Anda digunakan di perangkat lain. Anda akan keluar.","error"),await qt())}catch{}};Ke&&(clearInterval(Ke),Ke=null),Ke=setInterval(n,2e4),window.addEventListener("focus",n,{passive:!0})}catch{}}async function Dt(){const{data:{session:t}}=await w.auth.getSession();if(t){m.loginOverlay.classList.add("hidden"),m.appContainer.classList.remove("hidden"),ln(),Y("generator"),en(),tn(),ra(),$o();try{await $.syncAll(),setTimeout(()=>{try{ie(),ce()}catch(e){console.warn("Failed to populate selectors after sync:",e.message)}},500),$.startAutoSync()}catch(e){console.warn("Failed to sync data after login:",e.message);try{ie(),ce()}catch(a){console.warn("Failed to populate selectors with local data:",a.message)}Eo()}}else m.loginOverlay.classList.remove("hidden"),m.appContainer.classList.add("hidden")}async function xt(){var o;const t=document.getElementById("login-email").value,e=document.getElementById("login-password").value,{data:a,error:n}=await w.auth.signInWithPassword({email:t,password:e});if(n)n.message.includes("Invalid login credentials")?b(d("notification_login_invalid"),"error"):b(`${d("notification_login_failed")} ${n.message}`,"error");else{const s="notification_login_success",i=d(s);b(i&&i!==s?i:localStorage.getItem("aethera_language")==="en"?"Login successful":"Berhasil masuk");try{let r=await En();localStorage.setItem("direktiva_session_id",r);const{data:{session:c}}=await w.auth.getSession();(o=c==null?void 0:c.user)!=null&&o.id&&await w.from("profiles").upsert({id:c.user.id,last_session_id:r,email:c.user.email})}catch{}await Dt()}}async function Mo(){var t,e;try{const a=(e=(t=document.getElementById("login-email"))==null?void 0:t.value)==null?void 0:e.trim();if(!a){b(d("email_label")||"Email","warning");return}const n=window.location.origin,{error:o}=await w.auth.resetPasswordForEmail(a,{redirectTo:n});if(o)throw o;b(d("password_reset_sent")||"Password reset link sent to your email.","success")}catch(a){b(a.message||"Failed to send reset link","error")}}async function qt(){try{w.auth.signOut({scope:"local"}).catch(a=>{console.warn("Network error during logout (ignored):",a.message)});const t=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);n&&n.startsWith("direktiva_")&&t.push(n)}t.forEach(a=>localStorage.removeItem(a));const e=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);n&&n.startsWith("sb-")&&e.push(n)}e.forEach(a=>localStorage.removeItem(a)),b(d("notification_logout_success"),"success"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.warn("Logout error:",t.message),localStorage.clear(),sessionStorage.clear(),window.location.reload()}}function It(t){localStorage.setItem("currentMode",t);const e=t==="single";m.modeSingleBtn.classList.toggle("bg-blue-600",e),m.modeSingleBtn.classList.toggle("text-white",e),m.modeSingleBtn.classList.toggle("text-gray-400",!e),m.modeSingleBtn.classList.toggle("hover:bg-gray-700",!e),m.modeCarouselBtn.classList.toggle("bg-blue-600",!e),m.modeCarouselBtn.classList.toggle("text-white",!e),m.modeCarouselBtn.classList.toggle("text-gray-400",e),m.modeCarouselBtn.classList.toggle("hover:bg-gray-700",e),m.modeSingleBtn.classList.toggle("is-active",e),m.modeCarouselBtn.classList.toggle("is-active",!e);const a=document.getElementById("duration-group");e?(m.scriptCountGroup.classList.remove("hidden"),a&&a.classList.remove("hidden"),m.visualStrategyGroup.classList.remove("hidden"),m.slideCountGroup.classList.add("hidden"),m.carouselTemplateGroup.classList.add("hidden")):(m.scriptCountGroup.classList.add("hidden"),a&&a.classList.add("hidden"),m.visualStrategyGroup.classList.add("hidden"),m.slideCountGroup.classList.remove("hidden"),m.carouselTemplateGroup.classList.remove("hidden"))}function Lt(t){localStorage.setItem("visualStrategy",t),document.querySelectorAll("#visual-strategy-group .track-btn").forEach(i=>{i.classList.remove("is-active")});const e=document.getElementById(`strategy-${t}`);e&&e.classList.add("is-active");const a=document.getElementById("character-mode-group"),n=document.getElementById("character-preset-controls"),o=document.getElementById("dynamic-character-sheet-area"),s=document.getElementById("interaction-description-container");t==="character"?(a.classList.remove("hidden"),n.classList.remove("hidden"),ia()):(a.classList.add("hidden"),n.classList.add("hidden"),o.innerHTML="",s.classList.add("hidden"))}function Tt(t){localStorage.setItem("aspectRatio",t),document.querySelectorAll(".ratio-toggle-track .track-btn").forEach(a=>{a.classList.remove("is-active")});const e=document.getElementById(`ratio-${t.replace(":","")}`);e&&e.classList.add("is-active")}let me=[];function ge(){if(me.length===0){const t=localStorage.getItem("aethera_lastGeneratedScripts");if(t)try{me=JSON.parse(t)}catch(e){console.error("Gagal mem-parsing skrip dari localStorage:",e),me=[]}}return me}function xn(t,e,a){me=t,localStorage.setItem("aethera_lastGeneratedScripts",JSON.stringify(t)),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString()),t&&t.length>0&&Ja(t,e,a)}function st(t){const e=ge(),a=e.findIndex(n=>n.id===t.id);a>-1&&(e[a]=t,me=e,localStorage.setItem("aethera_lastGeneratedScripts",JSON.stringify(e)),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString()))}function In(){me=[],localStorage.removeItem("aethera_lastGeneratedScripts"),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString())}const Ro=Object.freeze(Object.defineProperty({__proto__:null,clearScripts:In,getScripts:ge,setScripts:xn,updateSingleScript:st},Symbol.toStringTag,{value:"Module"}));async function Do(){var t;return(t=window.jspdf)!=null&&t.jsPDF||await new Promise((e,a)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",n.onload=e,n.onerror=a,document.head.appendChild(n)}),window.jspdf.jsPDF}async function qo(){return window.XLSX||await new Promise((t,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",a.onload=t,a.onerror=e,document.head.appendChild(a)}),window.XLSX}let At;async function Ho(){var t;return(t=window.jspdf)!=null&&t.jsPDF?window.jspdf.jsPDF:(At=At||Do(),At)}function jo(t){const e=ge();if(e.length===0){b(d("notification_no_script_to_download"),"warning");return}const n=`Aethera Studio - ${(m.inputs.productName.value.trim()||"Aethera_Studio_Script").replace(/[^a-z0-9]/gi,"_").toLowerCase()}`;t==="pdf"&&Uo(e,n),t==="docx"&&Fo(e,n),t==="xlsx"&&Go(e,n)}async function Uo(t,e){const a=await Ho();if(!a){b(d("export_pdf_unavailable")||"Export PDF unavailable: jsPDF not loaded.","error");return}const n=new a;t.forEach((o,s)=>{s>0&&n.addPage(),n.setFont("helvetica","bold"),n.text(`${d("script_option")} #${s+1}: ${o.title}`,10,10),n.setFont("helvetica","normal");const i=Te(o),r=n.splitTextToSize(i,180);n.text(r,10,20)}),n.save(`${e}.pdf`)}function ft(t){const e=[];return t.body_intro&&e.push({section:"Body",scene:"intro",text:t.body_intro,t2i:"",i2v:""}),t.hook&&(e.push({section:"Hook",scene:"main",text:t.hook.text||"",t2i:"",i2v:""}),t.hook.shots&&t.hook.shots.forEach((a,n)=>{e.push({section:"Hook",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),t.body&&(e.push({section:"Body",scene:"main",text:t.body.text||"",t2i:"",i2v:""}),t.body.shots&&t.body.shots.forEach((a,n)=>{e.push({section:"Body",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),t.cta&&(e.push({section:"CTA",scene:"main",text:t.cta.text||"",t2i:"",i2v:""}),t.cta.shots&&t.cta.shots.forEach((a,n)=>{e.push({section:"CTA",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),e}function Ln(t){const e=ft(t),a={title:t.title||"Untitled Script",created_at:new Date().toISOString(),format:"prompt_pack",rows:e},n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=`${t.title||"script"}_prompt_pack.json`,s.click(),URL.revokeObjectURL(o),b(d("prompt_pack_json_downloaded_success")||"Prompt Pack JSON berhasil diunduh!","success")}function Tn(t){const e=ft(t);let n=["Section","Scene","Text","Text-to-Image Prompt","Image-to-Video Prompt"].join(",")+`
`;e.forEach(r=>{const c=[`"${r.section}"`,`"${r.scene}"`,`"${r.text.replace(/"/g,'""')}"`,`"${r.t2i.replace(/"/g,'""')}"`,`"${r.i2v.replace(/"/g,'""')}"`].join(",");n+=c+`
`});const o=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=`${t.title||"script"}_prompt_pack.csv`,i.click(),URL.revokeObjectURL(s),b(d("prompt_pack_csv_downloaded_success")||"Prompt Pack CSV berhasil diunduh!","success")}function rt(t){const e=Math.floor(t/3600),a=Math.floor(t%3600/60),n=Math.floor(t%60),o=Math.floor(t%1*1e3);return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")},${o.toString().padStart(3,"0")}`}function An(t){const e=ft(t).filter(g=>g.text.trim()!=="");if(e.length===0){b(d("no_text_to_export_srt")||"Tidak ada teks untuk diekspor ke SRT","warning");return}const a=60,n=a*.25,o=a*.6,s=a*.15;let i="",r=0,c=1;e.forEach(g=>{let f;g.section==="Hook"?f=n/e.filter(k=>k.section==="Hook").length:g.section==="Body"?f=o/e.filter(k=>k.section==="Body").length:g.section==="CTA"?f=s/e.filter(k=>k.section==="CTA").length:f=2;const p=r,_=r+f;i+=`${c}
`,i+=`${rt(p)} --> ${rt(_)}
`,i+=`${g.text}

`,r=_,c++});const l=new Blob([i],{type:"text/plain;charset=utf-8;"}),u=URL.createObjectURL(l),h=document.createElement("a");h.href=u,h.download=`${t.title||"script"}_capcut.srt`,h.click(),URL.revokeObjectURL(u),b(d("capcut_srt_downloaded_success")||"CapCut SRT berhasil diunduh!","success")}function Cn(t){const e=ft(t).filter(l=>l.text.trim()!=="");if(e.length===0){b(d("no_text_to_export_csv")||"Tidak ada teks untuk diekspor ke CSV","warning");return}const a=3;let o=["Index","Start Time","End Time","Text","Section"].join(",")+`
`,s=0;e.forEach((l,u)=>{const h=s,g=s+a,f=[u+1,rt(h),rt(g),`"${l.text.replace(/"/g,'""')}"`,`"${l.section}"`].join(",");o+=f+`
`,s=g});const i=new Blob([o],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),c=document.createElement("a");c.href=r,c.download=`${t.title||"script"}_capcut.csv`,c.click(),URL.revokeObjectURL(r),b(d("capcut_csv_downloaded_success")||"CapCut CSV berhasil diunduh!","success")}function Fo(t,e){let a="";t.forEach((r,c)=>{a+=`<h1>${d("script_option")} #${c+1}: ${r.title}</h1>`,a+=Te(r).replace(/\n/g,"<br>"),c<t.length-1&&(a+='<br clear="all" style="page-break-before:always" />')});const n=`<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export</title></head><body>${a}</body></html>`,o=new Blob(["\uFEFF",n],{type:"application/msword"}),s=URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=`${e}.doc`,document.body.appendChild(i),i.click(),document.body.removeChild(i)}async function Go(t,e){const a=await qo(),n=a.utils.book_new();t.forEach((o,s)=>{let i=[];if(o.hook){i.push([d("part_label"),d("script_text_label"),d("visual_idea_label_short"),d("t2i_prompt_label_short"),d("i2v_prompt_label_short")]),i.push([d("script_title_label")||"Judul",o.title,"","",""]),o.character_sheet&&o.character_sheet.length>0&&o.character_sheet.forEach(l=>{i.push([d("character_label")||"Karakter",Qt(l)])});const c=(l,u)=>{u.shots.forEach((h,g)=>{i.push([g===0?l:"",g===0?u.text:"",h.visual_idea,h.text_to_image_prompt,h.image_to_video_prompt])})};c(d("hook_title"),o.hook),c(d("body_title"),o.body),c(d("cta_title"),o.cta)}else o.slides&&(i.push([d("slide_label_short"),d("slide_text_label"),d("t2i_prompt_label"),d("slide_layout_suggestion"),d("slide_engagement_idea")]),o.slides.forEach((c,l)=>{i.push([l+1,c.slide_text,c.text_to_image_prompt,c.layout_suggestion||"-",c.engagement_idea||"-"])}));const r=a.utils.aoa_to_sheet(i);a.utils.book_append_sheet(n,r,`${d("option_label")||"Opsi"} ${s+1}`)}),a.writeFile(n,`${e}.xlsx`)}const Ht={tiktok_video:{id:{rate:"+12%",pitch:"+2st",pauseMs:220,voiceHint:"energetic, upbeat, Indonesian"},en:{rate:"+10%",pitch:"+1st",pauseMs:220,voiceHint:"energetic, upbeat, American English"}},shopee_video:{id:{rate:"+8%",pitch:"+1st",pauseMs:260,voiceHint:"clear, friendly promo, Indonesian"},en:{rate:"+6%",pitch:"+1st",pauseMs:260,voiceHint:"clear, friendly promo, English"}},igreels:{id:{rate:"+8%",pitch:"+1st",pauseMs:240,voiceHint:"aesthetic, calm assertive, Indonesian"},en:{rate:"+6%",pitch:"+1st",pauseMs:240,voiceHint:"aesthetic, calm assertive, English"}},threads:{id:{rate:"+4%",pitch:"+0st",pauseMs:260,voiceHint:"conversational, friendly, Indonesian"},en:{rate:"+4%",pitch:"+0st",pauseMs:260,voiceHint:"conversational, friendly, English"}},shorts:{id:{rate:"+10%",pitch:"+1st",pauseMs:220,voiceHint:"punchy, confident, Indonesian"},en:{rate:"+10%",pitch:"+1st",pauseMs:220,voiceHint:"punchy, confident, English"}}},Vo={tiktok:"tiktok_video","tiktok video":"tiktok_video",shopee:"shopee_video","shopee video":"shopee_video",reels:"igreels","ig reels":"igreels",instagram:"igreels","youtube shorts":"shorts",ytshorts:"shorts","yt shorts":"shorts",shorts:"shorts",thread:"threads","instagram threads":"threads"};function Jo(t="tiktok_video"){const e=String(t||"").toLowerCase().trim();return Ht[e]?e:Vo[e]||"tiktok_video"}function Yo(t="tiktok_video",e="id"){const a=Jo(t),n=Ht[a]||Ht.tiktok_video;return String(e).toLowerCase()==="en"?n.en:n.id}const Ko={Elavoz:"E-la-voz",viscose:"vis-kos",niacinamide:"nia-si-na-mayd",keranjang:"ke-ranjang"},zo={niacinamide:"nai-uh-SIN-uh-mide",viscose:"VIS-kohss"};function Wo(t,e="id"){const a=e==="en"?zo:Ko;let n=t;for(const[o,s]of Object.entries(a)){const i=new RegExp(`\\b${o}\\b`,"g");n=n.replace(i,`<sub alias="${s}">${o}</sub>`)}return n}function Xo(t,e="id"){const a=(t||"").trim().split(/\s+/).filter(Boolean).length;return Math.round(a/(e==="en"?180:170)*6e4)}function jt(t){return(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;")}const Ct=t=>`<break time="${t}ms"/>`,Zo=t=>`<s>${jt(t)}</s>`;function Qo(t,e,a="id",n={}){const{hook:o="",scenes:s=[],cta:i=""}=t||{},r=e.pauseMs??240,c=(s||[]).map(u=>Zo(Array.isArray(u)?u.join(" "):u||"")).join(Ct(r));let l=`
<speak>
  <prosody rate="${e.rate}" pitch="${e.pitch}">
    <emphasis level="strong">${jt(o)}</emphasis>${Ct(300)}
    ${c}${Ct(300)}
    <emphasis level="moderate">${jt(i)}</emphasis>
  </prosody>
</speak>`.trim();return n.applyPronDict!==!1&&(l=Wo(l,a)),l}function es(t,e,a="id"){const{hook:n="",scenes:o=[],cta:s=""}=t||{},i=c=>Array.isArray(c)?c.join(" "):String(c||"");return[`${a==="en"?"Read in clear American English.":"Bacakan dalam Bahasa Indonesia yang jelas."} Style: ${e.voiceHint}. Pace ${e.rate}, pitch ${e.pitch}. Add natural short pauses between sentences. Emphasize key benefits.`,`HOOK: ${n}`,...(o||[]).map((c,l)=>`SCENE ${l+1}: ${i(c)}`),`CTA: ${s}`].join(`
`)}function ts(t,e="id"){const{scenes:a=[]}=t||{};return(a||[]).map(n=>{const o=Array.isArray(n)?n.join(" "):String(n||"");return{text:o,estMs:Xo(o,e)}})}function Je(t,e={}){const a=(e.lang||"id").toLowerCase()==="en"?"en":"id",n=e.platform||"tiktok_video",o=Yo(n,a),s=Qo(t,o,a,{applyPronDict:!0}),i=es(t,o,a),r=ts(t,a);return{lang:a,platform:n,recipe:o,ssml:s,geminiText:i,readTimes:r}}let Bt=[];function as(){"speechSynthesis"in window&&(Bt=window.speechSynthesis.getVoices(),Bt.length||(window.speechSynthesis.onvoiceschanged=()=>{Bt=window.speechSynthesis.getVoices()}))}as();async function ns(){return window.JSZip||await new Promise((t,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",a.onload=t,a.onerror=e,document.head.appendChild(a)}),window.JSZip}function os(t){return`<!doctype html>
<html lang="en"><meta charset="utf-8">
<title>VO Preview (Gemini)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Inter,Arial;padding:16px;background:#0b1220;color:#e5e7eb}
  .row{display:flex;gap:8px;align-items:center;margin:8px 0}
  textarea{width:100%;height:200px;background:#0f1629;color:#e5e7eb;border:1px solid #23314d;border-radius:8px;padding:10px}
  select,button{padding:8px 12px;border-radius:8px;border:1px solid #23314d;background:#111a2e;color:#e5e7eb;cursor:pointer}
  button[disabled]{opacity:.6;cursor:not-allowed}
  .hint{color:#9aa4b2;font-size:12px}
</style>
<h2>VO Preview (Gemini)</h2>
<div class="row">
  <label>Voice:</label>
  <select id="voice">
    <option value="Kore" selected>Kore</option>
    <option value="Puck">Puck</option>
  </select>
</div>
<textarea id="text"></textarea>
<div class="row">
  <button id="play"> Preview Gemini</button>
  <span id="status" class="hint"></span>
</div>
<script>
  const ta = document.getElementById('text');
  ta.value = ${JSON.stringify(t||"")};
  const btn = document.getElementById('play');
  const status = document.getElementById('status');
  let audioRef = null, busy = false;
  async function play() {
    if (busy) return;
    busy = true; btn.disabled = true; status.textContent = 'Generating audio...';
    try {
      if (audioRef) { try{ audioRef.pause(); }catch(e){} }
      const voiceName = document.getElementById('voice').value || 'Kore';
      const r = await fetch('/api/tts/gemini', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text: ta.value, voiceName })
      });
      const txt = await r.text();
      if (!r.ok) { let msg = txt; try{ const j=JSON.parse(txt); msg=j.error||txt; }catch{} throw new Error(msg); }
      const { audio_base64, mime } = JSON.parse(txt);
      audioRef = new Audio(\`data:\${mime||'audio/wav'};base64,\${audio_base64}\`);
      audioRef.onended = ()=>{ busy=false; btn.disabled=false; status.textContent=''; };
      audioRef.onerror = ()=>{ busy=false; btn.disabled=false; status.textContent='(audio error)'; };
      audioRef.play().then(()=>{ status.textContent='Playing...'; });
    } catch(e) {
      status.textContent = e.message || String(e);
      busy=false; btn.disabled=false;
    }
  }
  btn.addEventListener('click', play);
<\/script>
</html>`}async function Bn(t,e={}){const{geminiText:a}=Je(t,e);await navigator.clipboard.writeText(a)}async function Pn(t,e={}){const{ssml:a}=Je(t,e);await navigator.clipboard.writeText(a)}async function Nn(t,e={}){const{ssml:a,geminiText:n,lang:o,platform:s}=Je(t,e),i=await ns(),r=new i,c=r.folder(`VO/${s}_${o}`);c.file(`vo_${s}_${o}_gemini.txt`,n),c.file(`vo_${s}_${o}.ssml`,a),c.file("vo_preview_gemini.html",os(n));const l=await r.generateAsync({type:"blob"}),u=document.createElement("a");u.href=URL.createObjectURL(l),u.download=`vo_${s}_${o}.zip`,u.click(),URL.revokeObjectURL(u.href)}function Ut(){let t=document.getElementById("aethera-vo-audio");return t||(t=document.createElement("audio"),t.id="aethera-vo-audio",t.style.display="none",document.body.appendChild(t)),t}window.__voCache||(window.__voCache=new Map);window.__voState||(window.__voState={});function ss(t){let e=2166136261;for(let a=0;a<t.length;a++)e^=t.charCodeAt(a),e=Math.imul(e,16777619);return(e>>>0).toString(36)}function rs(t,e){var n;const a=[(t==null?void 0:t.hook)||"",((n=t==null?void 0:t.scenes)==null?void 0:n[0])||"",(t==null?void 0:t.cta)||"",(e==null?void 0:e.platform)||"",(e==null?void 0:e.lang)||""].join("|");return"vo:"+ss(a)}function j(t,e){t&&(t.__busy=e,t.disabled=e,t.classList.toggle("opacity-50",e),t.textContent=e?" Generating":" Preview Gemini (API)")}async function On(t,e={},a="Kore",n={}){const{geminiText:o}=Je(t,e),s=(n==null?void 0:n.button)||null,i=(n==null?void 0:n.cacheKey)||rs(t,e);if(s&&s.__busy)return;va();const r=window.__voCache.get(i);if(r!=null&&r.src){const l=Ut();l.src=r.src,window.__voState.playingKey=i,window.__voState.busyBtn=s||null,l.onended=()=>{j(s,!1),window.__voState.busyBtn=null},l.onerror=()=>{j(s,!1),window.__voState.busyBtn=null};try{j(s,!0),b("Playing cached preview","success"),await l.play()}catch(u){j(s,!1),window.__voState.busyBtn=null,b(u.message||"Failed to play","error")}return}if(r!=null&&r.speech)try{window.__voState.busyBtn=s||null,j(s,!0);const l=new SpeechSynthesisUtterance(r.speech);l.onend=()=>{j(s,!1),window.__voState.busyBtn=null},l.onerror=()=>{j(s,!1),window.__voState.busyBtn=null},window.speechSynthesis.cancel(),window.speechSynthesis.speak(l),b("Playing cached preview","success");return}catch(l){j(s,!1),window.__voState.busyBtn=null,b(l.message||"Failed to play","error");return}j(s,!0),b("Generating audio","info");const c=new AbortController;window.__voState.controller=c,window.__voState.busyBtn=s;try{const l=await fetch("/api/tts/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o,voiceName:a}),signal:c.signal}),u=await l.text();if(!l.ok){let _=u;try{_=JSON.parse(u).error||u}catch{}try{window.__voCache.set(i,{speech:o,createdAt:Date.now()});const k=new SpeechSynthesisUtterance(o);k.onend=()=>{j(s,!1),window.__voState.busyBtn=null},k.onerror=()=>{j(s,!1),window.__voState.busyBtn=null},window.__voState.busyBtn=s||null,window.speechSynthesis.cancel(),window.speechSynthesis.speak(k),b("Preview (browser TTS fallback)","info");return}catch{throw new Error(_)}}const{audio_base64:h,mime:g}=JSON.parse(u),f=`data:${g||"audio/wav"};base64,${h}`;window.__voCache.set(i,{src:f,mime:g||"audio/wav",createdAt:Date.now()});const p=Ut();p.src=f,window.__voState.playingKey=i,p.onended=()=>{j(s,!1),window.__voState.busyBtn=null},p.onerror=()=>{j(s,!1),window.__voState.busyBtn=null},await p.play(),b("Playing preview","success")}catch(l){(l==null?void 0:l.name)==="AbortError"?b("Preview canceled.","info"):(b(l.message||"Preview failed","error"),alert(l.message||l)),j(s,!1)}finally{window.__voState.controller=null}}function va(){var e;try{(e=window.__voState.controller)==null||e.abort()}catch{}try{const a=Ut();a.pause(),a.src="",a.load()}catch{}try{window.speechSynthesis&&window.speechSynthesis.cancel()}catch{}const t=window.__voState.busyBtn;t&&(j(t,!1),window.__voState.busyBtn=null),window.__voState.playingKey=null,b("Preview stopped.","info")}function is(t){const e=(t||"")+"";let a=0;for(let n=0;n<e.length;n++)a=a*31+e.charCodeAt(n)>>>0;return a}function $n(t,e,a,n){var h,g,f;const o=p=>Array.isArray(p)?p.map(_=>Number(_)).filter(Number.isFinite):[],s=p=>{const _=o(p);return _.length?Math.max(..._):0},i=s(t)*.5+s(e)*.3+s(a)*.2,r=`${((h=n==null?void 0:n.hook)==null?void 0:h.text)||(n==null?void 0:n.hook)||""}|${((g=n==null?void 0:n.body)==null?void 0:g.text)||(n==null?void 0:n.body)||""}|${((f=n==null?void 0:n.cta)==null?void 0:f.text)||(n==null?void 0:n.cta)||""}`,c=is(r)%3,u=90+Math.max(0,Math.min(8,i*.1))+c;return Math.min(98,Math.round(u))}async function le(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=5&&a<=12?n+=30:a<5?n+=10:n-=(a-12)*3;const{t:o}=await C(async()=>{const{t:u}=await Promise.resolve().then(()=>Wt);return{t:u}},void 0),s=o("action_words"),i=Array.isArray(s)?s:["try","check","see","discount","promo","secret","turns out","free","viral","trending"],r=t.toLowerCase();i.forEach(u=>{r.includes(u)&&(n+=15)});const c=o("commerce_words");return(Array.isArray(c)?c:["cart","checkout","buy","order"]).forEach(u=>{r.includes(u)&&(n+=10)}),/\d+%|\d+/.test(t)&&(n+=10),Math.max(0,n)}async function te(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=8&&a<=14?n+=25:a<8?n+=10:n-=(a-14)*2;const{t:o}=await C(async()=>{const{t:u}=await Promise.resolve().then(()=>Wt);return{t:u}},void 0),s=t.toLowerCase(),i=o("benefit_words")||["save","easy","fast","practical","effective","proven","quality"];Array.isArray(i)&&i.forEach(u=>{s.includes(u)&&(n+=12)});const r=o("problem_words")||["problem","difficult","complicated","expensive","slow"],c=o("solution_words")||["solution","answer","way","tips","tricks"];Array.isArray(r)&&Array.isArray(c)&&r.some(u=>s.includes(u))&&c.some(u=>s.includes(u))&&(n+=15);const l=o("social_words")||["many","thousands","millions","trusted","testimonial","review"];return Array.isArray(l)&&l.forEach(u=>{s.includes(u)&&(n+=10)}),Math.max(0,n)}function ye(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=3&&a<=8?n+=30:a<3?n+=5:n-=(a-8)*4;const o=t.toLowerCase(),s=(l,u)=>{const h=d(l);return Array.isArray(h)?h.map(g=>String(g).toLowerCase().trim()).filter(Boolean):typeof h=="string"?h.split(",").map(g=>g.toLowerCase().trim()).filter(Boolean):u.split(",").map(g=>g.toLowerCase().trim()).filter(Boolean)};return s("cta_low_friction_words","tap,klik,keranjang,subscribe,follow,comment,reply,swipe").forEach(l=>{l&&o.includes(l)&&(n+=20)}),s("cta_action_words","beli,order,dapatkan,ambil,coba,download").forEach(l=>{l&&o.includes(l)&&(n+=10)}),s("cta_urgency_words","sekarang,segera,terbatas,hari ini,buruan").forEach(l=>{l&&o.includes(l)&&(n+=8)}),Math.max(0,n)}function Mn(t,e=7){if(!t)return t;const a=t.trim().split(/\s+/);return a.length<=e?t:a.slice(0,e).join(" ")+"..."}async function Rn(t){const e=m.outputPanel,a=document.getElementById("results-toolbar");if(e&&(e.innerHTML=""),a){const o=Array.isArray(t)&&t.length>1;a.classList.toggle("hidden",!o);try{a.style.display=o?"flex":"none"}catch{}}try{if(e&&!e.__toolbarObserver){const o=()=>{const i=e.querySelectorAll(".result-card").length,r=document.getElementById("results-toolbar");if(!r)return;const c=i>1;r.classList.toggle("hidden",!c);try{r.style.display=c?"flex":"none"}catch{}},s=new MutationObserver(()=>o());s.observe(e,{childList:!0,subtree:!1}),e.__toolbarObserver=s,o()}}catch{}if(!t||t.length===0){ba(d("notification_script_generation_error"));return}const n=t.map(async(o,s)=>{const i=await Dn(o,s);return i.style.opacity="0",i.style.transform="translateY(20px)",m.outputPanel.appendChild(i),setTimeout(()=>{i.classList.add("animate-fadeInUp"),i.style.opacity="1",i.style.transform="translateY(0)"},s*150),o.slides&&da(`#card-${o.id||s} .carousel-swiper-container`),setTimeout(()=>{try{xe()}catch{}},0),i});await Promise.all(n);try{const o=document.getElementById("results-toolbar");if(o){const i=document.querySelectorAll("#output-panel .result-card").length>1;o.classList.toggle("hidden",!i);try{o.style.display=i?"flex":"none"}catch{}}}catch{}try{xe()}catch{}setTimeout(()=>{try{const o=document.getElementById("results-toolbar");if(!o)return;const i=document.querySelectorAll("#output-panel .result-card").length>1;o.classList.toggle("hidden",!i);try{o.style.display=i?"flex":"none"}catch{}}catch{}try{xe()}catch{}},50)}function ba(t){m.outputPanel.innerHTML=`<div class="flex flex-col items-center justify-center h-full text-center text-red-400"><div class="text-6xl mb-4">:(</div><h3 class="text-xl font-semibold">${d("notification_script_generation_error_title")||"Oops!"}</h3><p class="max-w-sm mt-2">${t}</p></div>`}async function Dn(t,e){var s,i,r,c;const n=document.getElementById("result-card-template").content.cloneNode(!0).firstElementChild;t.id||(t.id=`script-${Date.now()}-${e}`),n.id=`card-${t.id}`,n.querySelector(".result-title").textContent=d("script_option_title",{index:e+1,title:t.title});try{const l=Array.isArray(t.hook_variants)?t.hook_variants:[],u=await Promise.all([...l.map(I=>le(I)),le(((s=t.hook)==null?void 0:s.text)||t.hook||"")]),h=Math.max(...u.map(Number).filter(Number.isFinite),0),f=[...(Array.isArray(t.cta_variants)?t.cta_variants:[]).map(I=>ye(I)),ye(((i=t.cta)==null?void 0:i.text)||t.cta||"")],p=Math.max(...f.map(Number).filter(Number.isFinite),0),_=(((r=t.body)==null?void 0:r.text)||t.body||"").toString().split(`
`)[0]||"",k=Array.isArray(t.body_variants)?t.body_variants:[],E=await Promise.all([...k.map(I=>te(I)),te(_)]),A=Math.max(...E.map(Number).filter(Number.isFinite),0),v=$n([h],[A],[p],t);n.dataset.globalScore=String(v);const x=document.createElement("span"),y=localStorage.getItem("direktiva_theme")||"dark";x.textContent=`Score ${v}`,x.style.marginLeft="6px",x.style.padding="2px 8px",x.style.borderRadius="9999px",x.style.fontSize="12px",x.style.lineHeight="1",x.style.display="inline-flex",x.style.alignItems="center",x.style.fontWeight="600",y==="light"?(x.style.backgroundColor="#d1fae5",x.style.border="1px solid #6ee7b7",x.style.color="#065f46"):(x.style.backgroundColor="rgba(16,185,129,0.15)",x.style.border="1px solid rgba(16,185,129,0.25)",x.style.color="#a7f3d0");const S=n.querySelector(".result-title");if(S){const I=S.textContent;S.textContent="";const T=document.createElement("span");T.textContent=I,S.style.display="flex",S.style.alignItems="center",S.style.gap="8px",S.style.whiteSpace="normal",S.style.flex="1 1 auto",x.style.whiteSpace="nowrap",S.appendChild(T),S.appendChild(x)}}catch(l){console.warn("Scoring badge failed:",l)}n.querySelector(".edit-btn").title=d("edit_button")||"Edit",n.querySelector(".copy-btn").title=d("copy_full_script")||"Copy Full Script",pa(n,t);try{const l=n.querySelector(".card-content");if(l){const u=(((c=t.hook)==null?void 0:c.text)||t.hook||"").toString().split(`
`)[0]||"",h=document.createElement("p");h.className="text-sm text-gray-400",h.textContent=u.slice(0,120)+(u.length>120?"":""),l.innerHTML="",l.style.display="none"}}catch{}try{n.querySelectorAll(".edit-btn, .copy-btn, .view-btn").forEach(l=>{l.style.display="none"})}catch{}n.querySelector(".copy-btn").addEventListener("click",()=>{const l=n.querySelector(".copy-btn");U(!0,l);try{we(Te(n),l)}finally{setTimeout(()=>{U(!1,l)},500)}}),n.querySelector(".edit-btn").addEventListener("click",()=>Zt(n));const o=n.querySelector(".view-btn");o&&o.addEventListener("click",l=>{l.stopPropagation(),Ie(n,JSON.parse(n.dataset.script))}),n.addEventListener("click",l=>{l.target.closest(".export-dropdown")||l.target.closest(".edit-btn")||l.target.closest(".copy-btn")||l.target.closest(".view-btn")||Ie(n,JSON.parse(n.dataset.script))});try{const l=n.querySelector(".export-btn"),u=n.querySelector(".export-menu");(l||u)&&(l==null||l.remove(),u==null||u.remove())}catch{}return setTimeout(()=>{try{xe()}catch{}},0),n}async function qn(t){if(!t.hook_variants&&!t.body_variants&&!t.cta_variants)return"";localStorage.getItem("direktiva_theme");let e=`
        <div class="ab-variants p-4 rounded-lg bg-gray-900/40 border border-gray-800/40">
            <h4 class="text-lg font-semibold text-blue-300 mb-2">A/B Variants - Pilih Copy Terbaik</h4>
    `;return t.hook_variants&&t.hook_variants.length>0&&(e+=await Re("Hook",t.hook_variants,le,"hook")),t.body_intro&&(e+=await Re("Body Intro",[t.body_intro],te,"body_intro")),t.body_variants&&t.body_variants.length>0&&(e+=await Re("Body",t.body_variants,te,"body")),t.cta_variants&&t.cta_variants.length>0&&(e+=await Re("CTA",t.cta_variants,ye,"cta")),e+="</div>",e}async function Re(t,e,a,n){const o=await Promise.all(e.map(async(i,r)=>({text:i,score:await a(i),index:r})));o.sort((i,r)=>r.score-i.score),o[0];let s=`
        <div class="variant-section mb-4">
            <h6 class="text-xs font-semibold text-blue-200 mb-2 light-mode:text-blue-600">${t} (${e.length} ${d("options")||"opsi"})</h6>
            <div class="space-y-2">
    `;return o.forEach((i,r)=>{const c=r===0,l=c?"bg-green-600":i.score>=50?"bg-blue-600":"bg-gray-600",u=c?d("best")||"TERBAIK":`${i.score}pts`;s+=`
            <div class="variant-item flex items-start space-x-3 p-2 rounded ${c?"bg-green-900/20 border border-green-700/30":"bg-gray-800/30"}">
                <span class="${l} text-white text-xs px-2 py-1 rounded font-bold flex-shrink-0">${u}</span>
                <p class="text-sm text-gray-300 flex-1">${i.text}</p>
                <div class="flex space-x-1 flex-shrink-0">
                    ${n==="hook"?`<button class="shorten-btn text-xs bg-yellow-600 hover:bg-yellow-700 text-white px-2 py-1 rounded" data-section="${n}" data-index="${i.index}" title="${d("shorten_tooltip")||"Pendekkan (7 kata)"}">${d("shorten_button")||"Pendek"}</button>`:""}
                    <button class="use-variant-btn text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded" data-section="${n}" data-index="${i.index}">${d("use_button")||"Gunakan"}</button>
                </div>
            </div>
        `}),s+=`
            </div>
            <div class="mt-2 flex space-x-2">
                <button class="use-best-btn text-xs bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded font-semibold" data-section="${n}"> ${d("use_best_button")||"Pakai Terbaik"}</button>
            </div>
        </div>
    `,s}function cs(t){const e=JSON.parse(t.dataset.script);t.querySelectorAll(".use-best-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.target.dataset.section;Sa(t,e,o)})}),t.querySelectorAll(".use-variant-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.target.dataset.section,s=parseInt(n.target.dataset.index);wa(t,e,o,s)})}),t.querySelectorAll(".shorten-btn").forEach(a=>{a.addEventListener("click",n=>{const o=n.target.dataset.section,s=parseInt(n.target.dataset.index);ka(t,e,o,s)})})}async function Sa(t,e,a){let n,o;switch(a){case"hook":n=e.hook_variants,o=le;break;case"body":n=e.body_variants,o=te;break;case"body_intro":n=[e.body_intro],o=te;break;case"cta":n=e.cta_variants,o=ye;break;default:return}if(!n||n.length===0)return;const s=await Promise.all(n.map(c=>Promise.resolve(o(c))));let i=0,r=Number.NEGATIVE_INFINITY;s.forEach((c,l)=>{const u=Number(c);Number.isFinite(u)&&u>r&&(r=u,i=l)}),await _t(t,e,a,n[i])}async function wa(t,e,a,n){let o;switch(a){case"hook":o=e.hook_variants;break;case"body":o=e.body_variants;break;case"body_intro":o=[e.body_intro];break;case"cta":o=e.cta_variants;break;default:return}!o||!o[n]||await _t(t,e,a,o[n])}async function ka(t,e,a,n){let o;switch(a){case"hook":o=e.hook_variants;break;default:return}if(!o||!o[n])return;const s=Mn(o[n],7);await _t(t,e,a,s)}async function De(t,e,a){try{const n=localStorage.getItem("productName")||t.title||"Product",o=localStorage.getItem("productDescription")||"Product description",s=localStorage.getItem("visualStrategy")||"standard",i=localStorage.getItem("aspectRatio")||"9:16",r=localStorage.getItem("direktiva_language")||"id",c=localStorage.getItem("direktiva_system_prompt")||"",l=JSON.stringify(t.character_sheet||[],null,2),u=Array.isArray(t.original_character_descriptions)?t.original_character_descriptions.join("; "):"",h=`Characters (character_sheet): ${l}
Original character physical descriptions: ${u}`,g=`${c}

${r==="en"?`Based on the new ${e.toUpperCase()} text: "${a}"

Product: ${n}
Description: ${o}
Visual Strategy: ${s}
Aspect Ratio: ${i}
${h}

IMPORTANT LANGUAGE RULES (override any previous instructions):
- visual_idea MUST be in English only.
- text_to_image_prompt MUST be in English only.
- image_to_video_prompt MUST be in English only.
- DO NOT mix any other language.

CHARACTER CONSTRAINTS:
- Use ONLY the characters provided in character_sheet above. Keep names and personalities consistent.
- DO NOT invent, change, or swap characters.
- In text_to_image_prompt, put physical descriptions ONLY inside <char-desc>...</char-desc> tags.
- NEVER include <char-desc> in image_to_video_prompt.

Return strictly JSON with structure:
{
  "shots": [
    {
      "visual_idea": "concise cinematic description in English",
      "text_to_image_prompt": "very detailed T2I prompt in English (use <char-desc> for physical details only)",
      "image_to_video_prompt": "I2V prompt in English (movement only, no physical descriptions)",
      "negative_prompt": "negative prompt for image quality"
    }
  ]
}`:`Berdasarkan teks ${e.toUpperCase()} yang baru: "${a}"

Produk: ${n}
Deskripsi: ${o}
Strategi Visual: ${s}
Rasio: ${i}
${h}

ATURAN BAHASA (menimpa instruksi sebelumnya):
- visual_idea WAJIB dalam Bahasa Indonesia saja.
- text_to_image_prompt (T2I) WAJIB dalam Bahasa Inggris saja.
- image_to_video_prompt (I2V) WAJIB dalam Bahasa Inggris saja.
- JANGAN campur bahasa dalam setiap field.

KONSTR A KARAKTER:
- Gunakan HANYA karakter dari character_sheet di atas. Nama dan kepribadian harus konsisten.
- JANGAN menciptakan/mengubah karakter.
- Di text_to_image_prompt, taruh deskripsi fisik HANYA di dalam tag <char-desc>...</char-desc>.
- JANGAN pernah menaruh <char-desc> pada image_to_video_prompt.

Kembalikan JSON murni dengan struktur:
{
  "shots": [
    {
      "visual_idea": "deskripsi sinematik singkat dalam Bahasa Indonesia",
      "text_to_image_prompt": "prompt T2I sangat detail dalam Bahasa Inggris (gunakan <char-desc> hanya untuk deskripsi fisik)",
      "image_to_video_prompt": "prompt I2V dalam Bahasa Inggris (khusus pergerakan, tanpa deskripsi fisik)",
      "negative_prompt": "negative prompt untuk kualitas gambar"
    }
  ]
}`}`,f=localStorage.getItem("direktiva_user_api_key"),p={"Content-Type":"application/json"};f&&(p["x-user-api-key"]=f);const _=await fetch("/api/generateScript",{method:"POST",headers:p,body:JSON.stringify({prompt:g,scriptCount:1,mode:"visual_regeneration"})});if(!_.ok)throw new Error("Failed to regenerate visual prompts");return(await _.json()).shots||[]}catch(n){return console.error("Error regenerating visual prompts:",n),null}}async function _t(t,e,a,n){switch(C(async()=>{const{showNotification:o}=await Promise.resolve().then(()=>J);return{showNotification:o}},void 0).then(({showNotification:o})=>{o(d("regenerating_visual_prompts")||"Meregenerasi prompt visual...","info")}),a){case"hook":if(e.hook){e.hook.text=n;const o=await De(e,"hook",n);o&&o.length>0&&(e.hook.shots=o)}break;case"body":if(e.body){e.body.text=n;const o=await De(e,"body",n);o&&o.length>0&&(e.body.shots=o)}break;case"body_intro":if(e.body){if(e.body_intro=n,e.body.text){const s=e.body.text.split(". ");s[0]=n,e.body.text=s.join(". ")}const o=await De(e,"body",e.body.text);o&&o.length>0&&(e.body.shots=o)}break;case"cta":if(e.cta){e.cta.text=n;const o=await De(e,"cta",n);o&&o.length>0&&(e.cta.shots=o)}break}t.dataset.script=JSON.stringify(e),st(e),pa(t,e),C(async()=>{const{showNotification:o}=await Promise.resolve().then(()=>J);return{showNotification:o}},void 0).then(({showNotification:o})=>{const s=d("variant_applied_with_visuals")||`${a.toUpperCase()} dan prompt visual berhasil diperbarui!`;o(s,"success")})}function ls(t){var A;const e=t.querySelector(".export-btn"),a=t.querySelector(".export-menu"),n=JSON.parse(t.dataset.script);function o(v,x="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"){const y=document.createElement("button");return y.type="button",y.className=x,y.textContent=v,y}const s=document.createElement("div");s.className="border-t border-gray-100 my-1";const i=o(" Copy VO  Gemini Text"),r=o(" Copy VO  ElevenLabs SSML"),c=o(" Download VO Files"),l=o(" Preview Gemini (API)"),u=o(" Stop Audio");a.append(s,i,r,c,l,u);const h={tiktok:"tiktok_video",shopee:"shopee_video",instagram:"igreels",threads:"threads",shorts:"shorts"},g=(((A=document.getElementById("platform-target"))==null?void 0:A.value)||"tiktok").toLowerCase(),f={platform:h[g]||"tiktok_video",lang:(q==null?void 0:q.current)==="en"?"en":"id"},_=(v=>{var x,y,S;return{hook:((x=v==null?void 0:v.hook)==null?void 0:x.text)||(v==null?void 0:v.hook)||"",scenes:[((y=v==null?void 0:v.body)==null?void 0:y.text)||(v==null?void 0:v.body)||""],cta:((S=v==null?void 0:v.cta)==null?void 0:S.text)||(v==null?void 0:v.cta)||""}})(n),k=n!=null&&n.id?`script:${n.id}`:void 0;i.addEventListener("click",async()=>{await Bn(_,f),a.classList.add("hidden")}),r.addEventListener("click",async()=>{await Pn(_,f),a.classList.add("hidden")}),c.addEventListener("click",()=>{Nn(_,f),a.classList.add("hidden")}),l.addEventListener("click",()=>{On(_,f,"Kore",{button:l,cacheKey:k}),a.classList.add("hidden")}),u.addEventListener("click",()=>{va(),a.classList.add("hidden")}),e.addEventListener("click",v=>{v.stopPropagation(),document.querySelectorAll(".export-menu").forEach(x=>{x!==a&&x.classList.add("hidden")}),a.classList.toggle("hidden")}),document.addEventListener("click",v=>{t.contains(v.target)||a.classList.add("hidden")}),t.querySelector(".export-prompt-json").addEventListener("click",async()=>{const v=t.querySelector(".export-prompt-json");v.disabled=!0,v.classList.add("opacity-50");try{await Ln(n)}finally{v.disabled=!1,v.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-prompt-csv").addEventListener("click",async()=>{const v=t.querySelector(".export-prompt-csv");v.disabled=!0,v.classList.add("opacity-50");try{await Tn(n)}finally{v.disabled=!1,v.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-capcut-srt").addEventListener("click",async()=>{const v=t.querySelector(".export-capcut-srt");v.disabled=!0,v.classList.add("opacity-50");try{await An(n)}finally{v.disabled=!1,v.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-capcut-csv").addEventListener("click",async()=>{const v=t.querySelector(".export-capcut-csv");v.disabled=!0,v.classList.add("opacity-50");try{await Cn(n)}finally{v.disabled=!1,v.classList.remove("opacity-50"),a.classList.add("hidden")}});const E=t.querySelector(".export-all-zip-item");E&&E.addEventListener("click",async()=>{E.disabled=!0,E.classList.add("opacity-50");try{const{exportZipForScripts:v}=await C(async()=>{const{exportZipForScripts:x}=await Promise.resolve().then(()=>xa);return{exportZipForScripts:x}},void 0);await v([n],!1)}catch{}finally{E.disabled=!1,E.classList.remove("opacity-50"),a.classList.add("hidden")}})}function xe(){try{const t=[...document.querySelectorAll(".result-card")];if(t.length<2){t.forEach(n=>{var o;return(o=n.querySelector(".best-of-all"))==null?void 0:o.remove()});return}let e=null,a=-1/0;if(t.forEach(n=>{const o=n.dataset.globalScore,s=Number(o);Number.isFinite(s)&&s>a&&(a=s,e=n)}),t.forEach(n=>{var o;return(o=n.querySelector(".best-of-all"))==null?void 0:o.remove()}),e){const n=document.createElement("span"),o=localStorage.getItem("direktiva_theme")||"dark";n.textContent=d("best_of_all")||"Best of All",n.className="best-of-all",n.style.marginLeft="6px",n.style.padding="2px 8px",n.style.borderRadius="9999px",n.style.fontSize="12px",n.style.lineHeight="1",n.style.display="inline-flex",n.style.alignItems="center",n.style.fontWeight="700",o==="light"?(n.style.backgroundColor="#fef3c7",n.style.border="1px solid #fde68a",n.style.color="#92400e"):(n.style.backgroundColor="rgba(234,179,8,0.20)",n.style.border="1px solid rgba(234,179,8,0.35)",n.style.color="#fde68a");const s=e.querySelector(".result-title");if(s){const i=s.firstChild&&s.firstChild.nodeType===Node.ELEMENT_NODE?s.firstChild:null;s.style.display="inline-flex",s.style.alignItems="baseline",s.style.flexWrap="wrap",s.style.gap="8px",i?s.insertBefore(n,i.nextSibling):s.appendChild(n)}}}catch{}}var Ha;try{(Ha=document.getElementById("rank-all-btn"))==null||Ha.addEventListener("click",()=>{try{xe()}catch{}})}catch{}async function Ie(t,e){var h,g,f;const a=document.getElementById("script-viewer-modal"),n=document.getElementById("script-viewer-content");if(!a||!n)return;try{const p=ge&&typeof ge=="function"?ge().find(_=>_.id===(e==null?void 0:e.id)):null;p&&(e=p)}catch{}const o=p=>(p||"").toString();let s=0;try{const p=await Promise.all([...(e.hook_variants||[]).map(A=>le(A)),le(((h=e.hook)==null?void 0:h.text)||e.hook||"")]),_=[...(e.cta_variants||[]).map(A=>ye(A)),ye(((g=e.cta)==null?void 0:g.text)||e.cta||"")],k=(((f=e.body)==null?void 0:f.text)||e.body||"").toString().split(`
`)[0]||"",E=await Promise.all([...(e.body_variants||[]).map(A=>te(A)),te(k)]);s=$n(p,E,_,e)}catch{s=65}const r=(localStorage.getItem("direktiva_theme")||"dark")==="light"?"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-800 border border-emerald-300":"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-200 text-emerald-900 border border-emerald-300";let c=`<div class="mb-4 flex items-center justify-between"><h3 class="text-xl font-bold">${o(e.title)}</h3><span class="${r}" data-tooltip><span>Score ${s}</span><span class="tooltip-hint">${d("score_tooltip")||"Skor gabungan dari Hook/Body/CTA"}</span></span></div>`;c+=`
  <div class="mb-4 flex items-center gap-2">
    <button class="overlay-copy-btn px-3 py-1.5 text-xs rounded bg-gray-700 text-white hover:bg-gray-600" data-tooltip><span>${d("copy_full_script")||"Copy Full Script"}</span><span class="tooltip-hint">${d("copy_tooltip")||"Salin semua teks skrip"}</span></button>
    <div class="relative">
      <button class="overlay-export-btn px-3 py-1.5 text-xs rounded bg-blue-600 text-white hover:bg-blue-700" data-tooltip><span>${d("export_button")||"Export"}</span><span class="tooltip-hint">${d("export_tooltip")||"Export ke berbagai format"}</span></button>
      <div class="overlay-export-menu hidden absolute right-0 mt-1 w-48 bg-gray-900 border border-gray-700 rounded shadow-lg z-10">
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="prompt-json">Prompt Pack (JSON)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="prompt-csv">Prompt Pack (CSV)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="capcut-srt">CapCut (SRT)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="capcut-csv">CapCut (CSV)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="zip-single">Export This (ZIP)</button>
        <div class="border-t border-gray-800 my-1"></div>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="vo-copy-gemini"> Copy VO  Gemini Text</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="vo-copy-ssml"> Copy VO  ElevenLabs SSML</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="vo-download"> Download VO Files</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="vo-prev-gemini"> Preview Gemini (API)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="vo-stop"> Stop Audio</button>
      </div>
    </div>
    <button class="overlay-edit-btn px-3 py-1.5 text-xs rounded bg-yellow-600 text-white hover:bg-yellow-700" data-tooltip><span>${d("edit_button")||"Edit"}</span><span class="tooltip-hint">${d("edit_tooltip")||"Edit teks skrip & regenerasi visual"}</span></button>
  </div>`;const l=(p,_,k)=>{if(!k)return"";let E=`<div class="mb-4"><div class="flex items-center justify-between mb-2"><h4 class="font-semibold">${_}</h4><button class="overlay-section-copy-btn px-2 py-1 text-xs rounded bg-gray-700 text-white hover:bg-gray-600" data-section="${p}">${d("copy_button")||"Copy"}</button></div>`;E+=`<p class="mb-2 whitespace-pre-wrap">${o(k.text||k)}</p>`;const A=k.shots||[];return Array.isArray(A)&&A.length&&(E+='<div class="space-y-2">',A.forEach((v,x)=>{E+=`<div class="p-3 rounded bg-gray-900/40 border border-gray-700/40"><div class="text-xs text-gray-300"><strong>${d("visual_idea_label")||"Ide Visual"} ${x+1}:</strong> ${o(v.visual_idea)}</div><div class="text-xs text-gray-400 mt-1 flex items-center gap-2"><strong>${d("t2i_prompt_label")||"Image Prompt"}:</strong><span class="prompt-t2i-display">${o(v.text_to_image_prompt)}</span><button class="prompt-howto-btn flex-shrink-0" data-type="t2i" data-tooltip><div class="icon icon-sm icon-info text-gray-500 hover:text-white"></div><span class="tooltip-hint">${d("t2i_tooltip_models")||""}</span></button><button class="prompt-copy-btn flex-shrink-0" data-prompt="${o(v.text_to_image_prompt).replace(/\\/g,"\\\\").replace(/\"/g,"&quot;")}"><div class="icon icon-sm icon-copy text-gray-500 hover:text-white"></div></button></div><div class="text-xs text-gray-400 mt-1 flex items-center gap-2"><strong>${d("i2v_prompt_label")||"Video Prompt"}:</strong><span class="prompt-i2v-display">${o(v.image_to_video_prompt)}</span><button class="prompt-howto-btn flex-shrink-0" data-type="i2v" data-tooltip><div class="icon icon-sm icon-info text-gray-500 hover:text-white"></div><span class="tooltip-hint">${d("i2v_tooltip_models")||""}</span></button><button class="prompt-copy-btn flex-shrink-0" data-prompt="${o(v.image_to_video_prompt).replace(/\\/g,"\\\\").replace(/\"/g,"&quot;")}"><div class="icon icon-sm icon-copy text-gray-500 hover:text-white"></div></button></div></div>`}),E+="</div>"),E+="</div>",E};if(e.character_sheet&&e.character_sheet.length&&(c+=`<div class="mb-4"><h4 class="font-semibold mb-2">${d("character_sheet_title")||"Character Sheet"}</h4>`,e.character_sheet.forEach((p,_)=>{c+=`<div class="text-xs text-gray-300 mb-1">${d("character_label")||"Karakter"} ${_+1}: ${o((p.name||"")+" "+(p.age||""))}</div>`}),c+="</div>"),!e.slides)c+=l("hook",d("hook_title")||"Hook",e.hook),c+=l("body",d("body_title")||"Body",e.body),c+=l("cta",d("cta_title")||"CTA",e.cta);else{const p=(e.slides||[]).map((_,k)=>ua(_,k)).join("");c+=`
      <div class="mb-4">
        <h4 class="font-semibold mb-2">${d("slides_title")||"Slides"}</h4>
        <div class="swiper carousel-swiper-container bg-gray-900/40 p-4 rounded-lg border border-gray-800/40">
          <div class="swiper-wrapper">${p}</div>
          <div class="swiper-pagination !bottom-2"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>`}n.innerHTML=c;try{n.dataset.script=JSON.stringify(e)}catch{}try{const p=await qn(e);p&&n.insertAdjacentHTML("beforeend",p)}catch{}try{n.insertAdjacentHTML("beforeend",ma(e));try{if(e.additional_assets_html){const p=n.querySelector(".additional-assets-container"),_=n.querySelector(".asset-loader"),k=n.querySelector(".asset-content");p==null||p.classList.remove("hidden"),_==null||_.classList.add("hidden"),k&&(k.classList.remove("hidden"),k.innerHTML=e.additional_assets_html)}}catch{}}catch{}n.onclick=async p=>{var K,he,ae,de;const _=p.target.closest(".overlay-export-btn");if(_){const O=_.parentElement.querySelector(".overlay-export-menu");O&&O.classList.toggle("hidden");try{const B=_.querySelector(".tooltip-hint");B&&(B.style.display="none")}catch{}return}const k=p.target.closest(".overlay-export-item");if(k){try{const B=k.dataset.type;if(B==="prompt-json")await Ln(e);else if(B==="prompt-csv")await Tn(e);else if(B==="capcut-srt")await An(e);else if(B==="capcut-csv")await Cn(e);else if(B==="zip-single"){const{exportZipForScripts:N}=await C(async()=>{const{exportZipForScripts:F}=await Promise.resolve().then(()=>xa);return{exportZipForScripts:F}},void 0);await N([e],!1)}else if(B==="vo-copy-gemini"||B==="vo-copy-ssml"||B==="vo-download"||B==="vo-prev-gemini"||B==="vo-stop"){const N={tiktok:"tiktok_video",shopee:"shopee_video",instagram:"igreels",threads:"threads",shorts:"shorts"},F=(((K=document.getElementById("platform-target"))==null?void 0:K.value)||"tiktok").toLowerCase(),G={platform:N[F]||"tiktok_video",lang:(q==null?void 0:q.current)==="en"?"en":"id"},z=(D=>{var Pe,ue,_e;return{hook:((Pe=D==null?void 0:D.hook)==null?void 0:Pe.text)||(D==null?void 0:D.hook)||"",scenes:[((ue=D==null?void 0:D.body)==null?void 0:ue.text)||(D==null?void 0:D.body)||""],cta:((_e=D==null?void 0:D.cta)==null?void 0:_e.text)||(D==null?void 0:D.cta)||""}})(e),Ye=e!=null&&e.id?`script:${e.id}`:void 0;B==="vo-copy-gemini"?await Bn(z,G):B==="vo-copy-ssml"?await Pn(z,G):B==="vo-download"?Nn(z,G):B==="vo-prev-gemini"?await On(z,G,"Kore",{button:k,cacheKey:Ye}):B==="vo-stop"&&va()}}catch{}const O=p.target.closest(".overlay-export-menu");O==null||O.classList.add("hidden");return}const E=n.querySelector(".overlay-export-menu:not(.hidden)");E&&!p.target.closest(".overlay-export-menu")&&!p.target.closest(".overlay-export-btn")&&E.classList.add("hidden");const A=p.target.closest(".overlay-copy-btn");if(A){try{we(Te(e),A)}catch{}return}if(p.target.closest(".overlay-edit-btn")){try{Zt(t);const O=document.getElementById("edit-modal"),B=document.getElementById("script-viewer-modal");O&&(O.style.zIndex="1001"),B&&(B.style.zIndex="1000")}catch{}return}const x=p.target.closest(".overlay-section-copy-btn");if(x){try{const O=x.dataset.section;let B="";O==="hook"?B=(((he=e.hook)==null?void 0:he.text)||e.hook||"").toString():O==="body"?B=(((ae=e.body)==null?void 0:ae.text)||e.body||"").toString():O==="cta"&&(B=(((de=e.cta)==null?void 0:de.text)||e.cta||"").toString()),we(B,x)}catch{}return}const y=p.target.closest(".prompt-copy-btn");if(y){const B=(y.dataset.prompt||"").replace(/<\/?char-desc>/gi,"");try{we(B,y)}catch{}return}const S=p.target.closest(".prompt-howto-btn");if(S){ds(S.dataset.type==="i2v"?"i2v":"t2i");return}if(p.target.closest(".generate-assets-btn")){try{const{handleGenerateAssets:O}=await C(async()=>{const{handleGenerateAssets:B}=await Promise.resolve().then(()=>ys);return{handleGenerateAssets:B}},void 0);await O(n.closest(".result-card")||n)}catch{}return}const T=p.target.closest(".use-best-btn"),L=p.target.closest(".use-variant-btn"),P=p.target.closest(".shorten-btn");if(T){await Sa(t,e,T.dataset.section),Ie(t,e);return}if(L){await wa(t,e,L.dataset.section,parseInt(L.dataset.index)),Ie(t,e);return}if(P){await ka(t,e,P.dataset.section,parseInt(P.dataset.index)),Ie(t,e);return}};try{e.slides&&da("#script-viewer-content .carousel-swiper-container")}catch{}a.classList.remove("opacity-0","pointer-events-none");const u=document.getElementById("script-viewer-close");a.__bound||(a.__bound=!0,u==null||u.addEventListener("click",()=>{a.classList.add("opacity-0","pointer-events-none")}),a.addEventListener("click",p=>{p.target===a&&a.classList.add("opacity-0","pointer-events-none")}),window.addEventListener("keydown",p=>{p.key==="Escape"&&a.classList.add("opacity-0","pointer-events-none")}))}function ds(t){try{const e=document.getElementById("howto-modal"),a=document.getElementById("howto-body");if(!e||!a)return;const n=t!=="i2v",o=c=>`<div class="flex flex-wrap gap-2 mt-2">${c.map(l=>`<span class="px-2 py-0.5 text-xs rounded bg-gray-700 text-white border border-gray-600">${l}</span>`).join("")}</div>`,s=n?["Leonardo","Flux","Imagen","Gemini"]:["Pika","Runway","Veo"],i=(c,l,u="")=>`
      <div class="mb-4">
        <div class="text-sm font-semibold text-blue-300">${c}</div>
        <div class="text-sm text-gray-300">${l}</div>
        ${u}
      </div>`,r=[i(d("howto_step1_title")||"Open the App",n?d("howto_step1_desc_t2i")||"Open Leonardo, Flux, Imagen, or Gemini Image.":d("howto_step1_desc_i2v")||"Open Pika, Runway, or Google Veo.",o(s)),i(d("howto_step2_title")||"Paste the Prompt",n?d("howto_step2_desc_t2i")||"Paste the Image Prompt. Keep <char-desc> tags for physical details.":d("howto_step2_desc_i2v")||"Paste the Video Prompt. Do NOT include <char-desc> tags."),i(d("howto_step3_title")||"Set Parameters",n?d("howto_params_t2i")||"Steps 2840, CFG 69, 9:16, DPM++, random seed.":d("howto_params_i2v")||"Duration 35s, FPS 2430, Motion medium, 9:16.")].join("");if(a.innerHTML=`
      <div class="mb-3 text-sm font-semibold">${n?d("howto_t2i")||"Use the Image Prompt":d("howto_i2v")||"Use the Video Prompt"}</div>
      ${r}`,e.classList.remove("opacity-0","pointer-events-none"),!e.__bound){e.__bound=!0;const c=document.getElementById("howto-close");c==null||c.addEventListener("click",()=>{e.classList.add("opacity-0","pointer-events-none")}),e.addEventListener("click",l=>{l.target===e&&e.classList.add("opacity-0","pointer-events-none")}),window.addEventListener("keydown",l=>{l.key==="Escape"&&e.classList.add("opacity-0","pointer-events-none")})}}catch{}}const je=Object.freeze(Object.defineProperty({__proto__:null,applyVariantToScript:_t,attachABVariantsListeners:cs,attachExportListeners:ls,createABVariantsHTML:qn,createResultCard:Dn,createVariantSection:Re,openScriptViewer:Ie,regenerateVisualPrompts:De,renderError:ba,renderResults:Rn,scoreBodyIntro:te,scoreCTA:ye,scoreHook:le,shorten:Mn,updateGlobalBestBadge:xe,useBestVariant:Sa,useShortenedVariant:ka,useSpecificVariant:wa},Symbol.toStringTag,{value:"Module"})),us={tiktok:{aspect:"9:16",maxDuration:23,cutsEverySec:.8,retentionHooksEvery:4,beatMap:[{t:0,action:"HOOK_PATTERN_INTERRUPT",textMaxWords:6},{t:3,action:"PROOF/DEMO_QUICK"},{t:7,action:"BENEFIT_1 + ON-SCREEN CAPTION"},{t:12,action:"BENEFIT_2 + B-ROLL"},{t:18,action:"MICRO_LOOP_SETUP"},{t:21,action:"CTA_SUPER_SHORT"}],caption:{maxChars:150,hashtagPolicy:{total:3,mix:["2 broad","1 niche"]}},audio:{useTrending:!0,fallback:"original"},cta:{style:"ultra-short",placement:"t=21-23"},commentBait:["Mau versi murahnya? ketik 'MURAH'"]},shopee:{aspect:"9:16",maxDuration:35,scriptMode:"DTC_SHORT + LIVE_MACROS",blocks:["ANCHOR_PRICE","USP_TRIPLE","TRUST_PROOF","URGENCY_TIMER","CTA_VOUCHER"],objections:["kualitas","kecepatan kirim","COD","garansi"],liveMacros:["Tanya warna: 'Hitam/Putih?'","Ketik 'BELI' untuk voucher"],cta:{copyID:"CTA_SHOPEE_BUY_NOW",mentions:["Voucher","Gratis Ongkir","COD"]},deepLink:!0},instagram:{targets:["reels","carousel","story"],reels:{aspect:"9:16",maxDuration:29,aestheticsFirst:!0,safeZones:["avoid bottom 15% for UI"],caption:{mode:"save/share oriented",includes:["line breaks","1 question"]},coverFrame:"auto-pick best frame at t0.5s",cta:{goal:"SAVE+SHARE",copy:"Save this for later"}},carousel:{slides:7,structure:["Slide1 HOOK big text","Slide2-6 value bites","Slide7 CTA save/share"],fontMaxWordsPerSlide:12}},threads:{threadLen:{min:3,max:7},tone:"conversational",ending:"open_question",media:{allowImage:!0,clipUnder10s:!0},caption:{skimmable:!0,lineBreaks:!0}},shorts:{aspect:"9:16",maxDuration:58,pacing:"fast",retentionHooksEvery:4,cta:{placement:"last 2s",copy:"Subscribe for the next tip"},commentsPinTemplate:"Link & resources in the pinned comment"}};function ms(t,e="id",a="post"){var f,p;const n=us[t];if(!n)return{promptNotes:"",beats:[],cta:{},commentBait:[],meta:{},cfg:{}};const o=a==="carousel";let s=n;t==="instagram"&&(s=o?n.carousel||n:n.reels||n);const i=e==="en",r=[];if(!o)s.aspect&&r.push(`${i?"Aspect":"Rasio"}: ${s.aspect}`),s.maxDuration&&r.push(`${i?"Target duration":"Durasi target"}  ${s.maxDuration}s`),s.pacing&&r.push(`${i?"Pacing":"Tempo"}: ${s.pacing}`),s.cutsEverySec&&r.push(`${i?"Cut cadence":"Frekuensi cut"}  ${s.cutsEverySec} cut/s`),s.safeZones&&r.push(`${i?"Safe-zones":"Area aman"}: ${Array.isArray(s.safeZones)?s.safeZones.join(", "):s.safeZones}`),(f=s.caption)!=null&&f.mode&&r.push(`Caption: ${s.caption.mode}`),s.retentionHooksEvery&&r.push(`${i?"Retention hook every":"Hook retensi tiap"} ${s.retentionHooksEvery}s`);else{const _=s.slides||7;r.push(`${i?"Slides":"Jumlah slide"}: ${_}`),s.fontMaxWordsPerSlide&&r.push(`${i?"Max words/slide":"Maks kata/slide"}: ${s.fontMaxWordsPerSlide}`),s.structure&&r.push(`${i?"Structure":"Struktur"}: ${s.structure.join("  ")}`)}const c=r.length?`
- ${r.join(`
- `)}`:"",l=o?[]:s.beatMap||s.blocks||[],u=s.cta||{},h=s.commentBait||[],g=o?{slides:s.slides||7,fontMaxWordsPerSlide:s.fontMaxWordsPerSlide||12}:{hashtags:((p=s.caption)==null?void 0:p.hashtagPolicy)||null,audio:s.audio||null,deepLink:s.deepLink||!1,coverFrame:s.coverFrame||null};return{promptNotes:c,beats:l,cta:u,commentBait:h,meta:g,cfg:s}}async function ze(t){try{return await t.clone().json()}catch{try{const a=await t.text();return a?JSON.parse(a):null}catch{return null}}}let $e=null;async function ps(t,e,a=""){try{try{$e==null||$e.abort()}catch{}$e=new AbortController;const{signal:n}=$e,o=localStorage.getItem("direktiva_user_api_key"),s={"Content-Type":"application/json"};o&&(s["x-user-api-key"]=o);const i=await fetch("/api/analyzeImage",{method:"POST",headers:s,body:JSON.stringify({base64Data:t,mimeType:e,mode:"fullDescription",focusLabel:a}),signal:n});if(!i.ok){const E=await ze(i),A=(E==null?void 0:E.error)||i.statusText||"Terjadi kesalahan";throw new Error(`Tahap 1 Gagal: ${A}`)}const r=await ze(i);if(!r||!r.description)throw new Error(d("notification_image_analysis_error")||"Image analysis error");const{description:c,palette:l,brand_guess:u,model_guess:h,ocr_text:g,distinctive_features:f}=r,p=await fetch("/api/analyzeImage",{method:"POST",headers:s,body:JSON.stringify({textData:{description:c,palette:l,brand_guess:u,model_guess:h,ocr_text:g,distinctive_features:f,focusLabel:a},mode:"extractKeywords",focusLabel:a}),signal:n});if(!p.ok){const E=await ze(p),A=(E==null?void 0:E.error)||p.statusText||"Terjadi kesalahan";throw new Error(`Tahap 2 Gagal: ${A}`)}const _=await ze(p);if(!_||!_.keywords)throw new Error(d("notification_image_analysis_error")||"Image analysis error");const{keywords:k}=_;return{description:c,palette:l,brand_guess:u,model_guess:h,ocr_text:g,distinctive_features:f,keywords:k}}catch(n){throw(n==null?void 0:n.name)==="AbortError"||console.error("Error dalam proses analisis gambar 2 tahap:",n),n}}const Pa=Number(localStorage.getItem("direktiva_timeout_ms"))||12e4;async function it(t,e,a,n=Pa){try{const o={"Content-Type":"application/json"};try{const{data:{session:l}}=await w.auth.getSession();l!=null&&l.access_token&&(o.Authorization=`Bearer ${l.access_token}`)}catch{}const s=localStorage.getItem("direktiva_user_api_key");s&&(o["x-user-api-key"]=s);const i=new AbortController,r=setTimeout(()=>i.abort(new DOMException("timeout","AbortError")),n),c=await fetch("/api/generateScript",{method:"POST",headers:o,body:JSON.stringify({prompt:t,schema:e,temperature:a}),signal:i.signal});if(clearTimeout(r),!c.ok){let l=d("notification_api_error")||"Terjadi kesalahan pada server.";try{const u=await c.json();u!=null&&u.error&&(l=u.error)}catch{}throw new Error(l)}return await c.json()}catch(o){if(console.error("Error calling backend function:",o),(o==null?void 0:o.name)==="AbortError"){const s=Math.round((n||Pa)/1e3),i=new Error(`Request timeout after ${s}s. Server lambat atau antrian penuhcoba lagi atau naikkan timeout.`);throw i.code="TIMEOUT",i}throw o}}function gs(){return{type:"OBJECT",properties:{titles:{type:"ARRAY",items:{type:"STRING"},minItems:3,maxItems:3},platform:{type:"STRING",enum:["tiktok","instagram_reels","youtube_shorts","shopee"]},hashtags:{type:"ARRAY",items:{type:"STRING"}},platform_hashtags:{type:"OBJECT",properties:{tiktok:{type:"ARRAY",items:{type:"STRING"}},instagram_reels:{type:"ARRAY",items:{type:"STRING"}},youtube_shorts:{type:"ARRAY",items:{type:"STRING"}},shopee:{type:"ARRAY",items:{type:"STRING"}}}},trending_tags:{type:"ARRAY",items:{type:"STRING"}},thumbnail_ideas:{type:"ARRAY",items:{type:"STRING"},minItems:3,maxItems:3}},required:["titles","hashtags","thumbnail_ideas"]}}const Fe={hooksConfig:null,ctaMapping:null,hookInstructions:null,ctaInstructions:null,async init(){const t=(await C(async()=>{const{default:o}=await import("./hooks_config-dN3H1HBZ.js");return{default:o}},[])).default,e=(await C(async()=>{const{default:o}=await import("./cta_mapping-COptbEKR.js");return{default:o}},[])).default,a=(await C(async()=>{const{default:o}=await import("./instructions.hooks-DfQTWXag.js");return{default:o}},[])).default,n=(await C(async()=>{const{default:o}=await import("./instructions.cta-C7HH3H5D.js");return{default:o}},[])).default;this.hooksConfig=t,this.ctaMapping=e,this.hookInstructions=a,this.ctaInstructions=n},suggestCtas(t,e){var a,n;return((n=(a=this.ctaMapping)==null?void 0:a[t])==null?void 0:n[e])||[]},getHookInstruction(t,e="id"){var a,n;return((n=(a=this.hookInstructions)==null?void 0:a[t])==null?void 0:n[e])||null},getCtaInstruction(t,e="id"){var a,n;return((n=(a=this.ctaInstructions)==null?void 0:a[t])==null?void 0:n[e])||null},listHookGroups(){var t;return((t=this.hooksConfig)==null?void 0:t.categories)||[]},listFormats(){var t;return((t=this.hooksConfig)==null?void 0:t.formats)||[]}};localStorage.getItem("visualStrategy");let Ft=localStorage.getItem("aspectRatio")||"9:16",We=0;function Hn(t){const e=q.current==="en"?"en":"id",a=Fe.getHookInstruction(t,e);return a||(console.warn("[HookInstructions] Missing for:",t),e==="en"?"Create a strong scrol-stopping hook in the first 3 seconds. Keep it concrete and audience-specific.":"Buat hook kuat yang menghentikan scroll dalam 3 detik pertama. Harus konkret dan spesifik untuk audiens.")}function jn(t){const e=q.current==="en"?"en":"id",a=Fe.getCtaInstruction(t,e);return a||(console.warn("[CTAInstructions] Missing for:",t),e==="en"?"Use a clear, actionable CTA that tells exactly what to do next.":"Gunakan CTA yang jelas dan langsung mengarahkan langkah berikutnya.")}function Un(){const{productName:t,productDesc:e}=m.inputs;return t.value.trim()?e.value.trim()?null:d("notification_product_desc_empty")||"Deskripsi produk tidak boleh kosong!":d("notification_product_name_empty")||"Nama produk tidak boleh kosong!"}async function Fn(t){var i;const e=++We,a=t.target.files[0];if(!a)return;if(a.size>5*1024*1024){b(d("notification_image_size_error")||"Image size too large","error");return}m.imageLoader.classList.remove("hidden"),m.imageHelper.textContent=d("analyzing_image")||"Analyzing image...",m.visualDnaStorage.textContent="",m.imagePreviewContainer.classList.add("hidden");try{m.generateBtn.disabled=!0}catch{}let n=a,o="",s=null;try{const r=document.getElementById("image-cropper-modal"),c=document.getElementById("cropper-target"),l=document.getElementById("cropper-use-btn"),u=document.getElementById("cropper-skip-btn");if(r&&c&&window.Cropper){o=URL.createObjectURL(a),c.src=o,r.classList.remove("opacity-0","pointer-events-none"),(i=r.querySelector(".modal-content"))==null||i.classList.remove("scale-95"),await new Promise(x=>setTimeout(x,50)),s=new window.Cropper(c,{viewMode:1,movable:!0,zoomable:!0,autoCropArea:.9,background:!1});const v=async x=>{var y;try{if(x&&s){const S=s.getCroppedCanvas({imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}),I=await new Promise(T=>S.toBlob(T,a.type||"image/jpeg",.92));I&&(n=new File([I],a.name,{type:a.type||"image/jpeg"}))}}finally{try{s==null||s.destroy()}catch{}s=null,r.classList.add("opacity-0","pointer-events-none"),(y=r.querySelector(".modal-content"))==null||y.classList.add("scale-95")}};await new Promise(x=>{const y=async()=>{l.removeEventListener("click",y),u.removeEventListener("click",S),await v(!0),x()},S=async()=>{l.removeEventListener("click",y),u.removeEventListener("click",S),await v(!1),x()};l.addEventListener("click",y,{once:!0}),u.addEventListener("click",S,{once:!0})})}const h=new FileReader;h.onload=v=>{m.imagePreview.src=v.target.result,m.imagePreviewContainer.classList.remove("hidden")},h.readAsDataURL(n);const g=await Ua(n),f=(m.inputs.productName.value||"").trim(),p=await ps(g,n.type,f);if(e!==We)return;const _=[p.brand_guess?`brand=${p.brand_guess}`:"",p.model_guess?`model=${p.model_guess}`:"",Array.isArray(p.palette)&&p.palette.length?`must_keep_colors=${p.palette.slice(0,3).join("|")}`:""].filter(Boolean).join(", "),k=Array.isArray(p.distinctive_features)?p.distinctive_features.join(", "):"",E=Array.isArray(p.ocr_text)?p.ocr_text.join(" "):"",A=[_,p.keywords,k,E].filter(Boolean).join(", ");m.visualDnaStorage.textContent=A,localStorage.setItem("productColorPalette",JSON.stringify(p.palette)),b(d("notification_image_analysis_success")||"Image analysis successful"),m.imageHelper.textContent=`${n.name} ${d("analysis_complete")||"analysis complete"}`}catch(r){(r==null?void 0:r.name)!=="AbortError"&&(console.error("Error during image analysis:",r),e===We&&(b(`${d("notification_image_analysis_error")||"Image analysis error"} ${r.message}`,"error"),Ea()))}finally{if(o)try{URL.revokeObjectURL(o)}catch{}if(e===We){m.imageLoader.classList.add("hidden");try{m.generateBtn.disabled=!1}catch{}}}}function Ea(){m.inputs.productImage.value="",m.imagePreview.src="",m.imagePreviewContainer.classList.add("hidden"),m.visualDnaStorage.textContent="",localStorage.removeItem("productColorPalette"),m.imageHelper.textContent=d("image_helper_text")||"Upload product image for better analysis";try{m.generateBtn.disabled=!1}catch{}}async function Gn(){var o,s,i;const t=Un();if(t){b(t,"error");return}try{const r=parseInt(((o=document.getElementById("script-count"))==null?void 0:o.value)||"1",10),c=document.getElementById("results-toolbar");if(c){const l=r>1;c.classList.toggle("hidden",!l);try{c.style.display=l?"flex":"none"}catch{}}}catch{}const e=document.querySelector(".progress-bar"),a=document.querySelector(".progress-bar-fill");e&&(e.classList.remove("hidden"),a.style.width="0%"),U(!0,m.generateBtn),m.downloadAllContainer.classList.add("hidden");const n=document.getElementById("results-container");if(n){n.innerHTML="";const r=parseInt(document.getElementById("script-count").value)||3;for(let c=0;c<r;c++){const l=document.getElementById("skeleton-card-template");if(l){const u=l.content.cloneNode(!0);n.appendChild(u)}}}try{a&&(a.style.width="20%");const r=Vn(),c=document.getElementById("creative-freedom"),l=c?parseFloat(c.value):.7;a&&(a.style.width="40%");const u=Number(localStorage.getItem("direktiva_timeout_ms"))||18e4;let h=await it(r,Le(),l,u);if(a&&(a.style.width="80%"),!h||h.length===0)throw new Error(d("notification_script_generation_error")||"Error generating script");const g=parseInt(((s=document.getElementById("script-count"))==null?void 0:s.value)||"1",10),f=v=>(v||"").toString().toLowerCase().replace(/\s+/g," ").replace(/[\-_,.;:!?"'`~()\[\]{}]/g,"").trim(),p=v=>{var x,y,S;return[f(((x=v==null?void 0:v.hook)==null?void 0:x.text)||(v==null?void 0:v.hook)||""),f(((y=v==null?void 0:v.body)==null?void 0:y.text)||(v==null?void 0:v.body)||""),f(((S=v==null?void 0:v.cta)==null?void 0:S.text)||(v==null?void 0:v.cta)||"")].join("|")},_=new Map;if(h.forEach(v=>{const x=p(v);_.has(x)||_.set(x,v)}),_.size<g){const v=Array.from(_.values()).map(L=>{var P;return((P=L==null?void 0:L.hook)==null?void 0:P.text)||(L==null?void 0:L.hook)||""}).filter(Boolean).slice(0,8),x=Array.from(_.values()).map(L=>{var P;return((P=L==null?void 0:L.body)==null?void 0:P.text)||(L==null?void 0:L.body)||""}).filter(Boolean).slice(0,8),y=Array.from(_.values()).map(L=>{var P;return((P=L==null?void 0:L.cta)==null?void 0:P.text)||(L==null?void 0:L.cta)||""}).filter(Boolean).slice(0,8),S=q.current==="en"?`
- DIVERSITY RULE: Each variation MUST be clearly different in angle, wording, and structure.
- STRICTLY AVOID reusing these exact texts (as-is) for any part:
HOOK_AVOID: ${v.join(" || ")}
BODY_AVOID: ${x.join(" || ")}
CTA_AVOID: ${y.join(" || ")}`:`
- ATURAN KERAGAMAN: Setiap variasi WAJIB jelas berbeda dalam angle, diksi, dan struktur.
- HINDARI keras mengulang teks persis berikut (apa adanya) pada bagian manapun:
HOOK_HINDARI: ${v.join(" || ")}
BODY_HINDARI: ${x.join(" || ")}
CTA_HINDARI: ${y.join(" || ")}`,I=r+S,T=Math.max(0,g-_.size);if(T>0)try{const L=await it(I,Le(T),Math.min(1,(l||.7)+.1),u);Array.isArray(L)&&L.forEach(P=>{const K=p(P);!_.has(K)&&_.size<g&&_.set(K,P)})}catch{}}const E=Array.from(_.values()).slice(0,g).map((v,x)=>({...v,visual_dna:m.visualDnaStorage.textContent,id:`script-${Date.now()}-${x}`})),A=localStorage.getItem("currentMode")||"single";xn(E,m.inputs.productName.value,A),a&&(a.style.width="90%"),await Rn(E);try{const v=document.getElementById("results-toolbar"),x=parseInt(((i=document.getElementById("script-count"))==null?void 0:i.value)||"1",10);if(v){const y=x>1;v.classList.toggle("hidden",!y);try{v.style.display=y?"flex":"none"}catch{}}}catch{}a&&(a.style.width="100%"),m.downloadAllContainer.classList.remove("hidden"),setTimeout(()=>{e&&e.classList.add("hidden")},1e3)}catch(r){console.error("Error during generation:",r);const c=r.message||d("notification_api_error")||"API Error";ba(c),b(c,"error",5e3),e&&e.classList.add("hidden")}finally{U(!1,m.generateBtn)}}async function Gt(){const t=document.getElementById("revision-instruction").value.trim(),e=Array.from(document.querySelectorAll(".section-checkbox:checked")).map(a=>a.dataset.section);if(e.length===0){b(d("notification_select_section_regenerate")||"Pilih setidaknya satu bagian untuk diregenerasi.","warning");return}if(!t){b(d("notification_revision_instruction_empty")||"Instruksi revisi tidak boleh kosong.","error");return}U(!0,m.editModal.regenerateBtn);try{const a=localStorage.getItem("cardBeingEditedId"),n=document.getElementById(a),o=JSON.parse(n.dataset.script),s=Jn(o,t,e),i={};e.includes("hook")&&(i.hook=Le(1).items.properties.hook),e.includes("body")&&(i.body=Le(1).items.properties.body),e.includes("cta")&&(i.cta=Le(1).items.properties.cta);const r=await it(s,{type:"OBJECT",properties:i});Fa(o,r,e)}catch(a){console.error("Error during regeneration:",a),b(`${d("notification_regeneration_error")||"Regeneration error"} ${a.message}`,"error")}finally{U(!1,m.editModal.regenerateBtn)}}function Le(t){const e=localStorage.getItem("currentMode")||"single",a=t||parseInt(m.inputs.scriptCount.value,10)||1,o={type:"OBJECT",properties:{text:{type:"STRING"},shots:{type:"ARRAY",items:{type:"OBJECT",properties:{visual_idea:{type:"STRING"},text_to_image_prompt:{type:"STRING"},negative_prompt:{type:"STRING",description:"Sebutkan hal-hal yang TIDAK BOLEH muncul di gambar, misal: blurry, text, watermark, ugly, deformed hands."},image_to_video_prompt:{type:"STRING"}},required:["visual_idea","text_to_image_prompt","image_to_video_prompt"]}}},required:["text","shots"]},s={type:"OBJECT",properties:{selling_points:{type:"ARRAY",items:{type:"STRING"}}},required:["selling_points"]},i={type:"OBJECT",properties:{name:{type:"STRING"},age:{type:"STRING"},ethnicity:{type:"STRING"},skin_tone:{type:"STRING"},face_shape:{type:"STRING"},body_shape:{type:"STRING"},hair_style:{type:"STRING"},hair_color:{type:"STRING"},eye_color:{type:"STRING"}},required:["name","age","ethnicity","skin_tone","face_shape","body_shape","hair_style","hair_color","eye_color"]},r={type:"OBJECT",properties:{title:{type:"STRING"},review_insights:s},required:["title","review_insights"]};if(e==="single")r.properties.character_sheet={type:"ARRAY",items:i},r.properties.hook=o,r.properties.body=o,r.properties.cta=o,r.properties.hook_variants={type:"ARRAY",items:{type:"STRING"}},r.properties.body_intro={type:"STRING"},r.properties.body_variants={type:"ARRAY",items:{type:"STRING"}},r.properties.cta_variants={type:"ARRAY",items:{type:"STRING"}},r.required.push("hook","body","cta","hook_variants","body_variants","cta_variants");else{const c={type:"OBJECT",properties:{slide_text:{type:"STRING"},text_to_image_prompt:{type:"STRING"},layout_suggestion:{type:"STRING"},engagement_idea:{type:"STRING"}},required:["slide_text","text_to_image_prompt"]};r.properties.slides={type:"ARRAY",items:c},r.required.push("slides")}return{type:"ARRAY",items:r,minItems:a,maxItems:a}}function Na(){const t=q.current,e=localStorage.getItem("direktiva_system_prompt");return e||(t==="en"?ga:ya)}function Vn(){var Ia,La;const t=localStorage.getItem("currentMode")||"single",e=q.current,a=t==="single"?m.inputs.scriptCount.value:1,n=m.personaSelector.value,o=localStorage.getItem("productColorPalette"),s=localStorage.getItem("model_target")||"auto",i=localStorage.getItem("platform_target")||localStorage.getItem("targetPlatform")||"tiktok",r=localStorage.getItem("content_mode")||"post",c=ms(i,e,r),l=(localStorage.getItem("aspectRatio")||"").trim(),u=(Ia=document.getElementById("script-duration"))==null?void 0:Ia.value,h=Number(u)>0?Number(u):null,g=(La=document.getElementById("carousel-slide-count"))==null?void 0:La.value,f=Number(g)>0?Number(g):null,p=r==="carousel",_=p?l&&l!=="auto"?l:"4:5":l&&l!=="auto"?l:c.cfg.aspect||"9:16",k=p?null:h||c.cfg.maxDuration||30,E=p?f||c.meta.slides||7:null;function A(M,H,W){if(!Array.isArray(M)||!H||!W||H===W)return M||[];const ne=W/H;return M.map(Q=>({...Q,t:typeof Q.t=="number"?Math.max(0,Math.round(Q.t*ne)):Q.t}))}const v=p?[]:A(c.beats,c.cfg.maxDuration,k),x=document.getElementById("creative-freedom"),y=x?parseFloat(x.value):.7,I=Math.max(0,Math.min(1,1-y))<.5?e==="en"?"- Treat the structure as advisory; you may deviate if clarity improves.":"- Struktur sebagai panduan; boleh menyimpang bila hasil lebih jelas.":e==="en"?"- Follow the structure closely.":"- Ikuti struktur secara ketat.",T=e==="en",L=p?`${T?"Slides":"Jumlah slide"}: ${E}
${T?"Aspect":"Rasio"}: ${_}`:`${T?"Aspect":"Rasio"}: ${_}
${T?"Target duration":"Durasi target"}: ${k}s`;let P=T?`
- **${i.toUpperCase()} ${p?"CAROUSEL":"PLAN"}:**
- ${L}${c.promptNotes}
${I}`:`
- **RANCANGAN ${i.toUpperCase()} ${p?"CAROUSEL":""}:**
- ${L}${c.promptNotes}
${I}`;const K=p?{type:"carousel",slides:E,structure:c.cfg.structure||["Slide1 HOOK","Slide2-6 value","Slide7 CTA"],fontMaxWordsPerSlide:c.meta.fontMaxWordsPerSlide||12,meta:{aspect:_}}:{type:"post",beats:v,cta:c.cta,commentBait:c.commentBait,meta:{...c.meta,aspect:_,targetDuration:k}},he=JSON.stringify(K);Na();const ae=Na(),de=ae.includes("[[PLATFORM_NOTES]]")||ae.includes("[[PLATFORM_PLAN_JSON]]"),O=ae.replace("[[PLATFORM_NOTES]]",P).replace("[[PLATFORM_PLAN_JSON]]",he);let B="";s==="flux"?B=e==="en"?`
- **NEGATIVE PROMPT (REQUIRED):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers`:`
- **NEGATIVE PROMPT (WAJIB):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers`:s==="leonardo"&&(B=e==="en"?`
- **NEGATIVE PROMPT (REQUIRED):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers, bad proportions`:`
- **NEGATIVE PROMPT (WAJIB):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers, bad proportions`);const N=parseInt(localStorage.getItem("ab_variant_count")||"3",10),F=e==="en"?`
- **A/B VARIANTS (MUST BE RETURNED):** Besides the main Hook/Body/CTA/shots structure, also return:
  - hook_variants: array containing EXACTLY ${N} alternative hook variations
  - body_intro: short intro string for body (optional)
  - body_variants: array containing 2-3 alternative body variations
  - cta_variants: array containing EXACTLY ${N} alternative CTA variations`:`
- **A/B VARIANTS (WAJIB DIKEMBALIKAN):** Selain struktur utama Hook/Body/CTA/shots, kembalikan juga:
  - hook_variants: array berisi TEPAT ${N} variasi hook alternatif
  - body_intro: string intro singkat untuk body (opsional)
  - body_variants: array berisi 2-3 variasi body alternatif
  - cta_variants: array berisi TEPAT ${N} variasi CTA alternatif`;let G="";if(o&&o!=="undefined"&&o!=="null")try{const M=JSON.parse(o);Array.isArray(M)&&M.length>0&&(G=e==="en"?`
- **MAIN COLOR PALETTE (MUST BE FOLLOWED):** Use the following color combinations dominantly: ${M.join(", ")}.`:`
- **PALET WARNA UTAMA (WAJIB DIPATUHI):** Gunakan kombinasi warna berikut secara dominan: ${M.join(", ")}.`)}catch(M){console.error(`${d("failed_parsing_color_palette")||"Gagal parsing palet warna:"}`,M);try{localStorage.removeItem("productColorPalette")}catch{}}let fe="";if(n){const H=Ce().find(W=>W.id===n);H&&(fe=e==="en"?`
- AI Persona / Brand Voice: Use this persona strictly: "${H.description}"`:`
- Persona AI / Brand Voice: Gunakan persona ini secara ketat: "${H.description}"`)}const z=m.inputs.hookType.value,Ye=Hn(z),D=m.inputs.ctaType.value,Pe=jn(D);let ue=[];const _e=localStorage.getItem("visualStrategy")||"default";_e==="character"&&document.querySelectorAll(".character-sheet-instance").forEach(M=>{const H={};["name","gender","age","ethnicity","face_shape","eye_color","eye_shape","lip_shape","nose_shape","eyebrow_style","hair_style","hair_color","unique_features","makeup_style","skin_tone","body_shape","height","clothing_style","color_palette","specific_outfit","vibe","notes"].forEach(ne=>{const Q=M.querySelector(`[data-field="${ne}"]`);Q&&Q.value.trim()!==""&&(H[ne]=Q.value)}),Object.keys(H).length>0&&ue.push(H)});let vt="";ue.length>0&&(vt=e==="en"?`
- **CHARACTER SHEET(S) (MUST BE USED):** ${JSON.stringify(ue)}`:`
- **CHARACTER SHEET(S) (WAJIB DIGUNAKAN):** ${JSON.stringify(ue)}`);let bt="";const Ne=document.getElementById("interaction-description");Ne&&!Ne.parentElement.classList.contains("hidden")&&Ne.value.trim()&&(bt=e==="en"?`
- **KEY INTERACTION DESCRIPTION (MUST BE USED):** ${Ne.value}`:`
- **DESKRIPSI INTERAKSI KUNCI (WAJIB DIGUNAKAN):** ${Ne.value}`);let St="";if(t==="single"){const M=document.getElementById("script-duration").value;St=e==="en"?`
- Target Video Duration: Around ${M} seconds.`:`
- Target Durasi Video: Sekitar ${M} detik.`}let ve=e==="en"?`${O}
                **User Request:**
                - Create ${a} script variations.
                - Product Name: ${m.inputs.productName.value}
                - Description: ${m.inputs.productDesc.value||d("no_description")||"No description provided."}
                - Product Category: ${document.getElementById("product-category").value}
                ${G}
                - Visual Strategy: ${_e}
                ${vt}
                ${bt}
                ${St}
                - Aspect Ratio: ${Ft}
                - Writing Style: ${m.inputs.writingStyle.value}
                - Tone & Vibe: ${m.inputs.toneVibe.value}
                - Target Audience: ${m.inputs.targetAudience.value}
                - Hook Type: ${m.inputs.hookType.value}
                - CTA Type: ${m.inputs.ctaType.value}
                ${fe}
                ${B}
                ${P}
                ${F}
                
                **SPECIFIC HOOK STRATEGY:**
                ${Ye}
                
                **SPECIFIC CTA STRATEGY:**
                ${Pe}`:`${O}
                **Permintaan Pengguna:**
                - Buat ${a} variasi skrip.
                - Nama Produk: ${m.inputs.productName.value}
                - Deskripsi: ${m.inputs.productDesc.value||d("no_description")||"Tidak ada deskripsi."}
                - Kategori Produk: ${document.getElementById("product-category").value}
                ${G}
                - Strategi Visual: ${_e}
                ${vt}
                ${bt}
                ${St}
                - Aspek Rasio: ${Ft}
                - Gaya Penulisan: ${m.inputs.writingStyle.value}
                - Tone & Vibe: ${m.inputs.toneVibe.value}
                - Target Penonton: ${m.inputs.targetAudience.value}
                - Jenis Hook: ${m.inputs.hookType.value}
                - Jenis CTA: ${m.inputs.ctaType.value}
                ${fe}
                ${B}
                ${P}
                ${F}
                
                **STRATEGI HOOK SPESIFIK:**
                ${Ye}
                
                **STRATEGI CTA SPESIFIK:**
                ${Pe}`;de||(ve+=P+`

[[PLATFORM_PLAN_JSON]]
${he}`);const wt=m.visualDnaStorage.textContent;if(wt&&(ve+=e==="en"?`
- **PRODUCT VISUAL DNA (STRICT IDENTITY LOCK):** ${wt}`:`
- **VISUAL DNA PRODUK (KUNCI IDENTITAS KETAT):** ${wt}`),t==="carousel"){const M=m.inputs.slideCount.value,H=m.inputs.carouselTemplate.value;let W="";const ne={pas:d("pas_template_desc"),feature_benefit:d("feature_benefit_template_desc"),listicle:d("listicle_template_desc")};return H!=="auto"&&ne[H]&&(W=e==="en"?`
- Story Template: ${ne[H]}`:`
- Template Cerita: ${ne[H]}`),e==="en"?`${ve}
- Slide Count: ${M}${W}
**Additional Instructions:** Create one carousel script. Generate a "slides" property containing an ARRAY of ${M} objects. Each object in the array MUST have "slide_text", "text_to_image_prompt" properties, and optional "layout_suggestion" and "engagement_idea" properties.`:`${ve}
- Jumlah Slide: ${M}${W}
**Instruksi Tambahan:** Buat satu skrip carousel. Hasilkan sebuah properti "slides" yang berisi sebuah ARRAY berisi ${M} objek. Setiap objek dalam array WAJIB memiliki properti "slide_text", "text_to_image_prompt", dan properti opsional "layout_suggestion" serta "engagement_idea".`}return o&&localStorage.removeItem("productColorPalette"),e==="en"?`${ve}
**Additional Instructions:** Create a script consisting of "hook", "body", and "cta". Each section must have script text and an array containing 2-3 'shots' (micro-shots). If the visual strategy is 'Character Sheet', define one or more characters in 'character_sheet'.`:`${ve}
**Instruksi Tambahan:** Buat skrip yang terdiri dari "hook", "body", dan "cta". Setiap bagian harus memiliki teks skrip dan sebuah array berisi 2-3 'shots' (micro-shots). Jika strategi visual adalah 'Character Sheet', definisikan satu atau lebih karakter di 'character_sheet'.`}function Jn(t,e,a){const n=q.current,o={};a.includes("hook")||(o.hook=t.hook),a.includes("body")||(o.body=t.body),a.includes("cta")||(o.cta=t.cta);const s={writingStyle:m.inputs.writingStyle.value,toneVibe:m.inputs.toneVibe.value,targetAudience:m.inputs.targetAudience.value,hookType:m.inputs.hookType.value,ctaType:m.inputs.ctaType.value,characterSheets:(()=>{const r=[];try{document.querySelectorAll(".character-sheet-instance").forEach(c=>{const l={};c.querySelectorAll("[data-field]").forEach(u=>{u.value.trim()&&(l[u.dataset.field]=u.value)}),Object.keys(l).length&&r.push(l)})}catch{}return r})()};let i="";return n==="en"?(i=`You are an AI revision assistant. A script has been created with the following initial constraints:
`,i+=`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\`

`,Object.keys(o).length>0&&(i+=`The following sections of this script are FINAL and MUST NOT BE CHANGED AT ALL:
`,i+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`),i+=`Now, your task is to regenerate the following sections: [${a.join(", ")}] based on this instruction: "${e}".
`,i+=`STRICT CHARACTER RULES: If characterSheets are provided, you MUST use them for all regenerated parts and visual prompts. Do NOT invent or modify characters. In T2I prompts, place physical descriptions ONLY inside <char-desc>...</char-desc>. NEVER include <char-desc> in I2V prompts.
`,i+=`IMPORTANT: Ensure your regeneration results still comply with the initial constraints given above (for example, if ctaType is 'TikTok', the result should still be TikTok-style). ALL SCRIPT TEXT OUTPUT MUST BE IN ENGLISH.
`,i+="Generate ONLY the sections you regenerate in valid JSON format."):(i=`Anda adalah asisten revisi AI. Sebuah skrip telah dibuat dengan batasan awal sebagai berikut:
`,i+=`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\`

`,Object.keys(o).length>0&&(i+=`Bagian berikut dari skrip ini SUDAH FINAL dan TIDAK BOLEH DIUBAH SAMA SEKALI:
`,i+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`),i+=`Sekarang, tugas Anda adalah me-regenerasi bagian berikut: [${a.join(", ")}] berdasarkan instruksi ini: "${e}".
`,i+=`ATURAN KARAKTER YANG KETAT: Jika characterSheets tersedia, WAJIB digunakan untuk semua bagian yang direvisi dan prompt visual. JANGAN membuat/mengubah karakter baru. Pada T2I, taruh deskripsi fisik HANYA di dalam tag <char-desc>...</char-desc>. JANGAN pernah menaruh <char-desc> pada I2V.
`,i+=`PENTING: Pastikan hasil regenerasi Anda tetap mematuhi batasan awal yang diberikan di atas (misalnya, jika ctaType adalah 'TikTok', hasilnya harus tetap bergaya TikTok). SEMUA OUTPUT TEKS SKRIP WAJIB DALAM BAHASA INDONESIA.
`,i+="Hasilkan HANYA bagian yang Anda regenerasi dalam format JSON yang valid."),i}async function Yn(t){var s,i;const e=t.querySelector(".additional-assets-container"),a=t.querySelector(".asset-loader"),n=t.querySelector(".asset-content");e.classList.remove("hidden"),a.classList.remove("hidden"),n.classList.add("hidden"),n.innerHTML="",b("Generating assets...","info");let o=null;try{const r=JSON.parse(t.dataset.script),c=Te(r),l=(localStorage.getItem("platform_target")||localStorage.getItem("targetPlatform")||"tiktok").toLowerCase(),u=`${d("asset_generation_prompt")||"Berdasarkan skrip berikut, buatlah 3 opsi judul/caption yang menarik, 1 set hashtag yang relevan (gabungan umum dan niche), dan 3 ide teks singkat untuk thumbnail/cover."}

Tambahkan juga daftar hashtag yang SPESIFIK untuk platform: ${l}.
Jika platform TikTok, gunakan kombinasi tag FYP dan niche yang relevan (contoh: #fyp, #foryou, #tiktokshop, serta niche spesifik produk/brand). Jika Instagram Reels, prioritaskan tag discoverability dan niche brand (contoh: #reels, #reelitfeelit). Jika YouTube Shorts, gunakan tag discoverability seperti #shorts serta niche.

WAJIB: Selain platform yang dipilih, SELALU sertakan juga daftar khusus untuk Shopee pada field platform_hashtags.shopee (format array of strings) yang relevan untuk konversi marketplace (contoh: #Shopee, #ShopeeHaul, #Voucher, #GratisOngkir, dll).
 
 ${d("script_label")||"Skrip"}:
 ---
 ${c}
 ---
 `,h=Number(localStorage.getItem("direktiva_timeout_ms"))||12e4;o=await it(u,gs(),.7,h);let g='<div class="space-y-4">';g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${d("asset_titles_label")||"Judul/Caption"}</h5><ul class="list-disc list-inside text-xs text-gray-400 space-y-1">`,o.titles.forEach(E=>{g+=`<li>${E}</li>`}),g+="</ul></div>",g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${d("asset_hashtags_label")||"Hashtags"}</h5>`;const f=(o.hashtags||[]).join(" "),p=((s=o.platform_hashtags)==null?void 0:s[l])||[],_=o.trending_tags||[];g+=`<p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${f}</p>`,p.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-blue-300">${l} #</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${p.join(" ")}</p></div>`);const k=((i=o.platform_hashtags)==null?void 0:i.shopee)||[];k.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-orange-300">Shopee #</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${k.join(" ")}</p></div>`),_.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-green-300">Trending</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${_.join(" ")}</p></div>`),g+="</div>",g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${d("asset_thumbnail_label")||"Ide Thumbnail"}</h5><ul class="list-disc list-inside text-xs text-gray-400 space-y-1">`,o.thumbnail_ideas.forEach(E=>{g+=`<li>${E}</li>`}),g+="</ul></div>",g+="</div>",n.innerHTML=g,b("Assets generated.","success");try{const E=JSON.parse(t.dataset.script);E.additional_assets=o,E.additional_assets_html=g,t.dataset.script=JSON.stringify(E);const{updateSingleScript:A}=await C(async()=>{const{updateSingleScript:v}=await Promise.resolve().then(()=>Ro);return{updateSingleScript:v}},void 0);A(E)}catch{}}catch(r){console.error("Error generating assets:",r),n.innerHTML=`<p class="text-red-400 text-xs">${d("failed_to_generate_assets")||"Failed to generate assets:"} ${r.message}</p>`,b(r.message||d("failed_to_generate_assets")||"Failed to generate assets","error")}finally{a.classList.add("hidden"),n.classList.remove("hidden")}}const ys=Object.freeze(Object.defineProperty({__proto__:null,aspectRatio:Ft,constructPrompt:Vn,constructRevisionPrompt:Jn,getCTAInstructions:jn,getHookInstructions:Hn,getResponseSchema:Le,handleGenerate:Gn,handleGenerateAssets:Yn,handleImageUpload:Fn,handleRegenerate:Gt,handleRemoveImage:Ea,validateInputs:Un},Symbol.toStringTag,{value:"Module"}));function hs(){fs()}function fs(){document.querySelectorAll("input[required], textarea[required]").forEach(e=>{const a=e.closest(".form-field");a&&(e.addEventListener("blur",()=>{_s(a,e)}),e.addEventListener("input",()=>{a.classList.contains("error")&&a.classList.remove("error")}))})}function _s(t,e){const a=e.checkValidity()&&e.value.trim()!=="";t.classList.remove("error","success"),!a&&e.value.trim()!==""?(t.classList.add("error"),vs(t,bs(e))):(a&&e.value.trim()!==""&&t.classList.add("success"),Vt(t))}function vs(t,e){Vt(t);const a=document.createElement("div");a.className="form-field-helper error-message",a.textContent=e,t.appendChild(a)}function Vt(t){const e=t.querySelector(".error-message");e&&e.remove()}function bs(t){return t.validity.valueMissing?"Field ini wajib diisi":t.validity.typeMismatch?"Format input tidak valid":t.validity.tooShort?`Minimal ${t.minLength} karakter`:t.validity.tooLong?`Maksimal ${t.maxLength} karakter`:"Input tidak valid"}function Ss(){ws(),Es(),xs(),Ls(),Ts()}function ws(){document.addEventListener("click",t=>{const e=t.target.closest(".btn, .icon-btn");e&&ks(e,t)})}function ks(t,e){const a=t.getBoundingClientRect(),n=Math.max(a.width,a.height),o=e.clientX-a.left-n/2,s=e.clientY-a.top-n/2,i=document.createElement("span");if(i.className="ripple",i.style.cssText=`
        position: absolute;
        width: ${n}px;
        height: ${n}px;
        left: ${o}px;
        top: ${s}px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        pointer-events: none;
        z-index: 1;
    `,t.style.position="relative",t.style.overflow="hidden",t.appendChild(i),!document.querySelector("#ripple-styles")){const r=document.createElement("style");r.id="ripple-styles",r.textContent=`
            @keyframes ripple-animation {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
        `,document.head.appendChild(r)}setTimeout(()=>{i.remove()},600)}function Es(){document.querySelectorAll(".result-card, .persona-card, .history-item").forEach(e=>{e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-4px) scale(1.02)",e.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}),e.addEventListener("mouseleave",()=>{e.style.transform="translateY(0) scale(1)"})})}function xs(){document.documentElement.classList.add("smooth-scroll");const t=document.querySelectorAll(".parallax");t.length>0&&window.addEventListener("scroll",()=>{const e=window.pageYOffset;t.forEach(a=>{const n=e*-.5;a.style.transform=`translateY(${n}px)`})},{passive:!0}),Is()}function Is(){const t={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&o.target.classList.add("animate-in")})},t);document.querySelectorAll(".animate-on-scroll").forEach(n=>e.observe(n))}function Ls(){window.showSuccessFeedback=t=>{t.classList.add("bounce"),setTimeout(()=>{t.classList.remove("bounce")},600)},window.showErrorFeedback=t=>{t.classList.add("shake"),setTimeout(()=>{t.classList.remove("shake")},500)},window.showLoadingFeedback=t=>{t.classList.add("pulse")},window.hideLoadingFeedback=t=>{t.classList.remove("pulse")}}function Ts(){document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});const t=document.createElement("style");t.textContent=`
        .keyboard-navigation *:focus {
            outline: 2px solid var(--primary-color) !important;
            outline-offset: 2px !important;
        }
        
        .keyboard-navigation .btn:focus,
        .keyboard-navigation .icon-btn:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3) !important;
        }
    `,document.head.appendChild(t),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.body.classList.add("reduce-motion")}const Oa="direktiva_migration_completed",As={kontenkilat_theme:"aethera_theme",kontenkilat_language:"aethera_language",kontenkilat_system_prompt:"aethera_system_prompt",kontenkilat_user_api_key:"aethera_user_api_key",kontenkilat_history:"aethera_history",kontenkilat_lastGeneratedScripts:"aethera_lastGeneratedScripts",kontenkilat_personas:"aethera_personas",aethera_theme:"direktiva_theme",aethera_language:"direktiva_language",aethera_system_prompt:"direktiva_system_prompt",aethera_user_api_key:"direktiva_user_api_key",aethera_settings_last_modified:"direktiva_settings_last_modified",aethera_timeout_ms:"direktiva_timeout_ms",aethera_session_id:"direktiva_session_id",aethera_history:"direktiva_history",aethera_history_last_modified:"direktiva_history_last_modified",aethera_history_tags:"direktiva_history_tags",aethera_last_settings:"direktiva_last_settings",aethera_settings_presets:"direktiva_settings_presets",aethera_presets_last_modified:"direktiva_presets_last_modified",aethera_character_presets:"direktiva_character_presets",aethera_character_presets_last_modified:"direktiva_character_presets_last_modified",aethera_pinned_characters:"direktiva_pinned_characters",aethera_character_usage:"direktiva_character_usage",aethera_personas:"direktiva_personas",aethera_lastGeneratedScripts:"direktiva_lastGeneratedScripts",aethera_sync_status:"direktiva_sync_status",aethera_last_sync:"direktiva_last_sync",aethera_pending_sync:"direktiva_pending_sync",aethera_offline_changes:"direktiva_offline_changes"};function Cs(){if(localStorage.getItem(Oa)){console.log("Migration already completed");return}console.log("Starting localStorage key migration...");let t=0;Object.entries(As).forEach(([e,a])=>{const n=localStorage.getItem(e);if(n!==null)try{localStorage.getItem(a)===null&&localStorage.setItem(a,n);try{localStorage.removeItem(e)}catch{}t++,console.log(`Migrated: ${e} -> ${a}`)}catch(o){console.error(`Failed to migrate ${e}:`,o)}}),localStorage.setItem(Oa,"true"),console.log(`Migration completed. ${t} keys migrated.`)}function Jt(){try{Cs()}catch(t){console.error("Migration failed:",t)}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Jt):Jt());function Yt(){if(localStorage.getItem("aethera_show_sync_indicator")!=="false"){const e=Bs();document.body.appendChild(e)}$s()}function Bs(){const t=document.createElement("div");return t.id="sync-indicator",t.className="sync-indicator sync-offline",t.innerHTML=`
        <svg class="sync-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6"/>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
        </svg>
        <span class="sync-text">${d("sync_status_offline")||"Offline"}</span>
    `,t.addEventListener("click",Os),t.addEventListener("dblclick",Ps),t}function Ps(){const t=document.getElementById("sync-indicator");if(!t)return;if(t.style.display==="none"){t.style.display="",localStorage.setItem("aethera_show_sync_indicator","true");const a=d("sync_indicator_shown")||"Indikator sinkronisasi ditampilkan";b(a,"info")}else{t.style.display="none",localStorage.setItem("aethera_show_sync_indicator","false");const a=d("sync_indicator_hidden")||"Indikator sinkronisasi disembunyikan. Double-click di area kosong untuk menampilkan kembali.";b(a,"info"),Ns()}}function Ns(){document.body.removeEventListener("dblclick",Kt),document.body.addEventListener("dblclick",Kt)}function Kt(t){if(t.target===document.body||t.target.tagName==="HTML"){const e=document.getElementById("sync-indicator");if(e&&e.style.display==="none"){e.style.display="",localStorage.setItem("aethera_show_sync_indicator","true");const a=d("sync_indicator_shown")||"Indikator sinkronisasi ditampilkan";b(a,"info"),document.body.removeEventListener("dblclick",Kt)}}}async function Os(){const{data:{session:t}}=await w.auth.getSession();if(!t){b(d("notification_login_required")||"Please login to sync data","warning");return}if(!navigator.onLine){b(d("notification_offline")||"You are offline. Data will sync when connection is restored.","info");return}try{await $.syncAll(),b(d("notification_sync_success")||"Data synced successfully")}catch(e){console.error("Manual sync failed:",e),b(d("notification_sync_failed")||"Sync failed. Please try again.","error")}}function $s(){const t=document.getElementById("settings-panel");if(!t)return;const e=document.createElement("div");e.className="settings-section sync-section",e.innerHTML=`
        <h3>${d("settings_sync_title")||"Cloud Sync"}</h3>
        <div class="sync-controls">
            <div class="sync-status-display">
                <div class="sync-status-item">
                    <span class="sync-label">${d("sync_last_sync")||"Last Sync"}:</span>
                    <span id="last-sync-time" class="sync-value">-</span>
                </div>
                <div class="sync-status-item">
                    <span class="sync-label">${d("sync_status")||"Status"}:</span>
                    <span id="sync-status-text" class="sync-value">-</span>
                </div>
            </div>
            
            <div class="sync-buttons">
                <button id="manual-sync-btn" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    ${d("sync_manual_sync")||"Sync Now"}
                </button>
                
                <button id="export-backup-btn" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    ${d("sync_export_backup")||"Export Backup"}
                </button>
                
                <button id="import-backup-btn" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17,8 12,3 7,8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    ${d("sync_import_backup")||"Import Backup"}
                </button>
            </div>
            
            <div class="sync-info">
                <p class="sync-description">
                    ${d("sync_description")||"Your data is automatically synced when you're online and logged in. You can also manually export/import backups."}
                </p>
            </div>
        </div>
        
        <input type="file" id="backup-file-input" accept=".json" style="display: none;">
    `,t.appendChild(e),Ms()}function Ms(){const t=document.getElementById("manual-sync-btn");t&&t.addEventListener("click",Rs);const e=document.getElementById("export-backup-btn");e&&e.addEventListener("click",Ds);const a=document.getElementById("import-backup-btn");a&&a.addEventListener("click",qs);const n=document.getElementById("backup-file-input");n&&n.addEventListener("change",Hs),ct(),setInterval(ct,3e4)}async function Rs(){const t=document.getElementById("manual-sync-btn"),e=t.innerHTML;try{t.disabled=!0,t.innerHTML=`
            <svg class="spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6"/>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            ${d("sync_syncing")||"Syncing..."}
        `,await $.syncAll(),b(d("notification_sync_success")||"Data synced successfully"),ct()}catch(a){console.error("Manual sync failed:",a),b(d("notification_sync_failed")||"Sync failed. Please try again.","error")}finally{t.disabled=!1,t.innerHTML=e}}async function Ds(){try{await $.exportBackup()}catch(t){console.error("Export backup failed:",t),b(d("notification_export_failed")||"Failed to export backup","error")}}function qs(){const t=document.getElementById("backup-file-input");t&&t.click()}async function Hs(t){const e=t.target.files[0];if(e){try{await $.restoreBackup(e),ct(),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error("Import backup failed:",a),b(d("notification_import_failed")||"Failed to import backup","error")}t.target.value=""}}function ct(){const t=document.getElementById("last-sync-time"),e=document.getElementById("sync-status-text");if(t){const a=localStorage.getItem("aethera_last_sync");if(a)try{const n=new Date(a);isNaN(n.getTime())?t.textContent=d("sync_never")||"Never":t.textContent=n.toLocaleString()}catch{console.warn("Invalid last sync date:",a),t.textContent=d("sync_never")||"Never"}else t.textContent=d("sync_never")||"Never"}if(e){const a=localStorage.getItem("aethera_sync_status")||R.OFFLINE,n={[R.SYNCED]:d("sync_status_synced")||"Synced",[R.SYNCING]:d("sync_status_syncing")||"Syncing...",[R.OFFLINE]:d("sync_status_offline")||"Offline",[R.ERROR]:d("sync_status_error")||"Error"};e.textContent=n[a],e.className=`sync-value sync-${a}`}}function $a(){const t=document.createElement("style");t.textContent=`
        /* Sync Indicator */
        .sync-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            display: none !important;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0.8;
        }
        
        .sync-indicator:hover {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .sync-indicator.hidden {
            display: none;
        }
        
        .sync-indicator.sync-synced {
            color: var(--success-color, #10b981);
        }
        
        .sync-indicator.sync-syncing {
            color: var(--warning-color, #f59e0b);
        }
        
        .sync-indicator.sync-offline {
            color: var(--text-secondary);
        }
        
        .sync-indicator.sync-error {
            color: var(--error-color, #ef4444);
        }
        
        .sync-icon {
            width: 14px;
            height: 14px;
        }
        
        .sync-indicator.sync-syncing .sync-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Sync Section in Settings */
        .sync-section {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-secondary);
        }
        
        .sync-section h3 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }
        
        .sync-status-display {
            margin-bottom: 16px;
        }
        
        .sync-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sync-status-item:last-child {
            border-bottom: none;
        }
        
        .sync-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .sync-value {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .sync-value.sync-synced {
            color: var(--success-color, #10b981);
        }
        
        .sync-value.sync-syncing {
            color: var(--warning-color, #f59e0b);
        }
        
        .sync-value.sync-offline {
            color: var(--text-secondary);
        }
        
        .sync-value.sync-error {
            color: var(--error-color, #ef4444);
        }
        
        .sync-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .sync-buttons .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .sync-buttons .btn:hover {
            background-color: var(--bg-secondary);
        }
        
        .sync-buttons .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .sync-buttons .btn-primary {
            background-color: var(--primary-color, #3b82f6);
            color: white;
            border-color: var(--primary-color, #3b82f6);
        }
        
        .sync-buttons .btn-primary:hover {
            background-color: var(--primary-hover, #2563eb);
        }
        
        .sync-info {
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }
        
        .sync-description {
            margin: 0;
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
        }
        
        /* Migration Modal */
        .migration-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .migration-modal.show {
            opacity: 1;
        }
        
        .migration-modal .modal-content {
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .migration-modal .modal-header {
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .migration-modal .modal-header h3 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
        }
        
        .migration-modal .modal-body {
            padding: 20px;
        }
        
        .migration-modal .modal-body p {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .migration-modal .modal-body ul {
            margin: 0 0 16px 0;
            padding-left: 20px;
            color: var(--text-primary);
        }
        
        .migration-modal .modal-body li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .migration-note {
            background-color: var(--bg-secondary);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color, #3b82f6);
        }
        
        .migration-modal .modal-footer {
            padding: 0 20px 20px 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .migration-modal .modal-footer .btn {
            padding: 10px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .migration-modal .modal-footer .btn:hover {
            background-color: var(--bg-secondary);
        }
        
        .migration-modal .modal-footer .btn-primary {
            background-color: var(--primary-color, #3b82f6);
            color: white;
            border-color: var(--primary-color, #3b82f6);
        }
        
        .migration-modal .modal-footer .btn-primary:hover {
            background-color: var(--primary-hover, #2563eb);
        }
        
        .migration-modal .modal-footer .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sync-buttons {
                flex-direction: column;
            }
            
            .sync-buttons .btn {
                justify-content: center;
            }
            
            .migration-modal .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .migration-modal .modal-footer {
                flex-direction: column;
            }
        }
    `,document.head.appendChild(t)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{$a(),Yt()}):($a(),Yt());function js(){const t=document.getElementById("back-to-top");if(!t)return;const e=()=>{window.pageYOffset>200?(t.style.opacity="1",t.style.pointerEvents="auto",t.setAttribute("aria-hidden","false")):(t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("aria-hidden","true"))},a=()=>{window.scrollTo({top:0,behavior:"smooth"})};window.addEventListener("scroll",e,{passive:!0}),t.addEventListener("click",a),e()}function Us(){const t=document.getElementById("generate-btn"),e=t==null?void 0:t.closest(".mt-6.pt-6.border-t.border-gray-800.space-y-4");if(!t||!e)return;const a=()=>{const n=window.innerWidth<768,o=!document.getElementById("generator-page").classList.contains("hidden");n&&o?(e.style.position="sticky",e.style.bottom="0",e.style.backgroundColor="var(--bg-primary)",e.style.borderTop="1px solid var(--border-color)",e.style.zIndex="20",e.style.padding="1rem",e.style.margin="0 -1.5rem",e.style.boxShadow="0 -4px 12px rgba(0, 0, 0, 0.15)"):(e.style.position="",e.style.bottom="",e.style.backgroundColor="",e.style.borderTop="",e.style.zIndex="",e.style.padding="",e.style.margin="",e.style.boxShadow="")};window.addEventListener("resize",a,{passive:!0}),a()}function Fs(){const t=document.getElementById("mobile-menu-button"),e=document.getElementById("mobile-menu"),a=document.getElementById("menu-open-icon"),n=document.getElementById("menu-close-icon");if(!t||!e)return;t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mobile-menu"),t.setAttribute("aria-label","Toggle mobile menu"),e.setAttribute("role","navigation"),e.setAttribute("aria-label","Mobile navigation");const o=i=>{i&&(i.preventDefault(),i.stopImmediatePropagation());const r=e.classList.contains("hidden");if(e.classList.toggle("hidden"),a.classList.toggle("hidden"),n.classList.toggle("hidden"),t.setAttribute("aria-expanded",r?"true":"false"),r?(document.body.style.overflow="hidden",document.body.style.paddingRight=Gs()+"px"):(document.body.style.overflow="",document.body.style.paddingRight=""),r){const c=e.querySelector("a, button");c&&setTimeout(()=>c.focus(),100)}else t.focus()};t.addEventListener("click",o,{capture:!0}),document.addEventListener("click",i=>{!e.classList.contains("hidden")&&!e.contains(i.target)&&!t.contains(i.target)&&o()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!e.classList.contains("hidden")&&o()}),e.querySelectorAll("a, button").forEach(i=>{i.addEventListener("click",()=>{e.classList.contains("hidden")||o()})}),window.originalToggleMobileMenu=o}function Gs(){const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const a=t.offsetWidth-e.offsetWidth;return t.parentNode.removeChild(t),a}function Vs(){document.querySelectorAll("input, textarea, select").forEach(e=>{e.type!=="date"&&e.type!=="datetime-local"&&parseFloat(getComputedStyle(e).fontSize)<16&&(e.style.fontSize="16px"),e.addEventListener("focus",()=>{var a;(a=e.parentElement)==null||a.classList.add("field-focused")}),e.addEventListener("blur",()=>{var a;(a=e.parentElement)==null||a.classList.remove("field-focused")})})}function Js(){const t=document.createElement("a");t.href="#main-content",t.textContent="Skip to main content",t.className="skip-link sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded z-50",t.style.transform="translateY(-100%)",t.style.transition="transform 0.3s ease",t.addEventListener("focus",()=>{t.style.transform="translateY(0)"}),t.addEventListener("blur",()=>{t.style.transform="translateY(-100%)"}),document.body.insertBefore(t,document.body.firstChild),document.querySelectorAll('[role="dialog"], .modal-overlay').forEach(a=>{a.addEventListener("keydown",n=>{n.key==="Tab"&&Ys(n,a)})})}function Ys(t,e){const a=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=a[0],o=a[a.length-1];t.shiftKey?document.activeElement===n&&(o.focus(),t.preventDefault()):document.activeElement===o&&(n.focus(),t.preventDefault())}function Ks(){js(),Us(),Fs(),Vs(),Js(),console.log(" UX improvements initialized")}function zs(t){return`<!doctype html><meta charset="utf-8"><title>VO Preview (Gemini)</title>
<style>body{font-family:system-ui,Segoe UI,Roboto,Inter,Arial;padding:16px;background:#0b1220;color:#e5e7eb}
.row{display:flex;gap:8px;align-items:center;margin:8px 0}
textarea{width:100%;height:200px;background:#0f1629;color:#e5e7eb;border:1px solid #23314d;border-radius:8px;padding:10px}
select,button{padding:8px 12px;border-radius:8px;border:1px solid #23314d;background:#111a2e;color:#e5e7eb;cursor:pointer}
button[disabled]{opacity:.6;cursor:not-allowed}.hint{color:#9aa4b2;font-size:12px}</style>
<h2>VO Preview (Gemini)</h2>
<div class="row"><label>Voice:</label><select id="voice"><option value="Kore" selected>Kore</option><option value="Puck">Puck</option></select></div>
<textarea id="text"></textarea>
<div class="row"><button id="play"> Preview Gemini</button><span id="status" class="hint"></span></div>
<script>
  const ta=document.getElementById('text'); ta.value=${JSON.stringify(t||"")};
  const btn=document.getElementById('play'); const status=document.getElementById('status');
  let busy=false, audioRef=null;
  btn.onclick=async()=>{ if(busy) return; busy=true; btn.disabled=true; status.textContent='Generating audio...';
    try{
      if(audioRef){ try{ audioRef.pause(); }catch(e){} }
      const voice=document.getElementById('voice').value || 'Kore';
      const r=await fetch('/api/tts/gemini',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:ta.value,voiceName:voice})});
      const txt=await r.text(); if(!r.ok){ let m=txt; try{const j=JSON.parse(txt); m=j.error||txt;}catch{} throw new Error(m); }
      const {audio_base64,mime}=JSON.parse(txt);
      audioRef=new Audio('data:'+(mime||'audio/wav')+';base64,'+audio_base64);
      audioRef.onended=()=>{busy=false;btn.disabled=false;status.textContent='';};
      audioRef.onerror=()=>{busy=false;btn.disabled=false;status.textContent='(audio error)';};
      await audioRef.play(); status.textContent='Playing...';
    }catch(e){ status.textContent = e.message||String(e); busy=false; btn.disabled=false; }
  };
<\/script>`}function Ws(t,e,a={},n={}){var f,p,_;const{ssml:o,geminiText:s,lang:i,platform:r,recipe:c,readTimes:l}=Je(e,a),u={lang:i,platform:r,engine:((f=a==null?void 0:a.vo)==null?void 0:f.engine)||"gemini",geminiVoice:((p=a==null?void 0:a.vo)==null?void 0:p.geminiVoice)||"Kore",elevenVoice:((_=a==null?void 0:a.vo)==null?void 0:_.elevenVoice)||"",recipe:c,readTimes:l},h=n.base||`VO/${r}_${i}`,g=(k,E)=>{t.file(`${h}/${k}`,E)};g(`vo_${r}_${i}.ssml`,o),g(`vo_${r}_${i}_gemini.txt`,s),g(`vo_meta_${r}_${i}.json`,JSON.stringify(u,null,2)),g("vo_preview_gemini.html",zs(s))}async function Xs(){return window.JSZip||await new Promise((t,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",a.onload=t,a.onerror=e,document.head.appendChild(a)}),window.JSZip}function Zs(t){return String(t||"").trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_\-]/g,"").slice(0,64)||"script"}function Qs(t){var i;const e=(((i=t.body)==null?void 0:i.text)||t.body||"").toString().split(`
`).filter(Boolean),a=2;let n=0,o=1,s="";for(const r of e){const c=new Date(n*1e3).toISOString().substr(11,8)+",000",l=new Date((n+a)*1e3).toISOString().substr(11,8)+",000";s+=`${o}
${c} --> ${l}
${r}

`,n+=a,o++}return s}function er(t){var s;const e=(((s=t.body)==null?void 0:s.text)||t.body||"").toString().split(`
`).filter(Boolean),a=2;let n=0,o=`start,end,text
`;for(const i of e){const r=n.toFixed(2),c=(n+a).toFixed(2);o+=`${r},${c},"${i.replace(/"/g,'""')}"
`,n+=a}return o}function tr(t){var i,r,c;const e=t.title||"",a=(((i=t.hook)==null?void 0:i.text)||t.hook||"").toString(),n=(((r=t.body)==null?void 0:r.text)||t.body||"").toString(),o=(((c=t.cta)==null?void 0:c.text)||t.cta||"").toString(),s=Array.isArray(t.hashtags)?t.hashtags.join(" "):t.hashtags||"";return`TITLE
${e}

HOOK
${a}

BODY
${n}

CTA
${o}

HASHTAGS
${s}
`}async function ar(t){var p,_;const n=document.createElement("canvas");n.width=1080,n.height=1920;const o=n.getContext("2d"),s=o.createLinearGradient(0,0,1080,1920);s.addColorStop(0,"#0f172a"),s.addColorStop(1,"#1e293b"),o.fillStyle=s,o.fillRect(0,0,1080,1920),o.globalAlpha=.5,o.fillStyle="#22d3ee",o.fillRect(0,1920*.72,1080,1920*.28),o.globalAlpha=1;const i=64,r=1080-i*2,c=(((p=t.hook)==null?void 0:p.text)||t.hook||t.title||"").toString();let l=88;o.fillStyle="#e2e8f0",o.textBaseline="top",o.font=`bold ${l}px Inter, system-ui, -apple-system, Segoe UI, Roboto`;function u(k){const E=k.split(/\s+/),A=[];let v="";for(const x of E){const y=v?v+" "+x:x;o.measureText(y).width>r?(v&&A.push(v),v=x):v=y}return v&&A.push(v),A}let h=u(c);for(;h.length>10&&l>44;)l-=6,o.font=`bold ${l}px Inter, system-ui, -apple-system, Segoe UI, Roboto`,h=u(c);const g=i;h.slice(0,10).forEach((k,E)=>o.fillText(k,i,g+E*(l*1.2)));const f=(((_=t.cta)==null?void 0:_.text)||t.cta||"").toString();return f&&(o.font="600 48px Inter, system-ui, -apple-system, Segoe UI, Roboto",o.fillStyle="#0b1320",o.fillText(f.slice(0,70),i,1920*.74)),await new Promise(k=>n.toBlob(k,"image/png"))}async function Kn(t,e){var h,g,f;const a=await Xs(),n=new a;if(!Array.isArray(t)||!t.length){b(d("notification_no_script_to_download")||"No script to export","warning");return}const o=n.folder("aethera_exports"),s=document.getElementById("platform-target"),i=((s==null?void 0:s.value)||"tiktok").toLowerCase(),c={platform:{tiktok:"tiktok_video",shopee:"shopee_video",instagram:"igreels",threads:"threads",shorts:"shorts"}[i]||"tiktok_video",lang:(q==null?void 0:q.current)==="en"?"en":"id",vo:{engine:"gemini",geminiVoice:"Kore"}};for(let p=0;p<t.length;p++){const _=t[p],k=Zs(_.title||`script_${p+1}`),E=o.folder(`${String(p+1).padStart(2,"0")}_${k}`);if(E.file(`${k}.json`,JSON.stringify(_,null,2)),E.file(`${k}.srt`,Qs(_)),E.file(`${k}.csv`,er(_)),E.file(`${k}_platform_pack.txt`,tr(_)),e){const v=await ar(_);v&&E.file(`${k}_thumb_1080x1920.png`,v)}const A={hook:((h=_==null?void 0:_.hook)==null?void 0:h.text)||(_==null?void 0:_.hook)||"",scenes:[((g=_==null?void 0:_.body)==null?void 0:g.text)||(_==null?void 0:_.body)||""],cta:((f=_==null?void 0:_.cta)==null?void 0:f.text)||(_==null?void 0:_.cta)||""};try{Ws(E,A,c)}catch(v){console.warn("appendVOToZip failed:",v)}}const l=await n.generateAsync({type:"blob"}),u=document.createElement("a");u.href=URL.createObjectURL(l),u.download=`aethera_exports_${Date.now()}.zip`,u.click(),URL.revokeObjectURL(u.href),b(d("zip_export_done")||"ZIP exported.","success")}async function zn(t){return Kn(ge(),t)}function Wn(){const t=document.getElementById("export-all-zip-btn"),e=document.getElementById("include-thumbs");t&&!t.__bound&&(t.__bound=!0,t.addEventListener("click",()=>zn(!!(e!=null&&e.checked))))}const xa=Object.freeze(Object.defineProperty({__proto__:null,exportAllZip:zn,exportZipForScripts:Kn,initResultsExportToolbar:Wn},Symbol.toStringTag,{value:"Module"}));function Xn(){const t=document.getElementById("rank-all-btn");t&&t.addEventListener("click",async()=>{const e=document.getElementById("output-panel"),a=Array.from(e?e.querySelectorAll(".result-card"):[]);if(a.length<2){try{(await C(async()=>{const{showNotification:s}=await Promise.resolve().then(()=>J);return{showNotification:s}},void 0)).showNotification("Rank requires at least 2 results","warning")}catch{}return}const n=[];for(const s of a){const i=s.querySelector(".hook-text"),r=s.querySelector(".body-text"),c=s.querySelector(".cta-text"),l=i?i.textContent.trim():"",u=c?c.textContent.trim():"";let h=await le(l);h+=Math.min(((r==null?void 0:r.textContent)||"").split(/\s+/).length,120)*.1,h+=/now|today|grab|discount|sale|link|tap|shop/i.test(u)?20:0,n.push({card:s,score:h})}n.sort((s,i)=>i.score-s.score);const o=document.getElementById("output-panel");o&&(n.forEach(({card:s})=>o.appendChild(s)),t.textContent=" "+(d("rank_button_active")||"Ranked (best  worst)"),setTimeout(()=>{t.textContent=" "+(d("rank_button_default")||"Rank All")},2e3))})}const nr=Object.freeze(Object.defineProperty({__proto__:null,initRankAll:Xn},Symbol.toStringTag,{value:"Module"}));async function Ma(){try{const{data:{session:t}}=await w.auth.getSession();if(!(t!=null&&t.user)){b(d("notification_login_required")||"Silakan login terlebih dahulu","warning");return}const e=t.user,a=document.getElementById("acc-email-current");a&&(a.value=e.email||"");const{data:n}=await w.from("profiles").select("*").eq("id",e.id).single();if(n){const o=document.getElementById("acc-fullname"),s=document.getElementById("acc-username"),i=document.getElementById("acc-bio");o&&(o.value=n.full_name||""),s&&(s.value=n.username||""),i&&(i.value=n.bio||"")}}catch{}}function or(){const t=document.getElementById("acc-save-profile"),e=document.getElementById("acc-update-email"),a=document.getElementById("acc-update-password");t==null||t.addEventListener("click",async()=>{var n,o,s;U(!0,t);try{const{data:{session:i}}=await w.auth.getSession();if(!(i!=null&&i.user))throw new Error("Not authenticated");const r={id:i.user.id,full_name:(((n=document.getElementById("acc-fullname"))==null?void 0:n.value)||"").trim(),username:(((o=document.getElementById("acc-username"))==null?void 0:o.value)||"").trim(),bio:(((s=document.getElementById("acc-bio"))==null?void 0:s.value)||"").trim(),updated_at:new Date().toISOString()},{error:c}=await w.from("profiles").upsert(r);c?String(c.code)==="23505"?b(d("username_taken")||"Username sudah dipakai","error"):b(c.message||"Gagal menyimpan profil","error"):b(d("profile_saved")||"Profil disimpan","success")}catch(i){b(i.message||"Gagal menyimpan","error")}finally{U(!1,t)}}),e==null||e.addEventListener("click",async()=>{var n,o;U(!0,e);try{const{data:{session:s}}=await w.auth.getSession();if(!((n=s==null?void 0:s.user)!=null&&n.email))throw new Error("Not authenticated");const i=(((o=document.getElementById("acc-email-new"))==null?void 0:o.value)||"").trim();if(!i)return;const r=window.location.origin,{error:c}=await w.auth.updateUser({email:i},{emailRedirectTo:r});if(c)throw c;b(d("email_update_sent")||"Email konfirmasi dikirim. Cek inbox Anda.","success");try{await w.from("profiles").upsert({id:s.user.id,email_pending:i})}catch{}}catch(s){b(s.message||"Gagal mengirim konfirmasi perubahan email","error")}finally{U(!1,e)}}),a==null||a.addEventListener("click",async()=>{var n,o;U(!0,a);try{const{data:{session:s}}=await w.auth.getSession();if(!((n=s==null?void 0:s.user)!=null&&n.email))throw new Error("Not authenticated");const i=(((o=document.getElementById("acc-password"))==null?void 0:o.value)||"").trim();if(!i||i.length<6){b(d("password_too_short")||"Password minimal 6 karakter","warning");return}const r=window.location.origin,{error:c}=await w.auth.resetPasswordForEmail(s.user.email,{redirectTo:r});if(c)throw c;b(d("password_reset_sent")||"Link reset password dikirim ke email Anda.","success")}catch(s){b(s.message||"Gagal mengirim link reset","error")}finally{U(!1,a)}})}function sr(){try{console.log("Language:",localStorage.getItem("direktiva_language")||localStorage.getItem("aethera_language")||"id"),console.log("Has id.json:",!!(V&&Object.keys(V.id||{}).length)),console.log("Has en.json:",!!(V&&Object.keys(V.en||{}).length)),console.log("Sample t(light_mode_active):",d("light_mode_active"))}catch{}}document.addEventListener("DOMContentLoaded",async()=>{var _,k,E,A,v,x;Jt(),await Nt(),sr(),hs(),Ss(),Yt(),await $.init(),In(),pt(localStorage.getItem("direktiva_theme")||localStorage.getItem("aethera_theme")||"dark");const t=localStorage.getItem("direktiva_language")||localStorage.getItem("aethera_language")||"id";await ca(t),Ks(),Wn(),Xn(),Dt(),Y("generator"),It(localStorage.getItem("currentMode")||"single"),await Nt(),await Fe.init();try{ie(),ce()}catch(y){console.warn("Failed to populate selectors on startup:",y.message)}hn();const e=localStorage.getItem("direktiva_theme")||localStorage.getItem("aethera_theme")||"dark";document.getElementById("theme-icon-sun").classList.toggle("hidden",e==="dark"),document.getElementById("theme-icon-moon").classList.toggle("hidden",e==="light"),document.getElementById("main-content").addEventListener("click",y=>{const S=y.target.closest(".result-card");if(S){if(y.target.closest(".prompt-copy-btn")){const T=y.target.closest(".prompt-copy-btn"),P=T.dataset.prompt.replace(/<\/?char-desc>/gi,"");U(!0,T);try{we(P,T)}finally{setTimeout(()=>{U(!1,T)},500)}return}if(y.target.closest(".generate-assets-btn")){Yn(S);return}}const I=y.target.closest(".history-entry");I&&(y.target.closest(".delete-history-btn")&&pe(d("confirm_delete_entry")||"Apakah Anda yakin ingin menghapus entri ini?",async()=>{await tt(I.dataset.entryId),b(d("history_entry_deleted")||"Entri riwayat berhasil dihapus.","success")}),y.target.closest(".history-checkbox")&&(oa(),Za()))}),m.generateBtn.addEventListener("click",()=>{yn(),Gn()}),document.getElementById("product-category").addEventListener("change",at),document.getElementById("character-mode").addEventListener("change",ia),m.personaSelector.addEventListener("change",()=>{const y=m.personaSelector.value,S=document.getElementById("persona-description-display");if(!y){S.classList.add("hidden"),S.textContent="";return}const T=(JSON.parse(localStorage.getItem("aethera_personas"))||[]).find(L=>L.id===y);T?(S.textContent=`${d("description_label")}: "${T.description}"`,S.classList.remove("hidden")):S.classList.add("hidden")}),document.getElementById("dynamic-character-sheet-area").addEventListener("click",y=>{if(y.target.closest("#save-character-preset-btn")&&bn(),y.target.closest("#add-character-btn")){const S=y.currentTarget,I=S.querySelectorAll(".character-sheet-instance").length,T=mt(I);S.insertBefore(T,y.target.closest("#add-character-btn")),at()}y.target.closest(".remove-character-btn")&&(y.target.closest(".character-sheet-instance").remove(),document.querySelectorAll(".character-sheet-instance .character-title").forEach((S,I)=>{S.textContent=d("character_number",{number:I+1})}))}),m.settingsPresetSelector.addEventListener("change",gn),m.savePresetBtn.addEventListener("click",mn),m.managePresetsBtn.addEventListener("click",fn),document.getElementById("character-preset-selector").addEventListener("change",fa),m.manageCharacterPresetsBtn.addEventListener("click",wn);const a=document.getElementById("manage-presets-modal");document.getElementById("close-manage-presets-modal-btn").addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:I}=await Promise.resolve().then(()=>J);return{setLoadingState:I}},void 0),S=document.getElementById("close-manage-presets-modal-btn");y(!0,S);try{nt()}finally{y(!1,S)}}),a.addEventListener("click",y=>y.target===a&&nt()),document.getElementById("preset-list-container").addEventListener("click",_n);const n=document.getElementById("manage-character-presets-modal");document.getElementById("close-manage-character-presets-modal-btn").addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:I}=await Promise.resolve().then(()=>J);return{setLoadingState:I}},void 0),S=document.getElementById("close-manage-character-presets-modal-btn");y(!0,S);try{ot()}finally{y(!1,S)}}),n.addEventListener("click",y=>y.target===n&&ot()),document.getElementById("character-preset-list-container").addEventListener("click",kn),document.getElementById("cancel-revision-btn").addEventListener("click",Se),document.getElementById("regenerate-again-btn").addEventListener("click",()=>{const y=document.getElementById("revision-instruction-stage2").value;document.getElementById("revision-instruction").value=y,Gt()}),document.getElementById("apply-changes-btn").addEventListener("click",async()=>{var de,O,B;const y=localStorage.getItem("cardBeingEditedId"),S=document.getElementById(y);if(!S){Se();return}const{setLoadingState:I}=await C(async()=>{const{setLoadingState:N}=await Promise.resolve().then(()=>J);return{setLoadingState:N}},void 0),T=document.getElementById("apply-changes-btn");I(!0,T);const L=JSON.parse(S.dataset.script);let P={...L};if(re){P={...P,...re};try{const N=[];if(typeof((de=re.hook)==null?void 0:de.text)=="string"&&N.push("hook"),typeof((O=re.body)==null?void 0:O.text)=="string"&&N.push("body"),typeof((B=re.cta)==null?void 0:B.text)=="string"&&N.push("cta"),N.length>0){const{regenerateVisualPrompts:F}=await C(async()=>{const{regenerateVisualPrompts:G}=await Promise.resolve().then(()=>je);return{regenerateVisualPrompts:G}},void 0);for(const G of N){const fe=P[G].text,z=await F(P,G,fe);Array.isArray(z)&&z.length&&(P[G].shots=z)}}}catch{}}const{updateCardContent:K,initSwiper:he}=await C(async()=>{const{updateCardContent:N,initSwiper:F}=await Promise.resolve().then(()=>Ba);return{updateCardContent:N,initSwiper:F}},void 0);K(S,P),st(P);try{const{openScriptViewer:N}=await C(async()=>{const{openScriptViewer:F}=await Promise.resolve().then(()=>je);return{openScriptViewer:F}},void 0);await N(S,P)}catch{}const{showActionNotification:ae}=await C(async()=>{const{showActionNotification:N}=await Promise.resolve().then(()=>J);return{showActionNotification:N}},void 0);ae(d("notification_script_updated")||"Skrip berhasil diperbarui!",d("undo_button")||"Urungkan",async()=>{K(S,L),st(L);try{const{openScriptViewer:N}=await C(async()=>{const{openScriptViewer:F}=await Promise.resolve().then(()=>je);return{openScriptViewer:F}},void 0);await N(S,L)}catch{}},"success"),Se(),I(!1,T)}),m.loginBtn.addEventListener("click",xt),(_=document.getElementById("forgot-password-btn"))==null||_.addEventListener("click",Mo),document.getElementById("login-password").addEventListener("keyup",y=>y.key==="Enter"&&xt()),document.getElementById("login-email").addEventListener("keyup",y=>y.key==="Enter"&&xt()),m.logoutBtn.addEventListener("click",qt),m.mobileLogoutBtn.addEventListener("click",qt),m.navGenerator.addEventListener("click",y=>{y.preventDefault(),Y("generator")}),m.navHistory.addEventListener("click",async y=>{y.preventDefault();const{loadHistory:S}=await C(async()=>{const{loadHistory:I}=await Promise.resolve().then(()=>Et);return{loadHistory:I}},void 0);await S(),Y("history")}),m.navSettings.addEventListener("click",y=>{y.preventDefault(),Y("settings")}),(k=m.navAccount)==null||k.addEventListener("click",async y=>{y.preventDefault(),Y("account"),await Ma()}),m.mobileMenuButton.addEventListener("click",Oe),m.mobileNavGenerator.addEventListener("click",y=>{y.preventDefault(),Y("generator"),Oe()}),m.mobileNavHistory.addEventListener("click",async y=>{y.preventDefault();const{loadHistory:S}=await C(async()=>{const{loadHistory:I}=await Promise.resolve().then(()=>Et);return{loadHistory:I}},void 0);await S(),Y("history"),Oe()}),m.mobileNavSettings.addEventListener("click",y=>{y.preventDefault(),Y("settings"),Oe()}),(E=m.mobileNavAccount)==null||E.addEventListener("click",async y=>{y.preventDefault(),Y("account"),Oe(),await Ma()}),m.apiKeyModal.saveBtn.addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>J);return{setLoadingState:S}},void 0);y(m.apiKeyModal.saveBtn,!0);try{await cn()}finally{y(m.apiKeyModal.saveBtn,!1)}}),m.modeSingleBtn.addEventListener("click",()=>It("single")),m.modeCarouselBtn.addEventListener("click",()=>It("carousel"));try{const y=document.getElementById("platform-target"),S=localStorage.getItem("platform_target")||localStorage.getItem("targetPlatform")||"tiktok";y&&(y.value=S,y.addEventListener("change",()=>{const I=y.value;localStorage.setItem("platform_target",I),localStorage.setItem("targetPlatform",I),b(`${d("target_platform_label")||"Target Platform"}: ${I}`,"success");try{const T=document.getElementById("cta-type");if(T){const L=I==="tiktok"?"cta_tiktok":I==="shopee"?"cta_shopee":I==="instagram"||I==="threads"?"cta_instagram":I==="shorts"?"cta_youtube":"cta_general";Array.from(T.options).some(P=>P.value===L)&&(T.value=L)}}catch{}}))}catch{}m.strategyDefaultBtn.addEventListener("click",()=>Lt("default")),m.strategyFacelessBtn.addEventListener("click",()=>Lt("faceless")),m.strategyCharacterBtn.addEventListener("click",()=>Lt("character")),m.ratio916Btn.addEventListener("click",()=>Tt("9:16")),m.ratio11Btn.addEventListener("click",()=>Tt("1:1")),m.ratio169Btn.addEventListener("click",()=>Tt("16:9")),m.inputs.productImage.addEventListener("change",Fn),m.removeImageBtn.addEventListener("click",Ea),m.editModal.closeBtn.addEventListener("click",Se),m.editModal.regenerateBtn.addEventListener("click",Gt),m.editModal.el.addEventListener("click",y=>y.target===m.editModal.el&&Se());try{const{translateUI:y}=await C(async()=>{const{translateUI:S}=await Promise.resolve().then(()=>Ba);return{translateUI:S}},void 0);y()}catch{}const o=document.getElementById("results-container");o&&o.children.length===0&&(o.innerHTML=`<div class="text-center text-gray-500 py-8">${d("empty_results_prompt")||"Belum ada hasil. Isi detail produk dan klik Generate untuk memulai."}</div>`);const s=document.getElementById("history-panel");s&&s.children.length===0&&(s.innerHTML=`<div class="text-center text-gray-500 py-8">${d("empty_history_prompt")||"Belum ada riwayat. Hasil skrip Anda akan tampil di sini."}</div>`),m.downloadAllContainer.addEventListener("click",y=>{y.target.classList.contains("download-all-btn")&&jo(y.target.dataset.format)}),m.saveSettingsBtn.addEventListener("click",dn),or(),m.personaModal.addBtn.addEventListener("click",()=>Ca()),m.personaModal.closeBtn.addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>J);return{setLoadingState:S}},void 0);y(!0,m.personaModal.closeBtn);try{Qa()}finally{y(!1,m.personaModal.closeBtn)}}),m.personaModal.saveBtn.addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>J);return{setLoadingState:S}},void 0);y(!0,m.personaModal.saveBtn);try{await ho()}finally{y(!1,m.personaModal.saveBtn)}}),m.personaModal.listContainer.addEventListener("click",y=>{const S=y.target.closest(".edit-persona-btn");if(S){const L=(JSON.parse(localStorage.getItem("aethera_personas"))||[]).find(P=>P.id===S.dataset.id);L&&Ca(L)}const I=y.target.closest(".delete-persona-btn");I&&fo(I.dataset.id)}),m.personaModal.defaultContainer.addEventListener("click",y=>{if(y.target.closest(".add-default-persona-btn")){const S=y.target.closest(".add-default-persona-btn");_o(S.dataset.name,S.dataset.desc)}}),m.confirmModal.cancelBtn.addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>J);return{setLoadingState:S}},void 0);y(!0,m.confirmModal.cancelBtn);try{Xe()}finally{y(!1,m.confirmModal.cancelBtn)}}),m.confirmModal.el.addEventListener("click",y=>y.target===m.confirmModal.el&&Xe()),m.confirmModal.confirmBtn.addEventListener("click",async()=>{const{setLoadingState:y}=await C(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>J);return{setLoadingState:S}},void 0);y(!0,m.confirmModal.confirmBtn);try{typeof Ue=="function"&&await Ue(),Xe()}finally{y(!1,m.confirmModal.confirmBtn)}}),document.getElementById("theme-toggle-btn").addEventListener("click",()=>{const S=(localStorage.getItem("direktiva_theme")||localStorage.getItem("aethera_theme")||"dark")==="dark"?"light":"dark";Rt(S)}),m.langIdBtn.addEventListener("click",async()=>await Me("id")),m.langEnBtn.addEventListener("click",async()=>await Me("en"));const i=document.getElementById("mobile-theme-toggle-btn");i&&i.addEventListener("click",()=>{const S=(localStorage.getItem("direktiva_theme")||localStorage.getItem("aethera_theme")||"dark")==="dark"?"light":"dark";Rt(S)}),m.mobileLangIdBtn&&m.mobileLangIdBtn.addEventListener("click",async()=>await Me("id")),m.mobileLangEnBtn&&m.mobileLangEnBtn.addEventListener("click",async()=>await Me("en"));try{const y=new URL(window.location.href),S=y.searchParams.get("code"),I=y.searchParams.get("message")||(y.hash.includes("message=")?decodeURIComponent(y.hash.split("message=")[1]):"");if(S){try{await w.auth.exchangeCodeForSession(S);try{(A=m.loginOverlay)==null||A.classList.add("hidden"),(v=m.appContainer)==null||v.classList.remove("hidden")}catch{}try{await Dt()}catch{}}catch{}try{const{data:{session:T}}=await w.auth.getSession();(x=T==null?void 0:T.user)!=null&&x.id&&await w.from("profiles").upsert({id:T.user.id,email:T.user.email,email_pending:null})}catch{}lt(d("set_new_password_title")||"Set New Password",d("set_new_password_desc")||"Enter your new password to complete recovery.",d("new_password")||"New Password",async T=>{if(!T||T.length<6){b(d("password_too_short")||"Password minimal 6 karakter","warning");return}try{const{error:L}=await w.auth.updateUser({password:T});if(L)throw L;b(d("password_updated")||"Password updated","success")}catch(L){b(L.message||"Failed to set password","error")}}),history.replaceState({},"",location.pathname)}else I&&(b(I,"success"),history.replaceState({},"",location.pathname))}catch{}const r=document.getElementById("delete-all-btn");r&&r.addEventListener("click",async()=>{pe(d("confirm_delete_all"),async()=>{var S;const{deleteAllHistory:y}=await C(async()=>{const{deleteAllHistory:I}=await Promise.resolve().then(()=>Et);return{deleteAllHistory:I}},void 0);await y(),b(d("history_deleted_all"),"success"),(S=document.getElementById("delete-selected-btn"))==null||S.classList.add("hidden")})});const c=document.getElementById("delete-selected-btn");c&&c.addEventListener("click",()=>{const y=Array.from(document.querySelectorAll(".history-checkbox:checked")).map(S=>{var I;return(I=S.closest(".history-entry"))==null?void 0:I.dataset.entryId}).filter(Boolean);y.length!==0&&pe(d("confirm_delete_selected").replace("{n}",y.length),async()=>{var S;await tt(y),b(d("history_deleted_selected"),"success"),(S=document.getElementById("delete-selected-btn"))==null||S.classList.add("hidden")})});const l=document.getElementById("prev-page"),u=document.getElementById("next-page");l&&l.addEventListener("click",za),u&&u.addEventListener("click",Ka);const h=document.getElementById("history-search"),g=document.getElementById("history-sort"),f=document.getElementById("select-all-history");h&&h.addEventListener("input",y=>{ta(y.target.value)}),g&&g.addEventListener("change",y=>{aa(y.target.value)}),f&&f.addEventListener("change",y=>{Wa(y.target.checked)}),document.querySelectorAll(".post-type-tab").forEach(y=>{y.addEventListener("click",()=>{const S=y.dataset.filter;na(S)})});const p=document.getElementById("group-by-product");p&&p.addEventListener("change",Xa)});(function(){const t=document.querySelector("header.sticky");function e(){const r=(window.scrollY||document.documentElement.scrollTop)>8;t&&(t.classList.toggle("bg-gray-900/70",!r),t.classList.toggle("bg-gray-900/50",r),t.classList.toggle("backdrop-blur-sm",!r),t.classList.toggle("backdrop-blur-md",r),t.classList.toggle("shadow-sm",r))}window.addEventListener("scroll",e,{passive:!0}),e();function a(r){var c;r==null||r.classList.remove("opacity-0","pointer-events-none"),(c=r==null?void 0:r.querySelector(".modal-content"))==null||c.classList.remove("scale-95")}function n(r){var c;r==null||r.classList.add("opacity-0","pointer-events-none"),(c=r==null?void 0:r.querySelector(".modal-content"))==null||c.classList.add("scale-95")}const o=document.getElementById("about-modal"),s=document.getElementById("nav-about"),i=document.getElementById("mobile-nav-about");[s,i].forEach(r=>r&&r.addEventListener("click",c=>{c.preventDefault(),a(o)})),document.querySelectorAll(".about-close").forEach(r=>r.addEventListener("click",()=>n(o))),o&&o.addEventListener("click",r=>{r.target===o&&n(o)}),window.addEventListener("keydown",r=>{r.key==="Escape"&&n(o)})})();const Pt=document.getElementById("creative-freedom"),rr=document.getElementById("freedom-value"),Ra=t=>{let e=d("freedom_balanced");t<=.3&&(e=d("freedom_very_obedient")),t>=.9&&(e=d("freedom_very_creative")),rr.textContent=`${t} (${e})`};Pt&&(Pt.addEventListener("input",t=>{Ra(t.target.value)}),Ra(Pt.value));(function(){function t(s){var i;s==null||s.classList.remove("opacity-0","pointer-events-none"),(i=s==null?void 0:s.querySelector(".modal-content"))==null||i.classList.remove("scale-95")}function e(s){var i;s==null||s.classList.add("opacity-0","pointer-events-none"),(i=s==null?void 0:s.querySelector(".modal-content"))==null||i.classList.add("scale-95")}const a=document.getElementById("manual-modal"),n=document.getElementById("nav-manual"),o=document.getElementById("mobile-nav-manual");[n,o].forEach(s=>s&&s.addEventListener("click",i=>{i.preventDefault(),t(a)})),document.querySelectorAll(".manual-close").forEach(s=>s.addEventListener("click",()=>e(a))),a==null||a.addEventListener("click",s=>{s.target===a&&e(a)}),window.addEventListener("keydown",s=>{s.key==="Escape"&&e(a)})})();(function(){const t=document.querySelector("header.sticky");function e(){const a=window.scrollY||document.documentElement.scrollTop||0;t&&(a>8?t.classList.add("is-scrolled"):t.classList.remove("is-scrolled"))}window.addEventListener("scroll",e,{passive:!0}),e()})();try{C(()=>Promise.resolve().then(()=>xa),void 0).then(t=>t.initResultsExportToolbar&&t.initResultsExportToolbar())}catch{}try{C(()=>Promise.resolve().then(()=>nr),void 0).then(t=>t.initRankAll&&t.initRankAll())}catch{}document.addEventListener("click",t=>{const e=t.target.closest("[data-cta-value]");if(!e)return;const a=e.getAttribute("data-cta-value"),n=document.getElementById("cta-type");n&&a&&(n.value=a,n.dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("[data-cta-value]").forEach(o=>o.classList.toggle("selected",o===e)))});(()=>{const t=document.getElementById("cta-type");if(t){t.disabled=!1;const e=t.closest(".form-group");e==null||e.classList.remove("pointer-events-none","opacity-50")}})();let qe=1;const Zn=5;function ir(){localStorage.getItem("aethera_onboarding_completed")||cr()}function cr(){const t=document.getElementById("onboarding-overlay");t&&(t.classList.remove("hidden"),zt(1))}function Da(){const t=document.getElementById("onboarding-overlay");t&&(t.classList.add("hidden"),localStorage.setItem("aethera_onboarding_completed","true"))}function zt(t){qe=t,document.querySelectorAll(".onboarding-step").forEach(o=>{o.classList.add("hidden")});const e=document.querySelector(`[data-step="${t}"]`);e&&e.classList.remove("hidden"),document.querySelectorAll(".onboarding-dot").forEach((o,s)=>{s+1<=t?(o.classList.remove("bg-muted"),o.classList.add("bg-accent")):(o.classList.remove("bg-accent"),o.classList.add("bg-muted"))});const a=document.getElementById("onboarding-prev"),n=document.getElementById("onboarding-next");a&&a.classList.toggle("hidden",t===1),n&&(t===Zn?n.textContent="Mulai Sekarang!":n.textContent="Selanjutnya")}const lr={"tiktok-viral":{name:"TikTok Viral 2025",settings:{hookType:"hook_future_pacing",ctaType:"cta_tiktok",targetAudience:"audience_young_pro",writingStyle:"style_storytelling",toneVibe:"tone_inspiring",duration:"15"}},"shopee-sales":{name:"Shopee Sales",settings:{hookType:"hook_negativity_bias",ctaType:"cta_shopee",targetAudience:"audience_general",writingStyle:"style_persuasive",toneVibe:"tone_urgent",duration:"30"}},"instagram-story":{name:"Instagram Story",settings:{hookType:"hook_question",ctaType:"cta_instagram",targetAudience:"audience_young_pro",writingStyle:"style_storytelling",toneVibe:"tone_inspiring",duration:"15"}},"youtube-review":{name:"YouTube Review",settings:{hookType:"hook_statistic",ctaType:"cta_youtube",targetAudience:"audience_gamers",writingStyle:"style_informative",toneVibe:"tone_professional",duration:"60"}}};function dr(t){const e=lr[t];if(!e)return;const a=e.settings;function n(i,r){const c=document.getElementById(i);if(!c)return!1;const l=c.querySelector(`option[data-lang-key="${r}"]`);return l?(c.value=l.value||r,!0):!1}function o(i,r){const c=document.getElementById(i);return c?(c.value=r,!0):!1}a.hookType&&n("hook-type",a.hookType),a.ctaType&&n("cta-type",a.ctaType),a.targetAudience&&n("target-audience",a.targetAudience),a.writingStyle&&n("writing-style",a.writingStyle),a.toneVibe&&n("tone-vibe",a.toneVibe),a.duration&&o("script-duration",a.duration),typeof b=="function"&&b(d("template_applied_success",{name:e.name}),"success");const s=document.getElementById("product-name");s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus())}function qa(){var e,a,n,o,s,i,r;const t={productName:((e=document.getElementById("product-name"))==null?void 0:e.value)||"",productDesc:((a=document.getElementById("product-desc"))==null?void 0:a.value)||"",hookType:((n=document.getElementById("hook-type"))==null?void 0:n.value)||"",ctaType:((o=document.getElementById("cta-type"))==null?void 0:o.value)||"",targetAudience:((s=document.getElementById("target-audience"))==null?void 0:s.value)||"",writingStyle:((i=document.getElementById("writing-style"))==null?void 0:i.value)||"",toneVibe:((r=document.getElementById("tone-vibe"))==null?void 0:r.value)||""};localStorage.setItem("aethera_form_autosave",JSON.stringify(t)),localStorage.setItem("aethera_form_last_modified",new Date().toISOString())}function ur(){const t=localStorage.getItem("aethera_form_autosave");if(t)try{const e=JSON.parse(t);Object.keys(e).forEach(a=>{const n=document.getElementById(a.replace(/([A-Z])/g,"-$1").toLowerCase());n&&e[a]&&(n.value=e[a])})}catch(e){console.warn("Failed to load auto-saved form data:",e)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{ir()},1e3);const t=document.getElementById("onboarding-next");t&&t.addEventListener("click",()=>{qe<Zn?zt(qe+1):Da()});const e=document.getElementById("onboarding-prev");e&&e.addEventListener("click",()=>{qe>1&&zt(qe-1)});const a=document.getElementById("onboarding-skip");a&&a.addEventListener("click",()=>{Da()}),document.querySelectorAll(".quick-template-btn").forEach(o=>{o.addEventListener("click",()=>{const s=o.dataset.template;dr(s),o.classList.add("pulse-glow"),setTimeout(()=>{o.classList.remove("pulse-glow")},1e3)})}),setTimeout(()=>{ur()},500),["product-name","product-desc","hook-type","cta-type","target-audience","writing-style","tone-vibe"].forEach(o=>{const s=document.getElementById(o);s&&(s.addEventListener("input",qa),s.addEventListener("change",qa))})});(async()=>{await Fe.init();const t=document.querySelector("#platform-target"),e=document.querySelector("#hook-type"),a=document.querySelector("#cta-type");let n=!1;a==null||a.addEventListener("change",()=>{n=!0});function o(){if(!t||!e||!a)return;[...a.options].forEach(c=>{c.textContent=c.textContent.replace(/^\s*/,"")});const s=(t.value||"").toLowerCase().trim(),i=s==="threads"?"instagram":s==="shorts"?"youtube":s,r=Fe.suggestCtas(i,e.value)||[];if(r.slice(0,3).forEach(c=>{const l=[...a.options].find(u=>u.value===c);l&&(l.textContent=" "+l.textContent.replace(/^\s*/,""))}),!n&&![...a.options].some(l=>l.selected)){const l=r[0]&&[...a.options].find(u=>u.value===r[0]);l&&(l.selected=!0)}}t==null||t.addEventListener("change",()=>{n=!1,o()}),e==null||e.addEventListener("change",()=>{n=!1,o()}),o()})();
