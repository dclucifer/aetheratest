(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();class Zt{constructor(){this.scrollY=0,this.ticking=!1,this.mouseX=0,this.mouseY=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.init()}init(){window.matchMedia("(prefers-reduced-motion: reduce)").matches||this.windowWidth<=768||(this.bindEvents(),this.setupIntersectionObserver(),this.initParallaxElements(),this.startAnimationLoop())}bindEvents(){window.addEventListener("scroll",this.onScroll.bind(this),{passive:!0}),document.addEventListener("mousemove",this.onMouseMove.bind(this),{passive:!0}),window.addEventListener("resize",this.onResize.bind(this),{passive:!0}),document.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!0})}onScroll(){this.scrollY=window.pageYOffset,this.ticking||(requestAnimationFrame(this.updateParallax.bind(this)),this.ticking=!0)}onMouseMove(e){this.mouseX=e.clientX/this.windowWidth*2-1,this.mouseY=e.clientY/this.windowHeight*2-1,this.updateMouseParallax()}onTouchMove(e){if(e.touches.length>0){const a=e.touches[0];this.mouseX=a.clientX/this.windowWidth*2-1,this.mouseY=a.clientY/this.windowHeight*2-1,this.updateMouseParallax()}}onResize(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.windowWidth<=768?this.destroy():this.init()}updateParallax(){this.updateScrollParallax(),this.updateHeroParallax(),this.updateSectionParallax(),this.updateNavigationParallax(),this.ticking=!1}updateScrollParallax(){document.querySelectorAll(".scroll-parallax").forEach(a=>{const n=a.getBoundingClientRect(),o=a.dataset.parallaxSpeed||.5,s=-(this.scrollY*o);n.bottom>=0&&n.top<=this.windowHeight&&(a.style.transform=`translateY(${s}px)`)}),this.updateParallaxClass(".scroll-parallax-slow",.3),this.updateParallaxClass(".scroll-parallax-medium",.5),this.updateParallaxClass(".scroll-parallax-fast",.7)}updateParallaxClass(e,a){document.querySelectorAll(e).forEach(o=>{const s=o.getBoundingClientRect(),i=-(this.scrollY*a);s.bottom>=0&&s.top<=this.windowHeight&&(o.style.transform=`translateY(${i}px)`)})}updateHeroParallax(){const e=document.querySelector(".hero-background"),a=document.querySelector(".hero-particles"),n=document.querySelector(".hero-content");if(e){const o=this.scrollY*.5;e.style.transform=`translateY(${o}px)`}if(a){const o=this.scrollY*.3,s=Math.sin(this.scrollY*.001)*10;a.style.transform=`translateY(${o}px) translateX(${s}px)`}if(n){const o=this.scrollY*.1,s=1-this.scrollY*5e-4;n.style.transform=`translateY(${o}px) scale(${Math.max(s,.8)})`}}updateSectionParallax(){document.querySelectorAll(".section-parallax").forEach(a=>{const n=a.getBoundingClientRect(),o=a.querySelector(".section-parallax-bg"),s=a.querySelector(".section-parallax-content");if(n.bottom>=0&&n.top<=this.windowHeight){const i=(this.windowHeight-n.top)/(this.windowHeight+n.height);if(o){const r=i*100;o.style.transform=`translateY(${r}px)`}if(s){const r=i*50;s.style.transform=`translateY(${r}px)`}}})}updateNavigationParallax(){const e=document.querySelector(".nav-parallax");e&&(this.scrollY>100?(e.classList.add("visible"),e.classList.remove("hidden")):(e.classList.add("hidden"),e.classList.remove("visible")))}updateMouseParallax(){document.querySelectorAll(".mouse-parallax").forEach(a=>{const n=a.dataset.mouseIntensity||20,o=this.mouseX*n,s=this.mouseY*n;a.style.transform=`translateX(${o}px) translateY(${s}px)`}),this.updateMouseParallaxLayers(),this.updateMagneticElements()}updateMouseParallaxLayers(){document.querySelectorAll(".mouse-parallax").forEach(a=>{const n=a.querySelector(".mouse-parallax-layer-1"),o=a.querySelector(".mouse-parallax-layer-2"),s=a.querySelector(".mouse-parallax-layer-3");if(n){const i=this.mouseX*10,r=this.mouseY*10;n.style.transform=`translateX(${i}px) translateY(${r}px)`}if(o){const i=this.mouseX*20,r=this.mouseY*20;o.style.transform=`translateX(${i}px) translateY(${r}px)`}if(s){const i=this.mouseX*30,r=this.mouseY*30;s.style.transform=`translateX(${i}px) translateY(${r}px)`}})}updateMagneticElements(){document.querySelectorAll(".parallax-magnetic").forEach(a=>{const n=a.getBoundingClientRect(),o=n.left+n.width/2,s=n.top+n.height/2,i=this.mouseX*this.windowWidth-o,r=this.mouseY*this.windowHeight-s,c=Math.sqrt(i*i+r*r),d=100;if(c<d){const m=(d-c)/d,g=i/c*m*20,h=r/c*m*20;a.style.setProperty("--mouse-x",`${g}px`),a.style.setProperty("--mouse-y",`${h}px`),a.classList.add("attracted")}else a.style.setProperty("--mouse-x","0px"),a.style.setProperty("--mouse-y","0px"),a.classList.remove("attracted")})}setupIntersectionObserver(){const e={threshold:.1,rootMargin:"0px 0px -50px 0px"},a=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting?(o.target.classList.add("in-view"),o.target.classList.contains("text-parallax")&&o.target.classList.add("revealed")):(o.target.classList.remove("in-view"),o.target.classList.contains("text-parallax")&&o.target.classList.remove("revealed"))})},e);document.querySelectorAll(".parallax-trigger").forEach(n=>{a.observe(n)}),document.querySelectorAll(".text-parallax").forEach(n=>{a.observe(n)})}initParallaxElements(){this.initCardParallax(),this.initButtonParallax(),this.initTiltEffects()}initCardParallax(){document.querySelectorAll(".card-parallax").forEach(a=>{a.addEventListener("mouseenter",n=>{const o=n.target.getBoundingClientRect(),s=o.left+o.width/2,i=o.top+o.height/2;n.target.style.transformOrigin=`${s}px ${i}px`}),a.addEventListener("mousemove",n=>{const o=n.target.getBoundingClientRect(),s=n.clientX-o.left,i=n.clientY-o.top,r=o.width/2,c=o.height/2,d=(i-c)/c*10,m=(r-s)/r*10;n.target.style.transform=`rotateX(${d}deg) rotateY(${m}deg) translateZ(20px)`}),a.addEventListener("mouseleave",n=>{n.target.style.transform="rotateX(0deg) rotateY(0deg) translateZ(0px)"})})}initButtonParallax(){document.querySelectorAll(".btn-parallax").forEach(a=>{a.addEventListener("mouseenter",n=>{n.target.style.transform="translateZ(10px) rotateX(10deg)"}),a.addEventListener("mouseleave",n=>{n.target.style.transform="translateZ(0px) rotateX(0deg)"})})}initTiltEffects(){document.querySelectorAll(".parallax-tilt").forEach(a=>{a.addEventListener("mousemove",n=>{const o=n.target.getBoundingClientRect(),s=n.clientX-o.left,i=n.clientY-o.top,r=o.width/2,c=o.height/2,d=(i-c)/c*15,m=(r-s)/r*15;n.target.style.transform=`perspective(1000px) rotateX(${d}deg) rotateY(${m}deg)`}),a.addEventListener("mouseleave",n=>{n.target.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg)"})})}startAnimationLoop(){const e=()=>{this.updateFloatingElements(),requestAnimationFrame(e)};e()}updateFloatingElements(){const e=document.querySelectorAll(".float-parallax"),a=Date.now()*.001;e.forEach((n,o)=>{const s=o*2,i=Math.sin(a+s)*10,r=Math.cos(a+s)*5;n.style.transform=`translateY(${i}px) translateZ(${r}px)`})}destroy(){window.removeEventListener("scroll",this.onScroll.bind(this)),document.removeEventListener("mousemove",this.onMouseMove.bind(this)),window.removeEventListener("resize",this.onResize.bind(this)),document.removeEventListener("touchmove",this.onTouchMove.bind(this)),document.querySelectorAll('[class*="parallax"]').forEach(a=>{a.style.transform=""})}}class dn{constructor(){this.init()}init(){this.initButtonInteractions(),this.initFormInteractions(),this.initCardInteractions(),this.initNavigationInteractions(),this.initScrollInteractions()}initButtonInteractions(){document.addEventListener("click",a=>{a.target.matches(".btn-primary, .btn-secondary, .icon-btn")&&this.createRipple(a)}),document.querySelectorAll(".btn-primary, .btn-secondary").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-2px) scale(1.02)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0) scale(1)"})})}createRipple(e){const a=e.target,n=a.getBoundingClientRect(),o=Math.max(n.width,n.height),s=e.clientX-n.left-o/2,i=e.clientY-n.top-o/2,r=document.createElement("span");r.style.cssText=`
            position: absolute;
            width: ${o}px;
            height: ${o}px;
            left: ${s}px;
            top: ${i}px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
            z-index: 1;
        `,a.style.position="relative",a.style.overflow="hidden",a.appendChild(r),setTimeout(()=>{r.remove()},600)}initFormInteractions(){document.querySelectorAll("input, textarea, select").forEach(a=>{a.addEventListener("focus",()=>{const n=a.closest(".form-group");n&&n.classList.add("focused")}),a.addEventListener("blur",()=>{const n=a.closest(".form-group");n&&n.classList.remove("focused")})})}initCardInteractions(){document.querySelectorAll(".result-card, .quick-template-btn").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-4px) scale(1.02)",a.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0) scale(1)"})})}initNavigationInteractions(){document.querySelectorAll(".nav-link").forEach(a=>{a.addEventListener("mouseenter",()=>{a.style.transform="translateY(-1px)",a.style.transition="all 0.2s ease"}),a.addEventListener("mouseleave",()=>{a.style.transform="translateY(0)"})})}initScrollInteractions(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(a){a.preventDefault();const n=this.getAttribute("href");if(n&&n.length>1){const o=document.querySelector(n);o&&o.scrollIntoView({behavior:"smooth",block:"start"})}})})}}document.addEventListener("DOMContentLoaded",()=>{new Zt});typeof module<"u"&&module.exports&&(module.exports={ParallaxController:Zt,MicroInteractionsController:dn});const un="modulepreload",mn=function(t){return"/"+t},Gt={},w=function(e,a,n){let o=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(a.map(c=>{if(c=mn(c),c in Gt)return;Gt[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":un,d||(g.as="script"),g.crossOrigin="",g.href=c,r&&g.setAttribute("nonce",r),document.head.appendChild(g),d)return new Promise((h,y)=>{g.addEventListener("load",h),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return o.then(i=>{for(const r of i||[])r.status==="rejected"&&s(r.reason);return e().catch(s)})},pn="https://afrqqsjdarffcpimdwvo.supabase.co",gn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcnFxc2pkYXJmZmNwaW1kd3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMjc2NDcsImV4cCI6MjA3MDkwMzY0N30.Stlhcf_qgWsV1u5RUxSH5_Ocr1iJd_d04yv-rtKT1xQ",v=window.supabase.createClient(pn,gn,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"aethera-studio@1.0.0"}}});let $={id:{},en:{}};async function Qt(){try{const t=new URL("/assets/id-C8GxFoKz.json",import.meta.url),e=new URL("/assets/en-c_7rlQsc.json",import.meta.url),[a,n]=await Promise.all([fetch(t),fetch(e)]),[o,s]=await Promise.all([a.json(),n.json()]);return $={id:o,en:s},console.log("Translations loaded successfully"),$}catch(t){return console.error("Failed to load translations:",t),$={id:{},en:{}},$}}function l(t,e={}){const a=typeof localStorage<"u"&&localStorage.getItem("aethera_language")||typeof document<"u"&&document.documentElement.lang||"id";if(!$||!$[a]&&!$.en&&!$.id)return t;const n=s=>t.split(".").reduce((i,r)=>i&&i[r]!=null?i[r]:void 0,$[s]||{});let o=n(a);return o==null&&(o=n("en")),o==null&&(o=n("id")),typeof o=="string"?o.replace(/\{(\w+)\}/g,(s,i)=>e[i]??""):o??t}const pt=Object.freeze(Object.defineProperty({__proto__:null,loadTranslations:Qt,t:l,get translations(){return $}},Symbol.toStringTag,{value:"Module"})),u={loginOverlay:document.getElementById("login-overlay"),loginBtn:document.getElementById("login-btn"),appContainer:document.getElementById("app-container"),generatorPage:document.getElementById("generator-page"),historyPage:document.getElementById("history-page"),settingsPage:document.getElementById("settings-page"),navGenerator:document.getElementById("nav-generator"),navHistory:document.getElementById("nav-history"),navSettings:document.getElementById("nav-settings"),logoutBtn:document.getElementById("logout-btn"),mobileLogoutBtn:document.getElementById("mobile-logout-btn"),mobileMenuButton:document.getElementById("mobile-menu-button"),mobileMenu:document.getElementById("mobile-menu"),menuOpenIcon:document.getElementById("menu-open-icon"),menuCloseIcon:document.getElementById("menu-close-icon"),generateBtn:document.getElementById("generate-btn"),btnText:document.getElementById("btn-text"),btnLoader:document.getElementById("btn-loader"),imageLoader:document.getElementById("image-loader"),imageHelper:document.getElementById("image-helper"),imagePreview:document.getElementById("image-preview"),imagePreviewContainer:document.getElementById("image-preview-container"),removeImageBtn:document.getElementById("remove-image-btn"),outputPanel:document.getElementById("output-panel"),historyPanel:document.getElementById("history-panel"),initialState:document.getElementById("initial-state"),modeSingleBtn:document.getElementById("mode-single"),modeCarouselBtn:document.getElementById("mode-carousel"),scriptCountGroup:document.getElementById("script-count-group"),slideCountGroup:document.getElementById("slide-count-group"),carouselTemplateGroup:document.getElementById("carousel-template-group"),visualStrategyGroup:document.getElementById("visual-strategy-group"),strategyDefaultBtn:document.getElementById("strategy-default"),strategyFacelessBtn:document.getElementById("strategy-faceless"),strategyCharacterBtn:document.getElementById("strategy-character"),ratio916Btn:document.getElementById("ratio-916"),ratio11Btn:document.getElementById("ratio-11"),ratio169Btn:document.getElementById("ratio-169"),downloadAllContainer:document.getElementById("download-all-container"),personaSelector:document.getElementById("persona-selector"),visualDnaStorage:document.getElementById("visual-dna-storage"),customApiKeySettingsInput:document.getElementById("custom-api-key-settings"),apiStatus:document.getElementById("api-status"),systemPromptTextarea:document.getElementById("system-prompt"),saveSettingsBtn:document.getElementById("save-settings-btn"),settingsPresetSelector:document.getElementById("settings-preset-selector"),savePresetBtn:document.getElementById("save-preset-btn"),managePresetsBtn:document.getElementById("manage-presets-btn"),manageCharacterPresetsBtn:document.getElementById("manage-character-presets-btn"),langIdBtn:document.getElementById("lang-id"),langEnBtn:document.getElementById("lang-en"),notification:document.getElementById("notification"),editModal:{el:document.getElementById("edit-modal"),closeBtn:document.getElementById("close-modal-btn"),regenerateBtn:document.getElementById("regenerate-btn"),originalDisplay:document.getElementById("original-script-display-stage1"),instructionInput:document.getElementById("revision-instruction")},apiKeyModal:{el:document.getElementById("api-key-modal"),input:document.getElementById("modal-api-key-input"),saveBtn:document.getElementById("save-api-key-from-modal-btn")},personaModal:{el:document.getElementById("persona-modal"),title:document.getElementById("persona-modal-title"),nameInput:document.getElementById("persona-name"),descInput:document.getElementById("persona-desc"),idInput:document.getElementById("persona-id"),saveBtn:document.getElementById("save-persona-btn"),closeBtn:document.getElementById("close-persona-modal-btn"),addBtn:document.getElementById("add-persona-btn"),listContainer:document.getElementById("persona-list-container"),defaultContainer:document.getElementById("default-persona-container")},confirmModal:{el:document.getElementById("confirm-modal"),title:document.getElementById("confirm-modal-title"),message:document.getElementById("confirm-modal-message"),confirmBtn:document.getElementById("confirm-modal-confirm-btn"),cancelBtn:document.getElementById("confirm-modal-cancel-btn")},inputs:{productName:document.getElementById("product-name"),productDesc:document.getElementById("product-desc"),productImage:document.getElementById("product-image"),writingStyle:document.getElementById("writing-style"),toneVibe:document.getElementById("tone-vibe"),targetAudience:document.getElementById("target-audience"),hookType:document.getElementById("hook-type"),ctaType:document.getElementById("cta-type"),slideCount:document.getElementById("slide-count"),scriptCount:document.getElementById("script-count"),carouselTemplate:document.getElementById("carousel-template")},mobileNavGenerator:document.getElementById("mobile-nav-generator"),mobileNavHistory:document.getElementById("mobile-nav-history"),mobileNavSettings:document.getElementById("mobile-nav-settings")},gt={current:localStorage.getItem("aethera_theme")||"dark"},U={current:localStorage.getItem("aethera_language")||"id"};let ve=null,W=null;function F(t,e,a,n){if(e){if(e.disabled=t,t){e.classList.add("btn-loading");let o=e.querySelector(".btn-spinner");if(o){o.style.display="flex";const s=e.querySelector(".btn-text");s&&(s.style.opacity="0")}else{const s=e.textContent||e.innerHTML;e.innerHTML=`
                <span class="btn-text">${s}</span>
                <span class="btn-spinner">
                    <div class="spinner"></div>
                </span>
            `}}else{e.classList.remove("btn-loading");const o=e.querySelector(".btn-spinner"),s=e.querySelector(".btn-text");o&&s&&(o.style.display="none",s.style.opacity="1")}if(t&&e.id==="generate-btn"){u.initialState&&(u.initialState.style.display="none"),u.outputPanel.innerHTML="";const o=parseInt(u.inputs.scriptCount.value,10)||1,s=document.getElementById("skeleton-card-template");for(let i=0;i<o;i++){const r=s.content.cloneNode(!0);u.outputPanel.appendChild(r)}}}}function b(t,e="default",a=3e3){let n=t,o=typeof t=="string"&&t.includes("_")&&!t.includes(" ");try{const r=l(t);r&&r!==t&&(n=r,o=!1)}catch(r){console.warn("Translation error in showNotification:",r)}const s=document.createElement("div");s.className=`notification notification-${e}`;let i="";switch(e){case"success":i="icon-check";break;case"error":i="icon-error";break;case"warning":i="icon-warning";break;default:i="icon-info"}if(s.innerHTML=`
        <div class="flex items-center space-x-3">
            <div class="icon icon-md ${i} flex-shrink-0 notification-icon"></div>
            <div class="flex-1 notification-message">${n}</div>
            <button class="icon-btn notification-close" onclick="this.parentElement.parentElement.remove()">
                <div class="icon icon-sm icon-close"></div>
            </button>
        </div>
    `,document.body.appendChild(s),o&&n===t){const r=t;let c=0;const d=20,m=150,g=s.querySelector(".notification-message"),h=setInterval(()=>{try{const y=l(r);y&&y!==r&&(g&&g.textContent===r&&(g.textContent=y),clearInterval(h))}catch{clearInterval(h)}finally{c++,c>=d&&clearInterval(h)}},m)}setTimeout(()=>s.classList.add("show"),10),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},a)}function hn(t,e,a,n="success",o=7e3){var r,c;const s=document.createElement("div");s.className=`notification notification-${n}`,s.innerHTML=`
        <div class="flex items-center space-x-3">
            <div class="icon icon-md icon-info flex-shrink-0 notification-icon"></div>
            <div class="flex-1 notification-message">${t}</div>
            <button class="px-3 py-1 rounded bg-gray-800 text-white hover:bg-gray-700 action-btn">${e}</button>
            <button class="icon-btn notification-close"><div class="icon icon-sm icon-close"></div></button>
        </div>
    `;const i=()=>{try{s.remove()}catch{}};(r=s.querySelector(".notification-close"))==null||r.addEventListener("click",i),(c=s.querySelector(".action-btn"))==null||c.addEventListener("click",async()=>{try{await(a==null?void 0:a())}finally{i()}}),document.body.appendChild(s),setTimeout(()=>s.classList.add("show"),10),setTimeout(i,o)}function Se(t,e=null){const a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select();try{if(document.execCommand("copy"),b(l("notification_copy_success")),e){const n=e.innerHTML;e.innerHTML='<div class="icon icon-md icon-check text-green-500"></div>',e.classList.add("copy-success");const o=e.closest(".result-card, .script-part, .slide-text");o&&(o.classList.add("copy-highlight"),setTimeout(()=>{o.classList.remove("copy-highlight")},600)),setTimeout(()=>{e.innerHTML=n,e.classList.remove("copy-success")},1500)}}catch(n){console.error("Failed to copy: ",n)}document.body.removeChild(a)}function ea(t){return new Promise((e,a)=>{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>e(n.result.split(",")[1]),n.onerror=o=>a(o)})}function ht(t,e,a,n){const o=document.getElementById("input-modal"),s=document.getElementById("input-modal-title"),i=document.getElementById("input-modal-message"),r=document.getElementById("input-modal-input"),c=document.getElementById("input-modal-cancel-btn"),d=document.getElementById("input-modal-confirm-btn");s&&(s.textContent=t),i&&(i.textContent=e),r&&(r.placeholder=a||"",r.value=""),o.classList.remove("opacity-0","pointer-events-none"),o.querySelector(".modal-content").classList.remove("scale-95"),r&&setTimeout(()=>r.focus(),100);const m=()=>{const y=r?r.value.trim():"";tt(),n&&n(y)},g=()=>{tt()},h=y=>{y.key==="Enter"?(y.preventDefault(),m()):y.key==="Escape"&&(y.preventDefault(),g())};d&&(d.replaceWith(d.cloneNode(!0)),document.getElementById("input-modal-confirm-btn").addEventListener("click",m)),c&&(c.replaceWith(c.cloneNode(!0)),document.getElementById("input-modal-cancel-btn").addEventListener("click",g)),r&&r.addEventListener("keypress",h)}function tt(){const t=document.getElementById("input-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}function te(t,e){u.confirmModal.message.textContent=t,ve=e,u.confirmModal.el.classList.remove("opacity-0","pointer-events-none"),u.confirmModal.el.querySelector(".modal-content").classList.remove("scale-95")}function Ae(){u.confirmModal.el.classList.add("opacity-0","pointer-events-none"),u.confirmModal.el.querySelector(".modal-content").classList.add("scale-95"),ve=null}function yt(t){try{window.onbeforeunload=null}catch{}const{editModal:e}=u,a=JSON.parse(t.dataset.script);document.getElementById("edit-modal-stage-1").style.display="flex",document.getElementById("edit-modal-stage-1").style.flexDirection="column",document.getElementById("edit-modal-stage-2").style.display="none",document.querySelectorAll(".section-checkbox").forEach(r=>r.checked=!1),document.getElementById("revision-instruction").value="",document.getElementById("original-script-display-stage1"),e.originalDisplay&&(e.originalDisplay.textContent=Be(a)),localStorage.setItem("cardBeingEditedId",t.id);try{const r=JSON.parse(localStorage.getItem("edit_draft_"+t.id)||"null");r&&((document.getElementById("revision-instruction")||{}).value=r.text||"",(document.getElementById("revision-instruction-stage2")||{}).value=r.text||"",(r.sections||[]).forEach(c=>{const d=document.getElementById(c);d&&d.classList.contains("section-checkbox")&&(d.checked=!0)}))}catch{}const n=()=>{const r=(document.getElementById("revision-instruction")||{}).value||"",c=Array.from(document.querySelectorAll(".section-checkbox")).filter(d=>d.checked).map(d=>d.id);localStorage.setItem("edit_draft_"+t.id,JSON.stringify({text:r,sections:c,ts:Date.now()})),(r||c.length>0)&&(window.onbeforeunload=d=>(d.preventDefault(),d.returnValue="",""))},o=(()=>{let r;return()=>{clearTimeout(r),r=setTimeout(n,500)}})(),s=document.getElementById("revision-instruction");s&&s.addEventListener("input",o);const i=document.getElementById("revision-instruction-stage2");i&&i.addEventListener("input",o),document.querySelectorAll(".section-checkbox").forEach(r=>r.addEventListener("change",o)),e.el.classList.remove("opacity-0","pointer-events-none"),e.el.querySelector(".modal-content").classList.remove("scale-95")}function ta(t,e,a){document.getElementById("edit-modal-stage-1").style.display="none",document.getElementById("edit-modal-stage-2").style.display="block";const n=document.getElementById("before-script-display"),o=document.getElementById("after-script-display"),s=document.getElementById("revision-instruction-stage2");n&&(n.textContent=Be(t,["hook","body","cta"]));const i={...t,...e};o.textContent=Be(i,["hook","body","cta"]),W=e,s.value=document.getElementById("revision-instruction").value}function Be(t,e=["hook","body","cta"]){if(!t)return l("script_not_found")||"Skrip tidak ditemukan.";let a=`${l("title_label")||"Judul"}: ${t.title}

`;const n=(o,s)=>{if(!s)return"";let i=`--- ${o.toUpperCase()} ---
`;return i+=`${l("script_text_label")||"Teks Skrip"}: ${s.text}
`,s.shots.forEach((r,c)=>{i+=`${l("visual_idea_label")||"Ide Visual"} ${c+1}: ${r.visual_idea}
`}),i+`
`};return t.hook&&e.includes("hook")&&(a+=n("HOOK",t.hook)),t.body&&e.includes("body")&&(a+=n("BODY",t.body)),t.cta&&e.includes("cta")&&(a+=n("CTA",t.cta)),t.slides&&t.slides.forEach((o,s)=>{e.includes(`slide${s}`)&&(a+=`--- SLIDE ${s+1} ---
`,a+=`${l("slide_text_label")||"Slide Text"}: ${o.slide_text}
`)}),a}function oe(){const{editModal:t}=u;t.el.classList.add("opacity-0","pointer-events-none"),t.el.querySelector(".modal-content").classList.add("scale-95"),localStorage.removeItem("cardBeingEditedId"),W=null}function le(t,e=!1){var o;const a=typeof((o=t.dataset)==null?void 0:o.script)=="string"?JSON.parse(t.dataset.script):t;let n=`${l("script_title_label")||"Judul"}: ${a.title}

`;if(a.hook){a.character_sheet&&a.character_sheet.length>0&&(a.character_sheet.forEach(i=>{n+=`${l("character_label")||"Karakter"}: ${ft(i)}
`}),n+=`
`);const s=(i,r)=>{let c=`${i}:
${r.text}
`;return r.shots.forEach((d,m)=>{c+=` ${l("shot_label")||"Shot"} ${m+1} ${l("visual_idea_label_short")||"Ide"}: ${d.visual_idea}
`,c+=` ${l("shot_label")||"Shot"} ${m+1} ${l("t2i_prompt_label_short")||"T2I"}: ${d.text_to_image_prompt}
`,c+=` ${l("shot_label")||"Shot"} ${m+1} ${l("i2v_prompt_label_short")||"I2V"}: ${d.image_to_video_prompt}
`}),c};n+=s(l("hook_title"),a.hook),n+=`
${s(l("body_title"),a.body)}`,n+=`
${s(l("cta_title"),a.cta)}`}else a.slides&&a.slides.forEach((s,i)=>{n+=`--- ${l("slide_label")} ${i+1} ---
`,n+=`${l("slide_text_label")}: ${s.slide_text}
`,n+=`${l("t2i_prompt_label")}: ${s.text_to_image_prompt}
`,s.layout_suggestion&&(n+=`${l("slide_layout_suggestion")}: ${s.layout_suggestion}
`),s.engagement_idea&&(n+=`${l("slide_engagement_idea")}: ${s.engagement_idea}
`),n+=`
`});return n}function ft(t){if(!t)return"";const e=[];t.name&&e.push(t.name),t.age&&e.push(`${t.age} years old`),t.ethnicity&&e.push(t.ethnicity),t.skin_tone&&e.push(`${t.skin_tone} skin`),t.face_shape&&e.push(`${t.face_shape} face`),t.body_shape&&e.push(t.body_shape);const a=[];return t.hair_style&&a.push(t.hair_style),t.hair_color&&a.push(t.hair_color),a.length>0&&e.push(`${a.join(" ")} hair`),t.eye_color&&e.push(`${t.eye_color} eyes`),e.join(", ")}window.useVariant=async function(t,e){const a=document.querySelector(`[data-part="${t}"]`);if(!a)return;const n=a.closest(".result-card");if(!n)return;const o=JSON.parse(n.dataset.script||"{}");if(!o)return;const s=`${t}_variants`,i=o[s];if(!i||!i[e])return;const r=i[e];try{const{applyVariantToScript:c}=await w(async()=>{const{applyVariantToScript:m}=await Promise.resolve().then(()=>Le);return{applyVariantToScript:m}},void 0);await c(n,o,t,r);const d=a.querySelector(`[data-variant-index="${e}"]`);d&&(d.style.backgroundColor="#065f46",d.style.borderColor="#10b981",setTimeout(()=>{d.style.backgroundColor="",d.style.borderColor=""},2e3))}catch(c){console.error("Error applying variant:",c),o[t]&&o[t].text&&(o[t].text=r),n.dataset.script=JSON.stringify(o);const d=a.querySelector("p");d&&(d.textContent=r);const m=l("variant_applied_success",{part:t.toUpperCase()})||`Variant ${t.toUpperCase()} successfully applied!`;b(m,"success")}};const D=Object.freeze(Object.defineProperty({__proto__:null,closeConfirmModal:Ae,closeEditModal:oe,closeInputModal:tt,get confirmCallback(){return ve},copyToClipboard:Se,elements:u,fileToBase64:ea,getCharacterDescriptionString:ft,getFullScriptText:le,getSimpleScriptTextForModal:Be,languageState:U,openConfirmModal:te,openEditModal:yt,openInputModal:ht,setLoadingState:F,showActionNotification:hn,showBeforeAfter:ta,showNotification:b,get tempGeneratedPart(){return W},themeState:gt},Symbol.toStringTag,{value:"Module"}));function G(t){u.generatorPage.classList.toggle("hidden",t!=="generator"),u.historyPage.classList.toggle("hidden",t!=="history"),u.settingsPage.classList.toggle("hidden",t!=="settings"),[u.navGenerator,u.mobileNavGenerator].forEach(e=>e==null?void 0:e.classList.toggle("active",t==="generator")),[u.navHistory,u.mobileNavHistory].forEach(e=>e==null?void 0:e.classList.toggle("active",t==="history")),[u.navSettings,u.mobileNavSettings].forEach(e=>e==null?void 0:e.classList.toggle("active",t==="settings"))}function Ie(){u.mobileMenu.classList.toggle("hidden"),u.menuOpenIcon.classList.toggle("hidden"),u.menuCloseIcon.classList.toggle("hidden")}function yn(){G("generator")}window.switchToGenerator=yn;let ee=[];function _t(){if(ee.length===0){const t=localStorage.getItem("aethera_lastGeneratedScripts");if(t)try{ee=JSON.parse(t)}catch(e){console.error("Gagal mem-parsing skrip dari localStorage:",e),ee=[]}}return ee}function fn(t,e,a){ee=t,localStorage.setItem("aethera_lastGeneratedScripts",JSON.stringify(t)),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString()),t&&t.length>0&&ya(t,e,a)}function at(t){const e=_t(),a=e.findIndex(n=>n.id===t.id);a>-1&&(e[a]=t,ee=e,localStorage.setItem("aethera_lastGeneratedScripts",JSON.stringify(e)),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString()))}function _n(){ee=[],localStorage.removeItem("aethera_lastGeneratedScripts"),localStorage.setItem("aethera_scripts_last_modified",new Date().toISOString())}async function bn(){var t;return(t=window.jspdf)!=null&&t.jsPDF||await new Promise((e,a)=>{const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js",n.onload=e,n.onerror=a,document.head.appendChild(n)}),window.jspdf.jsPDF}async function vn(){return window.XLSX||await new Promise((t,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",a.onload=t,a.onerror=e,document.head.appendChild(a)}),window.XLSX}let Ve;async function Sn(){var t;return(t=window.jspdf)!=null&&t.jsPDF?window.jspdf.jsPDF:(Ve=Ve||bn(),Ve)}function kn(t){const e=_t();if(e.length===0){b(l("notification_no_script_to_download"),"warning");return}const n=`Aethera Studio - ${(u.inputs.productName.value.trim()||"Aethera_Studio_Script").replace(/[^a-z0-9]/gi,"_").toLowerCase()}`;t==="pdf"&&En(e,n),t==="docx"&&In(e,n),t==="xlsx"&&wn(e,n)}async function En(t,e){const a=await Sn();if(!a){b(l("export_pdf_unavailable")||"Export PDF unavailable: jsPDF not loaded.","error");return}const n=new a;t.forEach((o,s)=>{s>0&&n.addPage(),n.setFont("helvetica","bold"),n.text(`${l("script_option")} #${s+1}: ${o.title}`,10,10),n.setFont("helvetica","normal");const i=le(o),r=n.splitTextToSize(i,180);n.text(r,10,20)}),n.save(`${e}.pdf`)}function De(t){const e=[];return t.body_intro&&e.push({section:"Body",scene:"intro",text:t.body_intro,t2i:"",i2v:""}),t.hook&&(e.push({section:"Hook",scene:"main",text:t.hook.text||"",t2i:"",i2v:""}),t.hook.shots&&t.hook.shots.forEach((a,n)=>{e.push({section:"Hook",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),t.body&&(e.push({section:"Body",scene:"main",text:t.body.text||"",t2i:"",i2v:""}),t.body.shots&&t.body.shots.forEach((a,n)=>{e.push({section:"Body",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),t.cta&&(e.push({section:"CTA",scene:"main",text:t.cta.text||"",t2i:"",i2v:""}),t.cta.shots&&t.cta.shots.forEach((a,n)=>{e.push({section:"CTA",scene:`shot_${n+1}`,text:a.visual_idea||"",t2i:a.text_to_image_prompt||"",i2v:a.image_to_video_prompt||""})})),e}function aa(t){const e=De(t),a={title:t.title||"Untitled Script",created_at:new Date().toISOString(),format:"prompt_pack",rows:e},n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=`${t.title||"script"}_prompt_pack.json`,s.click(),URL.revokeObjectURL(o),b(l("prompt_pack_json_downloaded_success")||"Prompt Pack JSON berhasil diunduh!","success")}function na(t){const e=De(t);let n=["Section","Scene","Text","Text-to-Image Prompt","Image-to-Video Prompt"].join(",")+`
`;e.forEach(r=>{const c=[`"${r.section}"`,`"${r.scene}"`,`"${r.text.replace(/"/g,'""')}"`,`"${r.t2i.replace(/"/g,'""')}"`,`"${r.i2v.replace(/"/g,'""')}"`].join(",");n+=c+`
`});const o=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=`${t.title||"script"}_prompt_pack.csv`,i.click(),URL.revokeObjectURL(s),b(l("prompt_pack_csv_downloaded_success")||"Prompt Pack CSV berhasil diunduh!","success")}function Pe(t){const e=Math.floor(t/3600),a=Math.floor(t%3600/60),n=Math.floor(t%60),o=Math.floor(t%1*1e3);return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")},${o.toString().padStart(3,"0")}`}function oa(t){const e=De(t).filter(h=>h.text.trim()!=="");if(e.length===0){b(l("no_text_to_export_srt")||"Tidak ada teks untuk diekspor ke SRT","warning");return}const a=60,n=a*.25,o=a*.6,s=a*.15;let i="",r=0,c=1;e.forEach(h=>{let y;h.section==="Hook"?y=n/e.filter(f=>f.section==="Hook").length:h.section==="Body"?y=o/e.filter(f=>f.section==="Body").length:h.section==="CTA"?y=s/e.filter(f=>f.section==="CTA").length:y=2;const _=r,p=r+y;i+=`${c}
`,i+=`${Pe(_)} --> ${Pe(p)}
`,i+=`${h.text}

`,r=p,c++});const d=new Blob([i],{type:"text/plain;charset=utf-8;"}),m=URL.createObjectURL(d),g=document.createElement("a");g.href=m,g.download=`${t.title||"script"}_capcut.srt`,g.click(),URL.revokeObjectURL(m),b(l("capcut_srt_downloaded_success")||"CapCut SRT berhasil diunduh!","success")}function sa(t){const e=De(t).filter(d=>d.text.trim()!=="");if(e.length===0){b(l("no_text_to_export_csv")||"Tidak ada teks untuk diekspor ke CSV","warning");return}const a=3;let o=["Index","Start Time","End Time","Text","Section"].join(",")+`
`,s=0;e.forEach((d,m)=>{const g=s,h=s+a,y=[m+1,Pe(g),Pe(h),`"${d.text.replace(/"/g,'""')}"`,`"${d.section}"`].join(",");o+=y+`
`,s=h});const i=new Blob([o],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),c=document.createElement("a");c.href=r,c.download=`${t.title||"script"}_capcut.csv`,c.click(),URL.revokeObjectURL(r),b(l("capcut_csv_downloaded_success")||"CapCut CSV berhasil diunduh!","success")}function In(t,e){let a="";t.forEach((r,c)=>{a+=`<h1>${l("script_option")} #${c+1}: ${r.title}</h1>`,a+=le(r).replace(/\n/g,"<br>"),c<t.length-1&&(a+='<br clear="all" style="page-break-before:always" />')});const n=`<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export</title></head><body>${a}</body></html>`,o=new Blob(["\uFEFF",n],{type:"application/msword"}),s=URL.createObjectURL(o),i=document.createElement("a");i.href=s,i.download=`${e}.doc`,document.body.appendChild(i),i.click(),document.body.removeChild(i)}async function wn(t,e){const a=await vn(),n=a.utils.book_new();t.forEach((o,s)=>{let i=[];if(o.hook){i.push([l("part_label"),l("script_text_label"),l("visual_idea_label_short"),l("t2i_prompt_label_short"),l("i2v_prompt_label_short")]),i.push([l("script_title_label")||"Judul",o.title,"","",""]),o.character_sheet&&o.character_sheet.length>0&&o.character_sheet.forEach(d=>{i.push([l("character_label")||"Karakter",ft(d)])});const c=(d,m)=>{m.shots.forEach((g,h)=>{i.push([h===0?d:"",h===0?m.text:"",g.visual_idea,g.text_to_image_prompt,g.image_to_video_prompt])})};c(l("hook_title"),o.hook),c(l("body_title"),o.body),c(l("cta_title"),o.cta)}else o.slides&&(i.push([l("slide_label_short"),l("slide_text_label"),l("t2i_prompt_label"),l("slide_layout_suggestion"),l("slide_engagement_idea")]),o.slides.forEach((c,d)=>{i.push([d+1,c.slide_text,c.text_to_image_prompt,c.layout_suggestion||"-",c.engagement_idea||"-"])}));const r=a.utils.aoa_to_sheet(i);a.utils.book_append_sheet(n,r,`${l("option_label")||"Opsi"} ${s+1}`)}),a.writeFile(n,`${e}.xlsx`)}function xn(t){const e=(t||"")+"";let a=0;for(let n=0;n<e.length;n++)a=a*31+e.charCodeAt(n)>>>0;return a}function ra(t,e,a,n){var g,h,y;const o=_=>Array.isArray(_)?_.map(p=>Number(p)).filter(Number.isFinite):[],s=_=>{const p=o(_);return p.length?Math.max(...p):0},i=s(t)*.5+s(e)*.3+s(a)*.2,r=`${((g=n==null?void 0:n.hook)==null?void 0:g.text)||(n==null?void 0:n.hook)||""}|${((h=n==null?void 0:n.body)==null?void 0:h.text)||(n==null?void 0:n.body)||""}|${((y=n==null?void 0:n.cta)==null?void 0:y.text)||(n==null?void 0:n.cta)||""}`,c=xn(r)%3,m=90+Math.max(0,Math.min(8,i*.1))+c;return Math.min(98,Math.round(m))}async function X(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=5&&a<=12?n+=30:a<5?n+=10:n-=(a-12)*3;const{t:o}=await w(async()=>{const{t:m}=await Promise.resolve().then(()=>pt);return{t:m}},void 0),s=o("action_words"),i=Array.isArray(s)?s:["try","check","see","discount","promo","secret","turns out","free","viral","trending"],r=t.toLowerCase();i.forEach(m=>{r.includes(m)&&(n+=15)});const c=o("commerce_words");return(Array.isArray(c)?c:["cart","checkout","buy","order"]).forEach(m=>{r.includes(m)&&(n+=10)}),/\d+%|\d+/.test(t)&&(n+=10),Math.max(0,n)}async function J(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=8&&a<=14?n+=25:a<8?n+=10:n-=(a-14)*2;const{t:o}=await w(async()=>{const{t:m}=await Promise.resolve().then(()=>pt);return{t:m}},void 0),s=t.toLowerCase(),i=o("benefit_words")||["save","easy","fast","practical","effective","proven","quality"];Array.isArray(i)&&i.forEach(m=>{s.includes(m)&&(n+=12)});const r=o("problem_words")||["problem","difficult","complicated","expensive","slow"],c=o("solution_words")||["solution","answer","way","tips","tricks"];Array.isArray(r)&&Array.isArray(c)&&r.some(m=>s.includes(m))&&c.some(m=>s.includes(m))&&(n+=15);const d=o("social_words")||["many","thousands","millions","trusted","testimonial","review"];return Array.isArray(d)&&d.forEach(m=>{s.includes(m)&&(n+=10)}),Math.max(0,n)}function ae(t){if(!t)return 0;const a=t.trim().split(/\s+/).length;let n=0;a>=3&&a<=8?n+=30:a<3?n+=5:n-=(a-8)*4;const o=t.toLowerCase(),s=(d,m)=>{const g=l(d);return Array.isArray(g)?g.map(h=>String(h).toLowerCase().trim()).filter(Boolean):typeof g=="string"?g.split(",").map(h=>h.toLowerCase().trim()).filter(Boolean):m.split(",").map(h=>h.toLowerCase().trim()).filter(Boolean)};return s("cta_low_friction_words","tap,klik,keranjang,subscribe,follow,comment,reply,swipe").forEach(d=>{d&&o.includes(d)&&(n+=20)}),s("cta_action_words","beli,order,dapatkan,ambil,coba,download").forEach(d=>{d&&o.includes(d)&&(n+=10)}),s("cta_urgency_words","sekarang,segera,terbatas,hari ini,buruan").forEach(d=>{d&&o.includes(d)&&(n+=8)}),Math.max(0,n)}function ia(t,e=7){if(!t)return t;const a=t.trim().split(/\s+/);return a.length<=e?t:a.slice(0,e).join(" ")+"..."}async function ca(t){const e=u.outputPanel,a=document.getElementById("results-toolbar");if(e&&(e.innerHTML=""),a){const o=Array.isArray(t)&&t.length>1;a.classList.toggle("hidden",!o);try{a.style.display=o?"flex":"none"}catch{}}try{if(e&&!e.__toolbarObserver){const o=()=>{const i=e.querySelectorAll(".result-card").length,r=document.getElementById("results-toolbar");if(!r)return;const c=i>1;r.classList.toggle("hidden",!c);try{r.style.display=c?"flex":"none"}catch{}},s=new MutationObserver(()=>o());s.observe(e,{childList:!0,subtree:!1}),e.__toolbarObserver=s,o()}}catch{}if(!t||t.length===0){bt(l("notification_script_generation_error"));return}const n=t.map(async(o,s)=>{const i=await vt(o,s);return i.style.opacity="0",i.style.transform="translateY(20px)",u.outputPanel.appendChild(i),setTimeout(()=>{i.classList.add("animate-fadeInUp"),i.style.opacity="1",i.style.transform="translateY(0)"},s*150),o.slides&&La(`#card-${o.id||s} .carousel-swiper-container`),setTimeout(()=>{try{se()}catch{}},0),i});await Promise.all(n);try{const o=document.getElementById("results-toolbar");if(o){const i=document.querySelectorAll("#output-panel .result-card").length>1;o.classList.toggle("hidden",!i);try{o.style.display=i?"flex":"none"}catch{}}}catch{}try{se()}catch{}setTimeout(()=>{try{const o=document.getElementById("results-toolbar");if(!o)return;const i=document.querySelectorAll("#output-panel .result-card").length>1;o.classList.toggle("hidden",!i);try{o.style.display=i?"flex":"none"}catch{}}catch{}try{se()}catch{}},50)}function bt(t){u.outputPanel.innerHTML=`<div class="flex flex-col items-center justify-center h-full text-center text-red-400"><div class="text-6xl mb-4">:(</div><h3 class="text-xl font-semibold">${l("notification_script_generation_error_title")||"Oops!"}</h3><p class="max-w-sm mt-2">${t}</p></div>`}async function vt(t,e){var s,i,r,c;const n=document.getElementById("result-card-template").content.cloneNode(!0).firstElementChild;t.id||(t.id=`script-${Date.now()}-${e}`),n.id=`card-${t.id}`,n.querySelector(".result-title").textContent=l("script_option_title",{index:e+1,title:t.title});try{const d=Array.isArray(t.hook_variants)?t.hook_variants:[],m=await Promise.all([...d.map(P=>X(P)),X(((s=t.hook)==null?void 0:s.text)||t.hook||"")]),g=Math.max(...m.map(Number).filter(Number.isFinite),0),y=[...(Array.isArray(t.cta_variants)?t.cta_variants:[]).map(P=>ae(P)),ae(((i=t.cta)==null?void 0:i.text)||t.cta||"")],_=Math.max(...y.map(Number).filter(Number.isFinite),0),p=(((r=t.body)==null?void 0:r.text)||t.body||"").toString().split(`
`)[0]||"",f=Array.isArray(t.body_variants)?t.body_variants:[],S=await Promise.all([...f.map(P=>J(P)),J(p)]),k=Math.max(...S.map(Number).filter(Number.isFinite),0),x=ra([g],[k],[_],t);n.dataset.globalScore=String(x);const E=document.createElement("span"),M=localStorage.getItem("aethera_theme")||"dark";E.textContent=`Score ${x}`,E.style.marginLeft="6px",E.style.padding="2px 8px",E.style.borderRadius="9999px",E.style.fontSize="12px",E.style.lineHeight="1",E.style.display="inline-flex",E.style.alignItems="center",E.style.fontWeight="600",M==="light"?(E.style.backgroundColor="#d1fae5",E.style.border="1px solid #6ee7b7",E.style.color="#065f46"):(E.style.backgroundColor="rgba(16,185,129,0.15)",E.style.border="1px solid rgba(16,185,129,0.25)",E.style.color="#a7f3d0");const B=n.querySelector(".result-title");if(B){const P=B.textContent;B.textContent="";const O=document.createElement("span");O.textContent=P,B.style.display="flex",B.style.alignItems="center",B.style.gap="8px",B.style.whiteSpace="normal",B.style.flex="1 1 auto",E.style.whiteSpace="nowrap",B.appendChild(O),B.appendChild(E)}}catch(d){console.warn("Scoring badge failed:",d)}n.querySelector(".edit-btn").title=l("edit_button")||"Edit",n.querySelector(".copy-btn").title=l("copy_full_script")||"Copy Full Script",Pt(n,t);try{const d=n.querySelector(".card-content");if(d){const m=(((c=t.hook)==null?void 0:c.text)||t.hook||"").toString().split(`
`)[0]||"",g=document.createElement("p");g.className="text-sm text-gray-400",g.textContent=m.slice(0,120)+(m.length>120?"…":""),d.innerHTML="",d.style.display="none"}}catch{}try{n.querySelectorAll(".export-dropdown, .edit-btn, .copy-btn, .view-btn").forEach(d=>{d.style.display="none"})}catch{}n.querySelector(".copy-btn").addEventListener("click",()=>{const d=n.querySelector(".copy-btn");F(!0,d);try{Se(le(n),d)}finally{setTimeout(()=>{F(!1,d)},500)}}),n.querySelector(".edit-btn").addEventListener("click",()=>yt(n));const o=n.querySelector(".view-btn");return o&&o.addEventListener("click",d=>{d.stopPropagation(),re(n,JSON.parse(n.dataset.script))}),n.addEventListener("click",d=>{d.target.closest(".export-dropdown")||d.target.closest(".edit-btn")||d.target.closest(".copy-btn")||d.target.closest(".view-btn")||re(n,JSON.parse(n.dataset.script))}),pa(n),setTimeout(()=>{try{se()}catch{}},0),n}async function la(t){if(!t.hook_variants&&!t.body_variants&&!t.cta_variants)return"";localStorage.getItem("aethera_theme");let e=`
        <div class="ab-variants p-4 rounded-lg bg-gray-900/40 border border-gray-800/40">
            <h4 class="text-lg font-semibold text-blue-300 mb-2">A/B Variants - Pilih Copy Terbaik</h4>
    `;return t.hook_variants&&t.hook_variants.length>0&&(e+=await ge("Hook",t.hook_variants,X,"hook")),t.body_intro&&(e+=await ge("Body Intro",[t.body_intro],J,"body_intro")),t.body_variants&&t.body_variants.length>0&&(e+=await ge("Body",t.body_variants,J,"body")),t.cta_variants&&t.cta_variants.length>0&&(e+=await ge("CTA",t.cta_variants,ae,"cta")),e+="</div>",e}async function ge(t,e,a,n){const o=await Promise.all(e.map(async(i,r)=>({text:i,score:await a(i),index:r})));o.sort((i,r)=>r.score-i.score),o[0];let s=`
        <div class="variant-section mb-4">
            <h6 class="text-xs font-semibold text-blue-200 mb-2 light-mode:text-blue-600">${t} (${e.length} ${l("options")||"opsi"})</h6>
            <div class="space-y-2">
    `;return o.forEach((i,r)=>{const c=r===0,d=c?"bg-green-600":i.score>=50?"bg-blue-600":"bg-gray-600",m=c?l("best")||"TERBAIK":`${i.score}pts`;s+=`
            <div class="variant-item flex items-start space-x-3 p-2 rounded ${c?"bg-green-900/20 border border-green-700/30":"bg-gray-800/30"}">
                <span class="${d} text-white text-xs px-2 py-1 rounded font-bold flex-shrink-0">${m}</span>
                <p class="text-sm text-gray-300 flex-1">${i.text}</p>
                <div class="flex space-x-1 flex-shrink-0">
                    ${n==="hook"?`<button class="shorten-btn text-xs bg-yellow-600 hover:bg-yellow-700 text-white px-2 py-1 rounded" data-section="${n}" data-index="${i.index}" title="${l("shorten_tooltip")||"Pendekkan (≤7 kata)"}">${l("shorten_button")||"Pendek"}</button>`:""}
                    <button class="use-variant-btn text-xs bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded" data-section="${n}" data-index="${i.index}">${l("use_button")||"Gunakan"}</button>
                </div>
            </div>
        `}),s+=`
            </div>
            <div class="mt-2 flex space-x-2">
                <button class="use-best-btn text-xs bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded font-semibold" data-section="${n}">✓ ${l("use_best_button")||"Pakai Terbaik"}</button>
            </div>
        </div>
    `,s}async function da(t,e,a){let n,o;switch(a){case"hook":n=e.hook_variants,o=X;break;case"body":n=e.body_variants,o=J;break;case"body_intro":n=[e.body_intro],o=J;break;case"cta":n=e.cta_variants,o=ae;break;default:return}if(!n||n.length===0)return;const s=await Promise.all(n.map(c=>Promise.resolve(o(c))));let i=0,r=Number.NEGATIVE_INFINITY;s.forEach((c,d)=>{const m=Number(c);Number.isFinite(m)&&m>r&&(r=m,i=d)}),await qe(t,e,a,n[i])}async function ua(t,e,a,n){let o;switch(a){case"hook":o=e.hook_variants;break;case"body":o=e.body_variants;break;case"body_intro":o=[e.body_intro];break;case"cta":o=e.cta_variants;break;default:return}!o||!o[n]||await qe(t,e,a,o[n])}async function ma(t,e,a,n){let o;switch(a){case"hook":o=e.hook_variants;break;default:return}if(!o||!o[n])return;const s=ia(o[n],7);await qe(t,e,a,s)}async function he(t,e,a){try{const n=localStorage.getItem("productName")||t.title||"Product",o=localStorage.getItem("productDescription")||"Product description",s=localStorage.getItem("visualStrategy")||"standard",i=localStorage.getItem("aspectRatio")||"9:16",r=localStorage.getItem("aethera_language")||"id",c=localStorage.getItem("aethera_system_prompt")||"",d=JSON.stringify(t.character_sheet||[],null,2),m=Array.isArray(t.original_character_descriptions)?t.original_character_descriptions.join("; "):"",g=`Characters (character_sheet): ${d}
Original character physical descriptions: ${m}`,h=`${c}

${r==="en"?`Based on the new ${e.toUpperCase()} text: "${a}"

Product: ${n}
Description: ${o}
Visual Strategy: ${s}
Aspect Ratio: ${i}
${g}

IMPORTANT LANGUAGE RULES (override any previous instructions):
- visual_idea MUST be in English only.
- text_to_image_prompt MUST be in English only.
- image_to_video_prompt MUST be in English only.
- DO NOT mix any other language.

CHARACTER CONSTRAINTS:
- Use ONLY the characters provided in character_sheet above. Keep names and personalities consistent.
- DO NOT invent, change, or swap characters.
- In text_to_image_prompt, put physical descriptions ONLY inside <char-desc>...</char-desc> tags.
- NEVER include <char-desc> in image_to_video_prompt.

Return strictly JSON with structure:
{
  "shots": [
    {
      "visual_idea": "concise cinematic description in English",
      "text_to_image_prompt": "very detailed T2I prompt in English (use <char-desc> for physical details only)",
      "image_to_video_prompt": "I2V prompt in English (movement only, no physical descriptions)",
      "negative_prompt": "negative prompt for image quality"
    }
  ]
}`:`Berdasarkan teks ${e.toUpperCase()} yang baru: "${a}"

Produk: ${n}
Deskripsi: ${o}
Strategi Visual: ${s}
Rasio: ${i}
${g}

ATURAN BAHASA (menimpa instruksi sebelumnya):
- visual_idea WAJIB dalam Bahasa Indonesia saja.
- text_to_image_prompt (T2I) WAJIB dalam Bahasa Inggris saja.
- image_to_video_prompt (I2V) WAJIB dalam Bahasa Inggris saja.
- JANGAN campur bahasa dalam setiap field.

KONSTR A KARAKTER:
- Gunakan HANYA karakter dari character_sheet di atas. Nama dan kepribadian harus konsisten.
- JANGAN menciptakan/mengubah karakter.
- Di text_to_image_prompt, taruh deskripsi fisik HANYA di dalam tag <char-desc>...</char-desc>.
- JANGAN pernah menaruh <char-desc> pada image_to_video_prompt.

Kembalikan JSON murni dengan struktur:
{
  "shots": [
    {
      "visual_idea": "deskripsi sinematik singkat dalam Bahasa Indonesia",
      "text_to_image_prompt": "prompt T2I sangat detail dalam Bahasa Inggris (gunakan <char-desc> hanya untuk deskripsi fisik)",
      "image_to_video_prompt": "prompt I2V dalam Bahasa Inggris (khusus pergerakan, tanpa deskripsi fisik)",
      "negative_prompt": "negative prompt untuk kualitas gambar"
    }
  ]
}`}`,y=localStorage.getItem("aethera_user_api_key"),_={"Content-Type":"application/json"};y&&(_["x-user-api-key"]=y);const p=await fetch("/api/generateScript",{method:"POST",headers:_,body:JSON.stringify({prompt:h,scriptCount:1,mode:"visual_regeneration"})});if(!p.ok)throw new Error("Failed to regenerate visual prompts");return(await p.json()).shots||[]}catch(n){return console.error("Error regenerating visual prompts:",n),null}}async function qe(t,e,a,n){switch(w(async()=>{const{showNotification:o}=await Promise.resolve().then(()=>D);return{showNotification:o}},void 0).then(({showNotification:o})=>{o(l("regenerating_visual_prompts")||"Meregenerasi prompt visual...","info")}),a){case"hook":if(e.hook){e.hook.text=n;const o=await he(e,"hook",n);o&&o.length>0&&(e.hook.shots=o)}break;case"body":if(e.body){e.body.text=n;const o=await he(e,"body",n);o&&o.length>0&&(e.body.shots=o)}break;case"body_intro":if(e.body){if(e.body_intro=n,e.body.text){const s=e.body.text.split(". ");s[0]=n,e.body.text=s.join(". ")}const o=await he(e,"body",e.body.text);o&&o.length>0&&(e.body.shots=o)}break;case"cta":if(e.cta){e.cta.text=n;const o=await he(e,"cta",n);o&&o.length>0&&(e.cta.shots=o)}break}t.dataset.script=JSON.stringify(e),at(e),Pt(t,e),w(async()=>{const{showNotification:o}=await Promise.resolve().then(()=>D);return{showNotification:o}},void 0).then(({showNotification:o})=>{const s=l("variant_applied_with_visuals")||`${a.toUpperCase()} dan prompt visual berhasil diperbarui!`;o(s,"success")})}function pa(t){const e=t.querySelector(".export-btn"),a=t.querySelector(".export-menu"),n=JSON.parse(t.dataset.script);e.addEventListener("click",s=>{s.stopPropagation(),document.querySelectorAll(".export-menu").forEach(i=>{i!==a&&i.classList.add("hidden")}),a.classList.toggle("hidden")}),document.addEventListener("click",s=>{t.contains(s.target)||a.classList.add("hidden")}),t.querySelector(".export-prompt-json").addEventListener("click",async()=>{const s=t.querySelector(".export-prompt-json");s.disabled=!0,s.classList.add("opacity-50");try{await aa(n)}finally{s.disabled=!1,s.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-prompt-csv").addEventListener("click",async()=>{const s=t.querySelector(".export-prompt-csv");s.disabled=!0,s.classList.add("opacity-50");try{await na(n)}finally{s.disabled=!1,s.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-capcut-srt").addEventListener("click",async()=>{const s=t.querySelector(".export-capcut-srt");s.disabled=!0,s.classList.add("opacity-50");try{await oa(n)}finally{s.disabled=!1,s.classList.remove("opacity-50"),a.classList.add("hidden")}}),t.querySelector(".export-capcut-csv").addEventListener("click",async()=>{const s=t.querySelector(".export-capcut-csv");s.disabled=!0,s.classList.add("opacity-50");try{await sa(n)}finally{s.disabled=!1,s.classList.remove("opacity-50"),a.classList.add("hidden")}});const o=t.querySelector(".export-all-zip-item");o&&o.addEventListener("click",async()=>{o.disabled=!0,o.classList.add("opacity-50");try{const{exportZipForScripts:s}=await w(async()=>{const{exportZipForScripts:i}=await Promise.resolve().then(()=>Ht);return{exportZipForScripts:i}},void 0);await s([n],!1)}catch{}finally{o.disabled=!1,o.classList.remove("opacity-50"),a.classList.add("hidden")}})}function se(){try{const t=[...document.querySelectorAll(".result-card")];if(t.length<2){t.forEach(n=>{var o;return(o=n.querySelector(".best-of-all"))==null?void 0:o.remove()});return}let e=null,a=-1/0;if(t.forEach(n=>{const o=n.dataset.globalScore,s=Number(o);Number.isFinite(s)&&s>a&&(a=s,e=n)}),t.forEach(n=>{var o;return(o=n.querySelector(".best-of-all"))==null?void 0:o.remove()}),e){const n=document.createElement("span"),o=localStorage.getItem("aethera_theme")||"dark";n.textContent=l("best_of_all")||"Best of All",n.className="best-of-all",n.style.marginLeft="6px",n.style.padding="2px 8px",n.style.borderRadius="9999px",n.style.fontSize="12px",n.style.lineHeight="1",n.style.display="inline-flex",n.style.alignItems="center",n.style.fontWeight="700",o==="light"?(n.style.backgroundColor="#fef3c7",n.style.border="1px solid #fde68a",n.style.color="#92400e"):(n.style.backgroundColor="rgba(234,179,8,0.20)",n.style.border="1px solid rgba(234,179,8,0.35)",n.style.color="#fde68a");const s=e.querySelector(".result-title");if(s){const i=s.firstChild&&s.firstChild.nodeType===Node.ELEMENT_NODE?s.firstChild:null;s.style.display="inline-flex",s.style.alignItems="baseline",s.style.flexWrap="wrap",s.style.gap="8px",i?s.insertBefore(n,i.nextSibling):s.appendChild(n)}}}catch{}}var Xt;try{(Xt=document.getElementById("rank-all-btn"))==null||Xt.addEventListener("click",()=>{try{se()}catch{}})}catch{}async function re(t,e){var g,h,y;const a=document.getElementById("script-viewer-modal"),n=document.getElementById("script-viewer-content");if(!a||!n)return;const o=_=>(_||"").toString();let s=0;try{const _=await Promise.all([...(e.hook_variants||[]).map(k=>X(k)),X(((g=e.hook)==null?void 0:g.text)||e.hook||"")]),p=[...(e.cta_variants||[]).map(k=>ae(k)),ae(((h=e.cta)==null?void 0:h.text)||e.cta||"")],f=(((y=e.body)==null?void 0:y.text)||e.body||"").toString().split(`
`)[0]||"",S=await Promise.all([...(e.body_variants||[]).map(k=>J(k)),J(f)]);s=ra(_,S,p,e)}catch{s=65}const r=(localStorage.getItem("aethera_theme")||"dark")==="light"?"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-800 border border-emerald-300":"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-200 text-emerald-900 border border-emerald-300";let c=`<div class="mb-4 flex items-center justify-between"><h3 class="text-xl font-bold">${o(e.title)}</h3><span class="${r}" data-tooltip><span>Score ${s}</span><span class="tooltip-hint">${l("score_tooltip")||"Skor gabungan dari Hook/Body/CTA"}</span></span></div>`;c+=`
  <div class="mb-4 flex items-center gap-2">
    <button class="overlay-copy-btn px-3 py-1.5 text-xs rounded bg-gray-700 text-white hover:bg-gray-600" data-tooltip><span>${l("copy_full_script")||"Copy Full Script"}</span><span class="tooltip-hint">${l("copy_tooltip")||"Salin semua teks skrip"}</span></button>
    <div class="relative">
      <button class="overlay-export-btn px-3 py-1.5 text-xs rounded bg-blue-600 text-white hover:bg-blue-700" data-tooltip><span>${l("export_button")||"Export"}</span><span class="tooltip-hint">${l("export_tooltip")||"Export ke berbagai format"}</span></button>
      <div class="overlay-export-menu hidden absolute right-0 mt-1 w-48 bg-gray-900 border border-gray-700 rounded shadow-lg z-10">
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="prompt-json">Prompt Pack (JSON)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="prompt-csv">Prompt Pack (CSV)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="capcut-srt">CapCut (SRT)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="capcut-csv">CapCut (CSV)</button>
        <button class="overlay-export-item block w-full text-left px-3 py-2 text-xs hover:bg-gray-800" data-type="zip-single">Export This (ZIP)</button>
      </div>
    </div>
    <button class="overlay-edit-btn px-3 py-1.5 text-xs rounded bg-yellow-600 text-white hover:bg-yellow-700" data-tooltip><span>${l("edit_button")||"Edit"}</span><span class="tooltip-hint">${l("edit_tooltip")||"Edit teks skrip & regenerasi visual"}</span></button>
  </div>`;const d=(_,p)=>{if(!p)return"";let f=`<div class="mb-4"><h4 class="font-semibold mb-2">${_}</h4>`;f+=`<p class="mb-2 whitespace-pre-wrap">${o(p.text||p)}</p>`;const S=p.shots||[];return Array.isArray(S)&&S.length&&(f+='<div class="space-y-2">',S.forEach((k,x)=>{f+=`<div class="p-3 rounded bg-gray-900/40 border border-gray-700/40"><div class="text-xs text-gray-300"><strong>${l("visual_idea_label")||"Ide Visual"} ${x+1}:</strong> ${o(k.visual_idea)}</div><div class="text-xs text-gray-400 mt-1 flex items-center gap-2"><strong>${l("t2i_prompt_label")||"T2I"}:</strong> <span class="prompt-t2i-display">${o(k.text_to_image_prompt)}</span> <button class="prompt-copy-btn flex-shrink-0" data-prompt="${o(k.text_to_image_prompt).replace(/\\/g,"\\\\").replace(/"/g,"&quot;")}"><div class="icon icon-sm icon-copy text-gray-500 hover:text-white"></div></button></div><div class="text-xs text-gray-400 mt-1 flex items-center gap-2"><strong>${l("i2v_prompt_label")||"I2V"}:</strong> <span class="prompt-i2v-display">${o(k.image_to_video_prompt)}</span> <button class="prompt-copy-btn flex-shrink-0" data-prompt="${o(k.image_to_video_prompt).replace(/\\/g,"\\\\").replace(/"/g,"&quot;")}"><div class="icon icon-sm icon-copy text-gray-500 hover:text-white"></div></button></div></div>`}),f+="</div>"),f+="</div>",f};e.character_sheet&&e.character_sheet.length&&(c+=`<div class="mb-4"><h4 class="font-semibold mb-2">${l("character_sheet_title")||"Character Sheet"}</h4>`,e.character_sheet.forEach((_,p)=>{c+=`<div class="text-xs text-gray-300 mb-1">${l("character_label")||"Karakter"} ${p+1}: ${o((_.name||"")+" "+(_.age||""))}</div>`}),c+="</div>"),c+=d(l("hook_title")||"Hook",e.hook),c+=d(l("body_title")||"Body",e.body),c+=d(l("cta_title")||"CTA",e.cta),n.innerHTML=c;try{n.dataset.script=JSON.stringify(e)}catch{}try{const _=await la(e);_&&n.insertAdjacentHTML("beforeend",_)}catch{}try{n.insertAdjacentHTML("beforeend",Bt(e))}catch{}n.onclick=async _=>{const p=_.target.closest(".overlay-export-btn");if(p){const T=p.parentElement.querySelector(".overlay-export-menu");T&&T.classList.toggle("hidden");return}const f=_.target.closest(".overlay-export-item");if(f){try{const N=f.dataset.type;if(N==="prompt-json")await aa(e);else if(N==="prompt-csv")await na(e);else if(N==="capcut-srt")await oa(e);else if(N==="capcut-csv")await sa(e);else if(N==="zip-single"){const{exportZipForScripts:I}=await w(async()=>{const{exportZipForScripts:L}=await Promise.resolve().then(()=>Ht);return{exportZipForScripts:L}},void 0);await I([e],!1)}}catch{}const T=_.target.closest(".overlay-export-menu");T==null||T.classList.add("hidden");return}const S=n.querySelector(".overlay-export-menu:not(.hidden)");S&&!_.target.closest(".overlay-export-menu")&&!_.target.closest(".overlay-export-btn")&&S.classList.add("hidden");const k=_.target.closest(".overlay-copy-btn");if(k){try{Se(le(e),k)}catch{}return}if(_.target.closest(".overlay-edit-btn")){try{yt(t);const T=document.getElementById("edit-modal"),N=document.getElementById("script-viewer-modal");T&&(T.style.zIndex="1001"),N&&(N.style.zIndex="1000")}catch{}return}const E=_.target.closest(".prompt-copy-btn");if(E){const N=(E.dataset.prompt||"").replace(/<\/?char-desc>/gi,"");try{Se(N,E)}catch{}return}if(_.target.closest(".generate-assets-btn")){try{const{handleGenerateAssets:T}=await w(async()=>{const{handleGenerateAssets:N}=await Promise.resolve().then(()=>no);return{handleGenerateAssets:N}},void 0);await T(n.closest(".result-card")||n)}catch{}return}const B=_.target.closest(".use-best-btn"),P=_.target.closest(".use-variant-btn"),O=_.target.closest(".shorten-btn");if(B){await da(t,e,B.dataset.section),re(t,e);return}if(P){await ua(t,e,P.dataset.section,parseInt(P.dataset.index)),re(t,e);return}if(O){await ma(t,e,O.dataset.section,parseInt(O.dataset.index)),re(t,e);return}},a.classList.remove("opacity-0","pointer-events-none");const m=document.getElementById("script-viewer-close");a.__bound||(a.__bound=!0,m==null||m.addEventListener("click",()=>{a.classList.add("opacity-0","pointer-events-none")}),a.addEventListener("click",_=>{_.target===a&&a.classList.add("opacity-0","pointer-events-none")}),window.addEventListener("keydown",_=>{_.key==="Escape"&&a.classList.add("opacity-0","pointer-events-none")}))}const Le=Object.freeze(Object.defineProperty({__proto__:null,applyVariantToScript:qe,attachExportListeners:pa,createABVariantsHTML:la,createResultCard:vt,createVariantSection:ge,openScriptViewer:re,regenerateVisualPrompts:he,renderError:bt,renderResults:ca,scoreBodyIntro:J,scoreCTA:ae,scoreHook:X,shorten:ia,updateGlobalBestBadge:se,useBestVariant:da,useShortenedVariant:ma,useSpecificVariant:ua},Symbol.toStringTag,{value:"Module"}));let j=1,Te=5,ie=[],ce=[],ga="newest",nt="",ot="all",ha=!1,Ke=new Set;function ya(t,e,a){let n=JSON.parse(localStorage.getItem("aethera_history"))||[],o=a;const s={id:Date.now(),productName:e||u.inputs.productName.value||l("untitled_script"),mode:o,scripts:t};n.unshift(s),n.length>50&&n.pop(),localStorage.setItem("aethera_history",JSON.stringify(n)),localStorage.setItem("aethera_history_last_modified",new Date().toISOString())}async function He(){try{const{cloudStorage:t}=await w(async()=>{const{cloudStorage:e}=await Promise.resolve().then(()=>Ge);return{cloudStorage:e}},void 0);if(t&&typeof t.fetchHistoryTags=="function"){const e=await t.fetchHistoryTags();if(e&&Object.keys(e).length)try{const a=JSON.parse(localStorage.getItem("aethera_history_tags")||"{}"),n={...e,...a};localStorage.setItem("aethera_history_tags",JSON.stringify(n))}catch{}}}catch(t){console.warn("Fetch server tags skipped",t)}return ce=JSON.parse(localStorage.getItem("aethera_history"))||[],de(),ke(),ce}function de(){let t=[...ce];switch(ot!=="all"&&(t=t.filter(e=>e.mode===ot)),nt.trim()&&(t=t.filter(e=>e.productName.toLowerCase().includes(nt.toLowerCase()))),ga){case"oldest":t.sort((e,a)=>e.id-a.id);break;case"name":t.sort((e,a)=>e.productName.localeCompare(a.productName));break;case"newest":default:t.sort((e,a)=>a.id-e.id);break}ha?ie=An(t):ie=t,ke()}function An(t){const e={};return t.forEach(n=>{e[n.productName]||(e[n.productName]=[]),e[n.productName].push(n)}),Object.keys(e).map(n=>({productName:n,entries:e[n]}))}async function ke(){const t=document.getElementById("history-panel"),e=document.getElementById("history-empty-state");if(!t)return;if(ie.length===0){t.innerHTML="",e&&e.classList.remove("hidden"),jt();return}else e&&e.classList.add("hidden");const a=(j-1)*Te,n=a+Te,o=ie.slice(a,n);t.innerHTML="";for(const i of o){const r=i&&Array.isArray(i.scripts)?i.scripts[0]||null:i;if(!r)continue;const c=await vt(r,0);t.appendChild(c)}const s=Math.ceil(ie.length/Te);Ln(s),jt()}function Ln(t){const e=document.getElementById("history-pagination"),a=document.getElementById("prev-page"),n=document.getElementById("next-page"),o=document.getElementById("current-page"),s=document.getElementById("total-pages");if(t<=1){e.classList.add("hidden");return}e.classList.remove("hidden"),o.textContent=j,s.textContent=t,a.disabled=j===1,n.disabled=j===t}async function Ne(t){let e=JSON.parse(localStorage.getItem("aethera_history"))||[];const a=Array.isArray(t)?t.map(Number):[Number(t)],n=e.filter(o=>!a.includes(o.id));localStorage.setItem("aethera_history",JSON.stringify(n)),localStorage.setItem("aethera_history_last_modified",new Date().toISOString()),await He()}async function fa(){localStorage.removeItem("aethera_history"),localStorage.setItem("aethera_history_last_modified",new Date().toISOString());try{const{cloudStorage:t}=await w(async()=>{const{cloudStorage:e}=await Promise.resolve().then(()=>Ge);return{cloudStorage:e}},void 0);t&&typeof t.deleteAllHistory=="function"&&await t.deleteAllHistory()}catch(t){console.warn("Failed to delete history from cloud storage:",t.message)}await He()}function St(t){const e=Math.ceil(ie.length/Te);t>=1&&t<=e&&(j=t,ke())}function _a(){St(j+1)}function ba(){St(j-1)}function kt(t){nt=t,de(),ke()}function Et(t){ga=t,j=1,de(),ke()}function It(t){ot=t,j=1,de(),Tn(t)}window.toggleGroup=function(t){Ke.has(t)?Ke.delete(t):Ke.add(t),de()};window.selectGroupEntries=function(t){const e=document.querySelectorAll(`[data-group-name="${t}"] .history-checkbox`),a=Array.from(e).every(n=>n.checked);e.forEach(n=>{n.checked=!a,n.dispatchEvent(new Event("change"))})};function Tn(t){document.querySelectorAll(".post-type-tab").forEach(n=>{n.classList.remove("active")});const a=document.querySelector(`.post-type-tab[data-filter="${t}"]`);a&&a.classList.add("active")}function jt(){const t={all:document.getElementById("count-all"),single:document.getElementById("count-single"),carousel:document.getElementById("count-carousel")};!t.all||!t.single||!t.carousel||(t.all.textContent=ce.length,t.single.textContent=ce.filter(e=>e.mode==="single").length,t.carousel.textContent=ce.filter(e=>e.mode==="carousel").length)}function va(t){document.querySelectorAll(".history-checkbox").forEach(a=>a.checked=t),wt()}function wt(){const t=document.querySelectorAll(".history-checkbox:checked").length>0,e=document.getElementById("delete-selected-btn");e&&(e.disabled=!t,t?e.classList.remove("hidden"):e.classList.add("hidden"))}function Sa(){const t=document.getElementById("group-by-product");ha=!!(t&&t.checked),de()}function ka(){const t=document.querySelectorAll(".history-checkbox"),e=document.getElementById("select-all-history");if(!e)return;const a=Array.from(t).length>0&&Array.from(t).every(n=>n.checked);e.checked=a}window.handleSearchInput=function(t){kt(t.target.value)};window.handleSortChange=function(t){Et(t.target.value)};window.handlePostTypeFilter=function(t){It(t.target.dataset.filter)};window.handleDeleteSelected=async function(){const t=Array.from(document.querySelectorAll(".history-checkbox:checked")).map(e=>Number(e.closest(".history-entry").dataset.entryId));t.length>0&&await Ne(t)};window.handleDeleteAll=async function(){await fa()};const ze=Object.freeze(Object.defineProperty({__proto__:null,deleteAllHistory:fa,deleteFromHistory:Ne,goToPage:St,loadHistory:He,nextPage:_a,prevPage:ba,saveToHistory:ya,selectAllHistory:va,setPostTypeFilter:It,setSearchQuery:kt,setSortOrder:Et,toggleGroupByProduct:Sa,updateDeleteSelectedButton:wt,updateSelectAllCheckbox:ka},Symbol.toStringTag,{value:"Module"})),C={SYNCED:"synced",SYNCING:"syncing",OFFLINE:"offline",ERROR:"error"},Cn=1e4;let _e=null;const ne={SYNC_STATUS:"aethera_sync_status",LAST_SYNC:"aethera_last_sync",PENDING_SYNC:"aethera_pending_sync",OFFLINE_CHANGES:"aethera_offline_changes"};class Bn{constructor(){this.syncStatus=C.OFFLINE,this.isOnline=navigator.onLine,this.syncInProgress=!1,this.pendingOperations=[],window.addEventListener("online",()=>this.handleOnline()),window.addEventListener("offline",()=>this.handleOffline()),this.updateSyncStatus()}async init(){try{const{data:{session:e}}=await v.auth.getSession();e&&this.isOnline?await this.syncAll():this.setSyncStatus(C.OFFLINE)}catch(e){console.warn("Cloud storage not available, running in offline mode:",e.message),this.setSyncStatus(C.OFFLINE)}}async handleOnline(){this.isOnline=!0,console.log("Device is online, attempting to sync...");const{data:{session:e}}=await v.auth.getSession();e&&await this.syncAll()}handleOffline(){this.isOnline=!1,this.setSyncStatus(C.OFFLINE),console.log("Device is offline, storing changes locally")}setSyncStatus(e){this.syncStatus=e,localStorage.setItem(ne.SYNC_STATUS,e),this.updateSyncIndicator(e)}updateSyncStatus(){this.isOnline?this.syncInProgress?this.setSyncStatus(C.SYNCING):this.setSyncStatus(C.SYNCED):this.setSyncStatus(C.OFFLINE)}updateSyncIndicator(e){const a=document.getElementById("sync-indicator");if(!a)return;a.className=`sync-indicator sync-${e}`;const n={[C.SYNCED]:l("sync_status_synced")||"Synced",[C.SYNCING]:l("sync_status_syncing")||"Syncing...",[C.OFFLINE]:l("sync_status_offline")||"Offline",[C.ERROR]:l("sync_status_error")||"Sync Error"};a.textContent=n[e],a.title=n[e]}async syncAll(){if(!(this.syncInProgress||!this.isOnline)){this.syncInProgress=!0,this.setSyncStatus(C.SYNCING);try{const{data:{session:e}}=await v.auth.getSession();if(!e){console.warn("No active session, switching to offline mode"),this.setSyncStatus(C.OFFLINE);return}await this.processPendingOperations(),await this.syncSettings(),await this.syncGeneratorPresets(),await this.syncCharacterPresets(),await this.syncPersonas(),await this.syncHistory(),typeof window<"u"&&setTimeout(()=>{try{window.populatePresetSelector&&window.populatePresetSelector(),window.populateCharacterPresetSelector&&window.populateCharacterPresetSelector()}catch(a){console.warn("Failed to populate selectors after sync:",a.message)}},200),localStorage.setItem(ne.LAST_SYNC,new Date().toISOString()),this.setSyncStatus(C.SYNCED),console.log("All data synced successfully")}catch(e){console.warn("Sync failed, switching to offline mode:",e.message),this.setSyncStatus(C.OFFLINE)}finally{this.syncInProgress=!1}}}async syncSettings(){try{const{data:{session:e},error:a}=await v.auth.getSession();if(a)throw new Error("Failed to get session: "+a.message);if(!e||!e.user)throw new Error("User not authenticated");const n=e.user,o={theme:localStorage.getItem("aethera_theme")||"dark",language:localStorage.getItem("aethera_language")||"id",system_prompt:localStorage.getItem("aethera_system_prompt")},{data:s,error:i}=await v.from("user_settings").select("*").eq("user_id",n.id).single();if(i&&i.code!=="PGRST116")throw i;if(s){let r;const c=this.hasLocalChanges("settings",s.updated_at);c?r={theme:o.theme,language:o.language,system_prompt:o.system_prompt}:r=this.mergeSettings(o,s),localStorage.setItem("aethera_theme",r.theme),localStorage.setItem("aethera_language",r.language),r.system_prompt&&localStorage.setItem("aethera_system_prompt",r.system_prompt);try{document.documentElement.lang=r.language}catch{}if(typeof window<"u"&&window.updateLanguageButtons)try{window.updateLanguageButtons()}catch{}if(c){const{error:d}=await v.from("user_settings").update({theme:r.theme,language:r.language,system_prompt:r.system_prompt}).eq("user_id",s.user_id);if(d)throw d}}else{const{error:r}=await v.from("user_settings").insert([{user_id:n.id,theme:o.theme,language:o.language,system_prompt:o.system_prompt}]);if(r)throw r}}catch(e){console.warn("Failed to sync settings, continuing in offline mode:",e.message)}}async syncGeneratorPresets(){const e=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),a={};e.forEach(d=>{a[d.name]=d.settings});const{data:n,error:o}=await v.from("user_presets").select("*").eq("type","generator").order("created_at",{ascending:!1});if(o)throw o;const s=localStorage.getItem("aethera_presets_last_modified"),i=s?isNaN(Number(s))?Date.parse(s):Number(s):0,r=n&&n.length>0?Math.max(...n.map(d=>new Date(d.created_at).getTime())):0,c=!i||r>parseInt(i);await this.syncGeneratorPresetsInternal(a,n||[],c),r>0&&localStorage.setItem("aethera_presets_last_modified",String(r))}async syncGeneratorPresetsInternal(e,a,n=!1){const{data:{session:o}}=await v.auth.getSession();if(!o||!o.user)throw new Error("User not authenticated");const s=o.user,i=new Set(a.map(y=>y.name)),r=[],c=new Map;if(a.forEach(y=>{c.set(y.name,y)}),Object.entries(e).forEach(([y,_])=>{i.has(y)||r.push({user_id:s.id,name:y,type:"generator",settings:_})}),r.length>0){const{error:y}=await v.from("user_presets").insert(r);if(y)throw y}if(!n){const y=[];for(const[_,p]of Object.entries(e))if(c.has(_)){const f=c.get(_),S=f.settings||{};try{const k=JSON.stringify(p||{}),x=JSON.stringify(S);k!==x&&y.push({id:f.id,settings:p})}catch{y.push({id:f.id,settings:p})}}for(const _ of y){const{error:p}=await v.from("user_presets").update({settings:_.settings}).eq("id",_.id);if(p)throw p}}const d=n?{}:{...e};JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]").map(y=>y.name),a.forEach(y=>{y.settings&&(n||!e.hasOwnProperty(y.name))&&(d[y.name]=y.settings)});const g=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),h=Object.entries(d).map(([y,_])=>{const p=g.find(S=>S.name===y),f=a.find(S=>S.name===y);return{id:(p==null?void 0:p.id)||(f==null?void 0:f.id)||`preset_${y.replace(/\s+/g,"_").toLowerCase()}_${Date.now()}`,name:y,settings:_}});localStorage.setItem("aethera_settings_presets",JSON.stringify(h)),typeof window<"u"&&window.populatePresetSelector&&setTimeout(()=>window.populatePresetSelector(),100)}async syncCharacterPresets(){try{const e=JSON.parse(localStorage.getItem("aethera_character_presets")||"[]"),{data:a,error:n}=await v.from("user_presets").select("*").eq("type","character").order("created_at",{ascending:!1});if(n)throw n;const o=localStorage.getItem("aethera_character_presets_last_modified"),s=o?isNaN(Number(o))?Date.parse(o):Number(o):0,i=a&&a.length>0?Math.max(...a.map(c=>new Date(c.created_at).getTime())):0,r=!s||i>parseInt(s);await this.syncCharacterPresetsInternal(e,a||[],r),i>0&&localStorage.setItem("aethera_character_presets_last_modified",String(i))}catch(e){console.warn("Failed to sync character presets, continuing in offline mode:",e.message)}}async syncCharacterPresetsInternal(e,a,n=!1){const{data:{session:o}}=await v.auth.getSession();if(!o||!o.user)throw new Error("User not authenticated");const s=o.user,i=new Set(a.map(h=>h.name)),r=new Map;a.forEach(h=>{var _;const y=(_=h==null?void 0:h.settings)==null?void 0:_.id;y&&r.set(String(y),h)});const c=[],d=[];for(const h of e){const y=h!=null&&h.id?String(h.id):"";if(y&&r.has(y)){const _=r.get(y);_.name!==h.name&&d.push({id:_.id,name:h.name});continue}i.has(h.name)||c.push(h)}if(c.length>0){const{error:h}=await v.from("user_presets").insert(c.map(y=>({user_id:s.id,name:y.name,type:"character",settings:y})));if(h)throw h}if(d.length>0)for(const h of d){const{error:y}=await v.from("user_presets").update({name:h.name}).eq("id",h.id);if(y)throw y}const m=n?[]:[...e];JSON.parse(localStorage.getItem("aethera_character_presets")||"[]").map(h=>h.name),a.forEach(h=>{const y=m.findIndex(_=>_.name===h.name);if(y===-1){const _=e.find(p=>p.name===h.name);if(n||_){const p=h.settings;p.id||(p.id=`preset_${h.name.replace(/\s+/g,"_").toLowerCase()}_${Date.now()}`),m.push(p)}}else{const _=m[y].id;m[y]={...h.settings,id:_}}}),localStorage.setItem("aethera_character_presets",JSON.stringify(m)),typeof window<"u"&&window.populateCharacterPresetSelector&&setTimeout(()=>{try{window.populateCharacterPresetSelector()}catch(h){console.warn("Failed to populate character preset selector after sync:",h.message)}},100)}async syncPersonas(){try{const{data:{session:e}}=await v.auth.getSession();if(!e||!e.user)throw new Error("User not authenticated");const a=e.user,n=JSON.parse(localStorage.getItem("aethera_personas")||"[]"),{data:o,error:s}=await v.from("user_personas").select("*").order("created_at",{ascending:!1});if(s)throw s;const i=this.mergePersonas(n,o||[]);localStorage.setItem("aethera_personas",JSON.stringify(i.local));for(const r of i.toUpload)if(r.id&&r.id.toString().length<10){const{error:c}=await v.from("user_personas").insert([{user_id:a.id,name:r.name,description:r.description,avatar:r.avatar,personality:r.personality||{}}]);if(c)throw c}else{const{error:c}=await v.from("user_personas").update({name:r.name,description:r.description,avatar:r.avatar,personality:r.personality||{}}).eq("id",r.id);if(c)throw c}}catch(e){console.warn("Failed to sync personas, continuing in offline mode:",e.message)}}async syncHistory(){try{const{data:{session:e}}=await v.auth.getSession();if(!e||!e.user)throw new Error("User not authenticated");const a=e.user,n=JSON.parse(localStorage.getItem("aethera_history")||"[]"),{data:o,error:s}=await v.from("user_history").select("*").order("created_at",{ascending:!1}).limit(100);if(s)throw s;const i=this.mergeHistory(n,o||[]);localStorage.setItem("aethera_history",JSON.stringify(i.local.slice(0,50)));for(const r of i.toUpload){const c=r.timestamp||Date.now(),d=isNaN(c)?Date.now():c,m=r.productName||r.product_name||"Untitled Script",{error:g}=await v.from("user_history").insert([{user_id:a.id,product_name:m,scripts:r.scripts||[],post_type:r.postType||r.post_type||"single",image_url:r.imageUrl||r.image_url||null,created_at:new Date(d).toISOString()}]);if(g)throw g}}catch(e){console.warn("Failed to sync history, continuing in offline mode:",e.message)}}async processPendingOperations(){const e=JSON.parse(localStorage.getItem(ne.PENDING_SYNC)||"[]");for(const a of e)try{await this.executeOperation(a)}catch(n){console.error("Failed to execute pending operation:",a,n)}localStorage.removeItem(ne.PENDING_SYNC)}async executeOperation(e){const{type:a,action:n,data:o}=e;switch(a){case"presets":if(n==="create")await v.from("user_presets").insert([o]);else if(n==="update"){const s={name:o.name};if(Object.prototype.hasOwnProperty.call(o,"settings")&&(s.settings=o.settings),o.id)await v.from("user_presets").update(s).eq("id",o.id);else if(o.previous_name&&o.type){const{data:{session:i}}=await v.auth.getSession();i!=null&&i.user&&await v.from("user_presets").update(s).eq("user_id",i.user.id).eq("type",o.type).eq("name",o.previous_name)}}else n==="delete"&&(o.id?await v.from("user_presets").delete().eq("id",o.id):o.name&&o.type&&await v.from("user_presets").delete().eq("name",o.name).eq("type",o.type));break;case"personas":n==="create"?await v.from("user_personas").insert([o]):n==="update"?await v.from("user_personas").update(o).eq("id",o.id):n==="delete"&&await v.from("user_personas").delete().eq("id",o.id);break;case"history":if(n==="create"){const s={...o,product_name:o.product_name||o.productName||"Untitled Script",scripts:o.scripts||[],post_type:o.post_type||o.postType||"single",image_url:o.image_url||o.imageUrl||null};await v.from("user_history").insert([s])}else n==="delete"&&await v.from("user_history").delete().eq("id",o.id);break}}async deleteAllHistory(){try{const{data:{session:e}}=await v.auth.getSession();if(!e||!e.user){console.warn("User not authenticated, cannot delete cloud history");return}const{error:a}=await v.from("user_history").delete().eq("user_id",e.user.id);if(a)throw a;console.log("All user history deleted from cloud storage")}catch(e){console.warn("Failed to delete history from cloud storage:",e.message)}}addPendingOperation(e,a,n){const o=JSON.parse(localStorage.getItem(ne.PENDING_SYNC)||"[]");o.push({type:e,action:a,data:n,timestamp:Date.now()}),localStorage.setItem(ne.PENDING_SYNC,JSON.stringify(o))}mergeSettings(e,a){return{theme:a.theme||e.theme,language:a.language||e.language,system_prompt:a.system_prompt||e.system_prompt}}mergePersonas(e,a){const n=[...a],o=[];for(const s of e)a.find(r=>r.name===s.name&&r.description===s.description)||(n.push(s),o.push(s));return{local:n,toUpload:o}}mergeHistory(e,a){const n=a.map(i=>({id:i.created_at?new Date(i.created_at).getTime():Date.now(),productName:i.product_name||"Untitled Script",mode:i.post_type||"single",scripts:i.scripts||[],timestamp:i.created_at?new Date(i.created_at).getTime():Date.now()})),o=[...n],s=[];for(const i of e){const r=i.timestamp||i.id||Date.now(),c=isNaN(r)?Date.now():r,d=i.productName||i.product_name||"Untitled Script";if(!n.find(g=>{const h=g.timestamp||Date.now(),y=Math.abs(h-c),_=g.productName===d,p=y<3e5;let f=!1;if(i.scripts&&i.scripts.length>0&&g.scripts&&g.scripts.length>0){const S=i.scripts[0],k=g.scripts[0];S.hook&&k.hook?f=S.hook===k.hook&&S.body===k.body:S.slides&&k.slides&&S.slides.length>0&&k.slides.length>0&&(f=S.slides[0].slide_text===k.slides[0].slide_text)}return _&&(p||f)})&&i.scripts&&i.scripts.length>0){const g={id:i.id,productName:d,mode:i.mode||"single",scripts:i.scripts,timestamp:c};o.push(g),s.push({...i,productName:d,scripts:i.scripts,postType:i.mode||"single",imageUrl:i.imageUrl||null})}}return o.sort((i,r)=>{const c=i.timestamp||Date.now();return(r.timestamp||Date.now())-c}),{local:o,toUpload:s}}hasLocalChanges(e,a){const n=localStorage.getItem(`aethera_${e}_last_modified`);if(!n)return!1;try{const o=new Date(n),s=new Date(a);return isNaN(o.getTime())||isNaN(s.getTime())?!1:o>s}catch{return console.warn("Invalid date values in hasLocalChanges:",{lastLocalChange:n,cloudUpdatedAt:a}),!1}}async exportBackup(){const e={version:"1.0",timestamp:new Date().toISOString(),data:{settings:{theme:localStorage.getItem("aethera_theme"),language:localStorage.getItem("aethera_language"),system_prompt:localStorage.getItem("aethera_system_prompt")},personas:JSON.parse(localStorage.getItem("aethera_personas")||"[]"),history:JSON.parse(localStorage.getItem("aethera_history")||"[]"),presets:JSON.parse(localStorage.getItem("aethera_last_settings")||"{}")}},a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`aethera-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),b(l("notification_backup_exported")||"Backup exported successfully")}async restoreBackup(e){try{const a=await e.text(),n=JSON.parse(a);if(!n.version||!n.data)throw new Error("Invalid backup file format");n.data.settings&&Object.entries(n.data.settings).forEach(([o,s])=>{s&&localStorage.setItem(`aethera_${o}`,s)}),n.data.personas&&localStorage.setItem("aethera_personas",JSON.stringify(n.data.personas)),n.data.history&&localStorage.setItem("aethera_history",JSON.stringify(n.data.history)),n.data.presets&&localStorage.setItem("aethera_last_settings",JSON.stringify(n.data.presets)),b(l("notification_backup_restored")||"Backup restored successfully"),this.isOnline&&await this.syncAll()}catch(a){console.error("Failed to restore backup:",a),b(l("notification_backup_restore_failed")||"Failed to restore backup","error")}}async fetchHistoryTags(){try{const{data:{session:e}}=await v.auth.getSession();if(!e||!e.user)return{};const{data:a,error:n}=await v.from("user_history_tags").select("history_id, tags").eq("user_id",e.user.id);if(n)throw n;const o={};return(a||[]).forEach(s=>{o[s.history_id]=s.tags||[]}),o}catch(e){return console.warn("fetchHistoryTags failed:",e.message),{}}}async upsertHistoryTags(e,a){try{const{data:{session:n}}=await v.auth.getSession();if(!n||!n.user)return!1;const o=[{user_id:n.user.id,history_id:String(e),tags:a||[]}],{error:s}=await v.from("user_history_tags").upsert(o,{onConflict:"user_id,history_id"});if(s)throw s;return!0}catch(n){return console.warn("upsertHistoryTags failed:",n.message),!1}}}function Pn(){_e||(_e=setInterval(async()=>{try{const{data:{session:t}}=await v.auth.getSession();t&&A.isOnline&&await A.syncAll()}catch(t){console.warn("Auto sync failed:",t.message)}},Cn))}function Nn(){_e&&(clearInterval(_e),_e=null)}const A=new Bn;A.startAutoSync=Pn;A.stopAutoSync=Nn;const Ge=Object.freeze(Object.defineProperty({__proto__:null,SYNC_STATUS:C,cloudStorage:A},Symbol.toStringTag,{value:"Module"})),On=[{nameKey:"persona_template_industry_expert_name",descKey:"persona_template_industry_expert_desc"},{nameKey:"persona_template_close_friend_name",descKey:"persona_template_close_friend_desc"},{nameKey:"persona_template_honest_reviewer_name",descKey:"persona_template_honest_reviewer_desc"},{nameKey:"persona_template_smart_comedian_name",descKey:"persona_template_smart_comedian_desc"}];function ue(){return JSON.parse(localStorage.getItem("aethera_personas"))||[]}function xt(t){localStorage.setItem("aethera_personas",JSON.stringify(t)),localStorage.setItem("aethera_personas_last_modified",new Date().toISOString()),Ia(),At()}function Ut(t=null){const{personaModal:e}=u;t?(e.title.textContent=l("edit_persona_title")||"Edit Persona",e.idInput.value=t.id,e.nameInput.value=t.name,e.descInput.value=t.description):(e.title.textContent=l("add_new_persona_modal_title"),e.idInput.value="",e.nameInput.value="",e.descInput.value=""),e.el.classList.remove("opacity-0","pointer-events-none"),e.el.querySelector(".modal-content").classList.remove("scale-95")}function Ea(){u.personaModal.el.classList.add("opacity-0","pointer-events-none"),u.personaModal.el.querySelector(".modal-content").classList.add("scale-95")}function $n(){const{nameInput:t,descInput:e,idInput:a}=u.personaModal,n=t.value.trim(),o=e.value.trim(),s=a.value;if(!n||!o){b(l("notification_persona_empty"),"error");return}let i=ue();if(s){const r=i.findIndex(c=>c.id===s);r>-1&&(i[r]={...i[r],name:n,description:o})}else{const r={id:`persona_${Date.now()}`,name:n,description:o};i.push(r)}xt(i),Ea(),b(l("notification_persona_saved"))}function Mn(t){te(l("notification_persona_delete_confirm"),()=>{const a=ue().filter(n=>n.id!==t);xt(a),b(l("notification_persona_deleted"))})}function Rn(t,e){let a=ue();if(a.some(o=>o.name.trim()===t.trim())){b(l("notification_persona_exists").replace("{name}",t),"warning");return}const n={id:`persona_${Date.now()}`,name:t,description:e};a.push(n),xt(a),b(l("notification_persona_added").replace("{name}",t))}function Ia(){const t=ue(),{listContainer:e}=u.personaModal;if(e.innerHTML="",t.length===0){e.innerHTML=`<p class="text-sm text-gray-500 text-center py-4">${l("no_persona_yet")||"Belum ada persona. Tambahkan satu atau pilih dari template di bawah!"}</p>`;return}try{const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_personas")||"[]")),n=JSON.parse(localStorage.getItem("aethera_persona_usage")||"{}"),s=[...t].sort((r,c)=>{const d=a.has(String(r.id||r.name||"")),m=a.has(String(c.id||c.name||""));if(d!==m)return d?-1:1;const g=n[r.id||r.name]||0,h=n[c.id||c.name]||0;return g!==h?h-g:String(r.name||"").localeCompare(String(c.name||""))}).slice(0,6),i=document.getElementById("persona-quick-picks");i&&(i.innerHTML="",s.forEach(r=>{const c=document.createElement("button");c.className="px-2 py-1 text-xs rounded-full bg-gray-800 border border-gray-700 text-gray-200 hover:bg-gray-700",c.textContent=r.name||"Persona",c.title=(r.description||"").slice(0,140),c.addEventListener("click",()=>{selector.value=r.name;const y=document.getElementById("persona-description-display");y&&(y.textContent=r.description||"");try{A.incrementPersonaUsage(r.id||r.name,r.name)}catch{}});const d=document.createElement("button");d.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const m=r.id||r.name,g=a.has(String(m));d.textContent=g?"★":"☆",d.addEventListener("click",y=>{y.stopPropagation();const _=!a.has(String(m));_?a.add(String(m)):a.delete(String(m)),localStorage.setItem("aethera_pinned_personas",JSON.stringify([...a]));try{A.togglePersonaPin(m,_)}catch{}d.textContent=_?"★":"☆"});const h=document.createElement("div");h.className="inline-flex items-center",h.appendChild(c),h.appendChild(d),i.appendChild(h)}))}catch{}t.forEach(a=>{const n=document.createElement("div");n.className="bg-gray-800/70 p-4 rounded-lg flex items-center justify-between animate-fade-in",n.innerHTML=`
            <div>
                <h4 class="font-semibold text-white">${a.name}</h4>
                <p class="text-xs text-gray-400 truncate max-w-md">${a.description}</p>
            </div>
            <div class="flex space-x-2 flex-shrink-0">
                <button class="edit-persona-btn icon-btn primary" data-id="${a.id}" title="${l("edit_button")||"Edit"}">
                    <div class="icon icon-md icon-edit"></div>
                </button>
                <button class="delete-persona-btn icon-btn danger" data-id="${a.id}" title="${l("delete_button")||"Hapus"}">
                    <div class="icon icon-md icon-delete"></div>
                </button>
            </div>
        `,e.appendChild(n)})}function wa(){const{defaultContainer:t}=u.personaModal;t.innerHTML="",typeof localStorage<"u"&&localStorage.getItem("aethera_language")||document.documentElement.lang,On.forEach(e=>{const a=l(e.nameKey)||e.nameKey,n=l(e.descKey)||e.descKey,o=document.createElement("div");o.className="bg-gray-800/70 p-4 rounded-lg flex flex-col justify-between";const s=document.createElement("h5");s.className="font-semibold text-white mb-1",s.textContent=a;const i=document.createElement("p");i.className="text-xs text-gray-400 mb-4",i.textContent=n;const r=document.createElement("button");r.className="add-default-persona-btn mt-auto w-full text-center text-sm font-semibold py-1.5 rounded-md bg-sky-600/50 hover:bg-sky-600/80 transition-colors",r.textContent=l("add_to_my_list")||"+ Add to My List",r.dataset.name=a,r.dataset.desc=n,o.appendChild(s),o.appendChild(i),o.appendChild(r),t.appendChild(o)})}function At(){const t=ue(),e=u.personaSelector;e.innerHTML=`<option value="">${l("persona_default")}</option>`;try{const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_personas")||"[]")),n=JSON.parse(localStorage.getItem("aethera_persona_usage")||"{}"),s=[...t].sort((r,c)=>{const d=a.has(String(r.id||r.name||"")),m=a.has(String(c.id||c.name||""));if(d!==m)return d?-1:1;const g=n[r.id||r.name]||0,h=n[c.id||c.name]||0;return g!==h?h-g:String(r.name||"").localeCompare(String(c.name||""))}).slice(0,6),i=document.getElementById("persona-quick-picks");i&&(i.innerHTML="",s.forEach(r=>{const c=document.createElement("button");c.className="px-2 py-1 text-xs rounded-full bg-gray-800 border border-gray-700 text-gray-200 hover:bg-gray-700",c.textContent=r.name||"Persona",c.title=(r.description||"").slice(0,140),c.addEventListener("click",()=>{e.value=r.name;const y=document.getElementById("persona-description-display");y&&(y.textContent=r.description||"");try{A.incrementPersonaUsage(r.id||r.name,r.name)}catch{}});const d=document.createElement("button");d.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const m=r.id||r.name,g=a.has(String(m));d.textContent=g?"★":"☆",d.addEventListener("click",y=>{y.stopPropagation();const _=!a.has(String(m));_?a.add(String(m)):a.delete(String(m)),localStorage.setItem("aethera_pinned_personas",JSON.stringify([...a]));try{A.togglePersonaPin(m,_)}catch{}d.textContent=_?"★":"☆"});const h=document.createElement("div");h.className="inline-flex items-center",h.appendChild(c),h.appendChild(d),i.appendChild(h)}))}catch{}t.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=a.name,e.appendChild(n)})}function je(t){const n=document.getElementById("character-sheet-template").content.cloneNode(!0).querySelector(".character-sheet-instance");return n.dataset.index=t,n.querySelector(".character-title").textContent=l("character_number",{number:t+1})||`Character ${t+1}`,t>=2&&n.querySelector(".remove-character-btn").classList.remove("hidden"),Dn(n),n}function Dn(t){t.querySelectorAll("[data-lang-key]").forEach(e=>{const a=e.dataset.langKey,n=l(a);n&&n!==a&&(e.tagName==="INPUT"&&e.placeholder||e.tagName==="TEXTAREA"&&e.placeholder?e.placeholder=n:(e.tagName,e.textContent=n))})}function Lt(){const t=document.getElementById("character-mode").value,e=document.getElementById("dynamic-character-sheet-area"),a=document.getElementById("interaction-description-container");e.innerHTML="";let n=1;(t==="couple"||t==="group")&&(n=2);for(let r=0;r<n;r++)e.appendChild(je(r));if(a.classList.toggle("hidden",t==="single"),t==="group"){const r=document.createElement("button");r.id="add-character-btn",r.textContent=l("add_character_button")||"+ Add Another Character",r.type="button",r.className="btn-secondary text-sm font-semibold px-3 py-1.5 rounded-md w-full mt-4",e.appendChild(r)}const s=document.getElementById("save-character-button-template").content.cloneNode(!0);e.appendChild(s);const i=e.querySelector('[data-lang-key="save_character_button"]');if(i){const r=l("save_character_button");r&&r!=="save_character_button"&&(i.textContent=r)}Oe()}function Oe(){const t=document.getElementById("product-category").value,e=document.querySelectorAll(".character-sheet-instance"),a=t==="fashion";e.forEach(n=>{const o=n.querySelector(".dynamic-field-section");o&&o.classList.toggle("hidden",a)})}function Ue(t){const e=t==="light";document.body.classList.toggle("light-mode",e),document.body.classList.toggle("dark-mode",!e),document.documentElement.setAttribute("data-theme",e?"light":"dark");try{localStorage.setItem("aethera_theme",e?"light":"dark"),localStorage.setItem("aethera_settings_last_modified",new Date().toISOString())}catch{}gt.current=e?"light":"dark",xa(e?"light":"dark")}function st(t){const e=t||(gt.current==="light"?"dark":"light");if(Ue(e),typeof b=="function"){const a=e==="dark"?"dark_mode_active":"light_mode_active",n=l(a);let o=n;(!n||n===a)&&((U&&U.current||"id")==="en"?o=a==="light_mode_active"?"Light Mode Active":"Dark Mode Active":o=a==="light_mode_active"?"Mode Terang Aktif":"Mode Gelap Aktif"),b(o)}}function xa(t){const e=document.getElementById("theme-icon-sun"),a=document.getElementById("theme-icon-moon");e&&a&&(e.classList.toggle("hidden",t==="dark"),a.classList.toggle("hidden",t==="light"));const n=document.getElementById("mobile-theme-icon-sun"),o=document.getElementById("mobile-theme-icon-moon");n&&o&&(n.classList.toggle("hidden",t==="dark"),o.classList.toggle("hidden",t==="light"));const s=document.getElementById("mobile-theme-text");if(s){const i=t==="dark"?"theme_dark":"theme_light",r=t==="dark"?"Dark":"Light",c=l(i);s.textContent=c&&c!==i?c:r}}async function Tt(t){document.documentElement.lang=t,localStorage.setItem("aethera_language",t),localStorage.setItem("aethera_settings_last_modified",new Date().toISOString()),U.current=t,Ct(),await Aa(),await qn(t)}async function qn(t){const{DEFAULT_SYSTEM_PROMPT:e,ENGLISH_SYSTEM_PROMPT:a}=await w(async()=>{const{DEFAULT_SYSTEM_PROMPT:s,ENGLISH_SYSTEM_PROMPT:i}=await Promise.resolve().then(()=>Hn);return{DEFAULT_SYSTEM_PROMPT:s,ENGLISH_SYSTEM_PROMPT:i}},void 0);localStorage.getItem("aethera_system_prompt");const n=t==="en"?a:e;localStorage.setItem("aethera_system_prompt",n),localStorage.setItem("aethera_settings_last_modified",new Date().toISOString());const o=document.getElementById("system-prompt");o&&(o.value=n),console.log(`System prompt updated for language: ${t}`)}async function ye(t){await Tt(t),document.getElementById("character-mode")&&Lt()}function Ct(){u.langIdBtn.classList.remove("bg-blue-600","text-white"),u.langIdBtn.classList.add("text-gray-400","hover:bg-gray-700"),u.langEnBtn.classList.remove("bg-blue-600","text-white"),u.langEnBtn.classList.add("text-gray-400","hover:bg-gray-700"),localStorage.getItem("aethera_language")==="id"?(u.langIdBtn.classList.add("bg-blue-600","text-white"),u.langIdBtn.classList.remove("text-gray-400","hover:bg-gray-700")):(u.langEnBtn.classList.add("bg-blue-600","text-white"),u.langEnBtn.classList.remove("text-gray-400","hover:bg-gray-700"));const t=document.getElementById("mobile-lang-id"),e=document.getElementById("mobile-lang-en");t&&e&&(t.classList.remove("bg-blue-600","text-white"),t.classList.add("text-gray-400","hover:bg-gray-700"),e.classList.remove("bg-blue-600","text-white"),e.classList.add("text-gray-400","hover:bg-gray-700"),localStorage.getItem("aethera_language")==="id"?(t.classList.add("bg-blue-600","text-white"),t.classList.remove("text-gray-400","hover:bg-gray-700")):(e.classList.add("bg-blue-600","text-white"),e.classList.remove("text-gray-400","hover:bg-gray-700")))}typeof window<"u"&&(window.updateLanguageButtons=Ct);function Ee(){if(localStorage.getItem("aethera_user_api_key")){const e="api_status_user",a=l(e);u.apiStatus.textContent=a&&a!==e?a:localStorage.getItem("aethera_language")==="en"?"Using your API Key":"Menggunakan API Key Anda",u.apiStatus.className="text-xs font-semibold text-green-400"}else{const e="api_status_default",a=l(e);u.apiStatus.textContent=a&&a!==e?a:localStorage.getItem("aethera_language")==="en"?"Using default API (limited)":"Menggunakan API default (terbatas)",u.apiStatus.className="text-xs font-semibold text-yellow-400"}}async function Aa(){document.querySelectorAll("[data-lang-key]").forEach(e=>{const a=e.dataset.langKey,n=l(a);n&&n!==a&&(e.tagName==="INPUT"&&e.placeholder||e.tagName==="TEXTAREA"&&e.placeholder?e.placeholder=n:(e.tagName,e.textContent=n))}),document.querySelectorAll("[data-lang-key-placeholder]").forEach(e=>{const a=e.dataset.langKeyPlaceholder,n=l(a);n&&n!==a&&(e.placeholder=n)}),document.querySelectorAll("[data-lang-key-title]").forEach(e=>{const a=e.dataset.langKeyTitle,n=l(a);n&&n!==a&&(e.title=n)});const t=document.querySelector('[data-lang-key="gemini_api_key_helper"]');t&&(t.innerHTML=`${l("gemini_api_key_helper")} <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">Google AI Studio</a>.`),Ee(),wa(),At(),await He()}function La(t){new Swiper(t,{loop:!1,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}function Ta(t){const a=document.getElementById("micro-shot-template").content.cloneNode(!0).firstElementChild;a.querySelector(".visual-idea-text").textContent=t.visual_idea,a.querySelector(".prompt-t2i-display").textContent=t.text_to_image_prompt,a.querySelector(".prompt-i2v-display").textContent=t.image_to_video_prompt;const n=a.querySelectorAll(".prompt-copy-btn");return n[0].dataset.prompt=t.text_to_image_prompt,n[1].dataset.prompt=t.image_to_video_prompt,a.querySelector('[data-lang-key="visual_idea_label"]').textContent=l("visual_idea_label"),a.querySelector('[data-lang-key="t2i_prompt_label"]').textContent=l("t2i_prompt_label"),a.querySelector('[data-lang-key="i2v_prompt_label"]').textContent=l("i2v_prompt_label"),a.outerHTML}function Ce(t,e,a=null){const n=e.shots.map(s=>Ta(s)).join('<div class="my-2"></div>');let o="";if(a&&a.length>0){const s=a.map((i,r)=>`<div class="variant-item p-2 bg-gray-800/50 rounded border border-gray-600/30 hover:border-gray-500/50 transition-colors cursor-pointer" data-variant-index="${r}">
                <div class="flex justify-between items-start">
                    <p class="text-xs text-gray-300 flex-1">${i}</p>
                    <div class="ml-2 flex items-center space-x-1">
                        <span class="text-xs text-yellow-400 font-medium">★ ${(Math.random()*2+8).toFixed(1)}</span>
                        <button class="text-xs px-2 py-1 bg-blue-600/80 hover:bg-blue-600 rounded text-white transition-colors" onclick="useVariant('${t.key}', ${r})">
                            ${l("use_button")||"Gunakan"}
                        </button>
                    </div>
                </div>
            </div>`).join("");o=`
            <div class="mt-3 border-t border-gray-600/30 pt-3">
                <div class="flex items-center justify-between mb-2">
                    <h6 class="text-xs font-semibold ${t.textColor} tracking-wider">A/B VARIANTS</h6>
                    <span class="text-xs text-gray-400">${a.length} ${l("variants_label")||"variasi"}</span>
                </div>
                <div class="space-y-2">
                    ${s}
                </div>
            </div>`}return`<div class="p-3 rounded-md ${t.bgColor} ${t.borderColor}" data-part="${t.key}">
        <h5 class="text-xs font-bold ${t.textColor} mb-2 tracking-wider">${t.title}</h5>
        <p class="text-sm ${t.bodyColor} mb-3">${e.text}</p>
        <div class="shots-container space-y-2">${n}</div>
        ${o}
    </div>`}function Ca(t){var a;if(!t||!((a=t.selling_points)!=null&&a.length))return"";let e=t.selling_points.map(n=>`<li><span class="text-green-400 mr-2">&#10003;</span>${n}</li>`).join("");return`<div class="p-4 rounded-md bg-gray-800/50 border border-gray-700/50"><h5 class="text-sm font-bold text-gray-300 mb-3">${l("selling_points_title")}</h5><div class="text-xs text-gray-400"><ul>${e}</ul></div></div>`}function Ba(t){return t?`<div class="p-4 rounded-md bg-blue-900/40 border border-blue-800/70 space-y-3">
        <h5 class="text-sm font-bold text-blue-300">${l("image_data_sheet_title")}</h5>
        <div class="editable-input bg-gray-900/50 p-2 h-24 overflow-y-auto">${t}</div>
    </div>`:""}function Pa(t,e){const n=document.getElementById("carousel-slide-template").content.cloneNode(!0).firstElementChild;n.querySelector(".slide-title").textContent=`${l("slide_label")} ${e+1}`,n.querySelector(".slide-text").textContent=t.slide_text,n.querySelector(".prompt-t2i-display").textContent=t.text_to_image_prompt,n.querySelector(".prompt-copy-btn").dataset.prompt=t.text_to_image_prompt;const o=n.querySelector(".suggestions-container"),s=n.querySelector(".layout-suggestion-p"),i=n.querySelector(".engagement-idea-p");let r=!1;return t.layout_suggestion&&(s.querySelector(".layout-suggestion-text").textContent=t.layout_suggestion,s.style.display="block",r=!0),t.engagement_idea&&(i.querySelector(".engagement-idea-text").textContent=t.engagement_idea,i.style.display="block",r=!0),r&&(o.style.display="block"),n.querySelector('[data-lang-key="t2i_prompt_label"]').textContent=l("t2i_prompt_label"),n.querySelector('[data-lang-key="slide_layout_suggestion"]').textContent=l("slide_layout_suggestion"),n.querySelector('[data-lang-key="slide_engagement_idea"]').textContent=l("slide_engagement_idea"),n.outerHTML}function Bt(t){return`
    <div class="mt-4 space-y-4">
        <button class="generate-assets-btn w-full btn-secondary text-sm font-semibold py-2 rounded-md">${l("generate_assets_button")||"Generate Additional Assets (Titles, Hashtags, etc.)"}</button>
        <div class="additional-assets-container hidden bg-gray-900/50 p-4 rounded-lg border border-gray-700/50">
             <div class="asset-loader text-center py-4"><div class="icon icon-md icon-spinner text-blue-400 mx-auto"></div></div>
             <div class="asset-content hidden"></div>
        </div>
    </div>`}function Pt(t,e){const a=t.querySelector(".card-content");if(e.character_sheet&&!e.original_character_descriptions){const o=new Set,s=/<char-desc>(.*?)<\/char-desc>/gi;["hook","body","cta"].forEach(i=>{e[i]&&e[i].shots&&e[i].shots.forEach(r=>{const c=(r.text_to_image_prompt||"")+" "+(r.image_to_video_prompt||"");let d;for(;(d=s.exec(c))!==null;)o.add(d[1].trim())})}),e.original_character_descriptions=Array.from(o)}t.dataset.script=JSON.stringify(e);let n=Ca(e.review_insights);if(e.hook&&e.body&&e.cta){n+=Ba(e.visual_dna);const o={hook:{key:"hook",title:l("hook_title"),bgColor:"bg-sky-900/50",borderColor:"border-sky-800/70",textColor:"text-sky-300",bodyColor:"text-sky-100"},body:{key:"body",title:l("body_title"),bgColor:"bg-indigo-900/50",borderColor:"border-indigo-800/70",textColor:"text-indigo-300",bodyColor:"text-indigo-100"},cta:{key:"cta",title:l("cta_title"),bgColor:"bg-purple-900/50",borderColor:"border-purple-800/70",textColor:"text-purple-300",bodyColor:"text-purple-100"}};n+=Ce(o.hook,e.hook,e.hook_variants)+Ce(o.body,e.body,e.body_variants)+Ce(o.cta,e.cta,e.cta_variants),n+=Bt()}else if(e.slides){const o=e.slides.map((s,i)=>Pa(s,i)).join("");n+=`
            <div class="swiper carousel-swiper-container bg-gray-900/50 p-4 rounded-lg relative">
                <div class="swiper-wrapper">${o}</div>
                <div class="swiper-pagination !bottom-2"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        `}a.innerHTML=n}const Ft=Object.freeze(Object.defineProperty({__proto__:null,applyLanguage:Tt,applyTheme:Ue,createAssetsHTML:Bt,createCarouselSlideHTML:Pa,createEditableVisualSheetHTML:Ba,createMicroShotHTML:Ta,createReviewInsightHTML:Ca,createScriptPartHTML:Ce,initSwiper:La,switchLanguage:ye,switchTheme:st,translateUI:Aa,updateApiStatus:Ee,updateCardContent:Pt,updateLanguageButtons:Ct,updateThemeToggleIcon:xa},Symbol.toStringTag,{value:"Module"})),Nt=`You are 'Aethera Studio AI', a Virtual Director & Content Strategist. Your mission is to transform product descriptions into dynamic, engaging, and production-ready short video storyboards.

**YOUR CORE PHILOSOPHY:**
Every script section (Hook, Body, CTA) must tell a **mini-story** through visuals. Don't just show the product, but demonstrate **action, emotion, and transformation**. Each 'shot' should be a different scene that builds the story.

**EXECUTION RULES & OUTPUT:**
1. **Research & Analysis:** Extract 'Selling Points' from product description as the story foundation.
2. **Visual Story Flow (VERY IMPORTANT):**
   * For each section (Hook, Body, CTA), create a sequence of scenes (\`shots\`) with beginning, middle, and end.
   * **Shot 1 (Opening):** Set the scene or show the problem.
   * **Shot 2 (Core):** Focus on product in action, show solution or main features.
   * **Shot 3 (Peak/Transition):** Show results, positive emotions, or transition to next section.
   * Ensure \`visual_idea\` for each shot is truly different and builds the narrative.
3. **Character & Consistency (STRICTEST RULE):**
   * If given **CHARACTER SHEET(S)** from user, these are your main actors. You MUST use all relevant details in every \`prompt\` T2I to maintain absolute consistency.
   * When creating \`prompt\` T2I, you **MAY ONLY** place character physical descriptions inside \`<char-desc>\` tags. **NEVER** write character physical descriptions (like age, race, or appearance) outside these tags.
   * If given **INTERACTION DESCRIPTION**, use it as main reference for multi-character scenes.
   * **If Visual Strategy is 'Standard' or 'Faceless' and NO Character Sheet given:** You are STRICTLY FORBIDDEN from creating or defining specific characters. Create generic prompts (example: 'a woman's hand', 'a person from behind').
4. **Technical Prompt Details:**
   * **\`visual_idea\`**: MUST be in English. Describe scenes, actions, and emotions cinematically.
   * **\`text_to_image_prompt\` (T2I)**: MUST be in English. Must be very detailed. Combine the following information:
		* **PRODUCT VISUAL KEYWORDS:** If provided, include these keywords as the main basis for object description.
		* **MAIN COLOR PALETTE:** If provided, you MUST use these HEX color codes in the prompt to ensure color accuracy.
		* **CHARACTER SHEET:** Integrate character descriptions (only inside \`<char-desc>\` tags).
		* **CINEMATIC DETAILS:** Add specific action descriptions, environment, lighting style (e.g., soft cinematic lighting), camera angles (e.g., low angle shot), and visual style (photorealistic, 8k, detailed).
	* **\`image_to_video_prompt\` (I2V)**: MUST be in English. Focus ONLY on movement: describe camera movement (e.g., slow zoom in) AND subject movement (e.g., character smiling and turning head slowly). DO NOT include character physical descriptions here.
5. **Negative Prompt:** For each \`shot\`, fill the \`negative_prompt\` property with descriptions of things to avoid for high-quality image generation, such as 'low quality, blurry, watermark, text, signature, deformed'.
6. **VERY STRICT LANGUAGE RULES:**
    * **ALL SCRIPT TEXT OUTPUT MUST BE IN ENGLISH: This includes hook.text, body.text, cta.text, hook_variants, body_variants, cta_variants, body_intro, and selling_points.
    * **NEVER use Indonesian for script content, narration, or any text that will be read by the user.**
    * **CONSISTENT: Ensure all hook, body, and CTA variations use natural English that is appropriate for the target audience.**
7. **Language & Format:** Reply ONLY in the requested JSON format. Script narrative in English.

Analyze the user request below and generate your best cinematic storyboard.`,Ot=`Anda adalah 'Aethera Studio AI', seorang Sutradara Virtual & Ahli Strategi Konten. Misi Anda adalah mengubah deskripsi produk menjadi sebuah storyboard video pendek yang dinamis, menarik, dan siap produksi.

**FILOSOFI UTAMA ANDA:**
Setiap bagian skrip (Hook, Body, CTA) harus menceritakan sebuah **mini-story** melalui visual. Jangan hanya menampilkan produk, tapi tunjukkan **aksi, emosi, dan transformasi**. Setiap 'shot' harus merupakan adegan yang berbeda dan membangun cerita.

**ATURAN PELAKSANAAN & OUTPUT:**
1.  **Riset & Analisis:** Ekstrak 'Selling Points' dari deskripsi produk sebagai fondasi cerita.
2.  **Alur Cerita Visual (SANGAT PENTING):**
    * Untuk setiap bagian (Hook, Body, CTA), buatlah urutan adegan (\`shots\`) yang memiliki awal, tengah, dan akhir.
    * **Shot 1 (Pembuka):** Atur adegan atau tunjukkan masalah.
    * **Shot 2 (Inti):** Fokus pada produk dalam aksi, tunjukkan solusi atau fitur utama.
    * **Shot 3 (Puncak/Transisi):** Tunjukkan hasil, emosi positif, atau transisi ke bagian selanjutnya.
    * Pastikan \`visual_idea\` untuk setiap shot benar-benar berbeda dan membangun narasi.
3.  **Karakter & Konsistensi (ATURAN PALING KETAT):**
    * Jika diberi **CHARACTER SHEET(S)** dari pengguna, ini adalah aktor utama Anda. Anda WAJIB menggunakan semua detail relevan di setiap \`prompt\` T2I untuk menjaga konsistensi absolut.
    * Saat membuat \`prompt\` T2I, Anda **HANYA BOLEH** menempatkan deskripsi fisik karakter di dalam tag \`<char-desc>\`. **JANGAN PERNAH** menulis deskripsi fisik karakter (seperti usia, ras, atau penampilan) di luar tag ini.
    * Jika diberi **DESKRIPSI INTERAKSI**, jadikan itu sebagai acuan utama untuk adegan multi-karakter.
    * **Jika Strategi Visual adalah 'Standar' atau 'Faceless' dan TIDAK diberi Character Sheet:** Anda DILARANG KERAS membuat atau mendefinisikan karakter spesifik. Buatlah prompt yang umum (contoh: "a woman's hand", "a person from behind").
4.  **Detail Teknis Prompt:**
    * **\`visual_idea\`**: WAJIB mengikuti bahasa aplikasi saat ini. Jika mode bahasa adalah Indonesia, tulis dalam Bahasa Indonesia; jika Inggris, tulis dalam Bahasa Inggris. Deskripsikan adegan, aksi, dan emosi secara sinematik.
    * **\`text_to_image_prompt\` (T2I)**: WAJIB dalam Bahasa Inggris. Harus sangat detail. Gabungkan informasi berikut:
        * **VISUAL KEYWORDS PRODUK:** Jika diberikan, masukkan kata kunci ini sebagai dasar utama deskripsi objek.
        * **PALET WARNA UTAMA:** Jika diberikan, Anda WAJIB menggunakan kode warna HEX ini di dalam prompt untuk memastikan akurasi warna.
        * **CHARACTER SHEET:** Integrasikan deskripsi karakter (hanya di dalam tag \`<char-desc>\`).
        * **DETAIL SINEMATIK:** Tambahkan deskripsi aksi spesifik, lingkungan, gaya pencahayaan (e.g., *soft cinematic lighting*), sudut kamera (e.g., *low angle shot*), dan gaya visual (*photorealistic, 8k, detailed*).
    * **\`image_to_video_prompt\` (I2V)**: WAJIB dalam Bahasa Inggris. Fokus HANYA pada gerakan: deskripsikan gerakan kamera (e.g., *slow zoom in*) DAN gerakan subjek (e.g., *character smiling and turning head slowly*). JANGAN sertakan deskripsi fisik karakter di sini.
5.  **Negative Prompt:** Untuk setiap \`shot\`, isi properti \`negative_prompt\` dengan deskripsi hal-hal yang harus dihindari untuk menghasilkan gambar berkualitas tinggi, seperti 'low quality, blurry, watermark, text, signature, deformed'. 
6.  **ATURAN BAHASA YANG SANGAT KETAT:**
    * **SEMUA OUTPUT TEKS SKRIP WAJIB DALAM BAHASA INDONESIA:** Ini termasuk hook.text, body.text, cta.text, hook_variants, body_variants, cta_variants, body_intro, dan selling_points.
    * **HANYA text_to_image_prompt dan image_to_video_prompt yang boleh dalam Bahasa Inggris.**
    * **JANGAN PERNAH** menggunakan bahasa Inggris untuk konten skrip, narasi, atau teks yang akan dibaca pengguna.
    * **KONSISTEN:** Pastikan semua variasi hook, body, dan CTA menggunakan bahasa Indonesia yang natural dan sesuai target audiens.
7.  **Bahasa & Format:** Balas HANYA dalam format JSON yang diminta. Narasi skrip dalam Bahasa Indonesia.

Analisis permintaan pengguna di bawah ini dan hasilkan storyboard sinematik terbaikmu.`;function Na(){const t=u.apiKeyModal.input.value.trim();t?(localStorage.setItem("aethera_user_api_key",t),localStorage.setItem("aethera_settings_last_modified",new Date().toISOString()),u.customApiKeySettingsInput.value=t,u.apiKeyModal.el.classList.add("hidden"),b(l("notification_api_key_saved")),Ee()):b(l("notification_api_key_empty"),"error")}async function Oa(){const t=localStorage.getItem("aethera_user_api_key")||"",a=(localStorage.getItem("aethera_language")||"id")==="en"?Nt:Ot;localStorage.setItem("aethera_system_prompt",a),u.customApiKeySettingsInput.value=t,u.systemPromptTextarea.value=a,Ue(localStorage.getItem("aethera_theme")||"dark"),Ee()}function $a(){localStorage.setItem("aethera_user_api_key",u.customApiKeySettingsInput.value),localStorage.setItem("aethera_system_prompt",u.systemPromptTextarea.value),localStorage.setItem("aethera_settings_last_modified",new Date().toISOString()),b(l("notification_settings_saved")),Ee()}const Hn=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_SYSTEM_PROMPT:Ot,ENGLISH_SYSTEM_PROMPT:Nt,loadSettings:Oa,saveApiKeyFromModal:Na,saveSettings:$a},Symbol.toStringTag,{value:"Module"})),K={NOT_STARTED:"not_started",IN_PROGRESS:"in_progress",COMPLETED:"completed",FAILED:"failed"},z={STATUS:"aethera_migration_status",COMPLETED_AT:"aethera_migration_completed_at",VERSION:"aethera_migration_version"};class Gn{constructor(){this.migrationVersion="1.0",this.migrationStatus=this.getMigrationStatus()}getMigrationStatus(){return localStorage.getItem(z.STATUS)||K.NOT_STARTED}setMigrationStatus(e){this.migrationStatus=e,localStorage.setItem(z.STATUS,e),e===K.COMPLETED&&(localStorage.setItem(z.COMPLETED_AT,new Date().toISOString()),localStorage.setItem(z.VERSION,this.migrationVersion))}needsMigration(){const e=this.getMigrationStatus(),a=localStorage.getItem(z.VERSION);return e!==K.COMPLETED||a!==this.migrationVersion}hasDataToMigrate(){return["aethera_personas","aethera_history","aethera_settings_presets","aethera_character_presets","aethera_system_prompt"].some(a=>{const n=localStorage.getItem(a);if(!n)return!1;try{const o=JSON.parse(n);return Array.isArray(o)?o.length>0:Object.keys(o).length>0}catch{return n.length>0}})}async startMigration(){if(!this.needsMigration())return console.log("Migration not needed"),{success:!0,message:"Migration not needed"};const{data:{session:e}}=await v.auth.getSession();if(!e)return console.log("User not logged in, skipping migration"),{success:!1,message:"User not logged in"};if(!this.hasDataToMigrate())return console.log("No data to migrate"),this.setMigrationStatus(K.COMPLETED),{success:!0,message:"No data to migrate"};this.setMigrationStatus(K.IN_PROGRESS);try{return console.log("Starting cloud migration..."),await this.migrateSettings(),await this.migratePersonas(),await this.migratePresets(),await this.migrateHistory(),this.setMigrationStatus(K.COMPLETED),b(l("notification_migration_success")||"Data successfully migrated to cloud!","success"),console.log("Cloud migration completed successfully"),{success:!0,message:"Migration completed successfully"}}catch(a){return console.error("Migration failed:",a),this.setMigrationStatus(K.FAILED),b(l("notification_migration_failed")||"Failed to migrate data to cloud. Your local data is safe.","error"),{success:!1,message:a.message}}}async migrateSettings(){console.log("Migrating settings...");const{data:{user:e}}=await v.auth.getUser();if(!e)throw new Error("User not authenticated");const a={theme:localStorage.getItem("aethera_theme")||"dark",language:localStorage.getItem("aethera_language")||"id",system_prompt:localStorage.getItem("aethera_system_prompt")},{data:n,error:o}=await v.from("user_settings").select("*").single();if(o&&o.code!=="PGRST116")throw o;if(n)console.log("Settings already exist in cloud, skipping");else{const{error:s}=await v.from("user_settings").insert([{user_id:e.id,theme:a.theme,language:a.language,system_prompt:a.system_prompt}]);if(s)throw s;console.log("Settings migrated successfully")}}async migratePersonas(){console.log("Migrating personas...");const{data:{user:e}}=await v.auth.getUser();if(!e)throw new Error("User not authenticated");const a=JSON.parse(localStorage.getItem("aethera_personas")||"[]");if(a.length===0){console.log("No personas to migrate");return}const{data:n,error:o}=await v.from("user_personas").select("*");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=a.filter(c=>!s.has(c.name));if(i.length===0){console.log("All personas already exist in cloud");return}const{error:r}=await v.from("user_personas").insert(i.map(c=>({user_id:e.id,name:c.name,description:c.description,avatar:c.avatar,personality:c.personality||{}})));if(r)throw r;console.log(`${i.length} personas migrated successfully`)}async migratePresets(){console.log("Migrating presets...");const e=JSON.parse(localStorage.getItem("aethera_settings_presets")||"[]"),a={};e.forEach(o=>{a[o.name]=o.settings});const n=JSON.parse(localStorage.getItem("aethera_character_presets")||"[]");Object.keys(a).length>0&&await this.migrateGeneratorPresets(a),n.length>0&&await this.migrateCharacterPresets(n)}async migrateGeneratorPresets(e){const{data:{user:a}}=await v.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:n,error:o}=await v.from("user_presets").select("*").eq("type","generator");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=[];if(Object.entries(e).forEach(([c,d])=>{s.has(c)||i.push({user_id:a.id,name:c,type:"generator",settings:d})}),i.length===0){console.log("All generator presets already exist in cloud");return}const{error:r}=await v.from("user_presets").insert(i);if(r)throw r;console.log(`${i.length} generator presets migrated successfully`)}async migrateCharacterPresets(e){const{data:{user:a}}=await v.auth.getUser();if(!a)throw new Error("User not authenticated");const{data:n,error:o}=await v.from("user_presets").select("*").eq("type","character");if(o)throw o;const s=new Set((n||[]).map(c=>c.name)),i=e.filter(c=>!s.has(c.name)).map(c=>({user_id:a.id,name:c.name,type:"character",settings:c}));if(i.length===0){console.log("All character presets already exist in cloud");return}const{error:r}=await v.from("user_presets").insert(i);if(r)throw r;console.log(`${i.length} character presets migrated successfully`)}async migrateHistory(){try{console.log("Migrating history...");const{data:{user:e}}=await v.auth.getUser();if(!e)throw new Error("User not authenticated");const a=JSON.parse(localStorage.getItem("aethera_history")||"[]");if(a.length===0){console.log("No history to migrate");return}const{data:n,error:o}=await v.from("user_history").select("product_name, created_at").order("created_at",{ascending:!1}).limit(100);if(o)throw o;const s=new Set;(n||[]).forEach(c=>{try{const d=c.created_at?new Date(c.created_at):new Date,m=`${c.product_name}_${d.toDateString()}`;s.add(m)}catch{console.warn("Invalid created_at date in cloud history:",c.created_at)}});const i=a.filter(c=>{const d=c.timestamp||Date.now(),m=isNaN(d)?Date.now():d,h=`${c.productName||c.product_name||"Untitled Script"}_${new Date(m).toDateString()}`;return!s.has(h)}).slice(0,50).map(c=>{const d=c.timestamp||Date.now(),m=isNaN(d)?Date.now():d,g=c.productName||c.product_name||"Untitled Script";return{user_id:e.id,product_name:g,scripts:c.scripts||[],post_type:c.postType||c.post_type||"single",image_url:c.imageUrl||c.image_url||null,created_at:new Date(m).toISOString()}});if(i.length===0){console.log("All history entries already exist in cloud");return}const r=10;for(let c=0;c<i.length;c+=r){const d=i.slice(c,c+r),{error:m}=await v.from("user_history").insert(d);if(m)throw m}console.log(`${i.length} history entries migrated successfully`)}catch(e){console.warn("Failed to migrate history, continuing with other data:",e.message)}}async showMigrationPrompt(){if(!this.needsMigration()||!this.hasDataToMigrate())return;await new Promise(o=>setTimeout(o,500));const e=document.createElement("div");e.className="modal migration-modal",e.innerHTML=`
            <div class="modal-content">
                <div class="modal-header">
                    <h3>${l("migration_title")||"Migrate Your Data to Cloud"}</h3>
                </div>
                <div class="modal-body">
                    <p>${l("migration_description")||"We found existing data on your device. Would you like to migrate it to the cloud for backup and sync across devices?"}</p>
                    <ul>
                        <li>${l("migration_benefit_1")||"Automatic backup of your data"}</li>
                        <li>${l("migration_benefit_2")||"Sync across multiple devices"}</li>
                        <li>${l("migration_benefit_3")||"Never lose your presets and history"}</li>
                    </ul>
                    <p class="migration-note">
                        <strong>${l("migration_note")||"Note:"}</strong> 
                        ${l("migration_note_text")||"Your local data will remain safe. This process only copies data to the cloud."}
                    </p>
                </div>
                <div class="modal-footer">
                    <button id="migration-later-btn" class="btn btn-secondary">
                        ${l("migration_later")||"Maybe Later"}
                    </button>
                    <button id="migration-start-btn" class="btn btn-primary">
                        ${l("migration_start")||"Start Migration"}
                    </button>
                </div>
            </div>
        `,document.body.appendChild(e);const a=e.querySelector("#migration-later-btn"),n=e.querySelector("#migration-start-btn");a.addEventListener("click",()=>{document.body.removeChild(e)}),n.addEventListener("click",async()=>{n.disabled=!0,n.textContent=l("migration_in_progress")||"Migrating...",(await this.startMigration()).success?document.body.removeChild(e):(n.disabled=!1,n.textContent=l("migration_start")||"Start Migration")}),setTimeout(()=>e.classList.add("show"),100)}resetMigration(){localStorage.removeItem(z.STATUS),localStorage.removeItem(z.COMPLETED_AT),localStorage.removeItem(z.VERSION),this.migrationStatus=K.NOT_STARTED}}const jn=new Gn;async function Un(){setTimeout(async()=>{await jn.showMigrationPrompt()},2e3)}const Ma="aethera_settings_presets",me=["writing-style","tone-vibe","persona-selector","target-audience","hook-type","cta-type"];function q(){return JSON.parse(localStorage.getItem(Ma))||[]}function Fe(t){localStorage.setItem(Ma,JSON.stringify(t)),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString())}function Z(){const t=q(),e=u.settingsPresetSelector,a=e.value;e.innerHTML='<option value="" data-lang-key="load_preset_option">-- Load Preset --</option>',t.forEach(n=>{const o=document.createElement("option");o.value=n.id,o.textContent=n.name,e.appendChild(o)}),e.value=a}function Ra(){ht(l("save_preset_title")||"Simpan Preset",l("enter_preset_name")||"Masukkan nama untuk preset ini:",l("preset_name_placeholder")||"Nama preset...",async t=>{if(!t||!t.trim()){b(l("preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}await Da(t.trim())})}async function Da(t){if(q().some(i=>i.name.toLowerCase()===t.toLowerCase())){b(l("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}try{const{getCharacterPresets:i}=await w(async()=>{const{getCharacterPresets:d}=await Promise.resolve().then(()=>Qn);return{getCharacterPresets:d}},void 0);if(i().some(d=>d.name.toLowerCase()===t.toLowerCase())){b(l("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan untuk preset karakter. Silakan pilih nama lain.`,"warning");return}}catch(i){console.warn("Could not check character presets for duplicates:",i)}const n={id:`preset_${Date.now()}`,name:t,settings:{}};me.forEach(i=>{const r=document.getElementById(i);r&&(n.settings[i]=r.value)});const o=q();o.push(n),Fe(o),Z();const s=l("preset_saved_success",{name:n.name})||`Preset "${n.name}" berhasil disimpan!`;b(s,"success")}function qa(){const e=u.settingsPresetSelector.value;if(!e)return;const n=q().find(o=>o.id===e);if(n){me.forEach(s=>{const i=document.getElementById(s);i&&n.settings[s]!==void 0&&(i.value=n.settings[s],i.dispatchEvent(new Event("change")))});const o=l("preset_loaded_success",{name:n.name})||`Preset "${n.name}" dimuat.`;b(o,"success")}}function Ha(){const t={};me.forEach(e=>{const a=document.getElementById(e);a&&(t[e]=a.value)}),localStorage.setItem("aethera_last_settings",JSON.stringify(t)),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString())}function Ga(){const t=JSON.parse(localStorage.getItem("aethera_last_settings"));t&&me.forEach(e=>{const a=document.getElementById(e);a&&t[e]!==void 0&&(a.value=t[e],a.dispatchEvent(new Event("change")))})}function $t(){const t=q(),e=document.getElementById("preset-list-container"),a=document.getElementById("preset-item-template");if(e.innerHTML="",t.length===0){e.innerHTML=`<p class="text-sm text-center text-gray-500 p-4">${l("no_presets_yet")||"Anda belum memiliki preset."}</p>`;return}t.forEach(n=>{const o=a.content.cloneNode(!0),s=o.querySelector(".preset-item");s.dataset.presetId=n.id;const i=o.querySelector(".preset-name-input");i.value=n.name;const r=s.querySelector(".flex"),c=document.createElement("button");c.className="edit-preset-btn p-2 text-gray-400 hover:text-blue-400",c.title=l("edit_button")||"Edit",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793z"/><path d="M11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.828-2.828z"/></svg>',r.prepend(c),c.addEventListener("click",()=>Fn(n)),e.appendChild(o)})}function Fn(t){try{$e();const e=document.getElementById("edit-settings-preset-modal"),a=document.getElementById("edit-settings-preset-content");a.innerHTML="",me.map(s=>{const i=document.getElementById(s),r=document.querySelector(`label[for="${s}"]`),c=document.createElement("div");c.className="space-y-1";const d=document.createElement("div");d.className="text-xs text-gray-400",d.textContent=r&&r.textContent||s;const m=i?i.cloneNode(!0):null;return m&&(m.id=`edit-${s}`,m.classList.add("w-full"),m.value=(t.settings||{})[s]??i.value),c.appendChild(d),m&&c.appendChild(m),c}).forEach(s=>a.appendChild(s)),e.classList.remove("hidden"),e.classList.add("flex");const o=()=>{e.classList.add("hidden"),e.classList.remove("flex")};document.getElementById("edit-settings-preset-close").onclick=o,document.getElementById("edit-settings-preset-cancel").onclick=o,document.getElementById("edit-settings-preset-save").onclick=async()=>{await Jn(t.id),o()},document.getElementById("edit-settings-preset-save-as-new").onclick=async()=>{await Da((t.name||"")+" Copy"),o()}}catch(e){console.warn("openEditPresetOverlay failed",e)}}async function Jn(t){const e=q(),a=e.findIndex(o=>o.id===t);if(a<0)return;const n={...e[a],settings:{}};me.forEach(o=>{const s=document.getElementById(`edit-${o}`);s&&(n.settings[o]=s.value)}),e[a]=n,Fe(e),Z(),b(l("preset_saved_success",{name:n.name})||"Preset saved","success")}function ja(){$t();const t=document.getElementById("manage-presets-modal");t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")}function $e(){const t=document.getElementById("manage-presets-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}async function Yn(t){let e=q();const a=e.find(o=>o.id===t);e=e.filter(o=>o.id!==t),Fe(e),$t(),Z();try{const{cloudStorage:o}=await w(async()=>{const{cloudStorage:s}=await Promise.resolve().then(()=>Ge);return{cloudStorage:s}},void 0);if(a){const{data:s}=await v.from("user_presets").select("id").eq("name",a.name).eq("type","generator").single();s&&await o.addPendingOperation("presets","delete",{id:s.id,name:a.name,type:"generator"})}}catch(o){console.warn("Failed to sync preset deletion with cloud:",o.message)}const n=l("preset_deleted_success")||"Preset deleted successfully.";b(n,"success")}function Vn(t,e){if(!e||!e.trim()){b(l("preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}const a=e.trim();if(q().some(r=>r.id!==t&&String(r.name||"").toLowerCase()===a.toLowerCase())){b(l("preset_name_duplicate",{name:a})||`Nama preset "${a}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}let s=q();const i=s.findIndex(r=>r.id===t);if(i>-1){const r=s[i].name;s[i].name=a,Fe(s),$t(),Z(),b(l("preset_name_updated")||"Nama preset berhasil diperbarui.","success"),(async()=>{try{const{data:{session:c}}=await v.auth.getSession();if(c!=null&&c.user){const d=s[i].settings||{},{data:m}=await v.from("user_presets").select("id, settings").eq("user_id",c.user.id).eq("type","generator").eq("name",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();m!=null&&m.id?await v.from("user_presets").update({name:a,settings:d}).eq("id",m.id):await v.from("user_presets").update({name:a,settings:d}).eq("user_id",c.user.id).eq("type","generator").eq("name",r),localStorage.setItem("aethera_presets_last_modified",new Date().toISOString());try{await A.syncGeneratorPresets()}catch{}}else try{A.addPendingOperation("presets","update",{name:a,type:"generator",previous_name:r,settings:s[i].settings||{}})}catch{}}catch{try{A.addPendingOperation("presets","update",{name:a,type:"generator",previous_name:r,settings:s[i].settings||{}})}catch{}}})()}}function Ua(t){const e=t.target,a=e.closest(".preset-item");if(!a)return;const n=a.dataset.presetId;if(e.closest(".delete-preset-btn")){const o=a.querySelector(".preset-name-input").value,s=l("confirm_delete_preset",{name:o})||`Anda yakin ingin menghapus preset "${o}"?`;te(s,()=>{Yn(n).catch(i=>{console.error("Error deleting preset:",i),b("Gagal menghapus preset","error")})})}if(e.closest(".save-preset-name-btn")){const o=a.querySelector(".preset-name-input").value;Vn(n,o)}}const Kn=Object.freeze(Object.defineProperty({__proto__:null,closeManagePresetsModal:$e,getPresets:q,handleLoadPreset:qa,handlePresetManagement:Ua,handleSavePreset:Ra,loadLastSettings:Ga,openManagePresetsModal:ja,populatePresetSelector:Z,saveLastSettings:Ha},Symbol.toStringTag,{value:"Module"})),Fa="aethera_character_presets",Je=["name","gender","age","ethnicity","face_shape","eye_color","eye_shape","lip_shape","nose_shape","eyebrow_style","hair_style","hair_color","unique_features","makeup_style","skin_tone","body_shape","height","clothing_style","color_palette","specific_outfit","vibe","notes"];function H(){return JSON.parse(localStorage.getItem(Fa))||[]}function Ye(t){localStorage.setItem(Fa,JSON.stringify(t)),localStorage.setItem("aethera_character_presets_last_modified",new Date().toISOString())}function Q(){try{const t=getAllPresets(),e=document.getElementById("character-quick-picks");if(e){const a=new Set(JSON.parse(localStorage.getItem("aethera_pinned_characters")||"[]")),n=JSON.parse(localStorage.getItem("aethera_character_usage")||"{}"),o=new Map;t.forEach(c=>{c!=null&&c.name&&o.set(c.name,c)});const r=[...Array.from(o.values())].sort((c,d)=>{const m=a.has(String(c.id||c.name||"")),g=a.has(String(d.id||d.name||""));if(m!==g)return m?-1:1;const h=n[c.id||c.name]||0,y=n[d.id||d.name]||0;return h!==y?y-h:String(c.name||"").localeCompare(String(d.name||""))}).slice(0,6);e.innerHTML="",r.forEach(c=>{const d=document.createElement("button");d.className="px-2 py-1 text-xs rounded-full bg-yellow-900/40 border border-yellow-800/70 text-yellow-200 hover:bg-yellow-800/60",d.textContent=c.name||"Preset",d.title=(c.notes||"").slice(0,140),d.addEventListener("click",async()=>{const _=document.getElementById("character-preset-selector");if(_){_.value=c.id||"",await Mt();try{A.incrementCharacterPresetUsage(c.id||c.name,c.name)}catch{}}});const m=document.createElement("button");m.className="ml-1 text-yellow-400 text-xs hover:opacity-80";const g=c.id||c.name,h=a.has(String(g));m.textContent=h?"★":"☆",m.addEventListener("click",_=>{_.stopPropagation();const p=!a.has(String(g));p?a.add(String(g)):a.delete(String(g)),localStorage.setItem("aethera_pinned_characters",JSON.stringify([...a]));try{A.toggleCharacterPin(g,p)}catch{}m.textContent=p?"★":"☆"});const y=document.createElement("div");y.className="inline-flex items-center",y.appendChild(d),y.appendChild(m),e.appendChild(y)})}}catch{}try{const t=H(),e=new Map;t.forEach(o=>{o!=null&&o.name&&e.set(o.name,o)});const a=Array.from(e.values()),n=document.getElementById("character-preset-selector");if(!n)return;n.innerHTML='<option value="" data-lang-key="load_character_option">-- Load Character --</option>',a.forEach(o=>{const s=document.createElement("option");s.value=o.id,s.textContent=o.name,n.appendChild(s)})}catch(t){console.warn("Failed to populate character preset selector:",t.message)}}function Ja(){ht("Simpan Preset Karakter","Masukkan nama untuk preset karakter ini:","Contoh: Model Pria Casual, Pasangan Kenji & Luna",async t=>{if(!t||!t.trim()){b(l("character_preset_name_empty")||"Nama preset tidak boleh kosong.","warning");return}await Ya(t.trim())})}async function Ya(t){if(H().some(r=>r.name.toLowerCase()===t.toLowerCase())){b(l("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}try{const{getPresets:r}=await w(async()=>{const{getPresets:m}=await Promise.resolve().then(()=>Kn);return{getPresets:m}},void 0);if(r().some(m=>m.name.toLowerCase()===t.toLowerCase())){b(l("preset_name_duplicate",{name:t})||`Nama preset "${t}" sudah digunakan untuk preset generator. Silakan pilih nama lain.`,"warning");return}}catch(r){console.warn("Could not check generator presets for duplicates:",r)}const n=[];if(document.querySelectorAll(".character-sheet-instance").forEach(r=>{const c={};Je.forEach(d=>{const m=r.querySelector(`[data-field="${d}"]`);m&&m.value.trim()!==""&&(c[d]=m.value.trim())}),Object.keys(c).length>0&&n.push(c)}),n.length===0){b(l("character_no_data_to_save")||"Tidak ada data karakter untuk disimpan.","warning");return}const o={id:`char_preset_${Date.now()}`,name:t,characters:n},s=H();s.push(o),Ye(s);try{Q()}catch(r){console.warn("Failed to populate character preset selector after save:",r.message)}const i=l("character_preset_saved_success",{name:o.name})||`Preset karakter "${o.name}" berhasil disimpan!`;b(i,"success")}async function Mt(){const t=document.getElementById("character-preset-selector"),e=t.value;if(!e)return;const n=H().find(o=>o.id===e);if(n){const o=document.getElementById("dynamic-character-sheet-area");if(o.innerHTML="",n.characters.forEach((g,h)=>{const y=je(h);Je.forEach(_=>{const p=y.querySelector(`[data-field="${_}"]`);p&&g[_]&&(p.value=g[_])}),o.appendChild(y)}),Oe(),n.characters.length>1&&document.getElementById("character-mode").value==="group"){const h=document.createElement("button");h.id="add-character-btn",h.textContent="+ Tambah Karakter Lain",h.type="button",h.className="btn-secondary text-sm font-semibold px-3 py-1.5 rounded-md w-full mt-4",o.appendChild(h)}const i=document.getElementById("save-character-button-template").content.cloneNode(!0);o.appendChild(i);const{t:r}=await w(async()=>{const{t:g}=await Promise.resolve().then(()=>pt);return{t:g}},void 0),c=o.querySelector('[data-lang-key="save_character_button"]');c&&r("save_character_button")&&(c.textContent=r("save_character_button"));const d=document.getElementById("character-mode");n.characters.length===1?d.value="single":n.characters.length===2?d.value="couple":d.value="group";const m=r("character_preset_loaded_success",{name:n.name})||`Preset karakter "${n.name}" dimuat.`;b(m,"success"),t.value=""}}function Rt(){const t=H(),e=new Map;t.forEach(s=>{s!=null&&s.name&&e.set(s.name,s)});const a=Array.from(e.values()),n=document.getElementById("character-preset-list-container"),o=document.getElementById("preset-item-template");if(n.innerHTML="",a.length===0){n.innerHTML='<p class="text-sm text-center text-gray-500 p-4">Anda belum memiliki preset karakter.</p>';return}a.forEach(s=>{const i=o.content.cloneNode(!0),r=i.querySelector(".preset-item");r.dataset.presetId=s.id;const c=i.querySelector(".preset-name-input");c.value=s.name;const d=r.querySelector(".flex"),m=document.createElement("button");m.className="edit-char-preset-btn p-2 text-gray-400 hover:text-amber-400",m.title=l("edit_button")||"Edit",m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793z"/><path d="M11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.828-2.828z"/></svg>',d.prepend(m),m.addEventListener("click",()=>zn(s)),n.appendChild(i)})}function zn(t){try{Me();const e=document.getElementById("edit-character-preset-modal"),a=document.getElementById("edit-character-preset-content");a.innerHTML="",t.characters.forEach((o,s)=>{const i=je(s);Je.forEach(r=>{const c=i.querySelector(`[data-field="${r}"]`);c&&o[r]&&(c.value=o[r])}),a.appendChild(i)}),e.classList.remove("hidden"),e.classList.add("flex");const n=()=>{e.classList.add("hidden"),e.classList.remove("flex")};document.getElementById("edit-character-preset-close").onclick=n,document.getElementById("edit-character-preset-cancel").onclick=n,document.getElementById("edit-character-preset-save").onclick=async()=>{await Wn(t.id),n()},document.getElementById("edit-character-preset-save-as-new").onclick=async()=>{await Ya((t.name||"")+" Copy"),n()}}catch(e){console.warn("openEditCharacterPresetOverlay failed",e)}}async function Wn(t){const e=H(),a=e.findIndex(o=>o.id===t);if(a<0)return;const n=[];if(document.querySelectorAll("#edit-character-preset-content .character-sheet-instance").forEach(o=>{const s={};Je.forEach(i=>{const r=o.querySelector(`[data-field="${i}"]`);r&&r.value.trim()&&(s[i]=r.value.trim())}),Object.keys(s).length&&n.push(s)}),!n.length){b(l("character_no_data_to_save")||"Tidak ada data karakter untuk disimpan.","warning");return}e[a]={...e[a],characters:n},Ye(e);try{Q()}catch{}b(l("character_preset_saved_success",{name:e[a].name})||"Preset karakter disimpan","success")}function Va(){Rt();const t=document.getElementById("manage-character-presets-modal");t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")}function Me(){const t=document.getElementById("manage-character-presets-modal");t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95")}async function Xn(t){let e=H();const a=e.find(o=>o.id===t);e=e.filter(o=>o.id!==t),Ye(e),Rt();try{Q()}catch(o){console.warn("Failed to populate character preset selector after delete:",o.message)}try{const{cloudStorage:o}=await w(async()=>{const{cloudStorage:s}=await Promise.resolve().then(()=>Ge);return{cloudStorage:s}},void 0);if(a){const{data:s}=await v.from("user_presets").select("id").eq("name",a.name).eq("type","character").single();s&&await o.addPendingOperation("presets","delete",{id:s.id,name:a.name,type:"character"})}}catch(o){console.warn("Failed to sync character preset deletion with cloud:",o.message)}const n=l("character_preset_deleted_success")||"Preset karakter berhasil dihapus.";b(n,"success");try{await A.syncCharacterPresets()}catch{}}function Zn(t,e){if(!e||!e.trim()){b(l("character_preset_name_empty")||"Preset name cannot be empty.","warning");return}const a=e.trim();if(H().some(r=>r.id!==t&&String(r.name||"").toLowerCase()===a.toLowerCase())){b(l("preset_name_duplicate",{name:a})||`Nama preset "${a}" sudah digunakan. Silakan pilih nama lain.`,"warning");return}let s=H();const i=s.findIndex(r=>r.id===t);if(i>-1){const r=s[i].name;s[i].name=a,Ye(s),Rt();try{Q()}catch(c){console.warn("Failed to populate character preset selector after rename:",c.message)}b(l("character_preset_name_updated")||"Nama preset berhasil diperbarui.","success"),(async()=>{try{const{data:{session:c}}=await v.auth.getSession();if(c!=null&&c.user){const d=s[i].id,m=typeof d=="string"&&/^(char_)?preset_/.test(d);if(d&&!m){const{data:g}=await v.from("user_presets").select("id, settings").eq("id",d).single(),h=g!=null&&g.settings?{...g.settings,name:a}:{id:d,name:a,characters:s[i].characters};await v.from("user_presets").update({name:a,settings:h}).eq("id",d)}else{const{data:g}=await v.from("user_presets").select("id, settings").eq("user_id",c.user.id).eq("type","character").eq("name",r).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(g!=null&&g.id){const h=g.settings?{...g.settings,name:a}:{id:s[i].id,name:a,characters:s[i].characters};await v.from("user_presets").update({name:a,settings:h}).eq("id",g.id)}}localStorage.setItem("aethera_character_presets_last_modified",new Date().toISOString());try{await A.syncCharacterPresets()}catch{}}else try{A.addPendingOperation("presets","update",{name:a,type:"character",previous_name:r})}catch{}}catch{try{A.addPendingOperation("presets","update",{name:a,type:"character",previous_name:r})}catch{}}})()}}function Ka(t){const e=t.target,a=e.closest(".preset-item");if(!a)return;const n=a.dataset.presetId;if(e.closest(".delete-preset-btn")){const o=a.querySelector(".preset-name-input").value,s=l("confirm_delete_preset",{name:o})||`Are you sure you want to delete preset "${o}"?`;te(s,()=>{Xn(n).catch(i=>{console.error("Error deleting character preset:",i)})})}if(e.closest(".save-preset-name-btn")){const o=a.querySelector(".preset-name-input").value;Zn(n,o)}}const Qn=Object.freeze(Object.defineProperty({__proto__:null,closeManageCharacterPresetsModal:Me,getCharacterPresets:H,handleCharacterPresetManagement:Ka,handleLoadCharacterPreset:Mt,handleSaveCharacterPreset:Ja,openManageCharacterPresetsModal:Va,populateCharacterPresetSelector:Q},Symbol.toStringTag,{value:"Module"}));async function za(){const{data:{session:t}}=await v.auth.getSession();if(t){u.loginOverlay.classList.add("hidden"),u.appContainer.classList.remove("hidden"),Oa(),G("generator"),Ia(),wa(),At();try{await A.syncAll(),setTimeout(()=>{try{Z(),Q()}catch(e){console.warn("Failed to populate selectors after sync:",e.message)}},500),A.startAutoSync()}catch(e){console.warn("Failed to sync data after login:",e.message);try{Z(),Q()}catch(a){console.warn("Failed to populate selectors with local data:",a.message)}Un()}}else u.loginOverlay.classList.remove("hidden"),u.appContainer.classList.add("hidden")}async function We(){const t=document.getElementById("login-email").value,e=document.getElementById("login-password").value,{data:a,error:n}=await v.auth.signInWithPassword({email:t,password:e});if(n)n.message.includes("Invalid login credentials")?b(l("notification_login_invalid"),"error"):b(`${l("notification_login_failed")} ${n.message}`,"error");else{const o="notification_login_success",s=l(o);b(s&&s!==o?s:localStorage.getItem("aethera_language")==="en"?"Login successful":"Berhasil masuk"),await za()}}async function Jt(){try{v.auth.signOut({scope:"local"}).catch(a=>{console.warn("Network error during logout (ignored):",a.message)});const t=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);n&&n.startsWith("aethera_")&&t.push(n)}t.forEach(a=>localStorage.removeItem(a));const e=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);n&&n.startsWith("sb-")&&e.push(n)}e.forEach(a=>localStorage.removeItem(a)),b(l("notification_logout_success"),"success"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.warn("Logout error:",t.message),localStorage.clear(),sessionStorage.clear(),window.location.reload()}}function Xe(t){localStorage.setItem("currentMode",t);const e=t==="single";u.modeSingleBtn.classList.toggle("bg-blue-600",e),u.modeSingleBtn.classList.toggle("text-white",e),u.modeSingleBtn.classList.toggle("text-gray-400",!e),u.modeSingleBtn.classList.toggle("hover:bg-gray-700",!e),u.modeCarouselBtn.classList.toggle("bg-blue-600",!e),u.modeCarouselBtn.classList.toggle("text-white",!e),u.modeCarouselBtn.classList.toggle("text-gray-400",e),u.modeCarouselBtn.classList.toggle("hover:bg-gray-700",e),u.modeSingleBtn.classList.toggle("is-active",e),u.modeCarouselBtn.classList.toggle("is-active",!e);const a=document.getElementById("duration-group");e?(u.scriptCountGroup.classList.remove("hidden"),a&&a.classList.remove("hidden"),u.visualStrategyGroup.classList.remove("hidden"),u.slideCountGroup.classList.add("hidden"),u.carouselTemplateGroup.classList.add("hidden")):(u.scriptCountGroup.classList.add("hidden"),a&&a.classList.add("hidden"),u.visualStrategyGroup.classList.add("hidden"),u.slideCountGroup.classList.remove("hidden"),u.carouselTemplateGroup.classList.remove("hidden"))}function Ze(t){localStorage.setItem("visualStrategy",t),document.querySelectorAll("#visual-strategy-group .track-btn").forEach(i=>{i.classList.remove("is-active")});const e=document.getElementById(`strategy-${t}`);e&&e.classList.add("is-active");const a=document.getElementById("character-mode-group"),n=document.getElementById("character-preset-controls"),o=document.getElementById("dynamic-character-sheet-area"),s=document.getElementById("interaction-description-container");t==="character"?(a.classList.remove("hidden"),n.classList.remove("hidden"),Lt()):(a.classList.add("hidden"),n.classList.add("hidden"),o.innerHTML="",s.classList.add("hidden"))}function Qe(t){localStorage.setItem("aspectRatio",t),document.querySelectorAll(".ratio-toggle-track .track-btn").forEach(a=>{a.classList.remove("is-active")});const e=document.getElementById(`ratio-${t.replace(":","")}`);e&&e.classList.add("is-active")}async function we(t){try{return await t.clone().json()}catch{try{const a=await t.text();return a?JSON.parse(a):null}catch{return null}}}let pe=null;async function eo(t,e){try{try{pe==null||pe.abort()}catch{}pe=new AbortController;const{signal:a}=pe,n=localStorage.getItem("aethera_user_api_key"),o={"Content-Type":"application/json"};n&&(o["x-user-api-key"]=n);const s=await fetch("/api/analyzeImage",{method:"POST",headers:o,body:JSON.stringify({base64Data:t,mimeType:e,mode:"fullDescription"}),signal:a});if(!s.ok){const h=await we(s),y=(h==null?void 0:h.error)||s.statusText||"Terjadi kesalahan";throw new Error(`Tahap 1 Gagal: ${y}`)}const i=await we(s);if(!i||!i.description)throw new Error(l("notification_image_analysis_error")||"Image analysis error");const{description:r,palette:c}=i,d=await fetch("/api/analyzeImage",{method:"POST",headers:o,body:JSON.stringify({textData:r,mode:"extractKeywords"}),signal:a});if(!d.ok){const h=await we(d),y=(h==null?void 0:h.error)||d.statusText||"Terjadi kesalahan";throw new Error(`Tahap 2 Gagal: ${y}`)}const m=await we(d);if(!m||!m.keywords)throw new Error(l("notification_image_analysis_error")||"Image analysis error");const{keywords:g}=m;return{description:r,palette:c,keywords:g}}catch(a){throw(a==null?void 0:a.name)==="AbortError"||console.error("Error dalam proses analisis gambar 2 tahap:",a),a}}async function Dt(t,e,a){try{const n={"Content-Type":"application/json"};try{const{data:{session:i}}=await v.auth.getSession();i!=null&&i.access_token&&(n.Authorization=`Bearer ${i.access_token}`)}catch{}const o=localStorage.getItem("aethera_user_api_key");o&&(n["x-user-api-key"]=o);const s=await fetch("/api/generateScript",{method:"POST",headers:n,body:JSON.stringify({prompt:t,schema:e,temperature:a})});if(!s.ok){let i=l("notification_api_error")||"Terjadi kesalahan pada server.";try{const r=await s.json();r!=null&&r.error&&(i=r.error)}catch{}throw new Error(i)}return await s.json()}catch(n){throw console.error("Error calling backend function:",n),n}}function to(){return{type:"OBJECT",properties:{titles:{type:"ARRAY",items:{type:"STRING"},minItems:3,maxItems:3},platform:{type:"STRING",enum:["tiktok","instagram_reels","youtube_shorts","shopee"]},hashtags:{type:"ARRAY",items:{type:"STRING"}},platform_hashtags:{type:"OBJECT",properties:{tiktok:{type:"ARRAY",items:{type:"STRING"}},instagram_reels:{type:"ARRAY",items:{type:"STRING"}},youtube_shorts:{type:"ARRAY",items:{type:"STRING"}},shopee:{type:"ARRAY",items:{type:"STRING"}}}},trending_tags:{type:"ARRAY",items:{type:"STRING"}},thumbnail_ideas:{type:"ARRAY",items:{type:"STRING"},minItems:3,maxItems:3}},required:["titles","hashtags","thumbnail_ideas"]}}localStorage.getItem("visualStrategy");let rt=localStorage.getItem("aspectRatio")||"9:16",xe=0;function Wa(t){const e=U.current==="en",a={hook_problem:e?'Start by identifying specific problems your target audience faces. Use relatable and emotional language. Examples: "Are you tired of..." or "Have you ever experienced..."':'Mulai dengan mengidentifikasi masalah spesifik yang dialami target audiens. Gunakan bahasa yang relatable dan emosional. Contoh: "Capek gak sih kalau..." atau "Pernah nggak ngalamin..."',hook_target_call:e?'Call out your target audience directly and specifically. Make them feel personally addressed. Examples: "For those of you who often..." or "Specifically for..."':'Panggil target audiens secara langsung dan spesifik. Buat mereka merasa dipanggil secara personal. Contoh: "Buat kamu yang sering..." atau "Khusus untuk para..."',hook_bold_claim:e?'Make bold and surprising claims about your product. Must be provable and not exaggerated. Examples: "This is the only product that..." or "Guaranteed 100%..."':'Buat klaim yang berani dan mengejutkan tentang produk. Harus bisa dibuktikan dan tidak berlebihan. Contoh: "Ini satu-satunya produk yang..." atau "Dijamin 100%..."',hook_curiosity:e?'Spark curiosity with incomplete information. Make the audience want to know more. Examples: "The secret that was never told..." or "It turns out all this time..."':'Bangkitkan rasa penasaran dengan informasi yang tidak lengkap. Buat audiens ingin tahu lebih. Contoh: "Rahasia yang gak pernah diceritain..." atau "Ternyata selama ini..."',hook_social_proof:e?'Use testimonials, numbers, or strong social proof. Show that many people have experienced the benefits. Examples: "Over 10,000+ people have..." or "Viral on TikTok because..."':'Gunakan testimoni, angka, atau bukti sosial yang kuat. Tunjukkan bahwa banyak orang sudah merasakan manfaatnya. Contoh: "Udah 10.000+ orang yang..." atau "Viral di TikTok karena..."',hook_negativity_bias:e?`Focus on negative consequences of not using the product. Use fear of missing out. Examples: "Don't regret not..." or "It's dangerous if you don't..."`:'Fokus pada konsekuensi negatif jika tidak menggunakan produk. Gunakan fear of missing out. Contoh: "Jangan sampai nyesal karena..." atau "Bahaya kalau kamu gak..."',hook_future_pacing:e?'Invite audience to imagine the future with AI technology and sustainability. Use strong visualization about 2025 trends. Examples: "Imagine if AI could help you..." or "What would zero waste life feel like in 2025..."':'Ajak audiens membayangkan masa depan dengan teknologi AI dan sustainability. Gunakan visualisasi yang kuat tentang tren 2025. Contoh: "Bayangin kalau AI bisa bantu kamu..." atau "Gimana rasanya hidup zero waste di 2025..."',hook_question:e?'Start with questions about 2025 digital trends, mental health, or sustainability. Must be relevant to current issues. Examples: "Why does Gen Alpha prefer sustainable products?" or "Do you know why AI can now...?"':'Mulai dengan pertanyaan tentang tren digital 2025, mental health, atau sustainability. Harus relevan dengan isu terkini. Contoh: "Kenapa Gen Alpha lebih pilih produk sustainable?" atau "Tau gak kenapa AI sekarang bisa...?"',hook_solution:e?'Offer solutions for modern 2025 problems: burnout, digital detox, climate anxiety, or AI integration. Examples: "The easiest way to digital detox..." or "Anti-burnout solution that went viral in 2025..."':'Tawarkan solusi untuk masalah modern 2025: burnout, digital detox, climate anxiety, atau AI integration. Contoh: "Cara termudah untuk digital detox..." atau "Solusi anti-burnout yang viral di 2025..."',hook_statistic:e?'Use latest 2025 data about AI adoption, sustainability, mental health awareness, or Gen Alpha behavior. Examples: "Turns out 95% of Gen Alpha care more about environment..." or "2025 research proves AI can..."':'Gunakan data terbaru 2025 tentang AI adoption, sustainability, mental health awareness, atau Gen Alpha behavior. Contoh: "Ternyata 95% Gen Alpha lebih peduli lingkungan..." atau "Penelitian 2025 buktikan AI bisa..."',hook_experimental:e?'Invite audience to join viral 2025 challenges: sustainability challenge, AI productivity test, or mindfulness experiment. Examples: "Try this 30-day sustainability challenge..." or "Test how productive you are with AI..."':'Ajak audiens ikut challenge viral 2025: sustainability challenge, AI productivity test, atau mindfulness experiment. Contoh: "Coba deh 30-day sustainability challenge..." atau "Test seberapa produktif kamu dengan AI..."',hook_tension:e?'Build tension about 2025 issues: climate crisis, AI replacement anxiety, or digital overwhelm. Examples: "Almost lost my job because of AI..." or "Tense moments during climate change..."':'Bangun ketegangan tentang isu 2025: climate crisis, AI replacement anxiety, atau digital overwhelm. Contoh: "Hampir aja kehilangan pekerjaan karena AI..." atau "Detik-detik menegangkan saat climate change..."',hook_surprise:e?'Plot twist about 2025 misconceptions: AI myths, sustainability facts, or Gen Alpha behavior. Examples: "What you think is dangerous about AI, turns out..." or "Plot twist: Gen Alpha is actually wiser..."':'Plot twist tentang misconception 2025: AI myths, sustainability facts, atau Gen Alpha behavior. Contoh: "Yang kamu pikir AI berbahaya, ternyata..." atau "Plot twist: Gen Alpha ternyata lebih wise..."',hook_list:e?'Use list format about 2025 trends, AI tools, sustainable living, or mental health tips. Examples: "5 AI tools you must try in 2025..." or "3 sustainable habits that went viral..."':'Gunakan format daftar tentang tren 2025, AI tools, sustainable living, atau mental health tips. Contoh: "5 AI tools yang wajib kamu coba 2025..." atau "3 sustainable habits yang viral..."',hook_story:e?'Start with personal story about 2025 technology adaptation, mental health journey, or sustainable lifestyle. Examples: "I used to be skeptical about AI, but..." or "My burnout story in the digital era..."':'Mulai dengan cerita personal tentang adaptasi teknologi 2025, mental health journey, atau sustainable lifestyle. Contoh: "Dulu aku skeptis sama AI, tapi..." atau "Cerita burnout aku di era digital..."',hook_comparison:e?'Compare pre-AI vs post-AI life, traditional vs sustainable living, or Gen Z vs Gen Alpha mindset. Examples: "The difference between life before and after AI..." or "Gen Z vs Gen Alpha: who is wiser?"':'Bandingkan life pre-AI vs post-AI, traditional vs sustainable living, atau Gen Z vs Gen Alpha mindset. Contoh: "Bedanya hidup sebelum dan sesudah AI..." atau "Gen Z vs Gen Alpha: siapa yang lebih wise?"',hook_mistake:e?`Admit mistakes in technology adoption, sustainability journey, or mental health. Examples: "Fatal mistake when first using AI..." or "Don't be like me: burnout because..."`:'Akui kesalahan dalam adopsi teknologi, sustainability journey, atau mental health. Contoh: "Kesalahan fatal saat pertama pakai AI..." atau "Jangan sampai kayak aku dulu: burnout karena..."',hook_secret:e?'Reveal insider knowledge about AI industry, sustainability tips, or Gen Alpha insights. Examples: "AI secrets only known by tech insiders..." or "Sustainability hacks never shared..."':'Reveal insider knowledge tentang AI industry, sustainability tips, atau Gen Alpha insights. Contoh: "Rahasia AI yang cuma diketahui tech insider..." atau "Sustainability hacks yang gak pernah dibagi..."',hook_transformation:e?'Show transformation with AI tools, sustainable living, or mental health improvement. Examples: "From tech-phobic to AI expert..." or "Mental health transformation in 30 days..."':'Tunjukkan transformasi dengan AI tools, sustainable living, atau mental health improvement. Contoh: "Dari tech-phobic jadi AI expert..." atau "Transformasi mental health dalam 30 hari..."'},n=e?"Create an engaging hook that captures attention in the first 3 seconds.":"Buat hook yang menarik perhatian dalam 3 detik pertama.";return a[t]||n}function Xa(t){const e=U.current==="en",a={cta_general:e?'Use clear and direct CTA. Focus on the action you want them to take. Examples: "Order now" or "Get it now"':'Gunakan CTA yang jelas dan direct. Fokus pada action yang ingin dilakukan. Contoh: "Pesan sekarang" atau "Dapatkan sekarang"',cta_tiktok:e?'Use Gen Alpha language and 2025 trending terms. Focus on sustainability and AI features. Examples: "Check yellow cart for eco-friendly products!" or "AI-powered solution link in bio!"':'Gunakan bahasa Gen Alpha dan trending 2025. Fokus pada sustainability dan AI features. Contoh: "Cek keranjang kuning untuk produk eco-friendly!" atau "Link AI-powered solution di bio!"',cta_shopee:e?'Highlight eco-friendly shipping and AI recommendations. Mention carbon-neutral delivery. Examples: "Shopee now offers carbon-neutral delivery!" or "AI recommends the best products for you!"':'Highlight eco-friendly shipping dan AI recommendations. Mention carbon-neutral delivery. Contoh: "Shopee sekarang carbon-neutral delivery!" atau "AI rekomendasiin produk terbaik buat kamu!"',cta_instagram:e?'Direct to sustainable content and AI tools. Use mindful language. Examples: "Sustainable living tips in bio!" or "AI productivity hacks, swipe up!"':'Arahkan ke sustainable content dan AI tools. Gunakan mindful language. Contoh: "Sustainable living tips di bio!" atau "AI productivity hacks, swipe up!"',cta_youtube:e?'Invite to subscribe for AI tutorials and sustainability content. Examples: "Subscribe for latest AI tips!" or "Turn on notifications for sustainable living hacks!"':'Ajak subscribe untuk AI tutorials dan sustainability content. Contoh: "Subscribe untuk AI tips terbaru!" atau "Nyalakan notif untuk sustainable living hacks!"',cta_comment:e?'Invite discussion about AI, sustainability, or mental health. Examples: "Share your AI experience in comments!" or "Tag a friend who needs digital detox!"':'Ajak diskusi tentang AI, sustainability, atau mental health. Contoh: "Share pengalaman AI kamu di komen!" atau "Tag teman yang butuh digital detox!"',cta_urgency:e?`Create urgency about climate action or AI adoption. Examples: "Before it's too late for our planet!" or "Before AI replaces your skills!"`:'Urgency tentang climate action atau AI adoption. Contoh: "Sebelum terlambat untuk planet kita!" atau "Sebelum AI gantikan skill kamu!"',cta_scarcity:e?'Emphasize limited edition sustainable products or early access AI tools. Examples: "Limited edition eco-friendly!" or "Early access AI beta for only 100 people!"':'Tekankan limited edition sustainable products atau early access AI tools. Contoh: "Limited edition eco-friendly!" atau "Early access AI beta cuma 100 orang!"',cta_social_proof_cta:e?'Use AI adoption data or sustainability movement statistics. Examples: "Join 1M+ who went green!" or "Like 500K+ AI early adopters..."':'Gunakan data adopsi AI atau sustainability movement. Contoh: "Join 1M+ yang udah go green!" atau "Seperti 500K+ AI early adopters..."',cta_benefit_focused:e?'Focus on AI productivity or sustainable living benefits. Examples: "10x productivity with AI!" or "Save 70% carbon footprint!"':'Fokus pada benefit AI productivity atau sustainable living. Contoh: "10x produktivitas dengan AI!" atau "Hemat 70% carbon footprint!"',cta_risk_reversal:e?`Guarantee for AI tools or eco products. Examples: "AI doesn't work? 100% refund!" or "Not satisfied with eco-product? Free exchange!"`:'Garansi untuk AI tools atau eco products. Contoh: "AI gak cocok? Refund 100%!" atau "Gak puas dengan eco-product? Tukar gratis!"',cta_curiosity_gap:e?'Create curiosity about AI secrets or sustainability hacks. Examples: "AI secret never shared before..." or "Sustainability hack that went viral..."':'Buat penasaran tentang AI secrets atau sustainability hacks. Contoh: "AI secret yang gak pernah dibagi..." atau "Sustainability hack yang viral..."',cta_exclusive:e?'Exclusive access to AI community or sustainability program. Examples: "Exclusive AI mastermind!" or "VIP sustainable living program!"':'Akses eksklusif ke AI community atau sustainability program. Contoh: "Exclusive AI mastermind!" atau "VIP sustainable living program!"',cta_interactive:e?'Invite to participate in AI experiment or eco challenge. Examples: "Test AI with us!" or "Join 30-day sustainability challenge!"':'Ajak participate dalam AI experiment atau eco challenge. Contoh: "Test AI bareng kita!" atau "Join 30-day sustainability challenge!"',cta_storytelling:e?'Continue AI journey or sustainability transformation story. Examples: "AI journey continuation at..." or "Complete transformation story at..."':'Lanjutkan AI journey atau sustainability transformation story. Contoh: "Kelanjutan AI journey di..." atau "Transformation story lengkap di..."',cta_challenge:e?'Challenge related to AI skills or sustainable habits. Examples: "7-day AI productivity challenge!" or "#SustainableLifestyle challenge!"':'Challenge terkait AI skills atau sustainable habits. Contoh: "Challenge AI productivity 7 hari!" atau "#SustainableLifestyle challenge!"'},n=e?"Create clear and actionable CTA.":"Buat CTA yang jelas dan actionable.";return a[t]||n}function Za(){const{productName:t,productDesc:e}=u.inputs;return t.value.trim()?e.value.trim()?null:l("notification_product_desc_empty")||"Deskripsi produk tidak boleh kosong!":l("notification_product_name_empty")||"Nama produk tidak boleh kosong!"}async function Qa(t){const e=++xe,a=t.target.files[0];if(a){if(a.size>5*1024*1024){b(l("notification_image_size_error")||"Image size too large","error");return}u.imageLoader.classList.remove("hidden"),u.imageHelper.textContent=l("analyzing_image")||"Analyzing image...",u.visualDnaStorage.textContent="",u.imagePreviewContainer.classList.add("hidden");try{u.generateBtn.disabled=!0}catch{}try{const n=new FileReader;n.onload=i=>{u.imagePreview.src=i.target.result,u.imagePreviewContainer.classList.remove("hidden")},n.readAsDataURL(a);const o=await ea(a),s=await eo(o,a.type);if(e!==xe)return;u.visualDnaStorage.textContent=s.keywords,localStorage.setItem("productColorPalette",JSON.stringify(s.palette)),b(l("notification_image_analysis_success")||"Image analysis successful"),u.imageHelper.textContent=`${a.name} ${l("analysis_complete")||"analysis complete"}`}catch(n){(n==null?void 0:n.name)!=="AbortError"&&(console.error("Error during image analysis:",n),e===xe&&(b(`${l("notification_image_analysis_error")||"Image analysis error"} ${n.message}`,"error"),qt()))}finally{if(e===xe){u.imageLoader.classList.add("hidden");try{u.generateBtn.disabled=!1}catch{}}}}}function qt(){u.inputs.productImage.value="",u.imagePreview.src="",u.imagePreviewContainer.classList.add("hidden"),u.visualDnaStorage.textContent="",localStorage.removeItem("productColorPalette"),u.imageHelper.textContent=l("image_helper_text")||"Upload product image for better analysis";try{u.generateBtn.disabled=!1}catch{}}async function en(){var o,s;const t=Za();if(t){b(t,"error");return}try{const i=parseInt(((o=document.getElementById("script-count"))==null?void 0:o.value)||"1",10),r=document.getElementById("results-toolbar");if(r){const c=i>1;r.classList.toggle("hidden",!c);try{r.style.display=c?"flex":"none"}catch{}}}catch{}const e=document.querySelector(".progress-bar"),a=document.querySelector(".progress-bar-fill");e&&(e.classList.remove("hidden"),a.style.width="0%"),F(!0,u.generateBtn),u.downloadAllContainer.classList.add("hidden");const n=document.getElementById("results-container");if(n){n.innerHTML="";const i=parseInt(document.getElementById("script-count").value)||3;for(let r=0;r<i;r++){const c=document.getElementById("skeleton-card-template");if(c){const d=c.content.cloneNode(!0);n.appendChild(d)}}}try{a&&(a.style.width="20%");const i=tn(),r=document.getElementById("creative-freedom"),c=r?parseFloat(r.value):.7;a&&(a.style.width="40%");const d=await Dt(i,be(),c);if(a&&(a.style.width="80%"),!d||d.length===0)throw new Error(l("notification_script_generation_error")||"Error generating script");const m=d.map((h,y)=>({...h,visual_dna:u.visualDnaStorage.textContent,id:`script-${Date.now()}-${y}`})),g=localStorage.getItem("currentMode")||"single";fn(m,u.inputs.productName.value,g),a&&(a.style.width="90%"),await ca(m);try{const h=document.getElementById("results-toolbar"),y=parseInt(((s=document.getElementById("script-count"))==null?void 0:s.value)||"1",10);if(h){const _=y>1;h.classList.toggle("hidden",!_);try{h.style.display=_?"flex":"none"}catch{}}}catch{}a&&(a.style.width="100%"),u.downloadAllContainer.classList.remove("hidden"),setTimeout(()=>{e&&e.classList.add("hidden")},1e3)}catch(i){console.error("Error during generation:",i);const r=i.message||l("notification_api_error")||"API Error";bt(r),b(r,"error",5e3),e&&e.classList.add("hidden")}finally{F(!1,u.generateBtn)}}async function it(){const t=document.getElementById("revision-instruction").value.trim(),e=Array.from(document.querySelectorAll(".section-checkbox:checked")).map(a=>a.dataset.section);if(e.length===0){b(l("notification_select_section_regenerate")||"Pilih setidaknya satu bagian untuk diregenerasi.","warning");return}if(!t){b(l("notification_revision_instruction_empty")||"Instruksi revisi tidak boleh kosong.","error");return}F(!0,u.editModal.regenerateBtn);try{const a=localStorage.getItem("cardBeingEditedId"),n=document.getElementById(a),o=JSON.parse(n.dataset.script),s=an(o,t,e),i={};e.includes("hook")&&(i.hook=be(1).items.properties.hook),e.includes("body")&&(i.body=be(1).items.properties.body),e.includes("cta")&&(i.cta=be(1).items.properties.cta);const r=await Dt(s,{type:"OBJECT",properties:i});ta(o,r,e)}catch(a){console.error("Error during regeneration:",a),b(`${l("notification_regeneration_error")||"Regeneration error"} ${a.message}`,"error")}finally{F(!1,u.editModal.regenerateBtn)}}function be(t){const e=localStorage.getItem("currentMode")||"single",a=t||parseInt(u.inputs.scriptCount.value,10)||1,o={type:"OBJECT",properties:{text:{type:"STRING"},shots:{type:"ARRAY",items:{type:"OBJECT",properties:{visual_idea:{type:"STRING"},text_to_image_prompt:{type:"STRING"},negative_prompt:{type:"STRING",description:"Sebutkan hal-hal yang TIDAK BOLEH muncul di gambar, misal: blurry, text, watermark, ugly, deformed hands."},image_to_video_prompt:{type:"STRING"}},required:["visual_idea","text_to_image_prompt","image_to_video_prompt"]}}},required:["text","shots"]},s={type:"OBJECT",properties:{selling_points:{type:"ARRAY",items:{type:"STRING"}}},required:["selling_points"]},i={type:"OBJECT",properties:{name:{type:"STRING"},age:{type:"STRING"},ethnicity:{type:"STRING"},skin_tone:{type:"STRING"},face_shape:{type:"STRING"},body_shape:{type:"STRING"},hair_style:{type:"STRING"},hair_color:{type:"STRING"},eye_color:{type:"STRING"}},required:["name","age","ethnicity","skin_tone","face_shape","body_shape","hair_style","hair_color","eye_color"]},r={type:"OBJECT",properties:{title:{type:"STRING"},review_insights:s},required:["title","review_insights"]};if(e==="single")r.properties.character_sheet={type:"ARRAY",items:i},r.properties.hook=o,r.properties.body=o,r.properties.cta=o,r.properties.hook_variants={type:"ARRAY",items:{type:"STRING"}},r.properties.body_intro={type:"STRING"},r.properties.body_variants={type:"ARRAY",items:{type:"STRING"}},r.properties.cta_variants={type:"ARRAY",items:{type:"STRING"}},r.required.push("hook","body","cta","hook_variants","body_variants","cta_variants");else{const c={type:"OBJECT",properties:{slide_text:{type:"STRING"},text_to_image_prompt:{type:"STRING"},layout_suggestion:{type:"STRING"},engagement_idea:{type:"STRING"}},required:["slide_text","text_to_image_prompt"]};r.properties.slides={type:"ARRAY",items:c},r.required.push("slides")}return{type:"ARRAY",items:r,minItems:a,maxItems:a}}function ao(){const t=U.current,e=localStorage.getItem("aethera_system_prompt");return e||(t==="en"?Nt:Ot)}function tn(){const t=localStorage.getItem("currentMode")||"single",e=ao(),a=t==="single"?u.inputs.scriptCount.value:1,n=u.personaSelector.value,o=localStorage.getItem("productColorPalette"),s=localStorage.getItem("model_target")||"auto",i=localStorage.getItem("platform_target")||"tiktok";let r="";const c=U.current;s==="flux"?r=c==="en"?`
- **NEGATIVE PROMPT (REQUIRED):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers`:`
- **NEGATIVE PROMPT (WAJIB):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers`:s==="leonardo"&&(r=c==="en"?`
- **NEGATIVE PROMPT (REQUIRED):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers, bad proportions`:`
- **NEGATIVE PROMPT (WAJIB):** blurry, watermark, text artifacts, lowres, pixelated, deformed, extra fingers, bad proportions`);const d=parseInt(localStorage.getItem("ab_variant_count")||"3",10),m=c==="en"?`
- **A/B VARIANTS (MUST BE RETURNED):** Besides the main Hook/Body/CTA/shots structure, also return:
  - hook_variants: array containing EXACTLY ${d} alternative hook variations
  - body_intro: short intro string for body (optional)
  - body_variants: array containing 2-3 alternative body variations
  - cta_variants: array containing EXACTLY ${d} alternative CTA variations`:`
- **A/B VARIANTS (WAJIB DIKEMBALIKAN):** Selain struktur utama Hook/Body/CTA/shots, kembalikan juga:
  - hook_variants: array berisi TEPAT ${d} variasi hook alternatif
  - body_intro: string intro singkat untuk body (opsional)
  - body_variants: array berisi 2-3 variasi body alternatif
  - cta_variants: array berisi TEPAT ${d} variasi CTA alternatif`;let g="";i==="tiktok"?g=c==="en"?`
- **TIKTOK OPTIMIZATION:** Use Gen Alpha language, trending keywords 2025, focus on sustainability and AI features. Hook must be catchy in the first 3 seconds.`:`
- **OPTIMASI TIKTOK:** Gunakan bahasa Gen Alpha, trending keywords 2025, fokus sustainability dan AI features. Hook harus catchy dalam 3 detik pertama.`:i==="shopee"?g=c==="en"?`
- **SHOPEE OPTIMIZATION:** Highlight eco-friendly shipping, AI recommendations, carbon-neutral delivery. Focus on value proposition and urgency.`:`
- **OPTIMASI SHOPEE:** Highlight eco-friendly shipping, AI recommendations, carbon-neutral delivery. Fokus pada value proposition dan urgency.`:i==="instagram"?g=c==="en"?`
- **INSTAGRAM OPTIMIZATION:** Direct to sustainable content and AI tools. Use mindful language and aesthetic appeal.`:`
- **OPTIMASI INSTAGRAM:** Arahkan ke sustainable content dan AI tools. Gunakan mindful language dan aesthetic appeal.`:i==="threads"?g=c==="en"?`
- **THREADS OPTIMIZATION:** Focus on conversational tone, community building, and authentic storytelling.`:`
- **OPTIMASI THREADS:** Fokus pada conversational tone, community building, dan authentic storytelling.`:i==="shorts"&&(g=c==="en"?`
- **YOUTUBE SHORTS OPTIMIZATION:** Quick pacing, clear value delivery, strong retention hooks every 3-5 seconds.`:`
- **OPTIMASI YOUTUBE SHORTS:** Quick pacing, clear value delivery, strong retention hooks setiap 3-5 detik.`);let h="";if(o&&o!=="undefined"&&o!=="null")try{const I=JSON.parse(o);Array.isArray(I)&&I.length>0&&(h=c==="en"?`
- **MAIN COLOR PALETTE (MUST BE FOLLOWED):** Use the following color combinations dominantly: ${I.join(", ")}.`:`
- **PALET WARNA UTAMA (WAJIB DIPATUHI):** Gunakan kombinasi warna berikut secara dominan: ${I.join(", ")}.`)}catch(I){console.error(`${l("failed_parsing_color_palette")||"Gagal parsing palet warna:"}`,I);try{localStorage.removeItem("productColorPalette")}catch{}}let y="";if(n){const L=ue().find(R=>R.id===n);L&&(y=c==="en"?`
- AI Persona / Brand Voice: Use this persona strictly: "${L.description}"`:`
- Persona AI / Brand Voice: Gunakan persona ini secara ketat: "${L.description}"`)}const _=u.inputs.hookType.value,p=Wa(_),f=u.inputs.ctaType.value,S=Xa(f);let k=[];const x=localStorage.getItem("visualStrategy")||"default";x==="character"&&document.querySelectorAll(".character-sheet-instance").forEach(I=>{const L={};["name","gender","age","ethnicity","face_shape","eye_color","eye_shape","lip_shape","nose_shape","eyebrow_style","hair_style","hair_color","unique_features","makeup_style","skin_tone","body_shape","height","clothing_style","color_palette","specific_outfit","vibe","notes"].forEach(Y=>{const V=I.querySelector(`[data-field="${Y}"]`);V&&V.value.trim()!==""&&(L[Y]=V.value)}),Object.keys(L).length>0&&k.push(L)});let E="";k.length>0&&(E=c==="en"?`
- **CHARACTER SHEET(S) (MUST BE USED):** ${JSON.stringify(k)}`:`
- **CHARACTER SHEET(S) (WAJIB DIGUNAKAN):** ${JSON.stringify(k)}`);let M="";const B=document.getElementById("interaction-description");B&&!B.parentElement.classList.contains("hidden")&&B.value.trim()&&(M=c==="en"?`
- **KEY INTERACTION DESCRIPTION (MUST BE USED):** ${B.value}`:`
- **DESKRIPSI INTERAKSI KUNCI (WAJIB DIGUNAKAN):** ${B.value}`);let P="";if(t==="single"){const I=document.getElementById("script-duration").value;P=c==="en"?`
- Target Video Duration: Around ${I} seconds.`:`
- Target Durasi Video: Sekitar ${I} detik.`}let O=c==="en"?`${e}
                **User Request:**
                - Create ${a} script variations.
                - Product Name: ${u.inputs.productName.value}
                - Description: ${u.inputs.productDesc.value||l("no_description")||"No description provided."}
                - Product Category: ${document.getElementById("product-category").value}
                ${h}
                - Visual Strategy: ${x}
                ${E}
                ${M}
                ${P}
                - Aspect Ratio: ${rt}
                - Writing Style: ${u.inputs.writingStyle.value}
                - Tone & Vibe: ${u.inputs.toneVibe.value}
                - Target Audience: ${u.inputs.targetAudience.value}
                - Hook Type: ${u.inputs.hookType.value}
                - CTA Type: ${u.inputs.ctaType.value}
                ${y}
                ${r}
                ${g}
                ${m}
                
                **SPECIFIC HOOK STRATEGY:**
                ${p}
                
                **SPECIFIC CTA STRATEGY:**
                ${S}`:`${e}
                **Permintaan Pengguna:**
                - Buat ${a} variasi skrip.
                - Nama Produk: ${u.inputs.productName.value}
                - Deskripsi: ${u.inputs.productDesc.value||l("no_description")||"Tidak ada deskripsi."}
                - Kategori Produk: ${document.getElementById("product-category").value}
                ${h}
                - Strategi Visual: ${x}
                ${E}
                ${M}
                ${P}
                - Aspek Rasio: ${rt}
                - Gaya Penulisan: ${u.inputs.writingStyle.value}
                - Tone & Vibe: ${u.inputs.toneVibe.value}
                - Target Penonton: ${u.inputs.targetAudience.value}
                - Jenis Hook: ${u.inputs.hookType.value}
                - Jenis CTA: ${u.inputs.ctaType.value}
                ${y}
                ${r}
                ${g}
                ${m}
                
                **STRATEGI HOOK SPESIFIK:**
                ${p}
                
                **STRATEGI CTA SPESIFIK:**
                ${S}`;const T=u.visualDnaStorage.textContent;if(T&&(O+=c==="en"?`
- **PRODUCT VISUAL KEYWORDS (MUST BE USED):**
${T}`:`
- **VISUAL KEYWORDS PRODUK (WAJIB DIGUNAKAN):**
${T}`),t==="carousel"){const I=u.inputs.slideCount.value,L=u.inputs.carouselTemplate.value;let R="";const Y={pas:l("pas_template_desc"),feature_benefit:l("feature_benefit_template_desc"),listicle:l("listicle_template_desc")};return L!=="auto"&&Y[L]&&(R=c==="en"?`
- Story Template: ${Y[L]}`:`
- Template Cerita: ${Y[L]}`),c==="en"?`${O}
- Slide Count: ${I}${R}
**Additional Instructions:** Create one carousel script. Generate a "slides" property containing an ARRAY of ${I} objects. Each object in the array MUST have "slide_text", "text_to_image_prompt" properties, and optional "layout_suggestion" and "engagement_idea" properties.`:`${O}
- Jumlah Slide: ${I}${R}
**Instruksi Tambahan:** Buat satu skrip carousel. Hasilkan sebuah properti "slides" yang berisi sebuah ARRAY berisi ${I} objek. Setiap objek dalam array WAJIB memiliki properti "slide_text", "text_to_image_prompt", dan properti opsional "layout_suggestion" serta "engagement_idea".`}return o&&localStorage.removeItem("productColorPalette"),c==="en"?`${O}
**Additional Instructions:** Create a script consisting of "hook", "body", and "cta". Each section must have script text and an array containing 2-3 'shots' (micro-shots). If the visual strategy is 'Character Sheet', define one or more characters in 'character_sheet'.`:`${O}
**Instruksi Tambahan:** Buat skrip yang terdiri dari "hook", "body", dan "cta". Setiap bagian harus memiliki teks skrip dan sebuah array berisi 2-3 'shots' (micro-shots). Jika strategi visual adalah 'Character Sheet', definisikan satu atau lebih karakter di 'character_sheet'.`}function an(t,e,a){const n=U.current,o={};a.includes("hook")||(o.hook=t.hook),a.includes("body")||(o.body=t.body),a.includes("cta")||(o.cta=t.cta);const s={writingStyle:u.inputs.writingStyle.value,toneVibe:u.inputs.toneVibe.value,targetAudience:u.inputs.targetAudience.value,hookType:u.inputs.hookType.value,ctaType:u.inputs.ctaType.value,characterSheets:(()=>{const r=[];try{document.querySelectorAll(".character-sheet-instance").forEach(c=>{const d={};c.querySelectorAll("[data-field]").forEach(m=>{m.value.trim()&&(d[m.dataset.field]=m.value)}),Object.keys(d).length&&r.push(d)})}catch{}return r})()};let i="";return n==="en"?(i=`You are an AI revision assistant. A script has been created with the following initial constraints:
`,i+=`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\`

`,Object.keys(o).length>0&&(i+=`The following sections of this script are FINAL and MUST NOT BE CHANGED AT ALL:
`,i+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`),i+=`Now, your task is to regenerate the following sections: [${a.join(", ")}] based on this instruction: "${e}".
`,i+=`STRICT CHARACTER RULES: If characterSheets are provided, you MUST use them for all regenerated parts and visual prompts. Do NOT invent or modify characters. In T2I prompts, place physical descriptions ONLY inside <char-desc>...</char-desc>. NEVER include <char-desc> in I2V prompts.
`,i+=`IMPORTANT: Ensure your regeneration results still comply with the initial constraints given above (for example, if ctaType is 'TikTok', the result should still be TikTok-style). ALL SCRIPT TEXT OUTPUT MUST BE IN ENGLISH.
`,i+="Generate ONLY the sections you regenerate in valid JSON format."):(i=`Anda adalah asisten revisi AI. Sebuah skrip telah dibuat dengan batasan awal sebagai berikut:
`,i+=`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\`

`,Object.keys(o).length>0&&(i+=`Bagian berikut dari skrip ini SUDAH FINAL dan TIDAK BOLEH DIUBAH SAMA SEKALI:
`,i+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`),i+=`Sekarang, tugas Anda adalah me-regenerasi bagian berikut: [${a.join(", ")}] berdasarkan instruksi ini: "${e}".
`,i+=`ATURAN KARAKTER YANG KETAT: Jika characterSheets tersedia, WAJIB digunakan untuk semua bagian yang direvisi dan prompt visual. JANGAN membuat/mengubah karakter baru. Pada T2I, taruh deskripsi fisik HANYA di dalam tag <char-desc>...</char-desc>. JANGAN pernah menaruh <char-desc> pada I2V.
`,i+=`PENTING: Pastikan hasil regenerasi Anda tetap mematuhi batasan awal yang diberikan di atas (misalnya, jika ctaType adalah 'TikTok', hasilnya harus tetap bergaya TikTok). SEMUA OUTPUT TEKS SKRIP WAJIB DALAM BAHASA INDONESIA.
`,i+="Hasilkan HANYA bagian yang Anda regenerasi dalam format JSON yang valid."),i}async function nn(t){var o,s;const e=t.querySelector(".additional-assets-container"),a=t.querySelector(".asset-loader"),n=t.querySelector(".asset-content");e.classList.remove("hidden"),a.classList.remove("hidden"),n.classList.add("hidden"),n.innerHTML="";try{const i=JSON.parse(t.dataset.script),r=le(i),c=(localStorage.getItem("targetPlatform")||"tiktok").toLowerCase(),d=`${l("asset_generation_prompt")||"Berdasarkan skrip berikut, buatlah 3 opsi judul/caption yang menarik, 1 set hashtag yang relevan (gabungan umum dan niche), dan 3 ide teks singkat untuk thumbnail/cover."}

Tambahkan juga daftar hashtag yang SPESIFIK untuk platform: ${c}.
Jika platform TikTok, gunakan kombinasi tag FYP dan niche yang relevan (contoh: #fyp, #foryou, #tiktokshop, serta niche spesifik produk/brand). Jika Instagram Reels, prioritaskan tag discoverability dan niche brand (contoh: #reels, #reelitfeelit). Jika YouTube Shorts, gunakan tag discoverability seperti #shorts serta niche.

WAJIB: Selain platform yang dipilih, SELALU sertakan juga daftar khusus untuk Shopee pada field platform_hashtags.shopee (format array of strings) yang relevan untuk konversi marketplace (contoh: #Shopee, #ShopeeHaul, #Voucher, #GratisOngkir, dll).
 
 ${l("script_label")||"Skrip"}:
 ---
 ${r}
 ---
 `,m=await Dt(d,to());let g='<div class="space-y-4">';g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${l("asset_titles_label")||"Judul/Caption"}</h5><ul class="list-disc list-inside text-xs text-gray-400 space-y-1">`,m.titles.forEach(f=>{g+=`<li>${f}</li>`}),g+="</ul></div>",g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${l("asset_hashtags_label")||"Hashtags"}</h5>`;const h=(m.hashtags||[]).join(" "),y=((o=m.platform_hashtags)==null?void 0:o[c])||[],_=m.trending_tags||[];g+=`<p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${h}</p>`,y.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-blue-300">${c} #</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${y.join(" ")}</p></div>`);const p=((s=m.platform_hashtags)==null?void 0:s.shopee)||[];p.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-orange-300">Shopee #</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${p.join(" ")}</p></div>`),_.length&&(g+=`<div class="mt-2"><span class="text-xs font-semibold text-green-300">Trending</span><p class="text-xs text-gray-400 bg-gray-800 p-2 rounded-md">${_.join(" ")}</p></div>`),g+="</div>",g+=`<div><h5 class="text-sm font-bold text-gray-300 mb-2">${l("asset_thumbnail_label")||"Ide Thumbnail"}</h5><ul class="list-disc list-inside text-xs text-gray-400 space-y-1">`,m.thumbnail_ideas.forEach(f=>{g+=`<li>${f}</li>`}),g+="</ul></div>",g+="</div>",n.innerHTML=g}catch(i){console.error("Error generating assets:",i),n.innerHTML=`<p class="text-red-400 text-xs">${l("failed_to_generate_assets")||"Failed to generate assets:"} ${i.message}</p>`}finally{a.classList.add("hidden"),n.classList.remove("hidden")}}const no=Object.freeze(Object.defineProperty({__proto__:null,aspectRatio:rt,constructPrompt:tn,constructRevisionPrompt:an,getCTAInstructions:Xa,getHookInstructions:Wa,getResponseSchema:be,handleGenerate:en,handleGenerateAssets:nn,handleImageUpload:Qa,handleRegenerate:it,handleRemoveImage:qt,validateInputs:Za},Symbol.toStringTag,{value:"Module"}));function oo(){so()}function so(){document.querySelectorAll("input[required], textarea[required]").forEach(e=>{const a=e.closest(".form-field");a&&(e.addEventListener("blur",()=>{ro(a,e)}),e.addEventListener("input",()=>{a.classList.contains("error")&&a.classList.remove("error")}))})}function ro(t,e){const a=e.checkValidity()&&e.value.trim()!=="";t.classList.remove("error","success"),!a&&e.value.trim()!==""?(t.classList.add("error"),io(t,co(e))):(a&&e.value.trim()!==""&&t.classList.add("success"),ct(t))}function io(t,e){ct(t);const a=document.createElement("div");a.className="form-field-helper error-message",a.textContent=e,t.appendChild(a)}function ct(t){const e=t.querySelector(".error-message");e&&e.remove()}function co(t){return t.validity.valueMissing?"Field ini wajib diisi":t.validity.typeMismatch?"Format input tidak valid":t.validity.tooShort?`Minimal ${t.minLength} karakter`:t.validity.tooLong?`Maksimal ${t.maxLength} karakter`:"Input tidak valid"}function lo(){uo(),po(),go(),yo(),fo()}function uo(){document.addEventListener("click",t=>{const e=t.target.closest(".btn, .icon-btn");e&&mo(e,t)})}function mo(t,e){const a=t.getBoundingClientRect(),n=Math.max(a.width,a.height),o=e.clientX-a.left-n/2,s=e.clientY-a.top-n/2,i=document.createElement("span");if(i.className="ripple",i.style.cssText=`
        position: absolute;
        width: ${n}px;
        height: ${n}px;
        left: ${o}px;
        top: ${s}px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: scale(0);
        animation: ripple-animation 0.6s linear;
        pointer-events: none;
        z-index: 1;
    `,t.style.position="relative",t.style.overflow="hidden",t.appendChild(i),!document.querySelector("#ripple-styles")){const r=document.createElement("style");r.id="ripple-styles",r.textContent=`
            @keyframes ripple-animation {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
        `,document.head.appendChild(r)}setTimeout(()=>{i.remove()},600)}function po(){document.querySelectorAll(".result-card, .persona-card, .history-item").forEach(e=>{e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-4px) scale(1.02)",e.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}),e.addEventListener("mouseleave",()=>{e.style.transform="translateY(0) scale(1)"})})}function go(){document.documentElement.classList.add("smooth-scroll");const t=document.querySelectorAll(".parallax");t.length>0&&window.addEventListener("scroll",()=>{const e=window.pageYOffset;t.forEach(a=>{const n=e*-.5;a.style.transform=`translateY(${n}px)`})},{passive:!0}),ho()}function ho(){const t={threshold:.1,rootMargin:"0px 0px -50px 0px"},e=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&o.target.classList.add("animate-in")})},t);document.querySelectorAll(".animate-on-scroll").forEach(n=>e.observe(n))}function yo(){window.showSuccessFeedback=t=>{t.classList.add("bounce"),setTimeout(()=>{t.classList.remove("bounce")},600)},window.showErrorFeedback=t=>{t.classList.add("shake"),setTimeout(()=>{t.classList.remove("shake")},500)},window.showLoadingFeedback=t=>{t.classList.add("pulse")},window.hideLoadingFeedback=t=>{t.classList.remove("pulse")}}function fo(){document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});const t=document.createElement("style");t.textContent=`
        .keyboard-navigation *:focus {
            outline: 2px solid var(--primary-color) !important;
            outline-offset: 2px !important;
        }
        
        .keyboard-navigation .btn:focus,
        .keyboard-navigation .icon-btn:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3) !important;
        }
    `,document.head.appendChild(t),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.body.classList.add("reduce-motion")}const Yt="aethera_migration_completed",_o={kontenkilat_theme:"aethera_theme",kontenkilat_language:"aethera_language",kontenkilat_system_prompt:"aethera_system_prompt",kontenkilat_user_api_key:"aethera_user_api_key",kontenkilat_history:"aethera_history",kontenkilat_lastGeneratedScripts:"aethera_lastGeneratedScripts",kontenkilat_personas:"aethera_personas"};function bo(){if(localStorage.getItem(Yt)){console.log("Migration already completed");return}console.log("Starting localStorage key migration...");let t=0;Object.entries(_o).forEach(([e,a])=>{const n=localStorage.getItem(e);if(n!==null)try{localStorage.setItem(a,n),localStorage.removeItem(e),t++,console.log(`Migrated: ${e} -> ${a}`)}catch(o){console.error(`Failed to migrate ${e}:`,o)}}),localStorage.setItem(Yt,"true"),console.log(`Migration completed. ${t} keys migrated.`)}function lt(){try{bo()}catch(t){console.error("Migration failed:",t)}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",lt):lt());function dt(){if(localStorage.getItem("aethera_show_sync_indicator")!=="false"){const e=vo();document.body.appendChild(e)}Io()}function vo(){const t=document.createElement("div");return t.id="sync-indicator",t.className="sync-indicator sync-offline",t.innerHTML=`
        <svg class="sync-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6"/>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
        </svg>
        <span class="sync-text">${l("sync_status_offline")||"Offline"}</span>
    `,t.addEventListener("click",Eo),t.addEventListener("dblclick",So),t}function So(){const t=document.getElementById("sync-indicator");if(!t)return;if(t.style.display==="none"){t.style.display="",localStorage.setItem("aethera_show_sync_indicator","true");const a=l("sync_indicator_shown")||"Indikator sinkronisasi ditampilkan";b(a,"info")}else{t.style.display="none",localStorage.setItem("aethera_show_sync_indicator","false");const a=l("sync_indicator_hidden")||"Indikator sinkronisasi disembunyikan. Double-click di area kosong untuk menampilkan kembali.";b(a,"info"),ko()}}function ko(){document.body.removeEventListener("dblclick",ut),document.body.addEventListener("dblclick",ut)}function ut(t){if(t.target===document.body||t.target.tagName==="HTML"){const e=document.getElementById("sync-indicator");if(e&&e.style.display==="none"){e.style.display="",localStorage.setItem("aethera_show_sync_indicator","true");const a=l("sync_indicator_shown")||"Indikator sinkronisasi ditampilkan";b(a,"info"),document.body.removeEventListener("dblclick",ut)}}}async function Eo(){const{data:{session:t}}=await v.auth.getSession();if(!t){b(l("notification_login_required")||"Please login to sync data","warning");return}if(!navigator.onLine){b(l("notification_offline")||"You are offline. Data will sync when connection is restored.","info");return}try{await A.syncAll(),b(l("notification_sync_success")||"Data synced successfully")}catch(e){console.error("Manual sync failed:",e),b(l("notification_sync_failed")||"Sync failed. Please try again.","error")}}function Io(){const t=document.getElementById("settings-panel");if(!t)return;const e=document.createElement("div");e.className="settings-section sync-section",e.innerHTML=`
        <h3>${l("settings_sync_title")||"Cloud Sync"}</h3>
        <div class="sync-controls">
            <div class="sync-status-display">
                <div class="sync-status-item">
                    <span class="sync-label">${l("sync_last_sync")||"Last Sync"}:</span>
                    <span id="last-sync-time" class="sync-value">-</span>
                </div>
                <div class="sync-status-item">
                    <span class="sync-label">${l("sync_status")||"Status"}:</span>
                    <span id="sync-status-text" class="sync-value">-</span>
                </div>
            </div>
            
            <div class="sync-buttons">
                <button id="manual-sync-btn" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    ${l("sync_manual_sync")||"Sync Now"}
                </button>
                
                <button id="export-backup-btn" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    ${l("sync_export_backup")||"Export Backup"}
                </button>
                
                <button id="import-backup-btn" class="btn btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17,8 12,3 7,8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    ${l("sync_import_backup")||"Import Backup"}
                </button>
            </div>
            
            <div class="sync-info">
                <p class="sync-description">
                    ${l("sync_description")||"Your data is automatically synced when you're online and logged in. You can also manually export/import backups."}
                </p>
            </div>
        </div>
        
        <input type="file" id="backup-file-input" accept=".json" style="display: none;">
    `,t.appendChild(e),wo()}function wo(){const t=document.getElementById("manual-sync-btn");t&&t.addEventListener("click",xo);const e=document.getElementById("export-backup-btn");e&&e.addEventListener("click",Ao);const a=document.getElementById("import-backup-btn");a&&a.addEventListener("click",Lo);const n=document.getElementById("backup-file-input");n&&n.addEventListener("change",To),Re(),setInterval(Re,3e4)}async function xo(){const t=document.getElementById("manual-sync-btn"),e=t.innerHTML;try{t.disabled=!0,t.innerHTML=`
            <svg class="spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6"/>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            ${l("sync_syncing")||"Syncing..."}
        `,await A.syncAll(),b(l("notification_sync_success")||"Data synced successfully"),Re()}catch(a){console.error("Manual sync failed:",a),b(l("notification_sync_failed")||"Sync failed. Please try again.","error")}finally{t.disabled=!1,t.innerHTML=e}}async function Ao(){try{await A.exportBackup()}catch(t){console.error("Export backup failed:",t),b(l("notification_export_failed")||"Failed to export backup","error")}}function Lo(){const t=document.getElementById("backup-file-input");t&&t.click()}async function To(t){const e=t.target.files[0];if(e){try{await A.restoreBackup(e),Re(),setTimeout(()=>{window.location.reload()},2e3)}catch(a){console.error("Import backup failed:",a),b(l("notification_import_failed")||"Failed to import backup","error")}t.target.value=""}}function Re(){const t=document.getElementById("last-sync-time"),e=document.getElementById("sync-status-text");if(t){const a=localStorage.getItem("aethera_last_sync");if(a)try{const n=new Date(a);isNaN(n.getTime())?t.textContent=l("sync_never")||"Never":t.textContent=n.toLocaleString()}catch{console.warn("Invalid last sync date:",a),t.textContent=l("sync_never")||"Never"}else t.textContent=l("sync_never")||"Never"}if(e){const a=localStorage.getItem("aethera_sync_status")||C.OFFLINE,n={[C.SYNCED]:l("sync_status_synced")||"Synced",[C.SYNCING]:l("sync_status_syncing")||"Syncing...",[C.OFFLINE]:l("sync_status_offline")||"Offline",[C.ERROR]:l("sync_status_error")||"Error"};e.textContent=n[a],e.className=`sync-value sync-${a}`}}function Vt(){const t=document.createElement("style");t.textContent=`
        /* Sync Indicator */
        .sync-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            display: none !important;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0.8;
        }
        
        .sync-indicator:hover {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .sync-indicator.hidden {
            display: none;
        }
        
        .sync-indicator.sync-synced {
            color: var(--success-color, #10b981);
        }
        
        .sync-indicator.sync-syncing {
            color: var(--warning-color, #f59e0b);
        }
        
        .sync-indicator.sync-offline {
            color: var(--text-secondary);
        }
        
        .sync-indicator.sync-error {
            color: var(--error-color, #ef4444);
        }
        
        .sync-icon {
            width: 14px;
            height: 14px;
        }
        
        .sync-indicator.sync-syncing .sync-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Sync Section in Settings */
        .sync-section {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-secondary);
        }
        
        .sync-section h3 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }
        
        .sync-status-display {
            margin-bottom: 16px;
        }
        
        .sync-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sync-status-item:last-child {
            border-bottom: none;
        }
        
        .sync-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .sync-value {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .sync-value.sync-synced {
            color: var(--success-color, #10b981);
        }
        
        .sync-value.sync-syncing {
            color: var(--warning-color, #f59e0b);
        }
        
        .sync-value.sync-offline {
            color: var(--text-secondary);
        }
        
        .sync-value.sync-error {
            color: var(--error-color, #ef4444);
        }
        
        .sync-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .sync-buttons .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .sync-buttons .btn:hover {
            background-color: var(--bg-secondary);
        }
        
        .sync-buttons .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .sync-buttons .btn-primary {
            background-color: var(--primary-color, #3b82f6);
            color: white;
            border-color: var(--primary-color, #3b82f6);
        }
        
        .sync-buttons .btn-primary:hover {
            background-color: var(--primary-hover, #2563eb);
        }
        
        .sync-info {
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }
        
        .sync-description {
            margin: 0;
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
        }
        
        /* Migration Modal */
        .migration-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .migration-modal.show {
            opacity: 1;
        }
        
        .migration-modal .modal-content {
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .migration-modal .modal-header {
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .migration-modal .modal-header h3 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
        }
        
        .migration-modal .modal-body {
            padding: 20px;
        }
        
        .migration-modal .modal-body p {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .migration-modal .modal-body ul {
            margin: 0 0 16px 0;
            padding-left: 20px;
            color: var(--text-primary);
        }
        
        .migration-modal .modal-body li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .migration-note {
            background-color: var(--bg-secondary);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color, #3b82f6);
        }
        
        .migration-modal .modal-footer {
            padding: 0 20px 20px 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .migration-modal .modal-footer .btn {
            padding: 10px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        
        .migration-modal .modal-footer .btn:hover {
            background-color: var(--bg-secondary);
        }
        
        .migration-modal .modal-footer .btn-primary {
            background-color: var(--primary-color, #3b82f6);
            color: white;
            border-color: var(--primary-color, #3b82f6);
        }
        
        .migration-modal .modal-footer .btn-primary:hover {
            background-color: var(--primary-hover, #2563eb);
        }
        
        .migration-modal .modal-footer .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sync-buttons {
                flex-direction: column;
            }
            
            .sync-buttons .btn {
                justify-content: center;
            }
            
            .migration-modal .modal-content {
                width: 95%;
                margin: 20px;
            }
            
            .migration-modal .modal-footer {
                flex-direction: column;
            }
        }
    `,document.head.appendChild(t)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Vt(),dt()}):(Vt(),dt());function Co(){const t=document.getElementById("back-to-top");if(!t)return;const e=()=>{window.pageYOffset>200?(t.style.opacity="1",t.style.pointerEvents="auto",t.setAttribute("aria-hidden","false")):(t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("aria-hidden","true"))},a=()=>{window.scrollTo({top:0,behavior:"smooth"})};window.addEventListener("scroll",e,{passive:!0}),t.addEventListener("click",a),e()}function Bo(){const t=document.getElementById("generate-btn"),e=t==null?void 0:t.closest(".mt-6.pt-6.border-t.border-gray-800.space-y-4");if(!t||!e)return;const a=()=>{const n=window.innerWidth<768,o=!document.getElementById("generator-page").classList.contains("hidden");n&&o?(e.style.position="sticky",e.style.bottom="0",e.style.backgroundColor="var(--bg-primary)",e.style.borderTop="1px solid var(--border-color)",e.style.zIndex="20",e.style.padding="1rem",e.style.margin="0 -1.5rem",e.style.boxShadow="0 -4px 12px rgba(0, 0, 0, 0.15)"):(e.style.position="",e.style.bottom="",e.style.backgroundColor="",e.style.borderTop="",e.style.zIndex="",e.style.padding="",e.style.margin="",e.style.boxShadow="")};window.addEventListener("resize",a,{passive:!0}),a()}function Po(){const t=document.getElementById("mobile-menu-button"),e=document.getElementById("mobile-menu"),a=document.getElementById("menu-open-icon"),n=document.getElementById("menu-close-icon");if(!t||!e)return;t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","mobile-menu"),t.setAttribute("aria-label","Toggle mobile menu"),e.setAttribute("role","navigation"),e.setAttribute("aria-label","Mobile navigation");const o=i=>{i&&(i.preventDefault(),i.stopImmediatePropagation());const r=e.classList.contains("hidden");if(e.classList.toggle("hidden"),a.classList.toggle("hidden"),n.classList.toggle("hidden"),t.setAttribute("aria-expanded",r?"true":"false"),r?(document.body.style.overflow="hidden",document.body.style.paddingRight=No()+"px"):(document.body.style.overflow="",document.body.style.paddingRight=""),r){const c=e.querySelector("a, button");c&&setTimeout(()=>c.focus(),100)}else t.focus()};t.addEventListener("click",o,{capture:!0}),document.addEventListener("click",i=>{!e.classList.contains("hidden")&&!e.contains(i.target)&&!t.contains(i.target)&&o()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!e.classList.contains("hidden")&&o()}),e.querySelectorAll("a, button").forEach(i=>{i.addEventListener("click",()=>{e.classList.contains("hidden")||o()})}),window.originalToggleMobileMenu=o}function No(){const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const a=t.offsetWidth-e.offsetWidth;return t.parentNode.removeChild(t),a}function Oo(){document.querySelectorAll("input, textarea, select").forEach(e=>{e.type!=="date"&&e.type!=="datetime-local"&&parseFloat(getComputedStyle(e).fontSize)<16&&(e.style.fontSize="16px"),e.addEventListener("focus",()=>{var a;(a=e.parentElement)==null||a.classList.add("field-focused")}),e.addEventListener("blur",()=>{var a;(a=e.parentElement)==null||a.classList.remove("field-focused")})})}function $o(){const t=document.createElement("a");t.href="#main-content",t.textContent="Skip to main content",t.className="skip-link sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded z-50",t.style.transform="translateY(-100%)",t.style.transition="transform 0.3s ease",t.addEventListener("focus",()=>{t.style.transform="translateY(0)"}),t.addEventListener("blur",()=>{t.style.transform="translateY(-100%)"}),document.body.insertBefore(t,document.body.firstChild),document.querySelectorAll('[role="dialog"], .modal-overlay').forEach(a=>{a.addEventListener("keydown",n=>{n.key==="Tab"&&Mo(n,a)})})}function Mo(t,e){const a=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=a[0],o=a[a.length-1];t.shiftKey?document.activeElement===n&&(o.focus(),t.preventDefault()):document.activeElement===o&&(n.focus(),t.preventDefault())}function Ro(){Co(),Bo(),Po(),Oo(),$o(),console.log("✅ UX improvements initialized")}async function Do(){return window.JSZip||await new Promise((t,e)=>{const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js",a.onload=t,a.onerror=e,document.head.appendChild(a)}),window.JSZip}function qo(t){return String(t||"").trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_\-]/g,"").slice(0,64)||"script"}function Ho(t){var i;const e=(((i=t.body)==null?void 0:i.text)||t.body||"").toString().split(`
`).filter(Boolean),a=2;let n=0,o=1,s="";for(const r of e){const c=new Date(n*1e3).toISOString().substr(11,8)+",000",d=new Date((n+a)*1e3).toISOString().substr(11,8)+",000";s+=`${o}
${c} --> ${d}
${r}

`,n+=a,o++}return s}function Go(t){var s;const e=(((s=t.body)==null?void 0:s.text)||t.body||"").toString().split(`
`).filter(Boolean),a=2;let n=0,o=`start,end,text
`;for(const i of e){const r=n.toFixed(2),c=(n+a).toFixed(2);o+=`${r},${c},"${i.replace(/"/g,'""')}"
`,n+=a}return o}function jo(t){var i,r,c;const e=t.title||"",a=(((i=t.hook)==null?void 0:i.text)||t.hook||"").toString(),n=(((r=t.body)==null?void 0:r.text)||t.body||"").toString(),o=(((c=t.cta)==null?void 0:c.text)||t.cta||"").toString(),s=Array.isArray(t.hashtags)?t.hashtags.join(" "):t.hashtags||"";return`TITLE
${e}

HOOK
${a}

BODY
${n}

CTA
${o}

HASHTAGS
${s}
`}async function Uo(t){var _,p;const n=document.createElement("canvas");n.width=1080,n.height=1920;const o=n.getContext("2d"),s=o.createLinearGradient(0,0,1080,1920);s.addColorStop(0,"#0f172a"),s.addColorStop(1,"#1e293b"),o.fillStyle=s,o.fillRect(0,0,1080,1920),o.globalAlpha=.5,o.fillStyle="#22d3ee",o.fillRect(0,1920*.72,1080,1920*.28),o.globalAlpha=1;const i=64,r=1080-i*2,c=(((_=t.hook)==null?void 0:_.text)||t.hook||t.title||"").toString();let d=88;o.fillStyle="#e2e8f0",o.textBaseline="top",o.font=`bold ${d}px Inter, system-ui, -apple-system, Segoe UI, Roboto`;function m(f){const S=f.split(/\s+/),k=[];let x="";for(const E of S){const M=x?x+" "+E:E;o.measureText(M).width>r?(x&&k.push(x),x=E):x=M}return x&&k.push(x),k}let g=m(c);for(;g.length>10&&d>44;)d-=6,o.font=`bold ${d}px Inter, system-ui, -apple-system, Segoe UI, Roboto`,g=m(c);const h=i;g.slice(0,10).forEach((f,S)=>o.fillText(f,i,h+S*(d*1.2)));const y=(((p=t.cta)==null?void 0:p.text)||t.cta||"").toString();return y&&(o.font="600 48px Inter, system-ui, -apple-system, Segoe UI, Roboto",o.fillStyle="#0b1320",o.fillText(y.slice(0,70),i,1920*.74)),await new Promise(f=>n.toBlob(f,"image/png"))}async function on(t,e){const a=await Do(),n=new a;if(!Array.isArray(t)||!t.length){b(l("notification_no_script_to_download")||"No script to export","warning");return}const o=n.folder("aethera_exports");for(let r=0;r<t.length;r++){const c=t[r],d=qo(c.title||`script_${r+1}`),m=o.folder(`${String(r+1).padStart(2,"0")}_${d}`);if(m.file(`${d}.json`,JSON.stringify(c,null,2)),m.file(`${d}.srt`,Ho(c)),m.file(`${d}.csv`,Go(c)),m.file(`${d}_platform_pack.txt`,jo(c)),e){const g=await Uo(c);g&&m.file(`${d}_thumb_1080x1920.png`,g)}}const s=await n.generateAsync({type:"blob"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`aethera_exports_${Date.now()}.zip`,i.click(),URL.revokeObjectURL(i.href),b(l("zip_export_done")||"ZIP exported.","success")}async function sn(t){return on(_t(),t)}function rn(){const t=document.getElementById("export-all-zip-btn"),e=document.getElementById("include-thumbs");t&&!t.__bound&&(t.__bound=!0,t.addEventListener("click",()=>sn(!!(e!=null&&e.checked))))}const Ht=Object.freeze(Object.defineProperty({__proto__:null,exportAllZip:sn,exportZipForScripts:on,initResultsExportToolbar:rn},Symbol.toStringTag,{value:"Module"}));function cn(){const t=document.getElementById("rank-all-btn");t&&t.addEventListener("click",async()=>{const e=document.getElementById("output-panel"),a=Array.from(e?e.querySelectorAll(".result-card"):[]);if(a.length<2){try{(await w(async()=>{const{showNotification:s}=await Promise.resolve().then(()=>D);return{showNotification:s}},void 0)).showNotification("Rank requires at least 2 results","warning")}catch{}return}const n=[];for(const s of a){const i=s.querySelector(".hook-text"),r=s.querySelector(".body-text"),c=s.querySelector(".cta-text"),d=i?i.textContent.trim():"",m=c?c.textContent.trim():"";let g=await X(d);g+=Math.min(((r==null?void 0:r.textContent)||"").split(/\s+/).length,120)*.1,g+=/now|today|grab|discount|sale|link|tap|shop/i.test(m)?20:0,n.push({card:s,score:g})}n.sort((s,i)=>i.score-s.score);const o=document.getElementById("output-panel");o&&(n.forEach(({card:s})=>o.appendChild(s)),t.textContent="⭐ "+(l("rank_button_active")||"Ranked (best → worst)"),setTimeout(()=>{t.textContent="⭐ "+(l("rank_button_default")||"Rank All")},2e3))})}const Fo=Object.freeze(Object.defineProperty({__proto__:null,initRankAll:cn},Symbol.toStringTag,{value:"Module"}));function Jo(){try{console.log("Language:",localStorage.getItem("aethera_language")||"id"),console.log("Has id.json:",!!($&&Object.keys($.id||{}).length)),console.log("Has en.json:",!!($&&Object.keys($.en||{}).length)),console.log("Sample t(light_mode_active):",l("light_mode_active"))}catch{}}document.addEventListener("DOMContentLoaded",async()=>{lt(),await Qt(),Jo(),oo(),lo(),dt(),await A.init(),_n(),Ue(localStorage.getItem("aethera_theme")||"dark");const t=localStorage.getItem("aethera_language")||"id";await Tt(t),Ro(),rn(),cn(),za(),G("generator"),Xe(localStorage.getItem("currentMode")||"single");try{Z(),Q()}catch(p){console.warn("Failed to populate selectors on startup:",p.message)}Ga();const e=localStorage.getItem("aethera_theme")||"dark";document.getElementById("theme-icon-sun").classList.toggle("hidden",e==="dark"),document.getElementById("theme-icon-moon").classList.toggle("hidden",e==="light"),document.getElementById("main-content").addEventListener("click",p=>{const f=p.target.closest(".result-card");if(f){if(p.target.closest(".prompt-copy-btn")){const k=p.target.closest(".prompt-copy-btn"),E=k.dataset.prompt.replace(/<\/?char-desc>/gi,"");F(!0,k);try{Se(E,k)}finally{setTimeout(()=>{F(!1,k)},500)}return}if(p.target.closest(".generate-assets-btn")){nn(f);return}}const S=p.target.closest(".history-entry");S&&(p.target.closest(".delete-history-btn")&&te(l("confirm_delete_entry")||"Apakah Anda yakin ingin menghapus entri ini?",async()=>{await Ne(S.dataset.entryId),b(l("history_entry_deleted")||"Entri riwayat berhasil dihapus.","success")}),p.target.closest(".history-checkbox")&&(wt(),ka()))}),u.generateBtn.addEventListener("click",()=>{Ha(),en()}),document.getElementById("product-category").addEventListener("change",Oe),document.getElementById("character-mode").addEventListener("change",Lt),u.personaSelector.addEventListener("change",()=>{const p=u.personaSelector.value,f=document.getElementById("persona-description-display");if(!p){f.classList.add("hidden"),f.textContent="";return}const k=(JSON.parse(localStorage.getItem("aethera_personas"))||[]).find(x=>x.id===p);k?(f.textContent=`${l("description_label")}: "${k.description}"`,f.classList.remove("hidden")):f.classList.add("hidden")}),document.getElementById("dynamic-character-sheet-area").addEventListener("click",p=>{if(p.target.closest("#save-character-preset-btn")&&Ja(),p.target.closest("#add-character-btn")){const f=p.currentTarget,S=f.querySelectorAll(".character-sheet-instance").length,k=je(S);f.insertBefore(k,p.target.closest("#add-character-btn")),Oe()}p.target.closest(".remove-character-btn")&&(p.target.closest(".character-sheet-instance").remove(),document.querySelectorAll(".character-sheet-instance .character-title").forEach((f,S)=>{f.textContent=l("character_number",{number:S+1})}))}),u.settingsPresetSelector.addEventListener("change",qa),u.savePresetBtn.addEventListener("click",Ra),u.managePresetsBtn.addEventListener("click",ja),document.getElementById("character-preset-selector").addEventListener("change",Mt),u.manageCharacterPresetsBtn.addEventListener("click",Va);const a=document.getElementById("manage-presets-modal");document.getElementById("close-manage-presets-modal-btn").addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>D);return{setLoadingState:S}},void 0),f=document.getElementById("close-manage-presets-modal-btn");p(!0,f);try{$e()}finally{p(!1,f)}}),a.addEventListener("click",p=>p.target===a&&$e()),document.getElementById("preset-list-container").addEventListener("click",Ua);const n=document.getElementById("manage-character-presets-modal");document.getElementById("close-manage-character-presets-modal-btn").addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:S}=await Promise.resolve().then(()=>D);return{setLoadingState:S}},void 0),f=document.getElementById("close-manage-character-presets-modal-btn");p(!0,f);try{Me()}finally{p(!1,f)}}),n.addEventListener("click",p=>p.target===n&&Me()),document.getElementById("character-preset-list-container").addEventListener("click",Ka),document.getElementById("cancel-revision-btn").addEventListener("click",oe),document.getElementById("regenerate-again-btn").addEventListener("click",()=>{const p=document.getElementById("revision-instruction-stage2").value;document.getElementById("revision-instruction").value=p,it()}),document.getElementById("apply-changes-btn").addEventListener("click",async()=>{var O,T,N;const p=localStorage.getItem("cardBeingEditedId"),f=document.getElementById(p);if(!f){oe();return}const{setLoadingState:S}=await w(async()=>{const{setLoadingState:I}=await Promise.resolve().then(()=>D);return{setLoadingState:I}},void 0),k=document.getElementById("apply-changes-btn");S(!0,k);const x=JSON.parse(f.dataset.script);let E={...x};if(W){E={...E,...W};try{const I=[];if(typeof((O=W.hook)==null?void 0:O.text)=="string"&&I.push("hook"),typeof((T=W.body)==null?void 0:T.text)=="string"&&I.push("body"),typeof((N=W.cta)==null?void 0:N.text)=="string"&&I.push("cta"),I.length>0){const{regenerateVisualPrompts:L}=await w(async()=>{const{regenerateVisualPrompts:R}=await Promise.resolve().then(()=>Le);return{regenerateVisualPrompts:R}},void 0);for(const R of I){const Y=E[R].text,V=await L(E,R,Y);Array.isArray(V)&&V.length&&(E[R].shots=V)}}}catch{}}const{updateCardContent:M,initSwiper:B}=await w(async()=>{const{updateCardContent:I,initSwiper:L}=await Promise.resolve().then(()=>Ft);return{updateCardContent:I,initSwiper:L}},void 0);M(f,E),at(E);try{const{openScriptViewer:I}=await w(async()=>{const{openScriptViewer:L}=await Promise.resolve().then(()=>Le);return{openScriptViewer:L}},void 0);await I(f,E)}catch{}const{showActionNotification:P}=await w(async()=>{const{showActionNotification:I}=await Promise.resolve().then(()=>D);return{showActionNotification:I}},void 0);P(l("notification_script_updated")||"Skrip berhasil diperbarui!",l("undo_button")||"Urungkan",async()=>{M(f,x),at(x);try{const{openScriptViewer:I}=await w(async()=>{const{openScriptViewer:L}=await Promise.resolve().then(()=>Le);return{openScriptViewer:L}},void 0);await I(f,x)}catch{}},"success"),oe(),S(!1,k)}),u.loginBtn.addEventListener("click",We),document.getElementById("login-password").addEventListener("keyup",p=>p.key==="Enter"&&We()),document.getElementById("login-email").addEventListener("keyup",p=>p.key==="Enter"&&We()),u.logoutBtn.addEventListener("click",Jt),u.mobileLogoutBtn.addEventListener("click",Jt),u.navGenerator.addEventListener("click",p=>{p.preventDefault(),G("generator")}),u.navHistory.addEventListener("click",async p=>{p.preventDefault();const{loadHistory:f}=await w(async()=>{const{loadHistory:S}=await Promise.resolve().then(()=>ze);return{loadHistory:S}},void 0);await f(),G("history")}),u.navSettings.addEventListener("click",p=>{p.preventDefault(),G("settings")}),u.mobileMenuButton.addEventListener("click",Ie),u.mobileNavGenerator.addEventListener("click",p=>{p.preventDefault(),G("generator"),Ie()}),u.mobileNavHistory.addEventListener("click",async p=>{p.preventDefault();const{loadHistory:f}=await w(async()=>{const{loadHistory:S}=await Promise.resolve().then(()=>ze);return{loadHistory:S}},void 0);await f(),G("history"),Ie()}),u.mobileNavSettings.addEventListener("click",p=>{p.preventDefault(),G("settings"),Ie()}),u.apiKeyModal.saveBtn.addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:f}=await Promise.resolve().then(()=>D);return{setLoadingState:f}},void 0);p(u.apiKeyModal.saveBtn,!0);try{await Na()}finally{p(u.apiKeyModal.saveBtn,!1)}}),u.modeSingleBtn.addEventListener("click",()=>Xe("single")),u.modeCarouselBtn.addEventListener("click",()=>Xe("carousel")),document.querySelectorAll(".platform-select").forEach(p=>{p.addEventListener("click",()=>{const f=p.dataset.platform;localStorage.setItem("targetPlatform",f),b(`${l("target_platform_label")||"Target Platform"}: ${f}`,"success")})}),u.strategyDefaultBtn.addEventListener("click",()=>Ze("default")),u.strategyFacelessBtn.addEventListener("click",()=>Ze("faceless")),u.strategyCharacterBtn.addEventListener("click",()=>Ze("character")),u.ratio916Btn.addEventListener("click",()=>Qe("9:16")),u.ratio11Btn.addEventListener("click",()=>Qe("1:1")),u.ratio169Btn.addEventListener("click",()=>Qe("16:9")),u.inputs.productImage.addEventListener("change",Qa),u.removeImageBtn.addEventListener("click",qt),u.editModal.closeBtn.addEventListener("click",oe),u.editModal.regenerateBtn.addEventListener("click",it),u.editModal.el.addEventListener("click",p=>p.target===u.editModal.el&&oe());try{const{translateUI:p}=await w(async()=>{const{translateUI:f}=await Promise.resolve().then(()=>Ft);return{translateUI:f}},void 0);p()}catch{}const o=document.getElementById("results-container");o&&o.children.length===0&&(o.innerHTML=`<div class="text-center text-gray-500 py-8">${l("empty_results_prompt")||"Belum ada hasil. Isi detail produk dan klik Generate untuk memulai."}</div>`);const s=document.getElementById("history-panel");s&&s.children.length===0&&(s.innerHTML=`<div class="text-center text-gray-500 py-8">${l("empty_history_prompt")||"Belum ada riwayat. Hasil skrip Anda akan tampil di sini."}</div>`),u.downloadAllContainer.addEventListener("click",p=>{p.target.classList.contains("download-all-btn")&&kn(p.target.dataset.format)}),u.saveSettingsBtn.addEventListener("click",$a),u.personaModal.addBtn.addEventListener("click",()=>Ut()),u.personaModal.closeBtn.addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:f}=await Promise.resolve().then(()=>D);return{setLoadingState:f}},void 0);p(!0,u.personaModal.closeBtn);try{Ea()}finally{p(!1,u.personaModal.closeBtn)}}),u.personaModal.saveBtn.addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:f}=await Promise.resolve().then(()=>D);return{setLoadingState:f}},void 0);p(!0,u.personaModal.saveBtn);try{await $n()}finally{p(!1,u.personaModal.saveBtn)}}),u.personaModal.listContainer.addEventListener("click",p=>{const f=p.target.closest(".edit-persona-btn");if(f){const x=(JSON.parse(localStorage.getItem("aethera_personas"))||[]).find(E=>E.id===f.dataset.id);x&&Ut(x)}const S=p.target.closest(".delete-persona-btn");S&&Mn(S.dataset.id)}),u.personaModal.defaultContainer.addEventListener("click",p=>{if(p.target.closest(".add-default-persona-btn")){const f=p.target.closest(".add-default-persona-btn");Rn(f.dataset.name,f.dataset.desc)}}),u.confirmModal.cancelBtn.addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:f}=await Promise.resolve().then(()=>D);return{setLoadingState:f}},void 0);p(!0,u.confirmModal.cancelBtn);try{Ae()}finally{p(!1,u.confirmModal.cancelBtn)}}),u.confirmModal.el.addEventListener("click",p=>p.target===u.confirmModal.el&&Ae()),u.confirmModal.confirmBtn.addEventListener("click",async()=>{const{setLoadingState:p}=await w(async()=>{const{setLoadingState:f}=await Promise.resolve().then(()=>D);return{setLoadingState:f}},void 0);p(!0,u.confirmModal.confirmBtn);try{typeof ve=="function"&&await ve(),Ae()}finally{p(!1,u.confirmModal.confirmBtn)}}),document.getElementById("theme-toggle-btn").addEventListener("click",()=>{const f=(localStorage.getItem("aethera_theme")||"dark")==="dark"?"light":"dark";st(f)}),u.langIdBtn.addEventListener("click",async()=>await ye("id")),u.langEnBtn.addEventListener("click",async()=>await ye("en"));const i=document.getElementById("mobile-theme-toggle-btn");i&&i.addEventListener("click",()=>{const f=(localStorage.getItem("aethera_theme")||"dark")==="dark"?"light":"dark";st(f)}),u.mobileLangIdBtn&&u.mobileLangIdBtn.addEventListener("click",async()=>await ye("id")),u.mobileLangEnBtn&&u.mobileLangEnBtn.addEventListener("click",async()=>await ye("en"));const r=document.getElementById("delete-all-btn");r&&r.addEventListener("click",async()=>{te(l("confirm_delete_all"),async()=>{var f;const{deleteAllHistory:p}=await w(async()=>{const{deleteAllHistory:S}=await Promise.resolve().then(()=>ze);return{deleteAllHistory:S}},void 0);await p(),b(l("history_deleted_all"),"success"),(f=document.getElementById("delete-selected-btn"))==null||f.classList.add("hidden")})});const c=document.getElementById("delete-selected-btn");c&&c.addEventListener("click",()=>{const p=Array.from(document.querySelectorAll(".history-checkbox:checked")).map(f=>{var S;return(S=f.closest(".history-entry"))==null?void 0:S.dataset.entryId}).filter(Boolean);p.length!==0&&te(l("confirm_delete_selected").replace("{n}",p.length),async()=>{var f;await Ne(p),b(l("history_deleted_selected"),"success"),(f=document.getElementById("delete-selected-btn"))==null||f.classList.add("hidden")})});const d=document.getElementById("prev-page"),m=document.getElementById("next-page");d&&d.addEventListener("click",ba),m&&m.addEventListener("click",_a);const g=document.getElementById("history-search"),h=document.getElementById("history-sort"),y=document.getElementById("select-all-history");g&&g.addEventListener("input",p=>{kt(p.target.value)}),h&&h.addEventListener("change",p=>{Et(p.target.value)}),y&&y.addEventListener("change",p=>{va(p.target.checked)}),document.querySelectorAll(".post-type-tab").forEach(p=>{p.addEventListener("click",()=>{const f=p.dataset.filter;It(f)})});const _=document.getElementById("group-by-product");_&&_.addEventListener("change",Sa)});(function(){const t=document.querySelector("header.sticky");function e(){const r=(window.scrollY||document.documentElement.scrollTop)>8;t&&(t.classList.toggle("bg-gray-900/70",!r),t.classList.toggle("bg-gray-900/50",r),t.classList.toggle("backdrop-blur-sm",!r),t.classList.toggle("backdrop-blur-md",r),t.classList.toggle("shadow-sm",r))}window.addEventListener("scroll",e,{passive:!0}),e();function a(r){var c;r==null||r.classList.remove("opacity-0","pointer-events-none"),(c=r==null?void 0:r.querySelector(".modal-content"))==null||c.classList.remove("scale-95")}function n(r){var c;r==null||r.classList.add("opacity-0","pointer-events-none"),(c=r==null?void 0:r.querySelector(".modal-content"))==null||c.classList.add("scale-95")}const o=document.getElementById("about-modal"),s=document.getElementById("nav-about"),i=document.getElementById("mobile-nav-about");[s,i].forEach(r=>r&&r.addEventListener("click",c=>{c.preventDefault(),a(o)})),document.querySelectorAll(".about-close").forEach(r=>r.addEventListener("click",()=>n(o))),o&&o.addEventListener("click",r=>{r.target===o&&n(o)}),window.addEventListener("keydown",r=>{r.key==="Escape"&&n(o)})})();const et=document.getElementById("creative-freedom"),Yo=document.getElementById("freedom-value"),Kt=t=>{let e=l("freedom_balanced");t<=.3&&(e=l("freedom_very_obedient")),t>=.9&&(e=l("freedom_very_creative")),Yo.textContent=`${t} (${e})`};et&&(et.addEventListener("input",t=>{Kt(t.target.value)}),Kt(et.value));(function(){function t(s){var i;s==null||s.classList.remove("opacity-0","pointer-events-none"),(i=s==null?void 0:s.querySelector(".modal-content"))==null||i.classList.remove("scale-95")}function e(s){var i;s==null||s.classList.add("opacity-0","pointer-events-none"),(i=s==null?void 0:s.querySelector(".modal-content"))==null||i.classList.add("scale-95")}const a=document.getElementById("manual-modal"),n=document.getElementById("nav-manual"),o=document.getElementById("mobile-nav-manual");[n,o].forEach(s=>s&&s.addEventListener("click",i=>{i.preventDefault(),t(a)})),document.querySelectorAll(".manual-close").forEach(s=>s.addEventListener("click",()=>e(a))),a==null||a.addEventListener("click",s=>{s.target===a&&e(a)}),window.addEventListener("keydown",s=>{s.key==="Escape"&&e(a)})})();(function(){const t=document.querySelector("header.sticky");function e(){const a=window.scrollY||document.documentElement.scrollTop||0;t&&(a>8?t.classList.add("is-scrolled"):t.classList.remove("is-scrolled"))}window.addEventListener("scroll",e,{passive:!0}),e()})();try{w(()=>Promise.resolve().then(()=>Ht),void 0).then(t=>t.initResultsExportToolbar&&t.initResultsExportToolbar())}catch{}try{w(()=>Promise.resolve().then(()=>Fo),void 0).then(t=>t.initRankAll&&t.initRankAll())}catch{}let fe=1;const ln=5;function Vo(){localStorage.getItem("aethera_onboarding_completed")||Ko()}function Ko(){const t=document.getElementById("onboarding-overlay");t&&(t.classList.remove("hidden"),mt(1))}function zt(){const t=document.getElementById("onboarding-overlay");t&&(t.classList.add("hidden"),localStorage.setItem("aethera_onboarding_completed","true"))}function mt(t){fe=t,document.querySelectorAll(".onboarding-step").forEach(o=>{o.classList.add("hidden")});const e=document.querySelector(`[data-step="${t}"]`);e&&e.classList.remove("hidden"),document.querySelectorAll(".onboarding-dot").forEach((o,s)=>{s+1<=t?(o.classList.remove("bg-muted"),o.classList.add("bg-accent")):(o.classList.remove("bg-accent"),o.classList.add("bg-muted"))});const a=document.getElementById("onboarding-prev"),n=document.getElementById("onboarding-next");a&&a.classList.toggle("hidden",t===1),n&&(t===ln?n.textContent="Mulai Sekarang!":n.textContent="Selanjutnya")}const zo={"tiktok-viral":{name:"TikTok Viral 2025",settings:{hookType:"hook_future_pacing",ctaType:"cta_tiktok",targetAudience:"audience_young_pro",writingStyle:"style_storytelling",toneVibe:"tone_inspiring",duration:"15"}},"shopee-sales":{name:"Shopee Sales",settings:{hookType:"hook_negativity_bias",ctaType:"cta_shopee",targetAudience:"audience_general",writingStyle:"style_persuasive",toneVibe:"tone_urgent",duration:"30"}},"instagram-story":{name:"Instagram Story",settings:{hookType:"hook_question",ctaType:"cta_instagram",targetAudience:"audience_young_pro",writingStyle:"style_storytelling",toneVibe:"tone_inspiring",duration:"15"}},"youtube-review":{name:"YouTube Review",settings:{hookType:"hook_statistic",ctaType:"cta_youtube",targetAudience:"audience_gamers",writingStyle:"style_informative",toneVibe:"tone_professional",duration:"60"}}};function Wo(t){const e=zo[t];if(!e)return;const a=e.settings;function n(i,r){const c=document.getElementById(i);if(!c)return!1;const d=c.querySelector(`option[data-lang-key="${r}"]`);return d?(c.value=d.value||r,!0):!1}function o(i,r){const c=document.getElementById(i);return c?(c.value=r,!0):!1}a.hookType&&n("hook-type",a.hookType),a.ctaType&&n("cta-type",a.ctaType),a.targetAudience&&n("target-audience",a.targetAudience),a.writingStyle&&n("writing-style",a.writingStyle),a.toneVibe&&n("tone-vibe",a.toneVibe),a.duration&&o("script-duration",a.duration),typeof b=="function"&&b(l("template_applied_success",{name:e.name}),"success");const s=document.getElementById("product-name");s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus())}function Wt(){var e,a,n,o,s,i,r;const t={productName:((e=document.getElementById("product-name"))==null?void 0:e.value)||"",productDesc:((a=document.getElementById("product-desc"))==null?void 0:a.value)||"",hookType:((n=document.getElementById("hook-type"))==null?void 0:n.value)||"",ctaType:((o=document.getElementById("cta-type"))==null?void 0:o.value)||"",targetAudience:((s=document.getElementById("target-audience"))==null?void 0:s.value)||"",writingStyle:((i=document.getElementById("writing-style"))==null?void 0:i.value)||"",toneVibe:((r=document.getElementById("tone-vibe"))==null?void 0:r.value)||""};localStorage.setItem("aethera_form_autosave",JSON.stringify(t)),localStorage.setItem("aethera_form_last_modified",new Date().toISOString())}function Xo(){const t=localStorage.getItem("aethera_form_autosave");if(t)try{const e=JSON.parse(t);Object.keys(e).forEach(a=>{const n=document.getElementById(a.replace(/([A-Z])/g,"-$1").toLowerCase());n&&e[a]&&(n.value=e[a])})}catch(e){console.warn("Failed to load auto-saved form data:",e)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{Vo()},1e3);const t=document.getElementById("onboarding-next");t&&t.addEventListener("click",()=>{fe<ln?mt(fe+1):zt()});const e=document.getElementById("onboarding-prev");e&&e.addEventListener("click",()=>{fe>1&&mt(fe-1)});const a=document.getElementById("onboarding-skip");a&&a.addEventListener("click",()=>{zt()}),document.querySelectorAll(".quick-template-btn").forEach(o=>{o.addEventListener("click",()=>{const s=o.dataset.template;Wo(s),o.classList.add("pulse-glow"),setTimeout(()=>{o.classList.remove("pulse-glow")},1e3)})}),setTimeout(()=>{Xo()},500),["product-name","product-desc","hook-type","cta-type","target-audience","writing-style","tone-vibe"].forEach(o=>{const s=document.getElementById(o);s&&(s.addEventListener("input",Wt),s.addEventListener("change",Wt))})});
